
<!DOCTYPE html>


<html lang="pl" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Moduł: | Moduł: game_bot/default_configs/vBot_4.8/vBot &#8212; OTClientV8 Dev Docs 0.1.0 - dokumentacja</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=8aaba760" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=8aaba760" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=c0495948"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/translations.js?v=da4973ce"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'modules/structured/bot_tools/modul-game-bot-default-configs-vbot-4.8-vbot';</script>
    <link rel="icon" href="../../../_static/logo-light.svg"/>
    <link rel="index" title="Indeks" href="../../../genindex.html" />
    <link rel="search" title="Szukaj" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="pl"/>
  <meta name="docsearch:version" content="0.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo-light.svg" class="logo__image only-light" alt="OTClientV8 Dev Docs 0.1.0 - dokumentacja - Home"/>
    <img src="../../../_static/logo-light.svg" class="logo__image only-dark pst-js-only" alt="OTClientV8 Dev Docs 0.1.0 - dokumentacja - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Szukaj" aria-label="Szukaj" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Szukaj</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/lukaszj321/otcv8-dev" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Szukaj" aria-label="Szukaj" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Szukaj</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/lukaszj321/otcv8-dev" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Moduł: | Moduł: <code class="docutils literal notranslate"><span class="pre">game_bot/default_configs/vBot_4.8/vBot</span></code></span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="modul-modul-game-bot-default-configs-vbot-4-8-vbot">
<h1>Moduł: | Moduł: <code class="docutils literal notranslate"><span class="pre">game_bot/default_configs/vBot_4.8/vBot</span></code><a class="headerlink" href="#modul-modul-game-bot-default-configs-vbot-4-8-vbot" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>

<span class="c1">-- locales</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;AttackBot&quot;</span>

<span class="kd">local</span> <span class="n">currentSettings</span>

<span class="kd">local</span> <span class="n">showSettings</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kd">local</span> <span class="n">showItem</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kd">local</span> <span class="n">category</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kd">local</span> <span class="n">patternCategory</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kd">local</span> <span class="n">pattern</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kd">local</span> <span class="n">mainWindow</span>

<span class="c1">-- label library</span>

<span class="kd">local</span> <span class="n">categories</span> <span class="o">=</span> <span class="p">{</span>

  <span class="s2">&quot;Targeted Spell (exori hur, exori flam, etc)&quot;</span><span class="p">,</span>

  <span class="s2">&quot;Area Rune (avalanche, great fireball, etc)&quot;</span><span class="p">,</span>

  <span class="s2">&quot;Targeted Rune (sudden death, icycle, etc)&quot;</span><span class="p">,</span>

  <span class="s2">&quot;Empowerment (utito tempo, etc)&quot;</span><span class="p">,</span>

  <span class="s2">&quot;Absolute Spell (exori, hells core, etc)&quot;</span><span class="p">,</span>

<span class="p">}</span>

<span class="kd">local</span> <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">-- targeted spells</span>

<span class="p">{</span>

    <span class="s2">&quot;1 Sqm Range (exori ico)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;2 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;3 Sqm Range (strike spells)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;4 Sqm Range (exori san)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;5 Sqm Range (exori hur)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;6 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;7 Sqm Range (exori con)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;8 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;9 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;10 Sqm Range&quot;</span>

<span class="p">},</span>

  <span class="c1">-- area runes</span>

<span class="p">{</span>

    <span class="s2">&quot;Cross (explosion)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Bomb (fire bomb)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Ball (gfb, avalanche)&quot;</span>

<span class="p">},</span>

  <span class="c1">-- empowerment/targeted rune</span>

<span class="p">{</span>

    <span class="s2">&quot;1 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;2 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;3 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;4 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;5 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;6 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;7 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;8 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;9 Sqm Range&quot;</span><span class="p">,</span>

    <span class="s2">&quot;10 Sqm Range&quot;</span><span class="p">,</span>

<span class="p">},</span>

  <span class="c1">-- absolute</span>

<span class="p">{</span>

    <span class="s2">&quot;Adjacent (exori, exori gran)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;3x3 Wave (vis hur, tera hur)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Small Area (mas san, exori mas)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Medium Area (mas flam, mas frigo)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Large Area (mas vis, mas tera)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Short Beam (vis lux)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Large Beam (gran vis lux)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Sweep (exori min)&quot;</span><span class="p">,</span> <span class="c1">-- 8</span>

    <span class="s2">&quot;Small Wave (gran frigo hur)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Big Wave (flam hur, frigo hur)&quot;</span><span class="p">,</span>

    <span class="s2">&quot;Huge Wave (gran flam hur)&quot;</span><span class="p">,</span>

<span class="p">}</span>

<span class="p">}</span>

  <span class="c1">-- spellPatterns[category][pattern][1 - normal, 2 - safe]</span>

<span class="kd">local</span> <span class="n">spellPatterns</span> <span class="o">=</span> <span class="p">{</span>

  <span class="p">{},</span> <span class="c1">-- blank, wont be used</span>

  <span class="c1">-- Area Runes,</span>

<span class="p">{</span>

    <span class="p">{</span>     <span class="c1">-- cross</span>

<span class="s">[[</span>

<span class="s">      010</span>

<span class="s">      111</span>

<span class="s">      010</span>

<span class="s">     ]]</span><span class="p">,</span>

     <span class="c1">-- cross SAFE</span>

<span class="s">[[</span>

<span class="s">       01110</span>

<span class="s">       01110</span>

<span class="s">       11111</span>

<span class="s">       11111</span>

<span class="s">       11111</span>

<span class="s">       01110</span>

<span class="s">       01110</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- bomb</span>

<span class="s">[[</span>

<span class="s">        111</span>

<span class="s">        111</span>

<span class="s">        111</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- bomb SAFE</span>

<span class="s">[[</span>

<span class="s">        11111</span>

<span class="s">        11111</span>

<span class="s">        11111</span>

<span class="s">        11111</span>

<span class="s">        11111</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- ball</span>

<span class="s">[[</span>

<span class="s">        0011100</span>

<span class="s">        0111110</span>

<span class="s">        1111111</span>

<span class="s">        1111111</span>

<span class="s">        1111111</span>

<span class="s">        0111110</span>

<span class="s">        0011100</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- ball SAFE</span>

<span class="s">[[</span>

<span class="s">        000111000</span>

<span class="s">        001111100</span>

<span class="s">        011111110</span>

<span class="s">        111111111</span>

<span class="s">        111111111</span>

<span class="s">        111111111</span>

<span class="s">        011111110</span>

<span class="s">        001111100</span>

<span class="s">        000111000</span>

<span class="s">]]</span>

<span class="p">},</span>

<span class="p">},</span>

  <span class="p">{},</span> <span class="c1">-- blank, wont be used</span>

  <span class="c1">-- Absolute</span>

<span class="p">{</span>

    <span class="p">{</span><span class="c1">-- adjacent</span>

<span class="s">[[</span>

<span class="s">        111</span>

<span class="s">        111</span>

<span class="s">        111</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- adjacent SAFE</span>

<span class="s">[[</span>

<span class="s">        11111</span>

<span class="s">        11111</span>

<span class="s">        11111</span>

<span class="s">        11111</span>

<span class="s">        11111</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- 3x3 Wave</span>

<span class="s">[[</span>

<span class="s">        0000NNN0000</span>

<span class="s">        0000NNN0000</span>

<span class="s">        0000NNN0000</span>

<span class="s">        00000N00000</span>

<span class="s">        WWW00N00EEE</span>

<span class="s">        WWWWW0EEEEE</span>

<span class="s">        WWW00S00EEE</span>

<span class="s">        00000S00000</span>

<span class="s">        0000SSS0000</span>

<span class="s">        0000SSS0000</span>

<span class="s">        0000SSS0000</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- 3x3 Wave SAFE</span>

<span class="s">[[</span>

<span class="s">        0000NNNNN0000</span>

<span class="s">        0000NNNNN0000</span>

<span class="s">        0000NNNNN0000</span>

<span class="s">        0000NNNNN0000</span>

<span class="s">        WWWW0NNN0EEEE</span>

<span class="s">        WWWWWNNNEEEEE</span>

<span class="s">        WWWWWW0EEEEEE</span>

<span class="s">        WWWWWSSSEEEEE</span>

<span class="s">        WWWW0SSS0EEEE</span>

<span class="s">        0000SSSSS0000</span>

<span class="s">        0000SSSSS0000</span>

<span class="s">        0000SSSSS0000</span>

<span class="s">        0000SSSSS0000</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- small area</span>

<span class="s">[[</span>

<span class="s">        0011100</span>

<span class="s">        0111110</span>

<span class="s">        1111111</span>

<span class="s">        1111111</span>

<span class="s">        1111111</span>

<span class="s">        0111110</span>

<span class="s">        0011100</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- small area SAFE</span>

<span class="s">[[</span>

<span class="s">        000111000</span>

<span class="s">        001111100</span>

<span class="s">        011111110</span>

<span class="s">        111111111</span>

<span class="s">        111111111</span>

<span class="s">        111111111</span>

<span class="s">        011111110</span>

<span class="s">        001111100</span>

<span class="s">        000111000</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- medium area</span>

<span class="s">[[</span>

<span class="s">        00000100000</span>

<span class="s">        00011111000</span>

<span class="s">        00111111100</span>

<span class="s">        01111111110</span>

<span class="s">        01111111110</span>

<span class="s">        11111111111</span>

<span class="s">        01111111110</span>

<span class="s">        01111111110</span>

<span class="s">        00111111100</span>

<span class="s">        00001110000</span>

<span class="s">        00000100000</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- medium area SAFE</span>

<span class="s">[[</span>

<span class="s">        0000011100000</span>

<span class="s">        0000111110000</span>

<span class="s">        0001111111000</span>

<span class="s">        0011111111100</span>

<span class="s">        0111111111110</span>

<span class="s">        0111111111110</span>

<span class="s">        1111111111111</span>

<span class="s">        0111111111110</span>

<span class="s">        0111111111110</span>

<span class="s">        0011111111100</span>

<span class="s">        0001111111000</span>

<span class="s">        0000111110000</span>

<span class="s">        0000011100000</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- large area</span>

<span class="s">[[</span>

<span class="s">        0000001000000</span>

<span class="s">        0000011100000</span>

<span class="s">        0000111110000</span>

<span class="s">        0001111111000</span>

<span class="s">        0011111111100</span>

<span class="s">        0111111111110</span>

<span class="s">        1111111111111</span>

<span class="s">        0111111111110</span>

<span class="s">        0011111111100</span>

<span class="s">        0001111111000</span>

<span class="s">        0000111110000</span>

<span class="s">        0000011100000</span>

<span class="s">        0000001000000</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- large area SAFE</span>

<span class="s">[[</span>

<span class="s">        000000010000000</span>

<span class="s">        000000111000000</span>

<span class="s">        000001111100000</span>

<span class="s">        000011111110000</span>

<span class="s">        000111111111000</span>

<span class="s">        001111111111100</span>

<span class="s">        011111111111110</span>

<span class="s">        111111111111111</span>

<span class="s">        011111111111110</span>

<span class="s">        001111111111100</span>

<span class="s">        000111111111000</span>

<span class="s">        000011111110000</span>

<span class="s">        000001111100000</span>

<span class="s">        000000111000000</span>

<span class="s">        000000010000000</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- short beam</span>

<span class="s">[[</span>

<span class="s">        00000N00000</span>

<span class="s">        00000N00000</span>

<span class="s">        00000N00000</span>

<span class="s">        00000N00000</span>

<span class="s">        00000N00000</span>

<span class="s">        WWWWW0EEEEE</span>

<span class="s">        00000S00000</span>

<span class="s">        00000S00000</span>

<span class="s">        00000S00000</span>

<span class="s">        00000S00000</span>

<span class="s">        00000S00000</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- short beam SAFE</span>

<span class="s">[[</span>

<span class="s">        00000NNN00000</span>

<span class="s">        00000NNN00000</span>

<span class="s">        00000NNN00000</span>

<span class="s">        00000NNN00000</span>

<span class="s">        00000NNN00000</span>

<span class="s">        WWWWWNNNEEEEE</span>

<span class="s">        WWWWWW0EEEEEE</span>

<span class="s">        00000SSS00000</span>

<span class="s">        00000SSS00000</span>

<span class="s">        00000SSS00000</span>

<span class="s">        00000SSS00000</span>

<span class="s">        00000SSS00000</span>

<span class="s">        00000SSS00000</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- large beam</span>

<span class="s">[[</span>

<span class="s">        0000000N0000000</span>

<span class="s">        0000000N0000000</span>

<span class="s">        0000000N0000000</span>

<span class="s">        0000000N0000000</span>

<span class="s">        0000000N0000000</span>

<span class="s">        0000000N0000000</span>

<span class="s">        0000000N0000000</span>

<span class="s">        WWWWWWW0EEEEEEE</span>

<span class="s">        0000000S0000000</span>

<span class="s">        0000000S0000000</span>

<span class="s">        0000000S0000000</span>

<span class="s">        0000000S0000000</span>

<span class="s">        0000000S0000000</span>

<span class="s">        0000000S0000000</span>

<span class="s">        0000000S0000000</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- large beam SAFE</span>

<span class="s">[[</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        WWWWWWWNNNEEEEEEE</span>

<span class="s">        WWWWWWWW0EEEEEEEE</span>

<span class="s">        WWWWWWWSSSEEEEEEE</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">      ]]</span><span class="p">,</span>

<span class="p">},</span>

    <span class="p">{},</span> <span class="c1">-- sweep, wont be used</span>

    <span class="p">{</span> <span class="c1">-- small wave</span>

<span class="s">[[</span>

<span class="s">        00NNN00</span>

<span class="s">        00NNN00</span>

<span class="s">        WW0N0EE</span>

<span class="s">        WWW0EEE</span>

<span class="s">        WW0S0EE</span>

<span class="s">        00SSS00</span>

<span class="s">        00SSS00</span>

<span class="s">      ]]</span><span class="p">,</span>

      <span class="c1">-- small wave SAFE</span>

<span class="s">[[</span>

<span class="s">        00NNNNN00</span>

<span class="s">        00NNNNN00</span>

<span class="s">        WWNNNNNEE</span>

<span class="s">        WWWWNEEEE</span>

<span class="s">        WWWW0EEEE</span>

<span class="s">        WWWWSEEEE</span>

<span class="s">        WWSSSSSEE</span>

<span class="s">        00SSSSS00</span>

<span class="s">        00SSSSS00</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- large wave</span>

<span class="s">[[</span>

<span class="s">        000NNNNN000</span>

<span class="s">        000NNNNN000</span>

<span class="s">        0000NNN0000</span>

<span class="s">        WW00NNN00EE</span>

<span class="s">        WWWW0N0EEEE</span>

<span class="s">        WWWWW0EEEEE</span>

<span class="s">        WWWW0S0EEEE</span>

<span class="s">        WW00SSS00EE</span>

<span class="s">        0000SSS0000</span>

<span class="s">        000SSSSS000</span>

<span class="s">        000SSSSS000</span>

<span class="s">      ]]</span><span class="p">,</span>

<span class="s">[[</span>

<span class="s">        000NNNNNNN000</span>

<span class="s">        000NNNNNNN000</span>

<span class="s">        000NNNNNNN000</span>

<span class="s">        WWWWNNNNNEEEE</span>

<span class="s">        WWWWNNNNNEEEE</span>

<span class="s">        WWWWWNNNEEEEE</span>

<span class="s">        WWWWWW0EEEEEE</span>

<span class="s">        WWWWWSSSEEEEE</span>

<span class="s">        WWWWSSSSSEEEE</span>

<span class="s">        WWWWSSSSSEEEE</span>

<span class="s">        000SSSSSSS000</span>

<span class="s">        000SSSSSSS000</span>

<span class="s">        000SSSSSSS000</span>

<span class="s">]]</span>

<span class="p">},</span>

    <span class="p">{</span> <span class="c1">-- huge wave</span>

<span class="s">[[</span>

<span class="s">        0000NNNNN0000</span>

<span class="s">        0000NNNNN0000</span>

<span class="s">        00000NNN00000</span>

<span class="s">        00000NNN00000</span>

<span class="s">        WW0000N0000EE</span>

<span class="s">        WWWW00N00EEEE</span>

<span class="s">        WWWWWW0EEEEEE</span>

<span class="s">        WWWW00S00EEEE</span>

<span class="s">        WW0000S0000EE</span>

<span class="s">        00000SSS00000</span>

<span class="s">        00000SSS00000</span>

<span class="s">        0000SSSSS0000</span>

<span class="s">        0000SSSSS0000</span>

<span class="s">      ]]</span><span class="p">,</span>

<span class="s">[[</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        0000000NNN0000000</span>

<span class="s">        WWWWWWWNNNEEEEEEE</span>

<span class="s">        WWWWWWWW0EEEEEEEE</span>

<span class="s">        WWWWWWWSSSEEEEEEE</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">        0000000SSS0000000</span>

<span class="s">]]</span>

<span class="p">}</span>

<span class="p">}</span>

<span class="p">}</span>

<span class="c1">-- direction patterns</span>

<span class="kd">local</span> <span class="n">ek</span> <span class="o">=</span> <span class="p">(</span><span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">true</span>

<span class="kd">local</span> <span class="n">posN</span> <span class="o">=</span> <span class="n">ek</span> <span class="ow">and</span> <span class="s">[[</span>

<span class="s">  111</span>

<span class="s">  000</span>

<span class="s">  000</span>

<span class="s">]]</span> <span class="ow">or</span> <span class="s">[[</span>

<span class="s">  00011111000</span>

<span class="s">  00011111000</span>

<span class="s">  00011111000</span>

<span class="s">  00011111000</span>

<span class="s">  00000100000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">]]</span>

<span class="kd">local</span> <span class="n">posE</span> <span class="o">=</span> <span class="n">ek</span> <span class="ow">and</span> <span class="s">[[</span>

<span class="s">  001</span>

<span class="s">  001</span>

<span class="s">  001</span>

<span class="s">]]</span> <span class="ow">or</span>   <span class="s">[[</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000001111</span>

<span class="s">  00000001111</span>

<span class="s">  00000011111</span>

<span class="s">  00000001111</span>

<span class="s">  00000001111</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">]]</span>

<span class="kd">local</span> <span class="n">posS</span> <span class="o">=</span> <span class="n">ek</span> <span class="ow">and</span> <span class="s">[[</span>

<span class="s">  000</span>

<span class="s">  000</span>

<span class="s">  111</span>

<span class="s">]]</span> <span class="ow">or</span>   <span class="s">[[</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000100000</span>

<span class="s">  00011111000</span>

<span class="s">  00011111000</span>

<span class="s">  00011111000</span>

<span class="s">  00011111000</span>

<span class="s">]]</span>

<span class="kd">local</span> <span class="n">posW</span> <span class="o">=</span> <span class="n">ek</span> <span class="ow">and</span> <span class="s">[[</span>

<span class="s">  100</span>

<span class="s">  100</span>

<span class="s">  100</span>

<span class="s">]]</span> <span class="ow">or</span>   <span class="s">[[</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  11110000000</span>

<span class="s">  11110000000</span>

<span class="s">  11111000000</span>

<span class="s">  11110000000</span>

<span class="s">  11110000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">  00000000000</span>

<span class="s">]]</span>

<span class="c1">-- AttackBotConfig</span>

<span class="c1">-- create blank profiles</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">AttackBotConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">AttackBotConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="o">#</span><span class="n">AttackBotConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">~=</span> <span class="mi">5</span> <span class="kr">then</span>

  <span class="n">AttackBotConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">attackTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">ignoreMana</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Kills</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">Rotate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #1&quot;</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">pvpMode</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">KillsAmount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

      <span class="n">PvpSafe</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">BlackListSafe</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">AntiRsRange</span> <span class="o">=</span> <span class="mi">5</span>

<span class="p">},</span>

    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">attackTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">ignoreMana</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Kills</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">Rotate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #2&quot;</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">pvpMode</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">KillsAmount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

      <span class="n">PvpSafe</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">BlackListSafe</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">AntiRsRange</span> <span class="o">=</span> <span class="mi">5</span>

<span class="p">},</span>

    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">attackTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">ignoreMana</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Kills</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">Rotate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #3&quot;</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">pvpMode</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">KillsAmount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

      <span class="n">PvpSafe</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">BlackListSafe</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">AntiRsRange</span> <span class="o">=</span> <span class="mi">5</span>

<span class="p">},</span>

    <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">attackTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">ignoreMana</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Kills</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">Rotate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #4&quot;</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">pvpMode</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">KillsAmount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

      <span class="n">PvpSafe</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">BlackListSafe</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">AntiRsRange</span> <span class="o">=</span> <span class="mi">5</span>

<span class="p">},</span>

    <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">attackTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">ignoreMana</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Kills</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">Rotate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #5&quot;</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">pvpMode</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">KillsAmount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

      <span class="n">PvpSafe</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">BlackListSafe</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">AntiRsRange</span> <span class="o">=</span> <span class="mi">5</span>

<span class="p">},</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span> <span class="ow">or</span> <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="kr">then</span>

  <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kr">end</span>

<span class="c1">-- create panel UI</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AttackBotBotPanel&quot;</span><span class="p">)</span>

<span class="c1">-- finding correct table, manual unfortunately</span>

<span class="kd">local</span> <span class="n">setActiveProfile</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span>

  <span class="n">currentSettings</span> <span class="o">=</span> <span class="n">AttackBotConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>

<span class="kr">end</span>

<span class="n">setActiveProfile</span><span class="p">()</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">AntiRsRange</span> <span class="kr">then</span>

  <span class="n">currentSettings</span><span class="p">.</span><span class="n">AntiRsRange</span> <span class="o">=</span> <span class="mi">5</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">setProfileName</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">ui</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- small UI elements</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

  <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;atk&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">ui</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">mainWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="n">mainWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

  <span class="n">mainWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

  <span class="n">mainWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s2">&quot;AttackBotWindow&quot;</span><span class="p">)</span>

  <span class="n">mainWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">.</span><span class="n">mainPanel</span>

  <span class="kd">local</span> <span class="n">settingsUI</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">.</span><span class="n">settingsPanel</span>

  <span class="n">mainWindow</span><span class="p">.</span><span class="n">onVisibilityChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">visible</span> <span class="kr">then</span>

      <span class="n">currentSettings</span><span class="p">.</span><span class="n">attackTable</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">attackTable</span><span class="p">,</span> <span class="n">child</span><span class="p">.</span><span class="n">params</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;atk&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="c1">-- main panel</span>

    <span class="c1">-- functions</span>

    <span class="kr">function</span> <span class="nf">toggleSettings</span><span class="p">()</span>

      <span class="n">panel</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="n">showSettings</span><span class="p">)</span>

      <span class="n">mainWindow</span><span class="p">.</span><span class="n">shooterLabel</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="n">showSettings</span><span class="p">)</span>

      <span class="n">settingsUI</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="n">showSettings</span><span class="p">)</span>

      <span class="n">mainWindow</span><span class="p">.</span><span class="n">settingsLabel</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="n">showSettings</span><span class="p">)</span>

      <span class="n">mainWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">showSettings</span> <span class="ow">and</span> <span class="s2">&quot;Back&quot;</span> <span class="ow">or</span> <span class="s2">&quot;Settings&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">toggleSettings</span><span class="p">()</span>

    <span class="n">mainWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">showSettings</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">showSettings</span>

      <span class="n">toggleSettings</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="kr">function</span> <span class="nf">toggleItem</span><span class="p">()</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">monsters</span><span class="p">:</span><span class="n">setWidth</span><span class="p">(</span><span class="n">showItem</span> <span class="ow">and</span> <span class="mi">405</span> <span class="ow">or</span> <span class="mi">341</span><span class="p">)</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">itemId</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="n">showItem</span><span class="p">)</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">spellName</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="n">showItem</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">toggleItem</span><span class="p">()</span>

    <span class="kr">function</span> <span class="nf">setCategoryText</span><span class="p">()</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">category</span><span class="p">.</span><span class="n">description</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">categories</span><span class="p">[</span><span class="n">category</span><span class="p">])</span>

    <span class="kr">end</span>

    <span class="n">setCategoryText</span><span class="p">()</span>

    <span class="kr">function</span> <span class="nf">setPatternText</span><span class="p">()</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">range</span><span class="p">.</span><span class="n">description</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="n">patternCategory</span><span class="p">][</span><span class="n">pattern</span><span class="p">])</span>

    <span class="kr">end</span>

    <span class="n">setPatternText</span><span class="p">()</span>

    <span class="c1">-- in/de/crementation buttons</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">previousCategory</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">category</span> <span class="o">=</span> <span class="o">#</span><span class="n">categories</span>

      <span class="kr">else</span>

        <span class="n">category</span> <span class="o">=</span> <span class="n">category</span> <span class="o">-</span> <span class="mi">1</span>

      <span class="kr">end</span>

      <span class="n">showItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">category</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">true</span> <span class="ow">or</span> <span class="kc">false</span>

      <span class="n">patternCategory</span> <span class="o">=</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">category</span>

      <span class="n">pattern</span> <span class="o">=</span> <span class="mi">1</span>

      <span class="n">toggleItem</span><span class="p">()</span>

      <span class="n">setPatternText</span><span class="p">()</span>

      <span class="n">setCategoryText</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">nextCategory</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">category</span> <span class="o">==</span> <span class="o">#</span><span class="n">categories</span> <span class="kr">then</span>

        <span class="n">category</span> <span class="o">=</span> <span class="mi">1</span>

      <span class="kr">else</span>

        <span class="n">category</span> <span class="o">=</span> <span class="n">category</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="kr">end</span>

      <span class="n">showItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">category</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">true</span> <span class="ow">or</span> <span class="kc">false</span>

      <span class="n">patternCategory</span> <span class="o">=</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">category</span>

      <span class="n">pattern</span> <span class="o">=</span> <span class="mi">1</span>

      <span class="n">toggleItem</span><span class="p">()</span>

      <span class="n">setPatternText</span><span class="p">()</span>

      <span class="n">setCategoryText</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">previousSource</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[AttackBot] TODO, reserved for future use.&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">nextSource</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[AttackBot] TODO, reserved for future use.&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">previousRange</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">[</span><span class="n">patternCategory</span><span class="p">]</span>

      <span class="kr">if</span> <span class="n">pattern</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="o">#</span><span class="n">t</span>

      <span class="kr">else</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span> <span class="o">-</span> <span class="mi">1</span>

      <span class="kr">end</span>

      <span class="n">setPatternText</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">nextRange</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">[</span><span class="n">patternCategory</span><span class="p">]</span>

      <span class="kr">if</span> <span class="n">pattern</span> <span class="o">==</span> <span class="o">#</span><span class="n">t</span> <span class="kr">then</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="mi">1</span>

      <span class="kr">else</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="kr">end</span>

      <span class="n">setPatternText</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="c1">-- eo in/de/crementation</span>

  <span class="c1">------- [[core table function]] -------</span>

    <span class="kr">function</span> <span class="nf">setupWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="kd">local</span> <span class="n">params</span> <span class="o">=</span> <span class="n">widget</span><span class="p">.</span><span class="n">params</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">params</span><span class="p">.</span><span class="n">itemId</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">spell</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">itemId</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">tooltip</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

      <span class="kr">end</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">params</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">params</span><span class="p">.</span><span class="n">enabled</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="c1">-- will serve as edit</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">manaPercent</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">mana</span><span class="p">)</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">creatures</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">count</span><span class="p">)</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">minHp</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">minHp</span><span class="p">)</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">maxHp</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">maxHp</span><span class="p">)</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">cooldown</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">cooldown</span><span class="p">)</span>

        <span class="n">showItem</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="n">itemId</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="kc">true</span> <span class="ow">or</span> <span class="kc">false</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">itemId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">itemId</span><span class="p">)</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">spellName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">spell</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">orMore</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">orMore</span><span class="p">)</span>

        <span class="n">toggleItem</span><span class="p">()</span>

        <span class="n">category</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="n">category</span>

        <span class="n">patternCategory</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="n">patternCategory</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="n">pattern</span>

        <span class="n">setPatternText</span><span class="p">()</span>

        <span class="n">setCategoryText</span><span class="p">()</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

      <span class="kr">end</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kr">if</span> <span class="o">#</span><span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildren</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

          <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

          <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

          <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

          <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span> <span class="o">==</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span> <span class="kr">then</span>

          <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

          <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

        <span class="kr">else</span>

          <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

          <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="c1">-- refreshing values</span>

    <span class="kr">function</span> <span class="nf">refreshAttacks</span><span class="p">()</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">attackTable</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">attackTable</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AttackEntry&quot;</span><span class="p">,</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">)</span>

        <span class="n">label</span><span class="p">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="n">setupWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">refreshAttacks</span><span class="p">()</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

    <span class="c1">-- adding values</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">addEntry</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">wdiget</span><span class="p">)</span>

      <span class="c1">-- first variables</span>

      <span class="kd">local</span> <span class="n">creatures</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">monsters</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">monsters</span> <span class="o">=</span> <span class="p">(</span><span class="n">creatures</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">creatures</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span> <span class="ow">or</span> <span class="n">creatures</span> <span class="o">==</span> <span class="s2">&quot;monster names&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">true</span> <span class="ow">or</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">creatures</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>

      <span class="kd">local</span> <span class="n">mana</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">manaPercent</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">count</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">creatures</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">minHp</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">minHp</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">maxHp</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">maxHp</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">cooldown</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">cooldown</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">itemId</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">itemId</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">spell</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">spellName</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">tooltip</span> <span class="o">=</span> <span class="n">monsters</span> <span class="o">~=</span> <span class="kc">true</span> <span class="ow">and</span> <span class="n">creatures</span>

      <span class="kd">local</span> <span class="n">orMore</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">orMore</span><span class="p">:</span><span class="n">isChecked</span><span class="p">()</span>

      <span class="c1">-- validation</span>

      <span class="kr">if</span> <span class="n">showItem</span> <span class="ow">and</span> <span class="n">itemId</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[AttackBot]: please fill item ID!&quot;</span><span class="p">)</span>

      <span class="kr">elseif</span> <span class="ow">not</span> <span class="n">showItem</span> <span class="ow">and</span> <span class="p">(</span><span class="n">spell</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;spell name&quot;</span> <span class="ow">or</span> <span class="n">spell</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[AttackBot]: please fill spell name!&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="kd">local</span> <span class="n">regex</span> <span class="o">=</span> <span class="n">patternCategory</span> <span class="o">~=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s">[[^[^\(]+]]</span> <span class="ow">or</span> <span class="s">[[^[^R]+]]</span>

      <span class="kd">local</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="n">patternCategory</span><span class="p">][</span><span class="n">pattern</span><span class="p">],</span> <span class="n">regex</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">trim</span><span class="p">()</span>

      <span class="n">regex</span> <span class="o">=</span> <span class="s">[[^[^ ]+]]</span>

      <span class="kd">local</span> <span class="n">categoryName</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">categories</span><span class="p">[</span><span class="n">category</span><span class="p">],</span> <span class="n">regex</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">trim</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">specificMonsters</span> <span class="o">=</span> <span class="n">monsters</span> <span class="o">==</span> <span class="kc">true</span> <span class="ow">and</span> <span class="s2">&quot;Any Creatures&quot;</span> <span class="ow">or</span> <span class="s2">&quot;Creatures&quot;</span>

      <span class="kd">local</span> <span class="n">attackType</span> <span class="o">=</span> <span class="n">showItem</span> <span class="ow">and</span> <span class="s2">&quot;rune &quot;</span><span class="o">..</span><span class="n">itemId</span> <span class="ow">or</span> <span class="n">spell</span>

      <span class="kd">local</span> <span class="n">countDescription</span> <span class="o">=</span> <span class="n">orMore</span> <span class="ow">and</span> <span class="n">count</span><span class="o">..</span><span class="s2">&quot;+&quot;</span> <span class="ow">or</span> <span class="n">count</span>

      <span class="kd">local</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">creatures</span> <span class="o">=</span> <span class="n">creatures</span><span class="p">,</span>

        <span class="n">monsters</span> <span class="o">=</span> <span class="n">monsters</span><span class="p">,</span>

        <span class="n">mana</span> <span class="o">=</span> <span class="n">mana</span><span class="p">,</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">,</span>

        <span class="n">minHp</span> <span class="o">=</span> <span class="n">minHp</span><span class="p">,</span>

        <span class="n">maxHp</span> <span class="o">=</span> <span class="n">maxHp</span><span class="p">,</span>

        <span class="n">cooldown</span> <span class="o">=</span> <span class="n">cooldown</span><span class="p">,</span>

        <span class="n">itemId</span> <span class="o">=</span> <span class="n">itemId</span><span class="p">,</span>

        <span class="n">spell</span> <span class="o">=</span> <span class="n">spell</span><span class="p">,</span>

        <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

        <span class="n">category</span> <span class="o">=</span> <span class="n">category</span><span class="p">,</span>

        <span class="n">patternCategory</span> <span class="o">=</span> <span class="n">patternCategory</span><span class="p">,</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">,</span>

        <span class="n">tooltip</span> <span class="o">=</span> <span class="n">tooltip</span><span class="p">,</span>

        <span class="n">orMore</span> <span class="o">=</span> <span class="n">orMore</span><span class="p">,</span>

        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">..</span><span class="nb">type</span><span class="o">..</span><span class="s1">&#39;] &#39;</span><span class="o">..</span><span class="n">countDescription</span><span class="o">..</span> <span class="s1">&#39; &#39;</span><span class="o">..</span><span class="n">specificMonsters</span><span class="o">..</span><span class="s1">&#39;: &#39;</span><span class="o">..</span><span class="n">attackType</span><span class="o">..</span><span class="s1">&#39;, &#39;</span><span class="o">..</span><span class="n">categoryName</span><span class="o">..</span><span class="s1">&#39; (&#39;</span><span class="o">..</span><span class="n">minHp</span><span class="o">..</span><span class="s1">&#39;%-&#39;</span><span class="o">..</span><span class="n">maxHp</span><span class="o">..</span><span class="s1">&#39;%)&#39;</span>

<span class="p">}</span>

      <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AttackEntry&quot;</span><span class="p">,</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">)</span>

      <span class="n">label</span><span class="p">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>

      <span class="n">setupWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

      <span class="n">resetFields</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="c1">-- moving values</span>

    <span class="c1">-- up</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="kd">local</span> <span class="n">focused</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">focused</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">focused</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">ensureChildVisible</span><span class="p">(</span><span class="n">focused</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="c1">-- down</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="kd">local</span> <span class="n">focused</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">focused</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">focused</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">ensureChildVisible</span><span class="p">(</span><span class="n">focused</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="c1">-- [[settings panel]] --</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">profileName</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">text</span>

    <span class="n">setProfileName</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">IgnoreMana</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">ignoreMana</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">ignoreMana</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">IgnoreMana</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">ignoreMana</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">Rotate</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Rotate</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Rotate</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Rotate</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Rotate</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">Kills</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Kills</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Kills</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Kills</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Kills</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">Visible</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Visible</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">PvpMode</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">pvpMode</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">pvpMode</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">PvpMode</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">pvpMode</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">PvpSafe</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">PvpSafe</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">PvpSafe</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">PvpSafe</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">PvpSafe</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">Training</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Training</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Training</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Training</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Training</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">BlackListSafe</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">BlackListSafe</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">BlackListSafe</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">BlackListSafe</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">BlackListSafe</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">KillsAmount</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">KillsAmount</span> <span class="o">=</span> <span class="n">value</span>

  <span class="kr">end</span>

  <span class="n">settingsUI</span><span class="p">.</span><span class="n">AntiRsRange</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">AntiRsRange</span> <span class="o">=</span> <span class="n">value</span>

  <span class="kr">end</span>

   <span class="c1">-- window elements</span>

  <span class="n">mainWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">showSettings</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="n">toggleSettings</span><span class="p">()</span>

    <span class="n">resetFields</span><span class="p">()</span>

    <span class="n">mainWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="c1">-- core functions</span>

  <span class="kr">function</span> <span class="nf">resetFields</span><span class="p">()</span>

    <span class="n">showItem</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="n">toggleItem</span><span class="p">()</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">patternCategory</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">category</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">setPatternText</span><span class="p">()</span>

    <span class="n">setCategoryText</span><span class="p">()</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">manaPercent</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">creatures</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">minHp</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">maxHp</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">cooldown</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">monsters</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;monster names&quot;</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">itemId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">spellName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;spell name&quot;</span><span class="p">)</span>

    <span class="n">panel</span><span class="p">.</span><span class="n">orMore</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">resetFields</span><span class="p">()</span>

  <span class="kr">function</span> <span class="nf">loadSettings</span><span class="p">()</span>

    <span class="c1">-- BOT panel</span>

    <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="n">setProfileName</span><span class="p">()</span>

    <span class="c1">-- main panel</span>

    <span class="n">refreshAttacks</span><span class="p">()</span>

    <span class="c1">-- settings</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">profileName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Visible</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">PvpMode</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">pvpMode</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">PvpSafe</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">PvpSafe</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">BlackListSafe</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">BlackListSafe</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">AntiRsRange</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">AntiRsRange</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">IgnoreMana</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">ignoreMana</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Rotate</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Rotate</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Kills</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Kills</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">KillsAmount</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">KillsAmount</span><span class="p">)</span>

    <span class="n">settingsUI</span><span class="p">.</span><span class="n">Training</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Training</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">loadSettings</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">activeProfileColor</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span> <span class="kr">then</span>

        <span class="n">ui</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>

      <span class="kr">else</span>

        <span class="n">ui</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">activeProfileColor</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">profileChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">setActiveProfile</span><span class="p">()</span>

    <span class="n">activeProfileColor</span><span class="p">()</span>

    <span class="n">loadSettings</span><span class="p">()</span>

    <span class="n">resetFields</span><span class="p">()</span>

    <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;atk&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">button</span> <span class="o">=</span> <span class="n">ui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="n">button</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span> <span class="o">=</span> <span class="n">i</span>

      <span class="n">profileChange</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

    <span class="c1">-- public functions</span>

    <span class="n">AttackBot</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- global table</span>

    <span class="n">AttackBot</span><span class="p">.</span><span class="n">isOn</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kr">return</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span>

    <span class="kr">end</span>

    <span class="n">AttackBot</span><span class="p">.</span><span class="n">isOff</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kr">return</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span>

    <span class="kr">end</span>

    <span class="n">AttackBot</span><span class="p">.</span><span class="n">setOff</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span>

      <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

      <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;atk&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">AttackBot</span><span class="p">.</span><span class="n">setOn</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span>

      <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

      <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;atk&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">AttackBot</span><span class="p">.</span><span class="n">getActiveProfile</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kr">return</span> <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span> <span class="c1">-- returns number 1-5</span>

    <span class="kr">end</span>

    <span class="n">AttackBot</span><span class="p">.</span><span class="n">setActiveProfile</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;[AttackBot] wrong profile parameter! should be 1 to 5 is &quot;</span> <span class="o">..</span> <span class="n">n</span><span class="p">)</span>

      <span class="kr">else</span>

        <span class="n">AttackBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span> <span class="o">=</span> <span class="n">n</span>

        <span class="n">profileChange</span><span class="p">()</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">AttackBot</span><span class="p">.</span><span class="n">show</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">mainWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

      <span class="n">mainWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

      <span class="n">mainWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="c1">-- otui covered, now support functions</span>

<span class="kr">function</span> <span class="nf">getPattern</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">safe</span><span class="p">)</span>

  <span class="n">safe</span> <span class="o">=</span> <span class="n">safe</span> <span class="ow">and</span> <span class="mi">2</span> <span class="ow">or</span> <span class="mi">1</span>

  <span class="kr">return</span> <span class="n">spellPatterns</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">pattern</span><span class="p">][</span><span class="n">safe</span><span class="p">]</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">getMonstersInArea</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">posOrCreature</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">minHp</span><span class="p">,</span> <span class="n">maxHp</span><span class="p">,</span> <span class="n">safePattern</span><span class="p">,</span> <span class="n">monsterNamesTable</span><span class="p">)</span>

  <span class="c1">-- monsterNamesTable can be nil</span>

  <span class="kd">local</span> <span class="n">monsters</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kr">if</span> <span class="n">monsterNamesTable</span> <span class="o">==</span> <span class="kc">true</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">monsterNamesTable</span> <span class="kr">then</span>

    <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kr">else</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">monsterNamesTable</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">safePattern</span> <span class="kr">then</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">posOrCreature</span><span class="p">,</span> <span class="n">safePattern</span><span class="p">))</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">spec</span> <span class="o">~=</span> <span class="n">player</span> <span class="ow">and</span> <span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPartyMember</span><span class="p">())</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">0</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">getTarget</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getTarget</span><span class="p">():</span><span class="n">getName</span><span class="p">()</span>

      <span class="kr">if</span> <span class="o">#</span><span class="n">t</span> <span class="o">~=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">0</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">specHp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getHealthPercent</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

      <span class="n">monsters</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">isMonster</span><span class="p">()</span> <span class="ow">and</span> <span class="n">specHp</span> <span class="o">&gt;=</span> <span class="n">minHp</span> <span class="ow">and</span> <span class="n">specHp</span> <span class="o">&lt;=</span> <span class="n">maxHp</span> <span class="ow">and</span> <span class="p">(</span><span class="o">#</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">true</span><span class="p">))</span> <span class="ow">and</span>

                 <span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">960</span> <span class="ow">or</span> <span class="n">spec</span><span class="p">:</span><span class="n">getType</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="n">monsters</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">monsters</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">monsters</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">posOrCreature</span><span class="p">,</span> <span class="n">pattern</span><span class="p">))</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">spec</span> <span class="o">~=</span> <span class="n">player</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">specHp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getHealthPercent</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">monsters</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">isMonster</span><span class="p">()</span> <span class="ow">and</span> <span class="n">specHp</span> <span class="o">&gt;=</span> <span class="n">minHp</span> <span class="ow">and</span> <span class="n">specHp</span> <span class="o">&lt;=</span> <span class="n">maxHp</span> <span class="ow">and</span> <span class="p">(</span><span class="o">#</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="ow">and</span>

                   <span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">960</span> <span class="ow">or</span> <span class="n">spec</span><span class="p">:</span><span class="n">getType</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="n">monsters</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">monsters</span>

      <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">monsters</span>

<span class="kr">end</span>

<span class="c1">-- for area runes only</span>

<span class="c1">-- should return valid targets number (int) and position</span>

<span class="kr">function</span> <span class="nf">getBestTileByPattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">minHp</span><span class="p">,</span> <span class="n">maxHp</span><span class="p">,</span> <span class="n">safePattern</span><span class="p">,</span> <span class="n">monsterNamesTable</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">tiles</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">())</span>

  <span class="kd">local</span> <span class="n">targetTile</span> <span class="o">=</span> <span class="p">{</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="kc">false</span><span class="p">}</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tiles</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">tPos</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">tPos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">canShoot</span><span class="p">()</span> <span class="ow">and</span> <span class="n">tile</span><span class="p">:</span><span class="n">isWalkable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">getMonstersInArea</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">tPos</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">minHp</span><span class="p">,</span> <span class="n">maxHp</span><span class="p">,</span> <span class="n">safePattern</span><span class="p">,</span> <span class="n">monsterNamesTable</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">amount</span> <span class="o">&gt;</span> <span class="n">targetTile</span><span class="p">.</span><span class="n">amount</span> <span class="kr">then</span>

        <span class="n">targetTile</span> <span class="o">=</span> <span class="p">{</span><span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">tPos</span><span class="p">}</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">targetTile</span><span class="p">.</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">targetTile</span> <span class="ow">or</span> <span class="kc">false</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">executeAttackBotAction</span><span class="p">(</span><span class="n">categoryOrPos</span><span class="p">,</span> <span class="n">idOrFormula</span><span class="p">,</span> <span class="n">cooldown</span><span class="p">)</span>

  <span class="n">cooldown</span> <span class="o">=</span> <span class="n">cooldown</span> <span class="ow">or</span> <span class="mi">0</span>

  <span class="kr">if</span> <span class="n">categoryOrPos</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">categoryOrPos</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">categoryOrPos</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

    <span class="n">cast</span><span class="p">(</span><span class="n">idOrFormula</span><span class="p">,</span> <span class="n">cooldown</span><span class="p">)</span>

  <span class="kr">elseif</span> <span class="n">categoryOrPos</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

    <span class="n">useWith</span><span class="p">(</span><span class="n">idOrFormula</span><span class="p">,</span> <span class="n">target</span><span class="p">())</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- support function covered, now the main loop</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="o">#</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">attackTable</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">isInPz</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">target</span><span class="p">()</span> <span class="ow">or</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_cooldown</span><span class="p">.</span><span class="n">isGroupCooldownIconActive</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Training</span> <span class="ow">and</span> <span class="n">target</span><span class="p">()</span> <span class="ow">and</span> <span class="n">target</span><span class="p">():</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;training&quot;</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">960</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span> <span class="kr">then</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">monstersN</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kd">local</span> <span class="n">monstersE</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kd">local</span> <span class="n">monstersS</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kd">local</span> <span class="n">monstersW</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="n">monstersN</span> <span class="o">=</span> <span class="n">getCreaturesInArea</span><span class="p">(</span><span class="n">pos</span><span class="p">(),</span> <span class="n">posN</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

  <span class="n">monstersE</span> <span class="o">=</span> <span class="n">getCreaturesInArea</span><span class="p">(</span><span class="n">pos</span><span class="p">(),</span> <span class="n">posE</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

  <span class="n">monstersS</span> <span class="o">=</span> <span class="n">getCreaturesInArea</span><span class="p">(</span><span class="n">pos</span><span class="p">(),</span> <span class="n">posS</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

  <span class="n">monstersW</span> <span class="o">=</span> <span class="n">getCreaturesInArea</span><span class="p">(</span><span class="n">pos</span><span class="p">(),</span> <span class="n">posW</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">posTable</span> <span class="o">=</span> <span class="p">{</span><span class="n">monstersE</span><span class="p">,</span> <span class="n">monstersN</span><span class="p">,</span> <span class="n">monstersS</span><span class="p">,</span> <span class="n">monstersW</span><span class="p">}</span>

  <span class="kd">local</span> <span class="n">bestSide</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kd">local</span> <span class="n">bestDir</span>

  <span class="c1">-- pulling out the biggest number</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">posTable</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">bestSide</span> <span class="kr">then</span>

        <span class="n">bestSide</span> <span class="o">=</span> <span class="n">v</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="c1">-- associate biggest number with turn direction</span>

  <span class="kr">if</span> <span class="n">monstersN</span> <span class="o">==</span> <span class="n">bestSide</span> <span class="kr">then</span> <span class="n">bestDir</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">elseif</span> <span class="n">monstersE</span> <span class="o">==</span> <span class="n">bestSide</span> <span class="kr">then</span> <span class="n">bestDir</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">monstersS</span> <span class="o">==</span> <span class="n">bestSide</span> <span class="kr">then</span> <span class="n">bestDir</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="kr">elseif</span> <span class="n">monstersW</span> <span class="o">==</span> <span class="n">bestSide</span> <span class="kr">then</span> <span class="n">bestDir</span> <span class="o">=</span> <span class="mi">3</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Rotate</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">player</span><span class="p">:</span><span class="n">getDirection</span><span class="p">()</span> <span class="o">~=</span> <span class="n">bestDir</span> <span class="ow">and</span> <span class="n">bestSide</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">turn</span><span class="p">(</span><span class="n">bestDir</span><span class="p">)</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="c1">-- support functions done, main spells now</span>

          <span class="cm">--[[</span>

<span class="cm">           entry = {</span>

<span class="cm">              creatures = creatures,</span>

<span class="cm">              monsters = monsters, (formatted creatures)</span>

<span class="cm">              mana = mana,</span>

<span class="cm">              count = count,</span>

<span class="cm">              minHp = minHp,</span>

<span class="cm">              maxHp = maxHp,</span>

<span class="cm">              cooldown = cooldown,</span>

<span class="cm">              itemId = itemId,</span>

<span class="cm">              spell = spell,</span>

<span class="cm">              enabled = true,</span>

<span class="cm">              category = category,</span>

<span class="cm">              patternCategory = patternCategory,</span>

<span class="cm">              pattern = pattern,</span>

<span class="cm">              tooltip = tooltip,</span>

<span class="cm">              description = &#39;[&#39;..type..&#39;] &#39;..count.. &#39;x &#39;..specificMonsters..&#39;: &#39;..attackType..&#39;, &#39;..categoryName..&#39; (&#39;..minHp..&#39;%-&#39;..maxHp..&#39;%)&#39;</span>

<span class="cm">}</span>

<span class="cm">]]</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="n">entryList</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">child</span><span class="p">.</span><span class="n">params</span>

    <span class="kd">local</span> <span class="n">attackData</span> <span class="o">=</span> <span class="n">entry</span><span class="p">.</span><span class="n">itemId</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">.</span><span class="n">itemId</span> <span class="ow">or</span> <span class="n">entry</span><span class="p">.</span><span class="n">spell</span>

    <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">mana</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">attackData</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="ow">and</span> <span class="n">canCast</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">,</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">ignoreMana</span><span class="p">,</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">itemId</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span> <span class="ow">or</span> <span class="n">findItem</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">itemId</span><span class="p">)))</span> <span class="kr">then</span>

        <span class="c1">-- first PVP scenario</span>

        <span class="kr">if</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">pvpMode</span> <span class="ow">and</span> <span class="n">target</span><span class="p">():</span><span class="n">getHealthPercent</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">minHp</span> <span class="ow">and</span> <span class="n">target</span><span class="p">():</span><span class="n">getHealthPercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">maxHp</span> <span class="ow">and</span> <span class="n">target</span><span class="p">():</span><span class="n">canShoot</span><span class="p">()</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">category</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[AttackBot] Area Runes cannot be used in PVP situation!&quot;</span><span class="p">)</span>

          <span class="kr">else</span>

            <span class="kr">return</span> <span class="n">executeAttackBotAction</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">category</span><span class="p">,</span> <span class="n">attackData</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">cooldown</span><span class="p">)</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="c1">-- empowerment</span>

        <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">category</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isBuffed</span><span class="p">()</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">monsterAmount</span> <span class="o">=</span> <span class="n">getMonstersInArea</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">category</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">minHp</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">maxHp</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">monsters</span><span class="p">)</span>

          <span class="kr">if</span> <span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">orMore</span> <span class="ow">and</span> <span class="n">monsterAmount</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">orMore</span> <span class="ow">and</span> <span class="n">monsterAmount</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span><span class="p">)</span> <span class="ow">and</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">target</span><span class="p">():</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">pattern</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">executeAttackBotAction</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">category</span><span class="p">,</span> <span class="n">attackData</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">cooldown</span><span class="p">)</span>

          <span class="kr">end</span>

<span class="c1">--</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">category</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">entry</span><span class="p">.</span><span class="n">category</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">monsterAmount</span> <span class="o">=</span> <span class="n">getMonstersInArea</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">category</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">minHp</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">maxHp</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">monsters</span><span class="p">)</span>

          <span class="kr">if</span> <span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">orMore</span> <span class="ow">and</span> <span class="n">monsterAmount</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">orMore</span> <span class="ow">and</span> <span class="n">monsterAmount</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span><span class="p">)</span> <span class="ow">and</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">target</span><span class="p">():</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">pattern</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">executeAttackBotAction</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">category</span><span class="p">,</span> <span class="n">attackData</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">cooldown</span><span class="p">)</span>

          <span class="kr">end</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">category</span> <span class="o">==</span> <span class="mi">5</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">pCat</span> <span class="o">=</span> <span class="n">entry</span><span class="p">.</span><span class="n">patternCategory</span>

          <span class="kd">local</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">entry</span><span class="p">.</span><span class="n">pattern</span>

          <span class="kd">local</span> <span class="n">anchorParam</span> <span class="o">=</span> <span class="p">(</span><span class="n">pattern</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">pattern</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">pattern</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">or</span> <span class="n">pattern</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">and</span> <span class="n">player</span> <span class="ow">or</span> <span class="n">pos</span><span class="p">()</span>

          <span class="kd">local</span> <span class="n">safe</span> <span class="o">=</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">PvpSafe</span> <span class="ow">and</span> <span class="n">spellPatterns</span><span class="p">[</span><span class="n">pCat</span><span class="p">][</span><span class="n">entry</span><span class="p">.</span><span class="n">pattern</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="kc">false</span>

          <span class="kd">local</span> <span class="n">monsterAmount</span> <span class="o">=</span> <span class="n">pCat</span> <span class="o">~=</span> <span class="mi">8</span> <span class="ow">and</span> <span class="n">getMonstersInArea</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">category</span><span class="p">,</span> <span class="n">anchorParam</span><span class="p">,</span> <span class="n">spellPatterns</span><span class="p">[</span><span class="n">pCat</span><span class="p">][</span><span class="n">entry</span><span class="p">.</span><span class="n">pattern</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">entry</span><span class="p">.</span><span class="n">minHp</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">maxHp</span><span class="p">,</span> <span class="n">safe</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">monsters</span><span class="p">)</span>

          <span class="kr">if</span> <span class="p">(</span><span class="n">pattern</span> <span class="o">~=</span> <span class="mi">8</span> <span class="ow">and</span> <span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">orMore</span> <span class="ow">and</span> <span class="n">monsterAmount</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">orMore</span> <span class="ow">and</span> <span class="n">monsterAmount</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pattern</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">and</span> <span class="n">bestSide</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">PvpSafe</span> <span class="ow">or</span> <span class="n">getPlayers</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">BlackListSafe</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isBlackListedPlayerInRange</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">AntiRsRange</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Kills</span> <span class="ow">or</span> <span class="n">killsToRs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">KillsAmount</span><span class="p">)</span> <span class="kr">then</span>

              <span class="kr">return</span> <span class="n">executeAttackBotAction</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">category</span><span class="p">,</span> <span class="n">attackData</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">cooldown</span><span class="p">)</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">category</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">pCat</span> <span class="o">=</span> <span class="n">entry</span><span class="p">.</span><span class="n">patternCategory</span>

          <span class="kd">local</span> <span class="n">safe</span> <span class="o">=</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">PvpSafe</span> <span class="ow">and</span> <span class="n">spellPatterns</span><span class="p">[</span><span class="n">pCat</span><span class="p">][</span><span class="n">entry</span><span class="p">.</span><span class="n">pattern</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="kc">false</span>

          <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">getBestTileByPattern</span><span class="p">(</span><span class="n">spellPatterns</span><span class="p">[</span><span class="n">pCat</span><span class="p">][</span><span class="n">entry</span><span class="p">.</span><span class="n">pattern</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">entry</span><span class="p">.</span><span class="n">minHp</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">maxHp</span><span class="p">,</span> <span class="n">safe</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">monsters</span><span class="p">)</span>

          <span class="kd">local</span> <span class="n">monsterAmount</span>

          <span class="kd">local</span> <span class="n">pos</span>

          <span class="kr">if</span> <span class="n">data</span> <span class="kr">then</span>

            <span class="n">monsterAmount</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">amount</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">pos</span>

          <span class="kr">end</span>

          <span class="kr">if</span> <span class="n">monsterAmount</span> <span class="ow">and</span> <span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">orMore</span> <span class="ow">and</span> <span class="n">monsterAmount</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">orMore</span> <span class="ow">and</span> <span class="n">monsterAmount</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">count</span><span class="p">)</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">BlackListSafe</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isBlackListedPlayerInRange</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">AntiRsRange</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Kills</span> <span class="ow">or</span> <span class="n">killsToRs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">KillsAmount</span><span class="p">)</span> <span class="kr">then</span>

              <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">attackData</span><span class="p">,</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span><span class="n">getTopUseThing</span><span class="p">())</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="attackbot-otui">
<h1>AttackBot.otui<a class="headerlink" href="#attackbot-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
AttackEntry &lt; UIWidget

  background-color: alpha

  text-offset: 35 1

  focusable: true

  height: 16

  font: verdana-11px-rounded

  text-align: left

  CheckBox

    id: enabled

    anchors.left: parent.left

    anchors.verticalCenter: parent.verticalCenter

    width: 15

    height: 15

    margin-top: 2

    margin-left: 3

  UIItem

    id: id

    anchors.left: prev.right

    anchors.verticalCenter: parent.verticalCenter

    size: 16 16

    focusable: false

    visible: false

  UIWidget

    id: spell

    anchors.left: enabled.right

    anchors.verticalCenter: parent.verticalCenter

    size: 12 12

    margin-left: 1

    image-source: /images/game/dangerous

  $focus:

    background-color: #00000055

  Button

    id: remove

    !text: tr(&#39;x&#39;)

    anchors.right: parent.right

    margin-right: 15

    width: 15

    height: 15

AttackBotBotPanel &lt; Panel

  height: 38

  BotSwitch

    id: title

    anchors.top: parent.top

    anchors.left: parent.left

    text-align: center

    width: 130

    !text: tr(&#39;AttackBot&#39;)

  Button

    id: settings

    anchors.top: prev.top

    anchors.left: prev.right

    anchors.right: parent.right

    margin-left: 3

    height: 17

    text: Setup

  Button

    id: 1

    anchors.top: prev.bottom

    anchors.left: parent.left

    text: 1

    margin-right: 2

    margin-top: 4

    size: 17 17

  Button

    id: 2

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    text: 2

    margin-left: 4

    size: 17 17

  Button

    id: 3

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    text: 3

    margin-left: 4

    size: 17 17

  Button

    id: 4

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    text: 4

    margin-left: 4

    size: 17 17

  Button

    id: 5

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    text: 5

    margin-left: 4

    size: 17 17

  Label

    id: name

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    anchors.right: parent.right

    text-align: center

    margin-left: 4

    height: 17

    text: Profile #1

    background: #292A2A

CategoryLabel &lt; Panel

  size: 315 15

  image-source: /images/ui/panel_flat

  image-border: 5

  padding: 1

  Label

    id: description

    anchors.fill: parent

    text-align: center

    text: Area Rune (avalanche, great fireball, etc)

    font: verdana-11px-rounded

    background: #363636

SourceLabel &lt; Panel

  size: 105 15

  image-source: /images/ui/panel_flat

  image-border: 5

  padding: 1

  Label

    id: description

    anchors.fill: parent

    text-align: center

    text: Monster Name

    font: verdana-11px-rounded

    background: #363636

RangeLabel &lt; Panel

  size: 323 15

  image-source: /images/ui/panel_flat

  image-border: 5

  padding: 1

  Label

    id: description

    anchors.fill: parent

    text-align: center

    text: 5 Sqm

    font: verdana-11px-rounded

    background: #363636

PreButton &lt; PreviousButton

  background: #363636

  height: 15

NexButton &lt; NextButton

  background: #363636

  height: 15

AttackBotPanel &lt; Panel

  size: 500 200

  image-source: /images/ui/panel_flat

  image-border: 5

  padding: 5

  TextList

    id: entryList

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: parent.top

    margin-top: 3

    size: 430 100

    vertical-scrollbar: entryListScrollBar

  VerticalScrollBar

    id: entryListScrollBar

    anchors.top: entryList.top

    anchors.bottom: entryList.bottom

    anchors.right: entryList.right

    step: 14

    pixels-scroll: true

  PreButton

    id: previousCategory

    anchors.left: entryList.left

    anchors.top: entryList.bottom

    margin-top: 8

  NexButton

    id: nextCategory

    anchors.left: category.right

    anchors.top: entryList.bottom

    margin-top: 8

    margin-left: 2

  CategoryLabel

    id: category

    anchors.top: entryList.bottom

    anchors.left: previousCategory.right

    anchors.verticalCenter: previousCategory.verticalCenter

    margin-left: 3

  PreButton

    id: previousSource

    anchors.left: entryList.left

    anchors.top: category.bottom

    margin-top: 8

  NexButton

    id: nextSource

    anchors.left: source.right

    anchors.top: category.bottom

    margin-top: 8

    margin-left: 2

  SourceLabel

    id: source

    anchors.top: category.bottom

    anchors.left: previousSource.right

    anchors.verticalCenter: previousSource.verticalCenter

    margin-left: 3

  PreButton

    id: previousRange

    anchors.left: nextSource.right

    anchors.verticalCenter: nextSource.verticalCenter

    margin-left: 8

  NexButton

    id: nextRange

    anchors.left: range.right

    anchors.verticalCenter: range.verticalCenter

    margin-left: 2

  RangeLabel

    id: range

    anchors.left: previousRange.right

    anchors.verticalCenter: previousRange.verticalCenter

    margin-left: 3

  TextEdit

    id: monsters

    anchors.left: entryList.left

    anchors.top: range.bottom

    margin-top: 5

    size: 405 15

    text: monster names

    font: cipsoftFont

    background: #363636

  Label

    anchors.left: prev.left

    anchors.top: prev.bottom

    margin-top: 6

    margin-left: 3

    text-align: center

    text: Mana%:

    font: verdana-11px-rounded

  SpinBox

    id: manaPercent

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 4

    size: 30 20

    minimum: 0

    maximum: 99

    step: 1

    editable: true

    focusable: true

  Label

    anchors.left: prev.right

    margin-left: 7

    anchors.verticalCenter: prev.verticalCenter

    text: Creatures:

    font: verdana-11px-rounded

  SpinBox

    id: creatures

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 4

    size: 30 20

    minimum: 1

    maximum: 99

    step: 1

    editable: true

    focusable: true

  CheckBox

    id: orMore

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    tooltip: or more creatures

  Label

    anchors.left: prev.right

    margin-left: 7

    anchors.verticalCenter: prev.verticalCenter

    text: HP:

    font: verdana-11px-rounded

  SpinBox

    id: minHp

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 4

    size: 40 20

    minimum: 0

    maximum: 99

    value: 0

    editable: true

    focusable: true

  Label

    anchors.left: prev.right

    margin-left: 4

    anchors.verticalCenter: prev.verticalCenter

    text: -

    font: verdana-11px-rounded

  SpinBox

    id: maxHp

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 4

    size: 40 20

    minimum: 1

    maximum: 100

    value: 100

    editable: true

    focusable: true

  Label

    anchors.left: prev.right

    margin-left: 7

    anchors.verticalCenter: prev.verticalCenter

    text: CD:

    font: verdana-11px-rounded

  SpinBox

    id: cooldown

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 4

    size: 60 20

    minimum: 0

    maximum: 999999

    step: 100

    value: 0

    editable: true

    focusable: true

  Button

    id: up

    anchors.right: parent.right

    anchors.top: entryList.bottom

    size: 60 17

    text: Move Up

    text-align: center

    font: cipsoftFont

    margin-top: 7

    margin-right: 8

  Button

    id: down

    anchors.right: prev.left

    anchors.verticalCenter: prev.verticalCenter

    size: 60 17

    margin-right: 5

    text: Move Down

    text-align: center

    font: cipsoftFont

  Button

    id: addEntry

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 40 19

    text-align: center

    text: New

    font: cipsoftFont

  BotItem

    id: itemId

    anchors.right: addEntry.left

    margin-right: 5

    anchors.bottom: parent.bottom

    margin-bottom: 2

    tooltip: drag item here on press to open window

  TextEdit

    id: spellName

    anchors.top: monsters.top

    anchors.left: monsters.right

    anchors.right: parent.right

    margin-left: 5

    height: 15

    text: spell name

    background: #363636

    font: cipsoftFont

    visible: false

SettingsPanel &lt; Panel

  size: 500 200

  image-source: /images/ui/panel_flat

  image-border: 5

  padding: 10

  VerticalSeparator

    anchors.top: parent.top

    anchors.bottom: parent.bottom

    anchors.left: Visible.right

    margin-left: 10

    margin-top: 5

    margin-bottom: 5

  Label

    anchors.top: parent.top

    anchors.left: prev.right

    anchors.right: parent.right

    margin-left: 10

    text-align: center

    font: verdana-11px-rounded

    text: Profile:

  TextEdit

    id: profileName

    anchors.top: prev.bottom

    margin-top: 3

    anchors.left: prev.left

    anchors.right: prev.right

    margin-left: 20

    margin-right: 20

  Button

    id: resetSettings

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    text-align: center

    text: Reset Settings

  CheckBox

    id: IgnoreMana

    anchors.top: parent.top

    anchors.left: parent.left

    margin-top: 5

    width: 200

    text: Check RL Tibia conditions

  CheckBox

    id: Kills

    anchors.top: prev.bottom

    anchors.left: prev.left

    margin-top: 8

    width: 200

    height: 22

    text: Don&#39;t use area attacks if less than kills to red skull

    text-wrap: true

    text-align: left

  SpinBox

    id: KillsAmount

    anchors.top: prev.top

    anchors.bottom: prev.bottom

    anchors.left: prev.right

    text-align: left

    width: 30

    minimum: 1

    maximum: 10

    focusable: true

    margin-left: 5

  CheckBox

    id: Rotate

    anchors.top: Kills.bottom

    anchors.left: Kills.left

    margin-top: 8

    width: 220

    text: Turn to side with most monsters

  CheckBox

    id: Cooldown

    anchors.top: prev.bottom

    anchors.left: prev.left

    margin-top: 8

    width: 220

    text: Check spell cooldowns

  CheckBox

    id: Visible

    anchors.top: prev.bottom

    anchors.left: prev.left

    margin-top: 8

    width: 245

    text: Items must be visible (recommended)

  CheckBox

    id: PvpMode

    anchors.top: prev.bottom

    anchors.left: prev.left

    margin-top: 8

    width: 245

    text: PVP mode

  CheckBox

    id: PvpSafe

    anchors.top: prev.bottom

    anchors.left: prev.left

    margin-top: 8

    width: 245

    text: PVP safe

  CheckBox

    id: Training

    anchors.top: prev.bottom

    anchors.left: prev.left

    margin-top: 8

    width: 245

    text: Stop when attacking trainers

  CheckBox

    id: BlackListSafe

    anchors.top: prev.bottom

    anchors.left: prev.left

    margin-top: 8

    width: 200

    height: 18

    text: Stop if Anti-RS player in range

  SpinBox

    id: AntiRsRange

    anchors.top: prev.top

    anchors.bottom: prev.bottom

    anchors.left: prev.right

    text-align: center

    width: 50

    minimum: 1

    maximum: 10

    focusable: true

    margin-left: 5

AttackBotWindow &lt; MainWindow

  size: 535 300

  padding: 15

  text: AttackBot v2

  @onEscape: self:hide()

  Label

    id: mainLabel

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: parent.top

    margin-top: 10

    margin-left: 2

    !text: tr(&#39;More important methods come first (Example: Exori gran above Exori)&#39;)

    text-align: left

    font: verdana-11px-rounded

    color: #aeaeae

  SettingsPanel

    id: settingsPanel

    anchors.top: prev.bottom

    margin-top: 10

    anchors.left: parent.left

    margin-left: 2

  Label

    id: settingsLabel

    anchors.verticalCenter: prev.top

    anchors.left: prev.left

    margin-left: 3

    text: Settings

    color: #fe4400

    font: verdana-11px-rounded

  AttackBotPanel

    id: mainPanel

    anchors.top: mainLabel.bottom

    margin-top: 10

    anchors.left: parent.left

    margin-left: 2

    visible: false

  Label

    id: shooterLabel

    anchors.verticalCenter: prev.top

    anchors.left: prev.left

    margin-left: 3

    text: Spell Shooter

    color: #fe4400

    font: verdana-11px-rounded

    visible: false

  HorizontalSeparator

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: closeButton.top

    margin-bottom: 10

  Button

    id: closeButton

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    text: Close

    font: cipsoftFont

  Button

    id: settings

    anchors.left: parent.left

    anchors.verticalCenter: prev.verticalCenter

    size: 50 21

    font: cipsoftFont

    text: Settings

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="botserver-lua">
<h1>BotServer.lua<a class="headerlink" href="#botserver-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">regex</span> <span class="o">=</span> <span class="s">[[&quot;(.*?)&quot;]]</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;BOTserver&quot;</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 18</span>

<span class="s">  Button</span>

<span class="s">    id: botServer</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    text-align: center</span>

<span class="s">    height: 18</span>

<span class="s">    !text: tr(&#39;BotServer&#39;)</span>

<span class="s">]]</span><span class="p">)</span>

<span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

  <span class="n">manaInfo</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

  <span class="n">mwallInfo</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

  <span class="n">vocation</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

  <span class="n">outfit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

  <span class="n">broadcasts</span> <span class="o">=</span> <span class="kc">true</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="n">config</span><span class="p">.</span><span class="n">mwalls</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span> <span class="kr">then</span>

  <span class="nb">math.randomseed</span><span class="p">(</span><span class="nb">os.time</span><span class="p">())</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1000000000000</span><span class="p">,</span><span class="mi">9999999999999</span><span class="p">))</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">channel</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span><span class="p">)</span>

<span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">name</span><span class="p">(),</span> <span class="n">channel</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">vBot</span><span class="p">.</span><span class="n">BotServerMembers</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">rootWidget</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">()</span>

<span class="kr">if</span> <span class="n">rootWidget</span> <span class="kr">then</span>

  <span class="n">botServerWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;BotServerWindow&#39;</span><span class="p">)</span>

  <span class="n">botServerWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">enabled</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

    <span class="n">botServerWindow</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

      <span class="n">channel</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span><span class="p">)</span>

      <span class="n">BotServer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">name</span><span class="p">(),</span> <span class="n">channel</span><span class="p">)</span>

      <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ServerStatus</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;CONNECTING...&quot;</span><span class="p">)</span>

      <span class="n">ui</span><span class="p">.</span><span class="n">botServer</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#FFF380&#39;</span><span class="p">)</span>

      <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ServerStatus</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#FFF380&#39;</span><span class="p">)</span>

    <span class="kr">else</span>

      <span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

        <span class="n">BotServer</span><span class="p">.</span><span class="n">terminate</span><span class="p">()</span>

      <span class="kr">end</span>

      <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ServerStatus</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;DISCONNECTED&quot;</span><span class="p">)</span>

      <span class="n">ui</span><span class="p">.</span><span class="n">botServer</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#E3242B&#39;</span><span class="p">)</span>

      <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ServerStatus</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#E3242B&#39;</span><span class="p">)</span>

      <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Participants</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

      <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Members</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="n">ServerMembers</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="n">serverCount</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">end</span>

    <span class="n">initBotServerListenFunctions</span><span class="p">()</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">updateStatusText</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Channel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span><span class="p">)</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Channel</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1000000000000</span><span class="p">,</span><span class="mi">9999999999999</span><span class="p">))</span>

    <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Channel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature1</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">manaInfo</span><span class="p">)</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature1</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">manaInfo</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">manaInfo</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">manaInfo</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature2</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">mwallInfo</span><span class="p">)</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature2</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">mwallInfo</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">mwallInfo</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">mwallInfo</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature3</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">vocation</span><span class="p">)</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature3</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">vocation</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">vocation</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">vocation</span> <span class="kr">then</span>

      <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;voc&quot;</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span><span class="n">getVocation</span><span class="p">())</span>

    <span class="kr">end</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">vocation</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature4</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">outfit</span><span class="p">)</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature4</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">outfit</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">outfit</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">outfit</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature5</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">broadcasts</span><span class="p">)</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Feature5</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">broadcasts</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">broadcasts</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">broadcasts</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

      <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;broadcast&quot;</span><span class="p">,</span> <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">broadcastText</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

    <span class="kr">end</span>

    <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">broadcastText</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">initBotServerListenFunctions</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="c1">-- list</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">serverCount</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">regex</span><span class="p">)</span>

    <span class="n">ServerMembers</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="c1">-- mwalls</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;mwall&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">mwallInfo</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">mwalls</span><span class="p">[</span><span class="n">message</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]]</span> <span class="ow">or</span> <span class="n">config</span><span class="p">.</span><span class="n">mwalls</span><span class="p">[</span><span class="n">message</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">now</span> <span class="kr">then</span>

        <span class="n">config</span><span class="p">.</span><span class="n">mwalls</span><span class="p">[</span><span class="n">message</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">150</span> <span class="c1">-- 150 is latency correction</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="c1">-- mana</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;mana&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">manaInfo</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">creature</span> <span class="o">=</span> <span class="n">getPlayerByName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">creature</span> <span class="kr">then</span>

        <span class="n">creature</span><span class="p">:</span><span class="n">setManaPercent</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s2">&quot;mana&quot;</span><span class="p">])</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="c1">-- vocation</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;voc&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">vocation</span> <span class="kr">then</span>

      <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;voc&quot;</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span><span class="n">getVocation</span><span class="p">())</span>

    <span class="kr">else</span>

      <span class="n">vBot</span><span class="p">.</span><span class="n">BotServerMembers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="c1">-- broadcast</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;broadcast&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">broadcasts</span> <span class="kr">then</span>

      <span class="n">broadcastMessage</span><span class="p">(</span><span class="n">name</span><span class="o">..</span><span class="s2">&quot;: &quot;</span><span class="o">..</span><span class="n">message</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">initBotServerListenFunctions</span><span class="p">()</span>

<span class="kr">function</span> <span class="nf">updateStatusText</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

    <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ServerStatus</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;CONNECTED&quot;</span><span class="p">)</span>

    <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ServerStatus</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#03AC13&#39;</span><span class="p">)</span>

    <span class="n">ui</span><span class="p">.</span><span class="n">botServer</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#03AC13&#39;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">serverCount</span> <span class="kr">then</span>

      <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Participants</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="o">#</span><span class="n">serverCount</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">ServerMembers</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="kd">local</span> <span class="n">regex</span> <span class="o">=</span> <span class="s">[[&quot;([a-z &#39;A-z-]*)&quot;*]]</span>

        <span class="kd">local</span> <span class="n">re</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">ServerMembers</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>

        <span class="c1">--re[name][2]</span>

        <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">re</span> <span class="kr">do</span>

          <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

            <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

          <span class="kr">else</span>

            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">..</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">..</span> <span class="n">re</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Members</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">else</span>

    <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ServerStatus</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;DISCONNECTED&quot;</span><span class="p">)</span>

    <span class="n">ui</span><span class="p">.</span><span class="n">botServer</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#E3242B&#39;</span><span class="p">)</span>

    <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ServerStatus</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#E3242B&#39;</span><span class="p">)</span>

    <span class="n">botServerWindow</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Participants</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

    <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">updateStatusText</span><span class="p">()</span>

  <span class="n">delay</span><span class="p">(</span><span class="mi">9000</span><span class="p">)</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">botServer</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">botServerWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="n">botServerWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

    <span class="n">botServerWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">botServerWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">botServerWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">onAddThing</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">mwallInfo</span> <span class="ow">and</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">thing</span><span class="p">:</span><span class="n">isItem</span><span class="p">()</span> <span class="ow">and</span> <span class="n">thing</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2129</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">x</span> <span class="o">..</span> <span class="s2">&quot;,&quot;</span> <span class="o">..</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">y</span> <span class="o">..</span> <span class="s2">&quot;,&quot;</span> <span class="o">..</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">mwalls</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">or</span> <span class="n">config</span><span class="p">.</span><span class="n">mwalls</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">now</span> <span class="kr">then</span>

        <span class="n">config</span><span class="p">.</span><span class="n">mwalls</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">20000</span>

        <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;mwall&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">20000</span><span class="p">})</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- mana</span>

<span class="kd">local</span> <span class="n">lastMana</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">manaInfo</span> <span class="ow">and</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">~=</span> <span class="n">lastMana</span> <span class="kr">then</span>

      <span class="n">lastMana</span> <span class="o">=</span> <span class="n">manapercent</span><span class="p">()</span>

      <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;mana&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">mana</span><span class="o">=</span><span class="n">lastMana</span><span class="p">})</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- vocation</span>

<span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">vocation</span> <span class="ow">and</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;voc&quot;</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span><span class="n">getVocation</span><span class="p">())</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;voc&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addSeparator</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="botserver-otui">
<h1>BotServer.otui<a class="headerlink" href="#botserver-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
BotServerData &lt; Panel

  size: 340 70

  image-source: /images/ui/window

  image-border: 6

  padding: 3

  Label

    id: label

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.right: parent.right

    text-align: center

    !text: tr(&quot;BotServer Data&quot;)

  Label

    id: label

    anchors.top: parent.top

    anchors.left: parent.left

    margin-top: 23

    text-align: center

    text: Channel Name:

    margin-left: 6

  TextEdit

    id: Channel

    anchors.top: parent.top

    anchors.left: prev.right

    margin-top: 20

    width: 150

    margin-left: 5

    text-align: center

  Button

    id: Random

    anchors.left: prev.right

    anchors.top: prev.top

    anchors.right: parent.right

    text-align: center

    text: Randomize

    margin-left: 6

    margin-right: 6

  Label

    id: label

    anchors.left: parent.left

    anchors.bottom: parent.bottom

    margin-left: 6

    margin-bottom: 4

    text-align: center

    text: Status:

  Label

    id: ServerStatus

    anchors.left: prev.right

    anchors.bottom: parent.bottom

    margin-left: 10

    width: 150

    margin-bottom: 4

    text-align: left

  Label

    id: Participants

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    width: 20

    margin-right: 8

    margin-bottom: 4

    text-align: center

  UIWidget

    id: Members

    anchors.right: Participants.left

    anchors.bottom: parent.bottom

    size: 80 21

    text-align: center

    text: Members:

FeaturePanel &lt; Panel

  size: 340 150

  image-source: /images/ui/panel_flat

  image-border: 5

  padding: 3

  Label

    id: title

    anchors.top: parent.top

    anchors.horizontalCenter: parent.horizontalCenter

    text-align: center

    text: Features

  HorizontalSeparator

    id: sep

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 2

  BotSwitch

    id: Feature1

    anchors.top: prev.bottom

    anchors.left: parent.left

    margin-left: 3

    margin-top: 5

    text: Mana info

  BotSwitch

    id: Feature2

    anchors.top: sep.bottom

    anchors.left: prev.right

    margin-top: 5

    margin-left: 5

    text: MWall info

  BotSwitch

    id: Feature3

    anchors.top: sep.bottom

    anchors.left: prev.right

    margin-top: 5

    margin-left: 5

    text: Send Vocation

  BotSwitch

    id: Feature4

    anchors.top: prev.bottom

    anchors.left: parent.left

    margin-top: 3

    margin-left: 3

    text: Outfit Vocation

  BotSwitch

    id: Feature5

    anchors.bottom: prev.bottom

    anchors.left: prev.right

    margin-top: 3

    margin-left: 5

    text: Broadcasts

  TextEdit

    id: broadcastText

    anchors.bottom: parent.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-left: 3

    margin-bottom: 3

    margin-right: 80

  Button

    id: Broadcast

    anchors.top: prev.top

    anchors.left: prev.right

    anchors.right: parent.right

    margin-right: 3

    margin-left: 3

    height: 22

    text: Broadcast

BotServerWindow &lt; MainWindow

  !text: tr(&#39;BotServer&#39;)

  size: 370 310

  @onEscape: self:hide()

  BotServerData

    id: Data

    anchors.top: parent.top

    anchors.horizontalCenter: parent.horizontalCenter

  FeaturePanel

    id: Features

    anchors.top: prev.bottom

    anchors.horizontalCenter: parent.horizontalCenter

    margin-top: 10

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-top: 15

    margin-right: 5

  BotSwitch

    id: enabled

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: parent.left

    margin-left: 5

    height: 21

    $!on:

      text: BotServer: OFF

    $on:

      text: BotServer: ON

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="conditions-lua">
<h1>Conditions.lua<a class="headerlink" href="#conditions-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;HP&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;ConditionPanel&quot;</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 19</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;Conditions&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: conditionList</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Setup</span>

<span class="s">  ]]</span><span class="p">)</span>

  <span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">HealBotConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

    <span class="n">HealBotConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">curePosion</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">poisonCost</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

      <span class="n">cureCurse</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">curseCost</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

      <span class="n">cureBleed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">bleedCost</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>

      <span class="n">cureBurn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">burnCost</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

      <span class="n">cureElectrify</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">electrifyCost</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>

      <span class="n">cureParalyse</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">paralyseCost</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

      <span class="n">paralyseSpell</span> <span class="o">=</span> <span class="s2">&quot;utani hur&quot;</span><span class="p">,</span>

      <span class="n">holdHaste</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">hasteCost</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

      <span class="n">hasteSpell</span> <span class="o">=</span> <span class="s2">&quot;utani hur&quot;</span><span class="p">,</span>

      <span class="n">holdUtamo</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">utamoCost</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

      <span class="n">holdUtana</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">utanaCost</span> <span class="o">=</span> <span class="mi">440</span><span class="p">,</span>

      <span class="n">holdUtura</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">uturaType</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

      <span class="n">uturaCost</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

      <span class="n">ignoreInPz</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">stopHaste</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">}</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">HealBotConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

  <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

  <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;heal&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">ui</span><span class="p">.</span><span class="n">conditionList</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="n">conditionsWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

    <span class="n">conditionsWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">rootWidget</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">rootWidget</span> <span class="kr">then</span>

    <span class="n">conditionsWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;ConditionsWindow&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">onVisibilityChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">visible</span> <span class="kr">then</span>

        <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;heal&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="c1">-- text edits</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">PoisonCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">poisonCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">PoisonCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">poisonCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CurseCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">curseCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CurseCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">curseCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">BleedCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bleedCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">BleedCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">bleedCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">BurnCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">burnCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">BurnCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">burnCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">ElectrifyCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">electrifyCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">ElectrifyCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">electrifyCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">ParalyseCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">paralyseCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">ParalyseCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">paralyseCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">ParalyseSpell</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">paralyseSpell</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">ParalyseSpell</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">paralyseSpell</span> <span class="o">=</span> <span class="n">text</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HasteSpell</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">hasteSpell</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HasteSpell</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">hasteSpell</span> <span class="o">=</span> <span class="n">text</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HasteCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">hasteCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HasteCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">hasteCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">UtamoCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">utamoCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">UtamoCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">utamoCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">UtanaCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">utanaCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">UtanaCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">utanaCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">UturaCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">uturaCost</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">UturaCost</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">uturaCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="c1">-- combo box</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">UturaType</span><span class="p">:</span><span class="n">setOption</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">uturaType</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">UturaType</span><span class="p">.</span><span class="n">onOptionChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">uturaType</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getCurrentOption</span><span class="p">().</span><span class="n">text</span>

    <span class="kr">end</span>

    <span class="c1">-- checkboxes</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CurePoison</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">curePoison</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CurePoison</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">curePoison</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">curePoison</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">curePoison</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureCurse</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureCurse</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureCurse</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">cureCurse</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">cureCurse</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureCurse</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureBleed</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureBleed</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureBleed</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">cureBleed</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">cureBleed</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureBleed</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureBurn</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureBurn</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureBurn</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">cureBurn</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">cureBurn</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureBurn</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureElectrify</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureElectrify</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureElectrify</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">cureElectrify</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">cureElectrify</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureElectrify</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureParalyse</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureParalyse</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Cure</span><span class="p">.</span><span class="n">CureParalyse</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">cureParalyse</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">cureParalyse</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">cureParalyse</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HoldHaste</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">holdHaste</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HoldHaste</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">holdHaste</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">holdHaste</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">holdHaste</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HoldUtamo</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">holdUtamo</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HoldUtamo</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">holdUtamo</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">holdUtamo</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">holdUtamo</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HoldUtana</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">holdUtana</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HoldUtana</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">holdUtana</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">holdUtana</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">holdUtana</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HoldUtura</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">holdUtura</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">HoldUtura</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">holdUtura</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">holdUtura</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">holdUtura</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">IgnoreInPz</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">ignoreInPz</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">IgnoreInPz</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">ignoreInPz</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">ignoreInPz</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">ignoreInPz</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">StopHaste</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">stopHaste</span><span class="p">)</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">Hold</span><span class="p">.</span><span class="n">StopHaste</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">stopHaste</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">stopHaste</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">stopHaste</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="c1">-- buttons</span>

    <span class="n">conditionsWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">conditionsWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">Conditions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">Conditions</span><span class="p">.</span><span class="n">show</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">conditionsWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

      <span class="n">conditionsWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

      <span class="n">conditionsWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">utanaCast</span> <span class="o">=</span> <span class="kc">nil</span>

  <span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">or</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_cooldown</span><span class="p">.</span><span class="n">isGroupCooldownIconActive</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">95</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">curePoison</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">poisonCost</span> <span class="ow">and</span> <span class="n">isPoisioned</span><span class="p">()</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="s2">&quot;exana pox&quot;</span><span class="p">)</span>

      <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">cureCurse</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">curseCost</span> <span class="ow">and</span> <span class="n">isCursed</span><span class="p">()</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="s2">&quot;exana mort&quot;</span><span class="p">)</span>

      <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">cureBleed</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">bleedCost</span> <span class="ow">and</span> <span class="n">isBleeding</span><span class="p">()</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="s2">&quot;exana kor&quot;</span><span class="p">)</span>

      <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">cureBurn</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">burnCost</span> <span class="ow">and</span> <span class="n">isBurning</span><span class="p">()</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="s2">&quot;exana flam&quot;</span><span class="p">)</span>

      <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">cureElectrify</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">electrifyCost</span> <span class="ow">and</span> <span class="n">isEnergized</span><span class="p">()</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="s2">&quot;exana vis&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">ignoreInPz</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isInPz</span><span class="p">())</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">holdUtura</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">uturaCost</span> <span class="ow">and</span> <span class="n">canCast</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">uturaType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">90</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">uturaType</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">ignoreInPz</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isInPz</span><span class="p">())</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">holdUtana</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">utanaCost</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">utanaCast</span> <span class="ow">or</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">utanaCast</span> <span class="o">&gt;</span> <span class="mi">120000</span><span class="p">))</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="s2">&quot;utana vid&quot;</span><span class="p">)</span> <span class="n">utanaCast</span> <span class="o">=</span> <span class="n">now</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">macro</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">ignoreInPz</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isInPz</span><span class="p">())</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">holdUtamo</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">utamoCost</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasManaShield</span><span class="p">()</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="s2">&quot;utamo vita&quot;</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="p">((</span><span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">ignoreInPz</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">isInPz</span><span class="p">())</span> <span class="ow">and</span> <span class="n">standTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">5000</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">holdHaste</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">hasteCost</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasHaste</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">getSpellCoolDown</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">hasteSpell</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">target</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">stopHaste</span> <span class="ow">or</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isCaveBotActionAllowed</span><span class="p">()))</span> <span class="ow">and</span> <span class="n">standTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3000</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">hasteSpell</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">cureParalyse</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">paralyseCost</span> <span class="ow">and</span> <span class="n">isParalyzed</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">getSpellCoolDown</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">paralyseSpell</span><span class="p">)</span> <span class="kr">then</span> <span class="n">say</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">paralyseSpell</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="conditions-otui">
<h1>Conditions.otui<a class="headerlink" href="#conditions-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
UturaComboBoxPopupMenu &lt; ComboBoxPopupMenu

UturaComboBoxPopupMenuButton &lt; ComboBoxPopupMenuButton

UturaComboBox &lt; ComboBox

  @onSetup: |

    self:addOption(&quot;Utura&quot;)

    self:addOption(&quot;Utura Gran&quot;)

CureConditions &lt; Panel

  id: Cure

  image-source: /images/ui/panel_flat

  image-border: 6

  padding: 3

  size: 200 190

  Label

    id: label1

    anchors.top: parent.top

    anchors.left: parent.left

    margin-top: 10

    margin-left: 5

    text: Poison

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label11

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 40

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: PoisonCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: CurePoison

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label2

    anchors.left: label1.left

    anchors.top: label1.bottom

    margin-top: 10

    text: Curse

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label22

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 44

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: CurseCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: CureCurse

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label3

    anchors.left: label2.left

    anchors.top: label2.bottom

    margin-top: 10

    text: Bleed

    color: #ffaa00

  font: verdana-11px-rounded

  Label

    id: label33

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 46

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: BleedCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: CureBleed

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label4

    anchors.left: label3.left

    anchors.top: label3.bottom

    margin-top: 10

    text: Burn

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label44

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 50

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: BurnCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: CureBurn

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label5

    anchors.left: label4.left

    anchors.top: label4.bottom

    margin-top: 10

    text: Electify

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label55

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 33

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: ElectrifyCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: CureElectrify

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label6

    anchors.left: label5.left

    anchors.top: label5.bottom

    margin-top: 10

    text: Paralyse

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label66

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 26

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: ParalyseCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: CureParalyse

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label7

    anchors.left: label6.left

    anchors.top: label6.bottom

    margin-top: 10

    margin-left: 12

    text: Spell:

    font: verdana-11px-rounded

  TextEdit

    id: ParalyseSpell

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 10

    width: 100

    font: verdana-11px-rounded

HoldConditions &lt; Panel

  id: Hold

  image-source: /images/ui/panel_flat

  image-border: 6

  padding: 3

  size: 200 190

  Label

    id: label1

    anchors.top: parent.top

    anchors.left: parent.left

    margin-top: 10

    margin-left: 5

    text: Haste

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label11

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 44

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: HasteCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: HoldHaste

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label2

    anchors.left: label1.left

    anchors.top: label1.bottom

    margin-top: 10

    margin-left: 12

    text: Spell:

    font: verdana-11px-rounded

  TextEdit

    id: HasteSpell

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 10

    width: 100

    font: verdana-11px-rounded

  Label

    id: label3

    anchors.left: label1.left

    anchors.top: label2.bottom

    margin-top: 10

    text: Utana Vid

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label33

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 21

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: UtanaCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: HoldUtana

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label4

    anchors.left: label3.left

    anchors.top: label3.bottom

    margin-top: 10

    text: Utamo Vita

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label44

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 12

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: UtamoCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: HoldUtamo

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label5

    anchors.left: label4.left

    anchors.top: label4.bottom

    margin-top: 10

    text: Recovery

    color: #ffaa00

    font: verdana-11px-rounded

  Label

    id: label55

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 20

    text: Mana:

    font: verdana-11px-rounded

  TextEdit

    id: UturaCost

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    width: 40

    font: verdana-11px-rounded

  CheckBox

    id: HoldUtura

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: parent.right

    margin-right: 10

  Label

    id: label6

    anchors.left: label5.left

    anchors.top: label5.bottom

    margin-top: 10

    margin-left: 12

    text: Spell:

    font: verdana-11px-rounded

  UturaComboBox

    id: UturaType

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 10

    width: 100

    font: verdana-11px-rounded

  CheckBox

    id: IgnoreInPz

    anchors.left: label5.left

    anchors.top: label6.bottom

    margin-top: 12

  Label

    anchors.verticalCenter: IgnoreInPz.verticalCenter

    anchors.left: prev.right

    margin-top: 3

    margin-left: 5

    text: Don&#39;t Cast in Protection Zones

    font: cipsoftFont

  CheckBox

    id: StopHaste

    anchors.horizontalCenter: IgnoreInPz.horizontalCenter

    anchors.top: IgnoreInPz.bottom

    margin-top: 8

  Label

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-top: 3

    margin-left: 5

    text: Stop Haste if TargetBot Is Active

    font: cipsoftFont

ConditionsWindow &lt; MainWindow

  !text: tr(&#39;Condition Manager&#39;)

  size: 445 280

  @onEscape: self:hide()

  CureConditions

    id: Cure

    anchors.top: parent.top

    anchors.left: parent.left

    margin-top: 7

  Label

    id: label

    anchors.top: parent.top

    anchors.left: parent.left

    text: Cure Conditions

    color: #88e3dd

    margin-left: 10

    font: verdana-11px-rounded

  HoldConditions

    id: Hold

    anchors.top: parent.top

    anchors.right: parent.right

    margin-top: 7

  Label

    id: label

    anchors.top: parent.top

    anchors.right: parent.right

    text: Hold Conditions

    color: #88e3dd

    margin-right: 100

    font: verdana-11px-rounded

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-top: 15

    margin-right: 5

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="containers-lua">
<h1>Containers.lua<a class="headerlink" href="#containers-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;renameContainers&quot;</span>

<span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">])</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="n">height</span> <span class="o">=</span> <span class="mi">170</span><span class="p">,</span>

        <span class="n">purse</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="n">list</span> <span class="o">=</span> <span class="p">{</span>

<span class="p">{</span>

                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;Main Backpack&quot;</span><span class="p">,</span>

                <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

                <span class="n">item</span> <span class="o">=</span> <span class="mi">9601</span><span class="p">,</span>

                <span class="n">min</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

                <span class="n">items</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">3081</span><span class="p">,</span> <span class="mi">3048</span> <span class="p">}</span>

<span class="p">},</span>

<span class="p">{</span>

                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;Runes&quot;</span><span class="p">,</span>

                <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

                <span class="n">item</span> <span class="o">=</span> <span class="mi">2866</span><span class="p">,</span>

                <span class="n">min</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

                <span class="n">items</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">3161</span><span class="p">,</span> <span class="mi">3180</span> <span class="p">}</span>

<span class="p">},</span>

<span class="p">{</span>

                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;Money&quot;</span><span class="p">,</span>

                <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

                <span class="n">item</span> <span class="o">=</span> <span class="mi">2871</span><span class="p">,</span>

                <span class="n">min</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

                <span class="n">items</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">3031</span><span class="p">,</span> <span class="mi">3035</span><span class="p">,</span> <span class="mi">3043</span> <span class="p">}</span>

<span class="p">},</span>

<span class="p">{</span>

                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;Purse&quot;</span><span class="p">,</span>

                <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

                <span class="n">item</span> <span class="o">=</span> <span class="mi">23396</span><span class="p">,</span>

                <span class="n">min</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

                <span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>

<span class="p">},</span>

<span class="p">}</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">renameContui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 50</span>

<span class="s">  Label</span>

<span class="s">    text-align: center</span>

<span class="s">    text: Container Panel</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;Open Minimised&#39;)</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  Button</span>

<span class="s">    id: editContList</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Setup</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  Button</span>

<span class="s">    id: reopenCont</span>

<span class="s">    !text: tr(&#39;Reopen All&#39;)</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    anchors.right: parent.horizontalCenter</span>

<span class="s">    margin-right: 2</span>

<span class="s">    height: 17</span>

<span class="s">    margin-top: 3</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  Button</span>

<span class="s">    id: minimiseCont</span>

<span class="s">    !text: tr(&#39;Minimise All&#39;)</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: parent.horizontalCenter</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-right: 2</span>

<span class="s">    height: 17</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  ]]</span><span class="p">)</span>

<span class="n">renameContui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

<span class="n">g_ui</span><span class="p">.</span><span class="n">loadUIFromString</span><span class="p">(</span><span class="s">[[</span>

<span class="s">BackpackName &lt; Label</span>

<span class="s">  background-color: alpha</span>

<span class="s">  text-offset: 18 2</span>

<span class="s">  focusable: true</span>

<span class="s">  height: 17</span>

<span class="s">  font: verdana-11px-rounded</span>

<span class="s">  CheckBox</span>

<span class="s">    id: enabled</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.verticalCenter: parent.verticalCenter</span>

<span class="s">    width: 15</span>

<span class="s">    height: 15</span>

<span class="s">    margin-top: 1</span>

<span class="s">    margin-left: 3</span>

<span class="s">  $focus:</span>

<span class="s">    background-color: #00000055</span>

<span class="s">  Button</span>

<span class="s">    id: state</span>

<span class="s">    !text: tr(&#39;M&#39;)</span>

<span class="s">    anchors.right: remove.left</span>

<span class="s">    anchors.verticalCenter: parent.verticalCenter</span>

<span class="s">    margin-right: 1</span>

<span class="s">    width: 15</span>

<span class="s">    height: 15</span>

<span class="s">  Button</span>

<span class="s">    id: remove</span>

<span class="s">    !text: tr(&#39;X&#39;)</span>

<span class="s">    !tooltip: tr(&#39;Remove&#39;)</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    anchors.verticalCenter: parent.verticalCenter</span>

<span class="s">    margin-right: 15</span>

<span class="s">    width: 15</span>

<span class="s">    height: 15</span>

<span class="s">  Button</span>

<span class="s">    id: openNext</span>

<span class="s">    !text: tr(&#39;N&#39;)</span>

<span class="s">    anchors.right: state.left</span>

<span class="s">    anchors.verticalCenter: parent.verticalCenter</span>

<span class="s">    margin-right: 1</span>

<span class="s">    width: 15</span>

<span class="s">    height: 15</span>

<span class="s">    tooltip: Open container inside with the same ID.</span>

<span class="s">ContListsWindow &lt; MainWindow</span>

<span class="s">  !text: tr(&#39;Container Names&#39;)</span>

<span class="s">  size: 465 170</span>

<span class="s">  @onEscape: self:hide()</span>

<span class="s">  TextList</span>

<span class="s">    id: itemList</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.bottom: separator.top</span>

<span class="s">    width: 200</span>

<span class="s">    margin-bottom: 6</span>

<span class="s">    margin-top: 3</span>

<span class="s">    margin-left: 3</span>

<span class="s">    vertical-scrollbar: itemListScrollBar</span>

<span class="s">  VerticalScrollBar</span>

<span class="s">    id: itemListScrollBar</span>

<span class="s">    anchors.top: itemList.top</span>

<span class="s">    anchors.bottom: itemList.bottom</span>

<span class="s">    anchors.right: itemList.right</span>

<span class="s">    step: 14</span>

<span class="s">    pixels-scroll: true</span>

<span class="s">  VerticalSeparator</span>

<span class="s">    id: sep</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: itemList.right</span>

<span class="s">    anchors.bottom: separator.top</span>

<span class="s">    margin-top: 3</span>

<span class="s">    margin-bottom: 6</span>

<span class="s">    margin-left: 10</span>

<span class="s">  Label</span>

<span class="s">    id: lblName</span>

<span class="s">    anchors.left: sep.right</span>

<span class="s">    anchors.top: sep.top</span>

<span class="s">    width: 70</span>

<span class="s">    text: Name:</span>

<span class="s">    margin-left: 10</span>

<span class="s">    margin-top: 3</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  TextEdit</span>

<span class="s">    id: contName</span>

<span class="s">    anchors.left: lblName.right</span>

<span class="s">    anchors.top: sep.top</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  Label</span>

<span class="s">    id: lblCont</span>

<span class="s">    anchors.left: lblName.left</span>

<span class="s">    anchors.verticalCenter: contId.verticalCenter</span>

<span class="s">    width: 70</span>

<span class="s">    text: Container:</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  BotItem</span>

<span class="s">    id: contId</span>

<span class="s">    anchors.left: contName.left</span>

<span class="s">    anchors.top: contName.bottom</span>

<span class="s">    margin-top: 3</span>

<span class="s">  BotContainer</span>

<span class="s">    id: sortList</span>

<span class="s">    anchors.left: prev.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    anchors.bottom: separator.top</span>

<span class="s">    margin-bottom: 6</span>

<span class="s">    margin-top: 3</span>

<span class="s">  Label</span>

<span class="s">    anchors.left: lblCont.left</span>

<span class="s">    anchors.verticalCenter: sortList.verticalCenter</span>

<span class="s">    width: 70</span>

<span class="s">    text: Items:</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  Button</span>

<span class="s">    id: addItem</span>

<span class="s">    anchors.right: contName.right</span>

<span class="s">    anchors.top: contName.bottom</span>

<span class="s">    margin-top: 5</span>

<span class="s">    text: Add</span>

<span class="s">    width: 40</span>

<span class="s">    font: cipsoftFont</span>

<span class="s">  HorizontalSeparator</span>

<span class="s">    id: separator</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.bottom: closeButton.top</span>

<span class="s">    margin-bottom: 8</span>

<span class="s">  CheckBox</span>

<span class="s">    id: purse</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.bottom: parent.bottom</span>

<span class="s">    text: Open Purse</span>

<span class="s">    tooltip: Opens Store/Charm Purse</span>

<span class="s">    width: 85</span>

<span class="s">    height: 15</span>

<span class="s">    margin-top: 2</span>

<span class="s">    margin-left: 3</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  CheckBox</span>

<span class="s">    id: sort</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.bottom: parent.bottom</span>

<span class="s">    text: Sort Items</span>

<span class="s">    tooltip: Sort items based on items widget</span>

<span class="s">    width: 85</span>

<span class="s">    height: 15</span>

<span class="s">    margin-top: 2</span>

<span class="s">    margin-left: 15</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  CheckBox</span>

<span class="s">    id: forceOpen</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.bottom: parent.bottom</span>

<span class="s">    text: Keep Open</span>

<span class="s">    tooltip: Will keep open containers all the time</span>

<span class="s">    width: 85</span>

<span class="s">    height: 15</span>

<span class="s">    margin-top: 2</span>

<span class="s">    margin-left: 15</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  CheckBox</span>

<span class="s">    id: lootBag</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.bottom: parent.bottom</span>

<span class="s">    text: Loot Bag</span>

<span class="s">    tooltip: Open Loot Bag (gunzodus franchaise)</span>

<span class="s">    width: 85</span>

<span class="s">    height: 15</span>

<span class="s">    margin-top: 2</span>

<span class="s">    margin-left: 15</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">  Button</span>

<span class="s">    id: closeButton</span>

<span class="s">    !text: tr(&#39;Close&#39;)</span>

<span class="s">    font: cipsoftFont</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    anchors.bottom: parent.bottom</span>

<span class="s">    size: 45 21</span>

<span class="s">    margin-top: 15</span>

<span class="s">  ResizeBorder</span>

<span class="s">    id: bottomResizeBorder</span>

<span class="s">    anchors.fill: separator</span>

<span class="s">    height: 3</span>

<span class="s">    minimum: 170</span>

<span class="s">    maximum: 245</span>

<span class="s">    margin-left: 3</span>

<span class="s">    margin-right: 3</span>

<span class="s">    background: #ffffff88</span>

<span class="s">]]</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">findItemsInArray</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tfind</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">tArray</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">for</span> <span class="n">x</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">aItem</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">item</span>

            <span class="kd">local</span> <span class="n">aEnabled</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">enabled</span>

                <span class="kr">if</span> <span class="n">aItem</span> <span class="kr">then</span>

                    <span class="kr">if</span> <span class="n">tfind</span> <span class="ow">and</span> <span class="n">aItem</span> <span class="o">==</span> <span class="n">tfind</span> <span class="kr">then</span>

                        <span class="kr">return</span> <span class="n">x</span>

                    <span class="kr">elseif</span> <span class="ow">not</span> <span class="n">tfind</span> <span class="kr">then</span>

                        <span class="kr">if</span> <span class="n">aEnabled</span> <span class="kr">then</span>

                            <span class="nb">table.insert</span><span class="p">(</span><span class="n">tArray</span><span class="p">,</span> <span class="n">aItem</span><span class="p">)</span>

                        <span class="kr">end</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">tfind</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">tArray</span> <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">lstBPs</span>

<span class="kd">local</span> <span class="n">openContainer</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="n">getRight</span><span class="p">(),</span> <span class="n">getLeft</span><span class="p">(),</span> <span class="n">getAmmo</span><span class="p">()}</span> <span class="c1">-- if more slots needed then add them here</span>

    <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">t</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">slotItem</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="kr">if</span> <span class="n">slotItem</span> <span class="ow">and</span> <span class="n">slotItem</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">slotItem</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">isContainer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">reopenBackpacks</span><span class="p">()</span>

    <span class="n">lstBPs</span> <span class="o">=</span> <span class="n">findItemsInArray</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span> <span class="n">g_game</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="n">container</span><span class="p">)</span> <span class="kr">end</span>

    <span class="n">bpItem</span> <span class="o">=</span> <span class="n">getBack</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">bpItem</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>

        <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">bpItem</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">200</span>

        <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">purse</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">getPurse</span><span class="p">()</span>

            <span class="kr">if</span> <span class="n">item</span> <span class="kr">then</span>

                <span class="n">use</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">lstBPs</span> <span class="kr">do</span>

            <span class="n">schedule</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                <span class="n">openContainer</span><span class="p">(</span><span class="n">lstBPs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="kr">end</span><span class="p">)</span>

            <span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span> <span class="o">+</span> <span class="mi">250</span>

        <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">rootWidget</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">()</span>

<span class="kr">if</span> <span class="n">rootWidget</span> <span class="kr">then</span>

    <span class="n">contListWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;ContListsWindow&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

    <span class="n">contListWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">onGeometryChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">old</span><span class="p">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="n">config</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">new</span><span class="p">.</span><span class="n">height</span>

    <span class="kr">end</span>

    <span class="n">contListWindow</span><span class="p">:</span><span class="n">setHeight</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">height</span> <span class="ow">or</span> <span class="mi">170</span><span class="p">)</span>

    <span class="n">renameContui</span><span class="p">.</span><span class="n">editContList</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">contListWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

        <span class="n">contListWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

        <span class="n">contListWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">renameContui</span><span class="p">.</span><span class="n">reopenCont</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">reopenBackpacks</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">renameContui</span><span class="p">.</span><span class="n">minimiseCont</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">containerWindow</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">window</span>

            <span class="n">containerWindow</span><span class="p">:</span><span class="n">setContentHeight</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">renameContui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="n">renameContui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">contListWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">purse</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">config</span><span class="p">.</span><span class="n">purse</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">purse</span>

        <span class="n">contListWindow</span><span class="p">.</span><span class="n">purse</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">purse</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">purse</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">purse</span><span class="p">)</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">sort</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">config</span><span class="p">.</span><span class="n">sort</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">sort</span>

        <span class="n">contListWindow</span><span class="p">.</span><span class="n">sort</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">sort</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">sort</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">sort</span><span class="p">)</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">forceOpen</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">config</span><span class="p">.</span><span class="n">forceOpen</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">forceOpen</span>

        <span class="n">contListWindow</span><span class="p">.</span><span class="n">forceOpen</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">forceOpen</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">forceOpen</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">forceOpen</span><span class="p">)</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">lootBag</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="n">config</span><span class="p">.</span><span class="n">lootBag</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">lootBag</span>

        <span class="n">contListWindow</span><span class="p">.</span><span class="n">lootBag</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">lootBag</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">lootBag</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">lootBag</span><span class="p">)</span>

    <span class="kd">local</span> <span class="kr">function</span> <span class="nf">refreshSortList</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">UI</span><span class="p">.</span><span class="n">Container</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">contListWindow</span><span class="p">.</span><span class="n">sortList</span><span class="p">:</span><span class="n">getItems</span><span class="p">()</span>

            <span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">items</span> <span class="o">=</span> <span class="n">t</span>

            <span class="kr">end</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">contListWindow</span><span class="p">.</span><span class="n">sortList</span><span class="p">)</span>

        <span class="n">contListWindow</span><span class="p">.</span><span class="n">sortList</span><span class="p">:</span><span class="n">setItems</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">refreshSortList</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">refreshContNames</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">tFocus</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">storageVal</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">list</span>

        <span class="kr">if</span> <span class="n">storageVal</span> <span class="ow">and</span> <span class="o">#</span><span class="n">storageVal</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

            <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">contListWindow</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

                <span class="n">child</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

            <span class="kr">end</span>

            <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storageVal</span><span class="p">)</span> <span class="kr">do</span>

                <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;BackpackName&quot;</span><span class="p">,</span> <span class="n">contListWindow</span><span class="p">.</span><span class="n">itemList</span><span class="p">)</span>

                <span class="n">label</span><span class="p">.</span><span class="n">onMouseRelease</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

                    <span class="n">contListWindow</span><span class="p">.</span><span class="n">contId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">)</span>

                    <span class="n">contListWindow</span><span class="p">.</span><span class="n">contName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

                    <span class="kr">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">items</span> <span class="kr">then</span>

                        <span class="n">entry</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="kr">end</span>

                    <span class="n">contListWindow</span><span class="p">.</span><span class="n">sortList</span><span class="p">:</span><span class="n">setItems</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">items</span><span class="p">)</span>

                    <span class="n">refreshSortList</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">items</span><span class="p">)</span>

                <span class="kr">end</span>

                <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

                    <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span>

                    <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

                    <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="s1">&#39;Disable&#39;</span> <span class="ow">or</span> <span class="s1">&#39;Enable&#39;</span><span class="p">)</span>

                    <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setImageColor</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="s1">&#39;#00FF00&#39;</span> <span class="ow">or</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span>

                <span class="kr">end</span>

                <span class="n">label</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

                    <span class="n">table</span><span class="p">.</span><span class="n">removevalue</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>

                    <span class="n">label</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

                <span class="kr">end</span>

                <span class="n">label</span><span class="p">.</span><span class="n">state</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">min</span><span class="p">)</span>

                <span class="n">label</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

                    <span class="n">entry</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">min</span>

                    <span class="n">label</span><span class="p">.</span><span class="n">state</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">min</span><span class="p">)</span>

                    <span class="n">label</span><span class="p">.</span><span class="n">state</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">min</span> <span class="ow">and</span> <span class="s1">&#39;#00FF00&#39;</span> <span class="ow">or</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span>

                    <span class="n">label</span><span class="p">.</span><span class="n">state</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">min</span> <span class="ow">and</span> <span class="s1">&#39;Open Minimised&#39;</span> <span class="ow">or</span> <span class="s1">&#39;Do not minimise&#39;</span><span class="p">)</span>

                <span class="kr">end</span>

                <span class="n">label</span><span class="p">.</span><span class="n">openNext</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

                    <span class="n">entry</span><span class="p">.</span><span class="n">openNext</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">openNext</span>

                    <span class="n">label</span><span class="p">.</span><span class="n">openNext</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">openNext</span><span class="p">)</span>

                    <span class="n">label</span><span class="p">.</span><span class="n">openNext</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">openNext</span> <span class="ow">and</span> <span class="s1">&#39;#00FF00&#39;</span> <span class="ow">or</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span>

                <span class="kr">end</span>

                <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

                <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

                <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="s1">&#39;Disable&#39;</span> <span class="ow">or</span> <span class="s1">&#39;Enable&#39;</span><span class="p">)</span>

                <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setImageColor</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="s1">&#39;#00FF00&#39;</span> <span class="ow">or</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span>

                <span class="n">label</span><span class="p">.</span><span class="n">state</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">min</span> <span class="ow">and</span> <span class="s1">&#39;#00FF00&#39;</span> <span class="ow">or</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span>

                <span class="n">label</span><span class="p">.</span><span class="n">state</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">min</span> <span class="ow">and</span> <span class="s1">&#39;Open Minimised&#39;</span> <span class="ow">or</span> <span class="s1">&#39;Do not minimise&#39;</span><span class="p">)</span>

                <span class="n">label</span><span class="p">.</span><span class="n">openNext</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">openNext</span> <span class="ow">and</span> <span class="s1">&#39;#00FF00&#39;</span> <span class="ow">or</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span>

                <span class="kr">if</span> <span class="n">tFocus</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">.</span><span class="n">item</span> <span class="o">==</span> <span class="n">tFocus</span> <span class="kr">then</span>

                    <span class="n">tFocus</span> <span class="o">=</span> <span class="n">label</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

            <span class="kr">if</span> <span class="n">tFocus</span> <span class="kr">then</span> <span class="n">contListWindow</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">focusChild</span><span class="p">(</span><span class="n">tFocus</span><span class="p">)</span> <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">contListWindow</span><span class="p">.</span><span class="n">addItem</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">contListWindow</span><span class="p">.</span><span class="n">contId</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">trigger</span> <span class="o">=</span> <span class="n">contListWindow</span><span class="p">.</span><span class="n">contName</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">id</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">trigger</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">ifind</span> <span class="o">=</span> <span class="n">findItemsInArray</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>

            <span class="kr">if</span> <span class="n">ifind</span> <span class="kr">then</span>

                <span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">[</span><span class="n">ifind</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">item</span> <span class="o">=</span> <span class="n">id</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">trigger</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">[</span><span class="n">ifind</span><span class="p">].</span><span class="n">enabled</span><span class="p">,</span> <span class="n">min</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">[</span><span class="n">ifind</span><span class="p">].</span><span class="n">min</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">[</span><span class="n">ifind</span><span class="p">].</span><span class="n">items</span><span class="p">}</span>

            <span class="kr">else</span>

                <span class="nb">table.insert</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">item</span> <span class="o">=</span> <span class="n">id</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">trigger</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">min</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">})</span>

            <span class="kr">end</span>

            <span class="n">contListWindow</span><span class="p">.</span><span class="n">contId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">contListWindow</span><span class="p">.</span><span class="n">contName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">contListWindow</span><span class="p">.</span><span class="n">contName</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

            <span class="n">contListWindow</span><span class="p">.</span><span class="n">contName</span><span class="p">:</span><span class="n">setImageColor</span><span class="p">(</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">)</span>

            <span class="n">contListWindow</span><span class="p">.</span><span class="n">contId</span><span class="p">:</span><span class="n">setImageColor</span><span class="p">(</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">)</span>

            <span class="n">refreshContNames</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

        <span class="kr">else</span>

            <span class="n">contListWindow</span><span class="p">.</span><span class="n">contId</span><span class="p">:</span><span class="n">setImageColor</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="n">contListWindow</span><span class="p">.</span><span class="n">contName</span><span class="p">:</span><span class="n">setImageColor</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="n">contListWindow</span><span class="p">.</span><span class="n">contName</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">refreshContNames</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">onContainerOpen</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">previousContainer</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">container</span><span class="p">.</span><span class="n">window</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">containerWindow</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">window</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">previousContainer</span> <span class="kr">then</span>

        <span class="n">containerWindow</span><span class="p">:</span><span class="n">setContentHeight</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">storageVal</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">list</span>

    <span class="kr">if</span> <span class="n">storageVal</span> <span class="ow">and</span> <span class="o">#</span><span class="n">storageVal</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storageVal</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">(),</span> <span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

                <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">min</span> <span class="kr">then</span>

                    <span class="n">containerWindow</span><span class="p">:</span><span class="n">minimize</span><span class="p">()</span>

                <span class="kr">end</span>

                <span class="kr">if</span> <span class="n">renameContui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">isOn</span><span class="p">()</span> <span class="kr">then</span>

                    <span class="n">containerWindow</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

                <span class="kr">end</span>

                <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">openNext</span> <span class="kr">then</span>

                    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                        <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">item</span> <span class="kr">then</span>

                            <span class="kd">local</span> <span class="n">time</span> <span class="o">=</span> <span class="o">#</span><span class="n">storageVal</span> <span class="o">*</span> <span class="mi">250</span>

                            <span class="n">schedule</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                                <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="mi">250</span>

                                <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                            <span class="kr">end</span><span class="p">)</span>

                        <span class="kr">end</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">nameContainersOnLogin</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">renameContui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">isOn</span><span class="p">()</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">container</span><span class="p">.</span><span class="n">window</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

            <span class="kd">local</span> <span class="n">containerWindow</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">window</span>

            <span class="kd">local</span> <span class="n">storageVal</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">list</span>

            <span class="kr">if</span> <span class="n">storageVal</span> <span class="ow">and</span> <span class="o">#</span><span class="n">storageVal</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

                <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storageVal</span><span class="p">)</span> <span class="kr">do</span>

                    <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">(),</span> <span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

                        <span class="n">containerWindow</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">nameContainersOnLogin</span><span class="p">()</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">moveItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

    <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span><span class="n">getSlotPosition</span><span class="p">(</span><span class="n">destination</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">()),</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">properTable</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">r</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="kr">then</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>

      <span class="kr">else</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">r</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">mainLoop</span> <span class="o">=</span> <span class="n">macro</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">sort</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">purse</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">storageVal</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">list</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storageVal</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">dId</span> <span class="o">=</span> <span class="n">entry</span><span class="p">.</span><span class="n">item</span>

        <span class="kd">local</span> <span class="n">items</span> <span class="o">=</span> <span class="n">properTable</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">items</span><span class="p">)</span>

        <span class="c1">-- sorting</span>

        <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">sort</span> <span class="kr">then</span>

            <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

                <span class="kd">local</span> <span class="n">cName</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

                <span class="kr">if</span> <span class="ow">not</span> <span class="n">cName</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;depot&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cName</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;depot&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cName</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;quiver&quot;</span><span class="p">)</span> <span class="kr">then</span>

                    <span class="kd">local</span> <span class="n">cId</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

                    <span class="kr">for</span> <span class="n">__</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                        <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

                        <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cId</span> <span class="o">~=</span> <span class="n">dId</span> <span class="kr">then</span>

                            <span class="kd">local</span> <span class="n">destination</span> <span class="o">=</span> <span class="n">getContainerByItem</span><span class="p">(</span><span class="n">dId</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

                            <span class="kr">if</span> <span class="n">destination</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">containerIsFull</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span> <span class="kr">then</span>

                                <span class="kr">return</span> <span class="n">moveItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

                            <span class="kr">end</span>

                        <span class="kr">end</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="c1">-- keep open / purse 23396</span>

        <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">forceOpen</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">container</span> <span class="o">=</span> <span class="n">getContainerByItem</span><span class="p">(</span><span class="n">dId</span><span class="p">)</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">container</span> <span class="kr">then</span>

                <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="n">getBack</span><span class="p">(),</span> <span class="n">getAmmo</span><span class="p">(),</span> <span class="n">getFinger</span><span class="p">(),</span> <span class="n">getNeck</span><span class="p">(),</span> <span class="n">getLeft</span><span class="p">(),</span> <span class="n">getRight</span><span class="p">()}</span>

                <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">t</span> <span class="kr">do</span>

                    <span class="kd">local</span> <span class="n">slot</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="kr">if</span> <span class="n">slot</span> <span class="ow">and</span> <span class="n">slot</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">dId</span> <span class="kr">then</span>

                        <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

                <span class="kd">local</span> <span class="n">cItem</span> <span class="o">=</span> <span class="n">findItem</span><span class="p">(</span><span class="n">dId</span><span class="p">)</span>

                <span class="kr">if</span> <span class="n">cItem</span> <span class="kr">then</span>

                    <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">cItem</span><span class="p">)</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">purse</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">forceOpen</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">getContainerByItem</span><span class="p">(</span><span class="mi">23396</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">use</span><span class="p">(</span><span class="n">getPurse</span><span class="p">())</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">lootBag</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">forceOpen</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">getContainerByItem</span><span class="p">(</span><span class="mi">23721</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">findItem</span><span class="p">(</span><span class="mi">23721</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">findItem</span><span class="p">(</span><span class="mi">23721</span><span class="p">),</span> <span class="n">getContainerByItem</span><span class="p">(</span><span class="mi">23396</span><span class="p">))</span>

        <span class="kr">else</span>

            <span class="kr">return</span> <span class="n">use</span><span class="p">(</span><span class="n">getPurse</span><span class="p">())</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">macro</span><span class="p">:</span><span class="n">setOff</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onContainerOpen</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">previousContainer</span><span class="p">)</span>

    <span class="n">mainLoop</span><span class="p">:</span><span class="n">setOn</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onAddItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

    <span class="n">mainLoop</span><span class="p">:</span><span class="n">setOn</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onPlayerInventoryChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

    <span class="n">mainLoop</span><span class="p">:</span><span class="n">setOn</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onContainerClose</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">container</span><span class="p">.</span><span class="n">lootContainer</span> <span class="kr">then</span>

        <span class="n">mainLoop</span><span class="p">:</span><span class="n">setOn</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="dropper-lua">
<h1>Dropper.lua<a class="headerlink" href="#dropper-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 19</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;Dropper&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: edit</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Edit</span>

<span class="s">]]</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">edit</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 150</span>

<span class="s">  Label</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-top: 5</span>

<span class="s">    text-align: center</span>

<span class="s">    text: Trash:</span>

<span class="s">  BotContainer</span>

<span class="s">    id: TrashItems</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    height: 32</span>

<span class="s">  Label</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    margin-top: 5</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    text-align: center</span>

<span class="s">    text: Use:</span>

<span class="s">  BotContainer</span>

<span class="s">    id: UseItems</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    height: 32</span>

<span class="s">  Label</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    margin-top: 5</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    text-align: center</span>

<span class="s">    text: Drop if below 150 cap:</span>

<span class="s">  BotContainer</span>

<span class="s">    id: CapItems</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    height: 32</span>

<span class="s">]]</span><span class="p">)</span>

<span class="n">edit</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">dropper</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">dropper</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">trashItems</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">283</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">285</span> <span class="p">},</span>

      <span class="n">useItems</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">21203</span><span class="p">,</span> <span class="mi">14758</span> <span class="p">},</span>

      <span class="n">capItems</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">21175</span> <span class="p">}</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">dropper</span>

<span class="kd">local</span> <span class="n">showEdit</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">ui</span><span class="p">.</span><span class="n">edit</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">showEdit</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">showEdit</span>

  <span class="kr">if</span> <span class="n">showEdit</span> <span class="kr">then</span>

    <span class="n">edit</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="kr">else</span>

    <span class="n">edit</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

  <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Container</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

    <span class="n">config</span><span class="p">.</span><span class="n">trashItems</span> <span class="o">=</span> <span class="n">edit</span><span class="p">.</span><span class="n">TrashItems</span><span class="p">:</span><span class="n">getItems</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">edit</span><span class="p">.</span><span class="n">TrashItems</span><span class="p">)</span>

<span class="n">edit</span><span class="p">.</span><span class="n">TrashItems</span><span class="p">:</span><span class="n">setItems</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">trashItems</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Container</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

    <span class="n">config</span><span class="p">.</span><span class="n">useItems</span> <span class="o">=</span> <span class="n">edit</span><span class="p">.</span><span class="n">UseItems</span><span class="p">:</span><span class="n">getItems</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">edit</span><span class="p">.</span><span class="n">UseItems</span><span class="p">)</span>

<span class="n">edit</span><span class="p">.</span><span class="n">UseItems</span><span class="p">:</span><span class="n">setItems</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">useItems</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Container</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

    <span class="n">config</span><span class="p">.</span><span class="n">capItems</span> <span class="o">=</span> <span class="n">edit</span><span class="p">.</span><span class="n">CapItems</span><span class="p">:</span><span class="n">getItems</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">edit</span><span class="p">.</span><span class="n">CapItems</span><span class="p">)</span>

<span class="n">edit</span><span class="p">.</span><span class="n">CapItems</span><span class="p">:</span><span class="n">setItems</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">capItems</span><span class="p">)</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">properTable</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">r</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

      <span class="nb">table.insert</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">r</span>

<span class="kr">end</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">tables</span> <span class="o">=</span> <span class="p">{</span><span class="n">properTable</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">capItems</span><span class="p">),</span> <span class="n">properTable</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">useItems</span><span class="p">),</span> <span class="n">properTable</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">trashItems</span><span class="p">)}</span>

    <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">getContainers</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span> <span class="kr">do</span>

        <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">for</span> <span class="n">__</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                <span class="kr">for</span> <span class="n">___</span><span class="p">,</span> <span class="n">userItem</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="kr">do</span>

                    <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">userItem</span> <span class="kr">then</span>

                        <span class="kr">return</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">freecap</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">150</span> <span class="ow">and</span> <span class="n">dropItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">or</span>

                               <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">use</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">or</span>

                               <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">dropItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="equipper-lua">
<h1>Equipper.lua<a class="headerlink" href="#equipper-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;EquipperPanel&quot;</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 19</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: switch</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;EQ Manager&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: setup</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Setup</span>

<span class="s">]]</span><span class="p">)</span>

<span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">bosses</span> <span class="kr">then</span> <span class="c1">-- no bosses - old ver</span>

    <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

        <span class="n">rules</span> <span class="o">=</span> <span class="p">{},</span>

        <span class="n">bosses</span> <span class="o">=</span> <span class="p">{}</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="n">ui</span><span class="p">.</span><span class="n">switch</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">switch</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span> <span class="c1">-- always add new conditions at the bottom</span>

    <span class="s2">&quot;Item is available and not worn.&quot;</span><span class="p">,</span> <span class="c1">-- nothing 1</span>

    <span class="s2">&quot;Monsters around is more than: &quot;</span><span class="p">,</span> <span class="c1">-- spinbox 2</span>

    <span class="s2">&quot;Monsters around is less than: &quot;</span><span class="p">,</span> <span class="c1">-- spinbox 3</span>

    <span class="s2">&quot;Health precent is below:&quot;</span><span class="p">,</span> <span class="c1">-- spinbox 4</span>

    <span class="s2">&quot;Health precent is above:&quot;</span><span class="p">,</span> <span class="c1">-- spinbox 5</span>

    <span class="s2">&quot;Mana precent is below:&quot;</span><span class="p">,</span> <span class="c1">-- spinbox 6</span>

    <span class="s2">&quot;Mana precent is above:&quot;</span><span class="p">,</span> <span class="c1">-- spinbox 7</span>

    <span class="s2">&quot;Target name is:&quot;</span><span class="p">,</span> <span class="c1">-- BotTextEdit 8</span>

    <span class="s2">&quot;Hotkey is being pressed:&quot;</span><span class="p">,</span> <span class="c1">-- BotTextEdit 9</span>

    <span class="s2">&quot;Player is paralyzed&quot;</span><span class="p">,</span> <span class="c1">-- nothing 10</span>

    <span class="s2">&quot;Player is in protection zone&quot;</span><span class="p">,</span> <span class="c1">-- nothing 11</span>

    <span class="s2">&quot;Players around is more than:&quot;</span><span class="p">,</span> <span class="c1">-- spinbox 12</span>

    <span class="s2">&quot;Players around is less than:&quot;</span><span class="p">,</span> <span class="c1">-- spinbox 13</span>

    <span class="s2">&quot;TargetBot Danger is Above:&quot;</span><span class="p">,</span> <span class="c1">-- spinbox 14</span>

    <span class="s2">&quot;Blacklist player in range (sqm)&quot;</span><span class="p">,</span> <span class="c1">-- spinbox 15</span>

    <span class="s2">&quot;Target is Boss&quot;</span><span class="p">,</span> <span class="c1">-- nothing 16</span>

    <span class="s2">&quot;Player is NOT in protection zone&quot;</span><span class="p">,</span> <span class="c1">-- nothing 17</span>

    <span class="s2">&quot;CaveBot is ON, TargetBot is OFF&quot;</span> <span class="c1">-- nothing 18</span>

<span class="p">}</span>

<span class="kd">local</span> <span class="n">conditionNumber</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kd">local</span> <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="mi">2</span>

<span class="kd">local</span> <span class="n">mainWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s2">&quot;EquipWindow&quot;</span><span class="p">)</span>

<span class="n">mainWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">ui</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">mainWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="n">mainWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

    <span class="n">mainWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">inputPanel</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">.</span><span class="n">inputPanel</span>

<span class="kd">local</span> <span class="n">listPanel</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">.</span><span class="n">listPanel</span>

<span class="kd">local</span> <span class="n">namePanel</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">.</span><span class="n">profileName</span>

<span class="kd">local</span> <span class="n">eqPanel</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">.</span><span class="n">setup</span>

<span class="kd">local</span> <span class="n">bossPanel</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">.</span><span class="n">bossPanel</span>

<span class="kd">local</span> <span class="n">slotWidgets</span> <span class="o">=</span> <span class="p">{</span><span class="n">eqPanel</span><span class="p">.</span><span class="n">head</span><span class="p">,</span> <span class="n">eqPanel</span><span class="p">.</span><span class="n">body</span><span class="p">,</span> <span class="n">eqPanel</span><span class="p">.</span><span class="n">legs</span><span class="p">,</span> <span class="n">eqPanel</span><span class="p">.</span><span class="n">feet</span><span class="p">,</span> <span class="n">eqPanel</span><span class="p">.</span><span class="n">neck</span><span class="p">,</span> <span class="n">eqPanel</span><span class="p">[</span><span class="s2">&quot;left-hand&quot;</span><span class="p">],</span> <span class="n">eqPanel</span><span class="p">[</span><span class="s2">&quot;right-hand&quot;</span><span class="p">],</span> <span class="n">eqPanel</span><span class="p">.</span><span class="n">finger</span><span class="p">,</span> <span class="n">eqPanel</span><span class="p">.</span><span class="n">ammo</span><span class="p">}</span> <span class="c1">-- back is disabled</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">setCondition</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">widget</span>

    <span class="kd">local</span> <span class="n">spinBox</span>

    <span class="kd">local</span> <span class="n">textEdit</span>

    <span class="kr">if</span> <span class="n">first</span> <span class="kr">then</span>

        <span class="n">widget</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">description</span><span class="p">.</span><span class="n">text</span>

        <span class="n">spinBox</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">spinbox</span>

        <span class="n">textEdit</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">text</span>

    <span class="kr">else</span>

        <span class="n">widget</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">description</span><span class="p">.</span><span class="n">text</span>

        <span class="n">spinBox</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">spinbox</span>

        <span class="n">textEdit</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">text</span>

    <span class="kr">end</span>

    <span class="c1">-- reset values after change</span>

    <span class="n">spinBox</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">textEdit</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">16</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">17</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">18</span> <span class="kr">then</span>

        <span class="n">spinBox</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

        <span class="n">textEdit</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">8</span> <span class="kr">then</span>

        <span class="n">spinBox</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

        <span class="n">textEdit</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">9</span> <span class="kr">then</span>

            <span class="n">textEdit</span><span class="p">:</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">75</span><span class="p">)</span>

        <span class="kr">else</span>

            <span class="n">textEdit</span><span class="p">:</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="n">spinBox</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

        <span class="n">textEdit</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">conditions</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">resetFields</span><span class="p">()</span>

    <span class="n">conditionNumber</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">setCondition</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="n">optionalConditionNumber</span><span class="p">)</span>

    <span class="n">setCondition</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">conditionNumber</span><span class="p">)</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">widget</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">slotWidgets</span><span class="p">)</span> <span class="kr">do</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

        <span class="n">child</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">end</span>

    <span class="n">namePanel</span><span class="p">.</span><span class="n">profileName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">spinbox</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">inputPanel</span><span class="p">.</span><span class="n">useSecondCondition</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>

    <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">spinbox</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="n">bossPanel</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="n">listPanel</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="n">mainWindow</span><span class="p">.</span><span class="n">bossList</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Boss List&#39;</span><span class="p">)</span>

    <span class="n">bossPanel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">resetFields</span><span class="p">()</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">resetFields</span><span class="p">()</span>

    <span class="n">mainWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">useSecondCondition</span><span class="p">.</span><span class="n">onOptionChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">option</span> <span class="o">~=</span> <span class="s2">&quot;-&quot;</span> <span class="kr">then</span>

        <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="kr">else</span>

        <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- add default text &amp; windows</span>

<span class="n">setCondition</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">setCondition</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">-- in/de/crementation buttons</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">nex</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="o">#</span><span class="n">conditions</span>

    <span class="kr">if</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">:</span><span class="n">isVisible</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="n">max</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

                <span class="n">conditionNumber</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="kr">else</span>

                <span class="n">conditionNumber</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="kr">end</span>

        <span class="kr">else</span>

            <span class="kd">local</span> <span class="n">futureNumber</span> <span class="o">=</span> <span class="n">conditionNumber</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="kd">local</span> <span class="n">safeFutureNumber</span> <span class="o">=</span> <span class="n">conditionNumber</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">max</span> <span class="ow">and</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">conditionNumber</span> <span class="o">+</span> <span class="mi">2</span>

            <span class="n">conditionNumber</span> <span class="o">=</span> <span class="n">futureNumber</span> <span class="o">~=</span> <span class="n">optionalConditionNumber</span> <span class="ow">and</span> <span class="n">futureNumber</span> <span class="ow">or</span> <span class="n">safeFutureNumber</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="n">conditionNumber</span> <span class="o">=</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="n">max</span> <span class="ow">and</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">conditionNumber</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="kr">if</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="n">conditionNumber</span> <span class="kr">then</span>

            <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="n">max</span> <span class="ow">and</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">optionalConditionNumber</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">setCondition</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="n">optionalConditionNumber</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">setCondition</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">conditionNumber</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="o">#</span><span class="n">conditions</span>

    <span class="kr">if</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">:</span><span class="n">isVisible</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="n">max</span> <span class="kr">then</span>

                <span class="n">conditionNumber</span> <span class="o">=</span> <span class="n">max</span><span class="o">-</span><span class="mi">1</span>

            <span class="kr">else</span>

                <span class="n">conditionNumber</span> <span class="o">=</span> <span class="n">max</span>

            <span class="kr">end</span>

        <span class="kr">else</span>

            <span class="kd">local</span> <span class="n">futureNumber</span> <span class="o">=</span> <span class="n">conditionNumber</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="kd">local</span> <span class="n">safeFutureNumber</span> <span class="o">=</span> <span class="n">conditionNumber</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">max</span> <span class="ow">or</span> <span class="n">conditionNumber</span> <span class="o">-</span> <span class="mi">2</span>

            <span class="n">conditionNumber</span> <span class="o">=</span> <span class="n">futureNumber</span> <span class="o">~=</span> <span class="n">optionalConditionNumber</span> <span class="ow">and</span> <span class="n">futureNumber</span> <span class="ow">or</span> <span class="n">safeFutureNumber</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="n">conditionNumber</span> <span class="o">=</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">max</span> <span class="ow">or</span> <span class="n">conditionNumber</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="kr">if</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="n">conditionNumber</span> <span class="kr">then</span>

            <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">max</span> <span class="ow">or</span> <span class="n">optionalConditionNumber</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">setCondition</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="n">optionalConditionNumber</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">setCondition</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">conditionNumber</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">nex</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="o">#</span><span class="n">conditions</span>

    <span class="kr">if</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="n">max</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

            <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="kr">else</span>

            <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="kd">local</span> <span class="n">futureNumber</span> <span class="o">=</span> <span class="n">optionalConditionNumber</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="kd">local</span> <span class="n">safeFutureNumber</span> <span class="o">=</span> <span class="n">optionalConditionNumber</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">max</span> <span class="ow">and</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">optionalConditionNumber</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="n">futureNumber</span> <span class="o">~=</span> <span class="n">conditionNumber</span> <span class="ow">and</span> <span class="n">futureNumber</span> <span class="ow">or</span> <span class="n">safeFutureNumber</span>

    <span class="kr">end</span>

    <span class="n">setCondition</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="n">optionalConditionNumber</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="o">#</span><span class="n">conditions</span>

    <span class="kr">if</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="n">max</span> <span class="kr">then</span>

            <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="n">max</span><span class="o">-</span><span class="mi">1</span>

        <span class="kr">else</span>

            <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="n">max</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="kd">local</span> <span class="n">futureNumber</span> <span class="o">=</span> <span class="n">optionalConditionNumber</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="kd">local</span> <span class="n">safeFutureNumber</span> <span class="o">=</span> <span class="n">optionalConditionNumber</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">max</span> <span class="ow">or</span> <span class="n">optionalConditionNumber</span> <span class="o">-</span> <span class="mi">2</span>

        <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="n">futureNumber</span> <span class="o">~=</span> <span class="n">conditionNumber</span> <span class="ow">and</span> <span class="n">futureNumber</span> <span class="ow">or</span> <span class="n">safeFutureNumber</span>

    <span class="kr">end</span>

    <span class="n">setCondition</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="n">optionalConditionNumber</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">listPanel</span><span class="p">.</span><span class="n">up</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">focused</span> <span class="o">=</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">focused</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">rules</span>

    <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

    <span class="kr">if</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">listPanel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

    <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">focused</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">ensureChildVisible</span><span class="p">(</span><span class="n">focused</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">listPanel</span><span class="p">.</span><span class="n">down</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">focused</span> <span class="o">=</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">focused</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">rules</span>

    <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

    <span class="kr">if</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span> <span class="kr">then</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">listPanel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

    <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">focused</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">ensureChildVisible</span><span class="p">(</span><span class="n">focused</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">eqPanel</span><span class="p">.</span><span class="n">cloneEq</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">.</span><span class="n">head</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getHead</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getHead</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">.</span><span class="n">body</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getBody</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getBody</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">.</span><span class="n">legs</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getLeg</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getLeg</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">.</span><span class="n">feet</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getFeet</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getFeet</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">.</span><span class="n">neck</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getNeck</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getNeck</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">[</span><span class="s2">&quot;left-hand&quot;</span><span class="p">]:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getLeft</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getLeft</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">[</span><span class="s2">&quot;right-hand&quot;</span><span class="p">]:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getRight</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getRight</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">.</span><span class="n">finger</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getFinger</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getFinger</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">eqPanel</span><span class="p">.</span><span class="n">ammo</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">getAmmo</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getAmmo</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">eqPanel</span><span class="p">.</span><span class="n">default</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="n">resetFields</span>

<span class="c1">-- buttons disabled by default</span>

<span class="n">listPanel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

<span class="n">listPanel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

<span class="c1">-- correct background image</span>

<span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">widget</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">slotWidgets</span><span class="p">)</span> <span class="kr">do</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;Right click to set as slot to unequip&quot;</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">selfId</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">selfId</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">widget</span><span class="p">:</span><span class="n">isChecked</span><span class="p">()</span> <span class="kr">then</span>

            <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">selfId</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">onMouseRelease</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">mousePos</span><span class="p">,</span> <span class="n">mouseButton</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">mouseButton</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">clearItem</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">isChecked</span><span class="p">()</span> <span class="o">==</span> <span class="kc">false</span>

            <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="ow">not</span> <span class="n">widget</span><span class="p">:</span><span class="n">isChecked</span><span class="p">())</span>

            <span class="kr">if</span> <span class="n">clearItem</span> <span class="kr">then</span>

                <span class="n">widget</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">description</span><span class="p">.</span><span class="n">onMouseWheel</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">mousePos</span><span class="p">,</span> <span class="n">scroll</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">scroll</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">nex</span><span class="p">.</span><span class="n">onClick</span><span class="p">()</span>

    <span class="kr">else</span>

        <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="n">onClick</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">description</span><span class="p">.</span><span class="n">onMouseWheel</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">mousePos</span><span class="p">,</span> <span class="n">scroll</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">scroll</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">nex</span><span class="p">.</span><span class="n">onClick</span><span class="p">()</span>

    <span class="kr">else</span>

        <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">pre</span><span class="p">.</span><span class="n">onClick</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">namePanel</span><span class="p">.</span><span class="n">profileName</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">button</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">add</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">child</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">button</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="n">text</span> <span class="ow">and</span> <span class="s2">&quot;Overwrite&quot;</span> <span class="ow">or</span> <span class="s2">&quot;Add Rule&quot;</span><span class="p">)</span>

        <span class="n">button</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="n">text</span> <span class="ow">and</span> <span class="s2">&quot;Overwrite existing rule named: &quot;</span><span class="o">..</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Add new rule to the list: &quot;</span><span class="o">..</span><span class="n">name</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">setupPreview</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">namePanel</span><span class="p">.</span><span class="n">profileName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">display</span> <span class="kr">then</span>

        <span class="n">resetFields</span><span class="p">()</span>

    <span class="kr">else</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">slotWidgets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="kr">if</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">false</span> <span class="kr">then</span>

                <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

                <span class="n">widget</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="kr">elseif</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">true</span> <span class="kr">then</span>

                <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

                <span class="n">widget</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="kr">else</span>

                <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

                <span class="n">widget</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">refreshRules</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span>

    <span class="n">list</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">rules</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;Rule&#39;</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">ruleData</span> <span class="o">=</span> <span class="n">v</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

            <span class="n">widget</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

            <span class="nb">table.remove</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">rules</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">rules</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>

            <span class="n">listPanel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

            <span class="n">listPanel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

            <span class="n">refreshRules</span><span class="p">()</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">visible</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">visible</span> <span class="ow">and</span> <span class="s2">&quot;green&quot;</span> <span class="ow">or</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">visible</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

            <span class="n">v</span><span class="p">.</span><span class="n">visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">v</span><span class="p">.</span><span class="n">visible</span>

            <span class="n">widget</span><span class="p">.</span><span class="n">visible</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">visible</span> <span class="ow">and</span> <span class="s2">&quot;green&quot;</span> <span class="ow">or</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

            <span class="n">v</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">v</span><span class="p">.</span><span class="n">enabled</span>

            <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">onHoverChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">hover</span><span class="p">)</span>

            <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

                <span class="kr">if</span> <span class="n">child</span><span class="p">.</span><span class="n">display</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

            <span class="kr">end</span>

            <span class="n">setupPreview</span><span class="p">(</span><span class="n">hover</span><span class="p">,</span> <span class="n">widget</span><span class="p">.</span><span class="n">ruleData</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

            <span class="kd">local</span> <span class="n">ruleData</span> <span class="o">=</span> <span class="n">widget</span><span class="p">.</span><span class="n">ruleData</span>

            <span class="n">widget</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="kc">true</span>

            <span class="n">setupPreview</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">ruleData</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>

            <span class="n">conditionNumber</span> <span class="o">=</span> <span class="n">ruleData</span><span class="p">.</span><span class="n">mainCondition</span>

            <span class="n">optionalConditionNumber</span> <span class="o">=</span> <span class="n">ruleData</span><span class="p">.</span><span class="n">optionalCondition</span>

            <span class="n">setCondition</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="n">optionalConditionNumber</span><span class="p">)</span>

            <span class="n">setCondition</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">conditionNumber</span><span class="p">)</span>

            <span class="n">inputPanel</span><span class="p">.</span><span class="n">useSecondCondition</span><span class="p">:</span><span class="n">setOption</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">relation</span><span class="p">)</span>

            <span class="n">namePanel</span><span class="p">.</span><span class="n">profileName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

            <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">mainValue</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span>

                <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">mainValue</span><span class="p">)</span>

            <span class="kr">elseif</span> <span class="nb">type</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">mainValue</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="kr">then</span>

                <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">spinbox</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">mainValue</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">optValue</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span>

                <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">optValue</span><span class="p">)</span>

            <span class="kr">elseif</span> <span class="nb">type</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">optValue</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="kr">then</span>

                <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">spinbox</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">ruleData</span><span class="p">.</span><span class="n">optValue</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

            <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">listPanel</span>

            <span class="kr">if</span> <span class="o">#</span><span class="n">panel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

                <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

                <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

            <span class="kr">elseif</span> <span class="n">panel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

                <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

                <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

            <span class="kr">elseif</span> <span class="n">panel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">())</span> <span class="o">==</span> <span class="o">#</span><span class="n">panel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">()</span> <span class="kr">then</span>

                <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

                <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

            <span class="kr">else</span>

                <span class="n">panel</span><span class="p">.</span><span class="n">up</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

                <span class="n">panel</span><span class="p">.</span><span class="n">down</span><span class="p">:</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">refreshRules</span><span class="p">()</span>

<span class="n">inputPanel</span><span class="p">.</span><span class="n">add</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">mainVal</span>

    <span class="kd">local</span> <span class="n">optVal</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kd">local</span> <span class="n">relation</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">useSecondCondition</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">profileName</span> <span class="o">=</span> <span class="n">namePanel</span><span class="p">.</span><span class="n">profileName</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">profileName</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;Please fill profile name!&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">widget</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">slotWidgets</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">checked</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">isChecked</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">checked</span> <span class="kr">then</span>

            <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">-- unequip selected slot</span>

        <span class="kr">elseif</span> <span class="n">id</span> <span class="kr">then</span>

            <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="c1">-- equip selected item</span>

        <span class="kr">else</span>

            <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="c1">-- ignore slot</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">mainVal</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">elseif</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="mi">8</span> <span class="kr">then</span>

        <span class="n">mainVal</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">mainVal</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[vBot Equipper] Please fill the name of the creature.&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">elseif</span> <span class="n">conditionNumber</span> <span class="o">==</span> <span class="mi">9</span> <span class="kr">then</span>

        <span class="n">mainVal</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">mainVal</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[vBot Equipper] Please set correct hotkey.&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="n">mainVal</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">condition</span><span class="p">.</span><span class="n">spinbox</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">relation</span> <span class="o">~=</span> <span class="s2">&quot;-&quot;</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

            <span class="n">optVal</span> <span class="o">=</span> <span class="kc">nil</span>

        <span class="kr">elseif</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="mi">8</span> <span class="kr">then</span>

            <span class="n">optVal</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

            <span class="kr">if</span> <span class="n">optVal</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[vBot Equipper] Please fill the name of the creature.&quot;</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">elseif</span> <span class="n">optionalConditionNumber</span> <span class="o">==</span> <span class="mi">9</span> <span class="kr">then</span>

            <span class="n">optVal</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

            <span class="kr">if</span> <span class="n">optVal</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[vBot Equipper] Please set correct hotkey.&quot;</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">else</span>

            <span class="n">optVal</span> <span class="o">=</span> <span class="n">inputPanel</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">.</span><span class="n">spinbox</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">index</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">rules</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">profileName</span> <span class="kr">then</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>   <span class="c1">-- search if there&#39;s already rule with this name</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">ruleData</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">profileName</span><span class="p">,</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span>

        <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

        <span class="n">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

        <span class="n">mainCondition</span> <span class="o">=</span> <span class="n">conditionNumber</span><span class="p">,</span>

        <span class="n">optionalCondition</span> <span class="o">=</span> <span class="n">optionalConditionNumber</span><span class="p">,</span>

        <span class="n">mainValue</span> <span class="o">=</span> <span class="n">mainVal</span><span class="p">,</span>

        <span class="n">optValue</span> <span class="o">=</span> <span class="n">optVal</span><span class="p">,</span>

        <span class="n">relation</span> <span class="o">=</span> <span class="n">relation</span><span class="p">,</span>

<span class="p">}</span>

    <span class="kr">if</span> <span class="n">index</span> <span class="kr">then</span>

        <span class="n">config</span><span class="p">.</span><span class="n">rules</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">ruleData</span> <span class="c1">-- overwrite</span>

    <span class="kr">else</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">rules</span><span class="p">,</span> <span class="n">ruleData</span><span class="p">)</span> <span class="c1">-- create new one</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

        <span class="n">child</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">end</span>

    <span class="n">resetFields</span><span class="p">()</span>

    <span class="n">refreshRules</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">bossList</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">bossPanel</span><span class="p">:</span><span class="n">isVisible</span><span class="p">()</span> <span class="kr">then</span>

        <span class="n">bossPanel</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

        <span class="n">listPanel</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Boss List&#39;</span><span class="p">)</span>

    <span class="kr">else</span>

        <span class="n">bossPanel</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

        <span class="n">listPanel</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Rule List&#39;</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- create boss labels</span>

<span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bosses</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;BossLabel&quot;</span><span class="p">,</span> <span class="n">bossPanel</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="nb">table.remove</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bosses</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bosses</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">bossPanel</span><span class="p">.</span><span class="n">add</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">bossPanel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">name</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[Equipped] Please enter boss name!&quot;</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bosses</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">(),</span> <span class="kc">true</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[Equipper] Boss already added!&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;BossLabel&quot;</span><span class="p">,</span> <span class="n">bossPanel</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="nb">table.remove</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bosses</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bosses</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="nb">table.insert</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bosses</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">bossPanel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">interpreteCondition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">getMonsters</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">v</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">getMonsters</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">v</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">v</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">5</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">v</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">6</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">v</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">7</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">v</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">8</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">target</span><span class="p">()</span> <span class="ow">and</span> <span class="n">target</span><span class="p">():</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="kc">false</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">9</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">g_keyboard</span><span class="p">.</span><span class="n">isKeyPressed</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">10</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">isParalyzed</span><span class="p">()</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">11</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">isInPz</span><span class="p">()</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">12</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">getPlayers</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">v</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">13</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">getPlayers</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">v</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">14</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">Danger</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">15</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">isBlackListedPlayerInRange</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">16</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">target</span><span class="p">()</span> <span class="ow">and</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">bosses</span><span class="p">,</span> <span class="n">target</span><span class="p">():</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">(),</span> <span class="kc">true</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">true</span> <span class="ow">or</span> <span class="kc">false</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">17</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="ow">not</span> <span class="n">isInPz</span><span class="p">()</span>

    <span class="kr">elseif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">18</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span> <span class="ow">and</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">finalCheck</span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="n">relation</span><span class="p">,</span><span class="n">second</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">relation</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">first</span>

    <span class="kr">elseif</span> <span class="n">relation</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">first</span> <span class="ow">and</span> <span class="n">second</span>

    <span class="kr">elseif</span> <span class="n">relation</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">first</span> <span class="ow">or</span> <span class="n">second</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">isEquipped</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="n">getNeck</span><span class="p">(),</span> <span class="n">getHead</span><span class="p">(),</span> <span class="n">getBody</span><span class="p">(),</span> <span class="n">getRight</span><span class="p">(),</span> <span class="n">getLeft</span><span class="p">(),</span> <span class="n">getLeg</span><span class="p">(),</span> <span class="n">getFeet</span><span class="p">(),</span> <span class="n">getFinger</span><span class="p">(),</span> <span class="n">getAmmo</span><span class="p">()}</span>

    <span class="kd">local</span> <span class="n">ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">id</span><span class="p">,</span> <span class="n">getInactiveItemId</span><span class="p">(</span><span class="n">id</span><span class="p">),</span> <span class="n">getActiveItemId</span><span class="p">(</span><span class="n">id</span><span class="p">)}</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slot</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">slot</span> <span class="ow">and</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">slot</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="kc">true</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="kc">false</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">unequipItem</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">slots</span> <span class="o">=</span> <span class="p">{</span><span class="n">getHead</span><span class="p">(),</span> <span class="n">getBody</span><span class="p">(),</span> <span class="n">getLeg</span><span class="p">(),</span> <span class="n">getFeet</span><span class="p">(),</span> <span class="n">getNeck</span><span class="p">(),</span> <span class="n">getLeft</span><span class="p">(),</span> <span class="n">getRight</span><span class="p">(),</span> <span class="n">getFinger</span><span class="p">(),</span> <span class="n">getAmmo</span><span class="p">()}</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slot</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">physicalSlot</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="kr">if</span> <span class="n">slot</span> <span class="o">==</span> <span class="kc">true</span> <span class="ow">and</span> <span class="n">physicalSlot</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">physicalSlot</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

            <span class="kr">if</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">910</span> <span class="kr">then</span>

                <span class="c1">-- new tibia</span>

                <span class="n">g_game</span><span class="p">.</span><span class="n">equipItemId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

            <span class="kr">else</span>

                <span class="c1">-- old tibia</span>

                <span class="kd">local</span> <span class="n">dest</span>

                <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

                    <span class="kd">local</span> <span class="n">cname</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>

                    <span class="kr">if</span> <span class="ow">not</span> <span class="n">containerIsFull</span><span class="p">(</span><span class="n">container</span><span class="p">)</span> <span class="kr">then</span>

                        <span class="kr">if</span> <span class="ow">not</span> <span class="n">cname</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;loot&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cname</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;backpack&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cname</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;bag&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cname</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;chess&quot;</span><span class="p">))</span> <span class="kr">then</span>

                            <span class="n">dest</span> <span class="o">=</span> <span class="n">container</span>

                        <span class="kr">end</span>

                        <span class="kr">break</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

                <span class="kr">if</span> <span class="ow">not</span> <span class="n">dest</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">true</span> <span class="kr">end</span>

                <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">dest</span><span class="p">:</span><span class="n">getSlotPosition</span><span class="p">(</span><span class="n">dest</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">())</span>

                <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">physicalSlot</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">physicalSlot</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

            <span class="kr">end</span>

            <span class="kr">return</span> <span class="kc">true</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="kc">false</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">equipItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>

    <span class="c1">-- need to correct slots...</span>

    <span class="kr">if</span> <span class="n">slot</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

        <span class="n">slot</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="kr">elseif</span> <span class="n">slot</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

        <span class="n">slot</span> <span class="o">=</span> <span class="mi">7</span>

    <span class="kr">elseif</span> <span class="n">slot</span> <span class="o">==</span> <span class="mi">8</span> <span class="kr">then</span>

        <span class="n">slot</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="kr">elseif</span> <span class="n">slot</span> <span class="o">==</span> <span class="mi">5</span> <span class="kr">then</span>

        <span class="n">slot</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="kr">elseif</span> <span class="n">slot</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span>

        <span class="n">slot</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="kr">elseif</span> <span class="n">slot</span> <span class="o">==</span> <span class="mi">9</span> <span class="kr">then</span>

        <span class="n">slot</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="kr">elseif</span> <span class="n">slot</span> <span class="o">==</span> <span class="mi">7</span> <span class="kr">then</span>

        <span class="n">slot</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">910</span> <span class="kr">then</span>

        <span class="c1">-- new tibia</span>

        <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">equipItemId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">else</span>

        <span class="c1">-- old tibia</span>

        <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">findItem</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

        <span class="kr">return</span> <span class="n">moveToSlot</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">markChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">mainWindow</span><span class="p">:</span><span class="n">isVisible</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">child</span> <span class="o">~=</span> <span class="n">widget</span> <span class="kr">then</span>

                <span class="n">child</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">missingItem</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kd">local</span> <span class="n">lastRule</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kd">local</span> <span class="n">correctEq</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">EquipManager</span> <span class="o">=</span> <span class="n">macro</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">config</span><span class="p">.</span><span class="n">rules</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">widget</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">listPanel</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">widget</span><span class="p">.</span><span class="n">ruleData</span>

        <span class="kr">if</span> <span class="n">rule</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

            <span class="c1">-- conditions</span>

            <span class="kd">local</span> <span class="n">firstCondition</span> <span class="o">=</span> <span class="n">interpreteCondition</span><span class="p">(</span><span class="n">rule</span><span class="p">.</span><span class="n">mainCondition</span><span class="p">,</span> <span class="n">rule</span><span class="p">.</span><span class="n">mainValue</span><span class="p">)</span>

            <span class="kd">local</span> <span class="n">optionalCondition</span> <span class="o">=</span> <span class="kc">nil</span>

            <span class="kr">if</span> <span class="n">rule</span><span class="p">.</span><span class="n">relation</span> <span class="o">~=</span> <span class="s2">&quot;-&quot;</span> <span class="kr">then</span>

                <span class="n">optionalCondition</span> <span class="o">=</span> <span class="n">interpreteCondition</span><span class="p">(</span><span class="n">rule</span><span class="p">.</span><span class="n">optionalCondition</span><span class="p">,</span> <span class="n">rule</span><span class="p">.</span><span class="n">optValue</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="c1">-- checks</span>

            <span class="kr">if</span> <span class="n">finalCheck</span><span class="p">(</span><span class="n">firstCondition</span><span class="p">,</span> <span class="n">rule</span><span class="p">.</span><span class="n">relation</span><span class="p">,</span> <span class="n">optionalCondition</span><span class="p">)</span> <span class="kr">then</span>

                <span class="c1">-- performance edits, loop reset</span>

                <span class="kd">local</span> <span class="n">resetLoop</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">missingItem</span> <span class="ow">and</span> <span class="n">correctEq</span> <span class="ow">and</span> <span class="n">lastRule</span> <span class="o">==</span>  <span class="n">rule</span>

                <span class="kr">if</span> <span class="n">resetLoop</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

                <span class="c1">-- reset executed rule</span>

                <span class="c1">-- first check unequip</span>

                <span class="kr">if</span> <span class="n">unequipItem</span><span class="p">(</span><span class="n">rule</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span> <span class="kr">then</span>

                    <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

                    <span class="kr">return</span>

                <span class="kr">end</span>

                <span class="c1">-- equiploop</span>

                <span class="kr">for</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">rule</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="kr">do</span>

                    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="ow">and</span> <span class="n">item</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="kr">then</span>

                        <span class="kr">if</span> <span class="ow">not</span> <span class="n">isEquipped</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

                            <span class="kr">if</span> <span class="n">rule</span><span class="p">.</span><span class="n">visible</span> <span class="kr">then</span>

                                <span class="kr">if</span> <span class="n">findItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

                                    <span class="n">missingItem</span> <span class="o">=</span> <span class="kc">false</span>

                                    <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

                                    <span class="kr">return</span> <span class="n">equipItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>

                                <span class="kr">else</span>

                                    <span class="n">missingItem</span> <span class="o">=</span> <span class="kc">true</span>

                                <span class="kr">end</span>

                            <span class="kr">else</span>

                                <span class="n">missingItem</span> <span class="o">=</span> <span class="kc">false</span>

                                <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

                                <span class="kr">return</span> <span class="n">equipItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>

                            <span class="kr">end</span>

                        <span class="kr">end</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

                <span class="n">correctEq</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">missingItem</span> <span class="ow">and</span> <span class="kc">true</span> <span class="ow">or</span> <span class="kc">false</span>

                <span class="c1">-- even if nothing was done, exit function to hold rule</span>

                <span class="kr">return</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="healbot-lua">
<h1>HealBot.lua<a class="headerlink" href="#healbot-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kd">local</span> <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kd">local</span> <span class="n">red</span> <span class="o">=</span> <span class="s2">&quot;#ff0800&quot;</span> <span class="c1">-- &quot;#ff0800&quot; / #ea3c53 best</span>

<span class="kd">local</span> <span class="n">blue</span> <span class="o">=</span> <span class="s2">&quot;#7ef9ff&quot;</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;HP&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">healPanelName</span> <span class="o">=</span> <span class="s2">&quot;healbot&quot;</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 38</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;HealBot&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: settings</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Setup</span>

<span class="s">  Button</span>

<span class="s">    id: 1</span>

<span class="s">    anchors.top: prev.bottom</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text: 1</span>

<span class="s">    margin-right: 2</span>

<span class="s">    margin-top: 4</span>

<span class="s">    size: 17 17</span>

<span class="s">  Button</span>

<span class="s">    id: 2</span>

<span class="s">    anchors.verticalCenter: prev.verticalCenter</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    text: 2</span>

<span class="s">    margin-left: 4</span>

<span class="s">    size: 17 17</span>

<span class="s">  Button</span>

<span class="s">    id: 3</span>

<span class="s">    anchors.verticalCenter: prev.verticalCenter</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    text: 3</span>

<span class="s">    margin-left: 4</span>

<span class="s">    size: 17 17</span>

<span class="s">  Button</span>

<span class="s">    id: 4</span>

<span class="s">    anchors.verticalCenter: prev.verticalCenter</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    text: 4</span>

<span class="s">    margin-left: 4</span>

<span class="s">    size: 17 17</span>

<span class="s">  Button</span>

<span class="s">    id: 5</span>

<span class="s">    anchors.verticalCenter: prev.verticalCenter</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    text: 5</span>

<span class="s">    margin-left: 4</span>

<span class="s">    size: 17 17</span>

<span class="s">  Label</span>

<span class="s">    id: name</span>

<span class="s">    anchors.verticalCenter: prev.verticalCenter</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    text-align: center</span>

<span class="s">    margin-left: 4</span>

<span class="s">    height: 17</span>

<span class="s">    text: Profile #1</span>

<span class="s">    background: #292A2A</span>

<span class="s">]]</span><span class="p">)</span>

<span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">healPanelName</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">HealBotConfig</span><span class="p">[</span><span class="n">healPanelName</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">HealBotConfig</span><span class="p">[</span><span class="n">healPanelName</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="o">#</span><span class="n">HealBotConfig</span><span class="p">[</span><span class="n">healPanelName</span><span class="p">]</span> <span class="o">~=</span> <span class="mi">5</span> <span class="kr">then</span>

  <span class="n">HealBotConfig</span><span class="p">[</span><span class="n">healPanelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">spellTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">itemTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #1&quot;</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Interval</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Conditions</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Delay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">MessageDelay</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">},</span>

    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">spellTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">itemTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #2&quot;</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Interval</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Conditions</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Delay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">MessageDelay</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">},</span>

    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">spellTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">itemTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #3&quot;</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Interval</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Conditions</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Delay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">MessageDelay</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">},</span>

    <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">spellTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">itemTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #4&quot;</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Interval</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Conditions</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Delay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">MessageDelay</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">},</span>

    <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">spellTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">itemTable</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #5&quot;</span><span class="p">,</span>

      <span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Interval</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Conditions</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">Delay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">MessageDelay</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">},</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span> <span class="ow">or</span> <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="kr">then</span>

  <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kr">end</span>

<span class="c1">-- finding correct table, manual unfortunately</span>

<span class="kd">local</span> <span class="n">currentSettings</span>

<span class="kd">local</span> <span class="n">setActiveProfile</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span>

  <span class="n">currentSettings</span> <span class="o">=</span> <span class="n">HealBotConfig</span><span class="p">[</span><span class="n">healPanelName</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>

<span class="kr">end</span>

<span class="n">setActiveProfile</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">activeProfileColor</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span> <span class="kr">then</span>

      <span class="n">ui</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>

    <span class="kr">else</span>

      <span class="n">ui</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">activeProfileColor</span><span class="p">()</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

  <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;heal&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">ui</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">healWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="n">healWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

  <span class="n">healWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">rootWidget</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">()</span>

<span class="kr">if</span> <span class="n">rootWidget</span> <span class="kr">then</span>

  <span class="n">healWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;HealWindow&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

  <span class="n">healWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">onVisibilityChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">visible</span> <span class="kr">then</span>

      <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;heal&quot;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">settingsButton</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Settings&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settingsButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">:</span><span class="n">isVisible</span><span class="p">()</span> <span class="kr">then</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Back&quot;</span><span class="p">)</span>

    <span class="kr">else</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Settings&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">setProfileName</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">ui</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">profiles</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">text</span>

    <span class="n">setProfileName</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Visible</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Visible</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Interval</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Interval</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Interval</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Interval</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Interval</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Conditions</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Conditions</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Conditions</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Conditions</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Conditions</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Delay</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Delay</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Delay</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Delay</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Delay</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">MessageDelay</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">MessageDelay</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">MessageDelay</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">MessageDelay</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">MessageDelay</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">refreshSpells</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span> <span class="kr">then</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

      <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;SpellEntry&quot;</span><span class="p">,</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">)</span>

        <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

        <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

          <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span>

          <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="n">label</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

          <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="n">table</span><span class="p">.</span><span class="n">removevalue</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>

          <span class="n">reindexTable</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span><span class="p">)</span>

          <span class="n">label</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

        <span class="kr">end</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;(MP&gt;&quot;</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">cost</span> <span class="o">..</span> <span class="s2">&quot;) &quot;</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="o">..</span> <span class="s2">&quot;: &quot;</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">refreshSpells</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">refreshItems</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span> <span class="kr">then</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

      <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;ItemEntry&quot;</span><span class="p">,</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">)</span>

        <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

        <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

          <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span>

          <span class="n">label</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="n">label</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

          <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="n">table</span><span class="p">.</span><span class="n">removevalue</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>

          <span class="n">reindexTable</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span><span class="p">)</span>

          <span class="n">label</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

        <span class="kr">end</span>

        <span class="n">label</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">)</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="o">..</span> <span class="s2">&quot;: &quot;</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">refreshItems</span><span class="p">()</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">MoveUp</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">input</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">input</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">index</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span>

    <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">ensureChildVisible</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">MoveDown</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">input</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">input</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">index</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span>

    <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellList</span><span class="p">:</span><span class="n">ensureChildVisible</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">MoveUp</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">input</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">input</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">index</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span>

    <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">ensureChildVisible</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">MoveDown</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">input</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">getFocusedChild</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">input</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">index</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span>

    <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemList</span><span class="p">:</span><span class="n">ensureChildVisible</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">addSpell</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">spellFormula</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellFormula</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">trim</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">manaCost</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">manaCost</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

    <span class="kd">local</span> <span class="n">spellTrigger</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellValue</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

    <span class="kd">local</span> <span class="n">spellSource</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellSource</span><span class="p">:</span><span class="n">getCurrentOption</span><span class="p">().</span><span class="n">text</span>

    <span class="kd">local</span> <span class="n">spellEquasion</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellCondition</span><span class="p">:</span><span class="n">getCurrentOption</span><span class="p">().</span><span class="n">text</span>

    <span class="kd">local</span> <span class="n">source</span>

    <span class="kd">local</span> <span class="n">equasion</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">manaCost</span> <span class="kr">then</span>

      <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;HealBot: incorrect mana cost value!&quot;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellFormula</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">manaCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">spellTrigger</span> <span class="kr">then</span>

      <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;HealBot: incorrect condition value!&quot;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellFormula</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">manaCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">spellSource</span> <span class="o">==</span> <span class="s2">&quot;Current Mana&quot;</span> <span class="kr">then</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;MP&quot;</span>

    <span class="kr">elseif</span> <span class="n">spellSource</span> <span class="o">==</span> <span class="s2">&quot;Current Health&quot;</span> <span class="kr">then</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;HP&quot;</span>

    <span class="kr">elseif</span> <span class="n">spellSource</span> <span class="o">==</span> <span class="s2">&quot;Mana Percent&quot;</span> <span class="kr">then</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;MP%&quot;</span>

    <span class="kr">elseif</span> <span class="n">spellSource</span> <span class="o">==</span> <span class="s2">&quot;Health Percent&quot;</span> <span class="kr">then</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;HP%&quot;</span>

    <span class="kr">else</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;burst&quot;</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">spellEquasion</span> <span class="o">==</span> <span class="s2">&quot;Above&quot;</span> <span class="kr">then</span>

      <span class="n">equasion</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span>

    <span class="kr">elseif</span> <span class="n">spellEquasion</span> <span class="o">==</span> <span class="s2">&quot;Below&quot;</span> <span class="kr">then</span>

      <span class="n">equasion</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span>

    <span class="kr">else</span>

      <span class="n">equasion</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">spellFormula</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="nb">table.insert</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span><span class="p">,</span>  <span class="p">{</span><span class="n">index</span> <span class="o">=</span> <span class="o">#</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">spell</span> <span class="o">=</span> <span class="n">spellFormula</span><span class="p">,</span> <span class="n">sign</span> <span class="o">=</span> <span class="n">equasion</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">manaCost</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">spellTrigger</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellFormula</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">spellValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">manaCost</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="n">refreshSpells</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">addItem</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemId</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">trigger</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemValue</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

    <span class="kd">local</span> <span class="n">src</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemSource</span><span class="p">:</span><span class="n">getCurrentOption</span><span class="p">().</span><span class="n">text</span>

    <span class="kd">local</span> <span class="n">eq</span> <span class="o">=</span> <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemCondition</span><span class="p">:</span><span class="n">getCurrentOption</span><span class="p">().</span><span class="n">text</span>

    <span class="kd">local</span> <span class="n">source</span>

    <span class="kd">local</span> <span class="n">equasion</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">trigger</span> <span class="kr">then</span>

      <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;HealBot: incorrect trigger value!&quot;</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;Current Mana&quot;</span> <span class="kr">then</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;MP&quot;</span>

    <span class="kr">elseif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;Current Health&quot;</span> <span class="kr">then</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;HP&quot;</span>

    <span class="kr">elseif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;Mana Percent&quot;</span> <span class="kr">then</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;MP%&quot;</span>

    <span class="kr">elseif</span> <span class="n">src</span> <span class="o">==</span> <span class="s2">&quot;Health Percent&quot;</span> <span class="kr">then</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;HP%&quot;</span>

    <span class="kr">else</span>

      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;burst&quot;</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="s2">&quot;Above&quot;</span> <span class="kr">then</span>

      <span class="n">equasion</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span>

    <span class="kr">elseif</span> <span class="n">eq</span> <span class="o">==</span> <span class="s2">&quot;Below&quot;</span> <span class="kr">then</span>

      <span class="n">equasion</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span>

    <span class="kr">else</span>

      <span class="n">equasion</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">id</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="kr">then</span>

      <span class="nb">table.insert</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span><span class="p">,</span> <span class="p">{</span><span class="n">index</span> <span class="o">=</span> <span class="o">#</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">item</span> <span class="o">=</span> <span class="n">id</span><span class="p">,</span> <span class="n">sign</span> <span class="o">=</span> <span class="n">equasion</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">trigger</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>

      <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

      <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

      <span class="n">refreshItems</span><span class="p">()</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

      <span class="n">healWindow</span><span class="p">.</span><span class="n">healer</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">itemValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">loadSettings</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="n">setProfileName</span><span class="p">()</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">profiles</span><span class="p">.</span><span class="n">Name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">refreshSpells</span><span class="p">()</span>

    <span class="n">refreshItems</span><span class="p">()</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Visible</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Delay</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Delay</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">MessageDelay</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">MessageDelay</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Interval</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Interval</span><span class="p">)</span>

    <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">Conditions</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">Conditions</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">loadSettings</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">profileChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">setActiveProfile</span><span class="p">()</span>

    <span class="n">activeProfileColor</span><span class="p">()</span>

    <span class="n">loadSettings</span><span class="p">()</span>

    <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;heal&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">resetSettings</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Delay</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">MessageDelay</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Interval</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">Conditions</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #&quot;</span> <span class="o">..</span> <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentBotProfile</span>

  <span class="kr">end</span>

  <span class="c1">-- profile buttons</span>

  <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">button</span> <span class="o">=</span> <span class="n">ui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="n">button</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span> <span class="o">=</span> <span class="n">i</span>

      <span class="n">profileChange</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">healWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">profiles</span><span class="p">.</span><span class="n">ResetSettings</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">resetSettings</span><span class="p">()</span>

    <span class="n">loadSettings</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="c1">-- public functions</span>

  <span class="n">HealBot</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- global table</span>

  <span class="n">HealBot</span><span class="p">.</span><span class="n">isOn</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span>

  <span class="kr">end</span>

  <span class="n">HealBot</span><span class="p">.</span><span class="n">isOff</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">return</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span>

  <span class="kr">end</span>

  <span class="n">HealBot</span><span class="p">.</span><span class="n">setOff</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;atk&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">HealBot</span><span class="p">.</span><span class="n">setOn</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;atk&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">HealBot</span><span class="p">.</span><span class="n">getActiveProfile</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span> <span class="c1">-- returns number 1-5</span>

  <span class="kr">end</span>

  <span class="n">HealBot</span><span class="p">.</span><span class="n">setActiveProfile</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;[HealBot] wrong profile parameter! should be 1 to 5 is &quot;</span> <span class="o">..</span> <span class="n">n</span><span class="p">)</span>

    <span class="kr">else</span>

      <span class="n">HealBotConfig</span><span class="p">.</span><span class="n">currentHealBotProfile</span> <span class="o">=</span> <span class="n">n</span>

      <span class="n">profileChange</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">HealBot</span><span class="p">.</span><span class="n">show</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">healWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="n">healWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

    <span class="n">healWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- spells</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">standBySpells</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">somethingIsOnCooldown</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">spellTable</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">.</span><span class="n">cost</span> <span class="o">&lt;</span> <span class="n">mana</span><span class="p">()</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">canCast</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">,</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Conditions</span><span class="p">,</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Cooldown</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;HP%&quot;</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">end</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;HP&quot;</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">end</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;MP%&quot;</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">end</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;MP&quot;</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">end</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;burst&quot;</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">burstDamageValue</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">burstDamageValue</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">burstDamageValue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

            <span class="kr">return</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">else</span>

        <span class="n">somethingIsOnCooldown</span> <span class="o">=</span> <span class="kc">true</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">somethingIsOnCooldown</span> <span class="kr">then</span>

    <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- items</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">standByItems</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">or</span> <span class="o">#</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Delay</span> <span class="ow">and</span> <span class="n">vBot</span><span class="p">.</span><span class="n">isUsing</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">MessageDelay</span> <span class="ow">and</span> <span class="n">vBot</span><span class="p">.</span><span class="n">isUsingPotion</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">MessageDelay</span> <span class="kr">then</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span> <span class="ow">and</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">Looting</span><span class="p">.</span><span class="n">getStatus</span><span class="p">():</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Interval</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">MessageDelay</span> <span class="kr">then</span>

      <span class="n">delay</span><span class="p">(</span><span class="mi">700</span><span class="p">)</span>

    <span class="kr">else</span>

      <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">currentSettings</span><span class="p">.</span><span class="n">itemTable</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">findItem</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">)</span>

    <span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">currentSettings</span><span class="p">.</span><span class="n">Visible</span> <span class="ow">or</span> <span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;HP%&quot;</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">end</span>

      <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;HP&quot;</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">()</span> <span class="o">==</span> <span class="n">tonumberentry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">end</span>

      <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;MP%&quot;</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">end</span>

      <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;MP&quot;</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">end</span>

      <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;burst&quot;</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span> <span class="ow">and</span> <span class="n">burstDamageValue</span><span class="p">()</span> <span class="o">==</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span> <span class="ow">and</span> <span class="n">burstDamageValue</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">elseif</span> <span class="n">entry</span><span class="p">.</span><span class="n">sign</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span> <span class="ow">and</span> <span class="n">burstDamageValue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">useInventoryItemWith</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">true</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

<span class="n">onPlayerHealthChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">healthPercent</span><span class="p">)</span>

  <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onManaChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">mana</span><span class="p">,</span> <span class="n">maxMana</span><span class="p">,</span> <span class="n">oldMana</span><span class="p">,</span> <span class="n">oldMaxMana</span><span class="p">)</span>

  <span class="n">standByItems</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="n">standBySpells</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="healbot-otui">
<h1>HealBot.otui<a class="headerlink" href="#healbot-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
SettingCheckBox &lt; CheckBox

  text-wrap: true

  text-auto-resize: true

  margin-top: 3

  font: verdana-11px-rounded

SpellSourceBoxPopupMenu &lt; ComboBoxPopupMenu

SpellSourceBoxPopupMenuButton &lt; ComboBoxPopupMenuButton

SpellSourceBox &lt; ComboBox

  @onSetup: |

    self:addOption(&quot;Current Mana&quot;)

    self:addOption(&quot;Current Health&quot;)

    self:addOption(&quot;Mana Percent&quot;)

    self:addOption(&quot;Health Percent&quot;)

    self:addOption(&quot;Burst Damage&quot;)

SpellConditionBoxPopupMenu &lt; ComboBoxPopupMenu

SpellConditionBoxPopupMenuButton &lt; ComboBoxPopupMenuButton

SpellConditionBox &lt; ComboBox

  @onSetup: |

    self:addOption(&quot;Below&quot;)

    self:addOption(&quot;Above&quot;)

    self:addOption(&quot;Equal To&quot;)

SpellEntry &lt; Label

  background-color: alpha

  text-offset: 18 1

  focusable: true

  height: 16

  font: verdana-11px-rounded

  CheckBox

    id: enabled

    anchors.left: parent.left

    anchors.verticalCenter: parent.verticalCenter

    width: 15

    height: 15

    margin-top: 2

    margin-left: 3

  $focus:

    background-color: #00000055

  Button

    id: remove

    !text: tr(&#39;x&#39;)

    anchors.right: parent.right

    margin-right: 15

    text-offset: 1 0

    width: 15

    height: 15

ItemEntry &lt; Label

  background-color: alpha

  text-offset: 40 1

  focusable: true

  height: 16

  font: verdana-11px-rounded

  CheckBox

    id: enabled

    anchors.left: parent.left

    anchors.verticalCenter: parent.verticalCenter

    width: 15

    height: 15

    margin-top: 2

    margin-left: 3

  UIItem

    id: id

    anchors.left: prev.right

    margin-left: 3

    anchors.verticalCenter: parent.verticalCenter

    size: 15 15

    focusable: false

  $focus:

    background-color: #00000055

  Button

    id: remove

    !text: tr(&#39;x&#39;)

    anchors.right: parent.right

    margin-right: 15

    text-offset: 1 0

    width: 15

    height: 15

SpellHealing &lt; FlatPanel

  size: 490 130

  Label

    id: title

    anchors.verticalCenter: parent.top

    anchors.left: parent.left

    margin-left: 5

    text: Spell Healing

    color: #269e26

    font: verdana-11px-rounded

  SpellSourceBox

    id: spellSource

    anchors.top: spellList.top

    anchors.left: spellList.right

    margin-left: 80

    width: 125

    font: verdana-11px-rounded

  Label

    id: whenSpell

    anchors.left: spellList.right

    anchors.verticalCenter: prev.verticalCenter

    text: When

    margin-left: 7

    font: verdana-11px-rounded

  Label

    id: isSpell

    anchors.left: spellList.right

    anchors.top: whenSpell.bottom

    text: Is

    margin-top: 9

    margin-left: 7

    font: verdana-11px-rounded

  SpellConditionBox

    id: spellCondition

    anchors.left: spellSource.left

    anchors.top: spellSource.bottom

    marin-top: 15

    width: 80

    font: verdana-11px-rounded

  TextEdit

    id: spellValue

    anchors.left: spellCondition.right

    anchors.top: spellCondition.top

    anchors.bottom: spellCondition.bottom

    anchors.right: spellSource.right

    font: verdana-11px-rounded

  Label

    id: castSpell

    anchors.left: isSpell.left

    anchors.top: isSpell.bottom

    text: Cast

    margin-top: 9

    font: verdana-11px-rounded

  TextEdit

    id: spellFormula

    anchors.left: spellCondition.left

    anchors.top: spellCondition.bottom

    anchors.right: spellValue.right

    font: verdana-11px-rounded

  Label

    id: manaSpell

    anchors.left: castSpell.left

    anchors.top: castSpell.bottom

    text: Mana Cost:

    margin-top: 8

    font: verdana-11px-rounded

  TextEdit

    id: manaCost

    anchors.left: spellFormula.left

    anchors.top: spellFormula.bottom

    width: 40

    font: verdana-11px-rounded

  TextList

    id: spellList

    anchors.left: parent.left

    anchors.bottom: parent.bottom

    anchors.top: parent.top

    padding: 1

    padding-top: 2

    width: 270

    margin-bottom: 7

    margin-left: 7

    margin-top: 10

    vertical-scrollbar: spellListScrollBar

  VerticalScrollBar

    id: spellListScrollBar

    anchors.top: spellList.top

    anchors.bottom: spellList.bottom

    anchors.right: spellList.right

    step: 14

    pixels-scroll: true

  Button

    id: addSpell

    anchors.right: spellFormula.right

    anchors.bottom: spellList.bottom

    text: Add

    size: 40 17

    font: cipsoftFont

  Button

    id: MoveUp

    anchors.right: prev.left

    anchors.bottom: prev.bottom

    margin-right: 5

    text: Move Up

    size: 55 17

    font: cipsoftFont

  Button

    id: MoveDown

    anchors.right: prev.left

    anchors.bottom: prev.bottom

    margin-right: 5

    text: Move Down

    size: 55 17

    font: cipsoftFont

ItemHealing &lt; FlatPanel

  size: 490 120

  Label

    id: title

    anchors.verticalCenter: parent.top

    anchors.left: parent.left

    margin-left: 5

    text: Item Healing

    color: #ff4513

    font: verdana-11px-rounded

  SpellSourceBox

    id: itemSource

    anchors.top: itemList.top

    anchors.right: parent.right

    margin-right: 10

    width: 128

    font: verdana-11px-rounded

  Label

    id: whenItem

    anchors.left: itemList.right

    anchors.verticalCenter: prev.verticalCenter

    text: When

    margin-left: 7

    font: verdana-11px-rounded

  Label

    id: isItem

    anchors.left: itemList.right

    anchors.top: whenItem.bottom

    text: Is

    margin-top: 9

    margin-left: 7

    font: verdana-11px-rounded

  SpellConditionBox

    id: itemCondition

    anchors.left: itemSource.left

    anchors.top: itemSource.bottom

    marin-top: 15

    width: 80

    font: verdana-11px-rounded

  TextEdit

    id: itemValue

    anchors.left: itemCondition.right

    anchors.top: itemCondition.top

    anchors.bottom: itemCondition.bottom

    width: 49

    font: verdana-11px-rounded

  Label

    id: useItem

    anchors.left: isItem.left

    anchors.top: isItem.bottom

    text: Use

    margin-top: 15

    font: verdana-11px-rounded

  BotItem

    id: itemId

    anchors.left: itemCondition.left

    anchors.top: itemCondition.bottom

  TextList

    id: itemList

    anchors.left: parent.left

    anchors.bottom: parent.bottom

    anchors.top: parent.top

    padding: 1

    padding-top: 2

    width: 270

    margin-top: 10

    margin-bottom: 7

    margin-left: 8

    vertical-scrollbar: itemListScrollBar

  VerticalScrollBar

    id: itemListScrollBar

    anchors.top: itemList.top

    anchors.bottom: itemList.bottom

    anchors.right: itemList.right

    step: 14

    pixels-scroll: true

  Button

    id: addItem

    anchors.right: itemValue.right

    anchors.bottom: itemList.bottom

    text: Add

    size: 40 17

    font: cipsoftFont

  Button

    id: MoveUp

    anchors.right: prev.left

    anchors.bottom: prev.bottom

    margin-right: 5

    text: Move Up

    size: 55 17

    font: cipsoftFont

  Button

    id: MoveDown

    anchors.right: prev.left

    anchors.bottom: prev.bottom

    margin-right: 5

    text: Move Down

    size: 55 17

    font: cipsoftFont

HealerPanel &lt; Panel

  size: 510 275

  SpellHealing

    id: spells

    anchors.top: parent.top

    margin-top: 8

    anchors.left: parent.left

  ItemHealing

    id: items

    anchors.top: prev.bottom

    anchors.left: parent.left

    margin-top: 10

HealBotSettingsPanel &lt; Panel

  size: 500 267

  padding-top: 8

  FlatPanel

    id: list

    anchors.fill: parent

    margin-right: 240

    padding-left: 6

    padding-right: 6

    padding-top: 6

    layout:

      type: verticalBox

    Label

      text: Additional Settings

      text-align: center

      font: verdana-11px-rounded

    HorizontalSeparator

    SettingCheckBox

      id: Cooldown

      text: Check spell cooldowns

      margin-top: 10

    SettingCheckBox

      id: Visible

      text: Items must be visible (recommended)

    SettingCheckBox

      id: Delay

      text: Don&#39;t use items when interacting

    SettingCheckBox

      id: Interval

      text: Additional delay when looting corpses

    SettingCheckBox

      id: Conditions

      text: Also check conditions from RL Tibia

    SettingCheckBox

      id: MessageDelay

      text: Cooldown based on &quot;Aaaah...&quot; message

  VerticalSeparator

    anchors.top: prev.top

    anchors.bottom: prev.bottom

    anchors.left: prev.right

    margin-left: 8

  FlatPanel

    id: profiles

    anchors.fill: parent

    anchors.left: prev.left

    margin-left: 8

    margin-right: 8

    padding: 8

    Label

      text: Profile Settings

      text-align: center

      anchors.top: parent.top

      anchors.left: parent.left

      anchors.right: parent.right

      font: verdana-11px-rounded

    HorizontalSeparator

      anchors.top: prev.bottom

      anchors.left: parent.left

      anchors.right: parent.right

    Label

      anchors.top: prev.bottom

      margin-top: 30

      anchors.left: parent.left

      anchors.right: parent.right

      text-align: center

      font: verdana-11px-rounded

      text: Profile Name:

    TextEdit

      id: Name

      anchors.top: prev.bottom

      margin-top: 3

      anchors.left: parent.left

      anchors.right: parent.right

    Button

      id: ResetSettings

      anchors.bottom: parent.bottom

      anchors.horizontalCenter: parent.horizontalCenter

      text: Reset Current Profile

      text-auto-resize: true

      color: #ff4513

HealWindow &lt; MainWindow

  !text: tr(&#39;Self Healer&#39;)

  size: 520 360

  @onEscape: self:hide()

  Label

    id: title

    anchors.left: parent.left

    anchors.top: parent.top

    margin-left: 2

    !text: tr(&#39;More important methods come first (Example: Exura gran above Exura)&#39;)

    text-align: left

    font: verdana-11px-rounded

    color: #aeaeae

  HealerPanel

    id: healer

    anchors.top: prev.bottom

    anchors.left: parent.left

  HealBotSettingsPanel

    id: settings

    anchors.top: title.bottom

    anchors.left: parent.left

    visible: false

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-right: 5

  Button

    id: settingsButton

    !text: tr(&#39;Settings&#39;)

    font: cipsoftFont

    anchors.left: parent.left

    anchors.bottom: parent.bottom

    size: 45 21

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="sio-lua">
<h1>Sio.lua<a class="headerlink" href="#sio-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;advancedFriendHealer&quot;</span>

  <span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 19</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;Friend Healer&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: editList</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Setup</span>

<span class="s">  ]]</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

  <span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">minMana</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

      <span class="n">minFriendHp</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

      <span class="n">customSpellName</span> <span class="o">=</span> <span class="s2">&quot;exura max sio&quot;</span><span class="p">,</span>

      <span class="n">customSpell</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">distance</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>

      <span class="n">itemHeal</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">id</span> <span class="o">=</span> <span class="mi">3160</span><span class="p">,</span>

      <span class="n">exuraSio</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">exuraGranSio</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">exuraMasRes</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">healEk</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">healRp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">healEd</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">healMs</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">}</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

  <span class="c1">-- basic elements</span>

  <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

  <span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">ui</span><span class="p">.</span><span class="n">editList</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="n">sioListWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

    <span class="n">sioListWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">rootWidget</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">rootWidget</span> <span class="kr">then</span>

    <span class="n">sioListWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;SioListWindow&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="c1">-- TextWindow</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">spellName</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">customSpellName</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">spellName</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">customSpellName</span> <span class="o">=</span> <span class="n">text</span>

    <span class="kr">end</span>

    <span class="c1">-- botswitches</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">spell</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">customSpell</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">spell</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">customSpell</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">customSpell</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">customSpell</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">itemHeal</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">item</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">itemHeal</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">itemHeal</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">itemHeal</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">exuraSio</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">exuraSio</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">exuraSio</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">exuraSio</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">exuraSio</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">exuraSio</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">exuraGranSio</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">exuraGranSio</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">exuraGranSio</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">exuraGranSio</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">exuraGranSio</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">exuraGranSio</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">exuraMasRes</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">exuraMasRes</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">exuraMasRes</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">exuraMasRes</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">exuraMasRes</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">exuraMasRes</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">vocation</span><span class="p">.</span><span class="n">ED</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">healEd</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">vocation</span><span class="p">.</span><span class="n">ED</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">healEd</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">healEd</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">healEd</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">vocation</span><span class="p">.</span><span class="n">MS</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">healMs</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">vocation</span><span class="p">.</span><span class="n">MS</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">healMs</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">healMs</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">healMs</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">vocation</span><span class="p">.</span><span class="n">EK</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">healEk</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">vocation</span><span class="p">.</span><span class="n">EK</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">healEk</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">healEk</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">healEk</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">vocation</span><span class="p">.</span><span class="n">RP</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">healRp</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">vocation</span><span class="p">.</span><span class="n">RP</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">healRp</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">healRp</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">healRp</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="c1">-- functions</span>

    <span class="kd">local</span> <span class="n">updateMinManaText</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">sioListWindow</span><span class="p">.</span><span class="n">manaInfo</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Minimum Mana &gt;= &quot;</span> <span class="o">..</span> <span class="n">config</span><span class="p">.</span><span class="n">minMana</span> <span class="o">..</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">updateFriendHpText</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">sioListWindow</span><span class="p">.</span><span class="n">friendHp</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Heal Friend Below &quot;</span> <span class="o">..</span> <span class="n">config</span><span class="p">.</span><span class="n">minFriendHp</span> <span class="o">..</span> <span class="s2">&quot;% hp&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">updateDistanceText</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">sioListWindow</span><span class="p">.</span><span class="n">distText</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Max Distance: &quot;</span> <span class="o">..</span> <span class="n">config</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="c1">-- scrollbars and text updates</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">Distance</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">Distance</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">scroll</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">value</span>

      <span class="n">updateDistanceText</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">updateDistanceText</span><span class="p">()</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">minMana</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">minMana</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">minMana</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">scroll</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">minMana</span> <span class="o">=</span> <span class="n">value</span>

      <span class="n">updateMinManaText</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">updateMinManaText</span><span class="p">()</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">minFriendHp</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">minFriendHp</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">minFriendHp</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">scroll</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">minFriendHp</span> <span class="o">=</span> <span class="n">value</span>

      <span class="n">updateFriendHpText</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">updateFriendHpText</span><span class="p">()</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">itemId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">itemId</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">sioListWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">sioListWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="c1">-- local variables</span>

  <span class="kd">local</span> <span class="n">newTibia</span> <span class="o">=</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">960</span>

  <span class="kd">local</span> <span class="kr">function</span> <span class="nf">isValid</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">newTibia</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">true</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">voc</span> <span class="o">=</span> <span class="n">vBot</span><span class="p">.</span><span class="n">BotServerMembers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">voc</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">true</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">11</span> <span class="kr">then</span> <span class="n">voc</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">12</span> <span class="kr">then</span> <span class="n">voc</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">13</span> <span class="kr">then</span> <span class="n">voc</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">14</span> <span class="kr">then</span> <span class="n">voc</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">isOk</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">if</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">healEk</span> <span class="kr">then</span>

      <span class="n">isOk</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">healRp</span> <span class="kr">then</span>

      <span class="n">isOk</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">healMs</span> <span class="kr">then</span>

      <span class="n">isOk</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">healEd</span> <span class="kr">then</span>

      <span class="n">isOk</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">isOk</span>

  <span class="kr">end</span>

  <span class="n">macro</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_cooldown</span><span class="p">.</span><span class="n">isGroupCooldownIconActive</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="cm">--[[</span>

<span class="cm">      1. custom spell</span>

<span class="cm">      2. exura gran sio - at 50% of minHpValue</span>

<span class="cm">      3. exura gran mas res</span>

<span class="cm">      4. exura sio</span>

<span class="cm">      5. item healing</span>

<span class="cm">    --]]</span>

    <span class="c1">-- exura gran sio &amp; custom spell</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">customSpell</span> <span class="ow">or</span> <span class="n">config</span><span class="p">.</span><span class="n">exuraGranSio</span> <span class="kr">then</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">spec</span> <span class="o">~=</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">isValid</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">canShoot</span><span class="p">()</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">customSpell</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">getHealthPercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">minFriendHp</span> <span class="kr">then</span>

              <span class="kr">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">customSpellName</span> <span class="o">..</span> <span class="s1">&#39; &quot;&#39;</span> <span class="o">..</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="o">..</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">exuraGranSio</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">getHealthPercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">minFriendHp</span><span class="o">/</span><span class="mi">3</span> <span class="kr">then</span>

              <span class="kr">if</span> <span class="n">canCast</span><span class="p">(</span><span class="s1">&#39;exura gran sio &quot;&#39;</span> <span class="o">..</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="o">..</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;exura gran sio &quot;&#39;</span> <span class="o">..</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="o">..</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="mi">60000</span><span class="p">)</span>

              <span class="kr">end</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="c1">-- exura gran mas res and standard sio</span>

    <span class="kd">local</span> <span class="n">friends</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">exuraMasRes</span> <span class="kr">then</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">largeRuneArea</span><span class="p">))</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">spec</span> <span class="o">~=</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">isValid</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">canShoot</span><span class="p">()</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">getHealthPercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">minFriendHp</span> <span class="kr">then</span>

            <span class="n">friends</span> <span class="o">=</span> <span class="n">friends</span> <span class="o">+</span> <span class="mi">1</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">friends</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;exura gran mas res&#39;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">exuraSio</span> <span class="ow">or</span> <span class="n">config</span><span class="p">.</span><span class="n">itemHeal</span> <span class="kr">then</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">spec</span> <span class="o">~=</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">isValid</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">canShoot</span><span class="p">()</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">getHealthPercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">minFriendHp</span> <span class="kr">then</span>

              <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">exuraSio</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;exura sio &quot;&#39;</span> <span class="o">..</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="o">..</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

              <span class="kr">elseif</span> <span class="n">findItem</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">and</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">config</span><span class="p">.</span><span class="n">distance</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

              <span class="kr">end</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="n">addSeparator</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="alarms-lua">
<h1>alarms.lua<a class="headerlink" href="#alarms-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;alarms&quot;</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 19</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;Alarms&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: alerts</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Edit</span>

<span class="s">]]</span><span class="p">)</span>

<span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">window</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s2">&quot;AlarmsWindow&quot;</span><span class="p">)</span>

<span class="n">window</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">ui</span><span class="p">.</span><span class="n">alerts</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">window</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="n">window</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

  <span class="n">window</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">widgets</span> <span class="o">=</span>

<span class="p">{</span>

  <span class="s2">&quot;AlarmCheckBox&quot;</span><span class="p">,</span>

  <span class="s2">&quot;AlarmCheckBoxAndSpinBox&quot;</span><span class="p">,</span>

  <span class="s2">&quot;AlarmCheckBoxAndTextEdit&quot;</span>

<span class="p">}</span>

<span class="kd">local</span> <span class="n">parents</span> <span class="o">=</span>

<span class="p">{</span>

  <span class="n">window</span><span class="p">.</span><span class="n">list</span><span class="p">,</span>

  <span class="n">window</span><span class="p">.</span><span class="n">settingsList</span>

<span class="p">}</span>

<span class="c1">-- type</span>

<span class="n">addAlarm</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">,</span> <span class="n">alarmType</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">tooltip</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="n">widgets</span><span class="p">[</span><span class="n">alarmType</span><span class="p">],</span> <span class="n">parents</span><span class="p">[</span><span class="n">parent</span><span class="p">])</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

  <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">])</span> <span class="o">~=</span> <span class="s1">&#39;table&#39;</span> <span class="kr">then</span>

    <span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kr">end</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">tick</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">tick</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">enabled</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">tick</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">tick</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">enabled</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">tick</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">enabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">alarmType</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;nil&#39;</span> <span class="kr">then</span>

    <span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="n">defaultValue</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">alarmType</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">value</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

      <span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="kr">end</span>

  <span class="kr">elseif</span> <span class="n">alarmType</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">value</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">newText</span><span class="p">)</span>

      <span class="n">config</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="n">newText</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- settings</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;ignoreFriends&quot;</span><span class="p">,</span> <span class="s2">&quot;Ignore Friends&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;flashClient&quot;</span><span class="p">,</span> <span class="s2">&quot;Flash Client&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">-- alarm list</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;damageTaken&quot;</span><span class="p">,</span> <span class="s2">&quot;Damage Taken&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;lowHealth&quot;</span><span class="p">,</span> <span class="s2">&quot;Low Health&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;lowMana&quot;</span><span class="p">,</span> <span class="s2">&quot;Low Mana&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;playerAttack&quot;</span><span class="p">,</span> <span class="s2">&quot;Player Attack&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">window</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;privateMsg&quot;</span><span class="p">,</span> <span class="s2">&quot;Private Message&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;defaultMsg&quot;</span><span class="p">,</span> <span class="s2">&quot;Default Message&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;customMessage&quot;</span><span class="p">,</span> <span class="s2">&quot;Custom Message:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;You can add text, that if found in any incoming message will trigger alert.</span><span class="se">\n</span><span class="s2"> You can add many, just separate them by comma.&quot;</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">window</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;creatureDetected&quot;</span><span class="p">,</span> <span class="s2">&quot;Creature Detected&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;playerDetected&quot;</span><span class="p">,</span> <span class="s2">&quot;Player Detected&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">addAlarm</span><span class="p">(</span><span class="s2">&quot;creatureName&quot;</span><span class="p">,</span> <span class="s2">&quot;Creature Name:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;You can add a name or part of it, that if found in any visible creature name will trigger alert.</span><span class="se">\n</span><span class="s2">You can add many, just separate them by comma.&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">lastCall</span> <span class="o">=</span> <span class="n">now</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">alarm</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">windowText</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">lastCall</span> <span class="o">&lt;</span> <span class="mi">2000</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span> <span class="c1">-- 2s delay</span>

  <span class="n">lastCall</span> <span class="o">=</span> <span class="n">now</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">g_resources</span><span class="p">.</span><span class="n">fileExists</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="kr">then</span>

    <span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;/sounds/alarm.ogg&quot;</span>

    <span class="n">lastCall</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">4000</span> <span class="c1">-- alarm.ogg length is 6s</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_bot</span><span class="p">.</span><span class="n">g_app</span><span class="p">.</span><span class="n">getOs</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">flashClient</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="n">g_window</span><span class="p">.</span><span class="n">flash</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">g_window</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="o">..</span> <span class="s2">&quot; - &quot;</span> <span class="o">..</span> <span class="n">windowText</span><span class="p">)</span>

  <span class="n">playSound</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- damage taken &amp; custom message</span>

<span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">22</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">damageTaken</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s1">&#39;/sounds/magnum.ogg&#39;</span><span class="p">,</span> <span class="s2">&quot;Damage Received!&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">customMessage</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">alertText</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">customMessage</span><span class="p">.</span><span class="n">value</span>

    <span class="kr">if</span> <span class="n">alertText</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">alertText</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>

      <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">parts</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="p">:</span><span class="n">trim</span><span class="p">()</span>

        <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="kr">then</span>

          <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s1">&#39;/sounds/magnum.ogg&#39;</span><span class="p">,</span> <span class="s2">&quot;Special Message!&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- default &amp; private message</span>

<span class="n">onTalk</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span> <span class="c1">-- ignore self messages</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">ignoreFriends</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span> <span class="c1">-- ignore friends if enabled</span>

  <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">defaultMsg</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s2">&quot;/sounds/magnum.ogg&quot;</span><span class="p">,</span> <span class="s2">&quot;Default Message!&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">privateMsg</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s2">&quot;/sounds/Private_Message.ogg&quot;</span><span class="p">,</span> <span class="s2">&quot;Private Message!&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- health &amp; mana</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">lowHealth</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">config</span><span class="p">.</span><span class="n">lowHealth</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s2">&quot;/sounds/Low_Health.ogg&quot;</span><span class="p">,</span> <span class="s2">&quot;Low Health!&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">lowMana</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">config</span><span class="p">.</span><span class="n">lowMana</span><span class="p">.</span><span class="n">value</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s2">&quot;/sounds/Low_Mana.ogg&quot;</span><span class="p">,</span> <span class="s2">&quot;Low Mana!&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">ignoreFriends</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">creatureDetected</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s2">&quot;/sounds/magnum.ogg&quot;</span><span class="p">,</span> <span class="s2">&quot;Creature Detected!&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isTimedSquareVisible</span><span class="p">()</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">playerAttack</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

          <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s2">&quot;/sounds/Player_Attack.ogg&quot;</span><span class="p">,</span> <span class="s2">&quot;Player Attack!&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">playerDetected</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

          <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s2">&quot;/sounds/Player_Detected.ogg&quot;</span><span class="p">,</span> <span class="s2">&quot;Player Detected!&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">creatureName</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">fragments</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">creatureName</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>

        <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">fragments</span> <span class="kr">do</span>

          <span class="kd">local</span> <span class="n">frag</span> <span class="o">=</span> <span class="n">fragments</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">trim</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

          <span class="kr">if</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="n">frag</span><span class="p">)</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">alarm</span><span class="p">(</span><span class="s2">&quot;/sounds/alarm.ogg&quot;</span><span class="p">,</span> <span class="s2">&quot;Special Creature Detected!&quot;</span><span class="p">)</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="alarms-otui">
<h1>alarms.otui<a class="headerlink" href="#alarms-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
AlarmCheckBox &lt; Panel

  height: 20

  margin-top: 2

  CheckBox

    id: tick

    anchors.fill: parent

    margin-top: 4

    font: verdana-11px-rounded

    text: Player Attack

    text-offset: 17 -3

AlarmCheckBoxAndSpinBox &lt; Panel

  height: 20

  margin-top: 2

  CheckBox

    id: tick

    anchors.fill: parent

    anchors.right: next.left

    margin-top: 4

    font: verdana-11px-rounded

    text: Player Attack

    text-offset: 17 -3

  SpinBox

    id: value

    anchors.top: parent.top

    margin-top: 1

    margin-bottom: 1

    anchors.bottom: parent.bottom

    anchors.right: parent.right

    width: 40

    minimum: 0

    maximum: 100

    step: 1

    editable: true

    focusable: true

AlarmCheckBoxAndTextEdit &lt; Panel

  height: 20

  margin-top: 2

  CheckBox

    id: tick

    anchors.fill: parent

    anchors.right: next.left

    margin-top: 4

    font: verdana-11px-rounded

    text: Creature Name

    text-offset: 17 -3

  BotTextEdit

    id: text

    anchors.right: parent.right

    anchors.top: parent.top

    anchors.bottom: parent.bottom

    width: 150

    font: terminus-10px

    margin-top: 1

    margin-bottom: 1

AlarmsWindow &lt; MainWindow

  !text: tr(&#39;Alarms&#39;)

  size: 330 400

  padding: 15

  @onEscape: self:hide()

  FlatPanel

    id: list

    anchors.fill: parent

    anchors.bottom: settingsList.top

    margin-bottom: 20

    margin-top: 10

    layout: verticalBox

    padding: 10

    padding-top: 5

  FlatPanel

    id: settingsList

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: separator.top

    margin-bottom: 5

    margin-top: 10

    padding: 5

    padding-left: 10

    layout:

      type: verticalBox

      fit-children: true

  Label

    anchors.verticalCenter: settingsList.top

    anchors.left: settingsList.left

    margin-left: 5

    width: 200

    text: Alarms Settings

    font: verdana-11px-rounded

    color: #9f5031

  Label

    anchors.verticalCenter: list.top

    anchors.left: list.left

    margin-left: 5

    width: 200

    text: Active Alarms

    font: verdana-11px-rounded

    color: #9f5031

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  ResizeBorder

    id: bottomResizeBorder

    anchors.fill: separator

    height: 3

    minimum: 260

    maximum: 600

    margin-left: 3

    margin-right: 3

    background: #ffffff88

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-right: 5

    @onClick: self:getParent():hide()

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="analyzer-lua">
<h1>analyzer.lua<a class="headerlink" href="#analyzer-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cm">--[[</span>

<span class="cm">  Bot-based Tibia 12 features v1.1</span>

<span class="cm">  made by Vithrax</span>

<span class="cm">  Credits also to:</span>

<span class="cm">  - Lee#7725</span>

<span class="cm">  Thanks for ideas, graphics, functions, design tips!</span>

<span class="cm">  br, Vithrax</span>

<span class="cm">]]</span>

<span class="c1">-- here you can fix incorrect bosses names in cooldown messages</span>

<span class="kd">local</span> <span class="n">BOSSES</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">-- {in message, correct one}</span>

  <span class="p">{</span><span class="s2">&quot;Scarlet Etzel&quot;</span><span class="p">,</span> <span class="s2">&quot;Scarlett Etzel&quot;</span><span class="p">},</span>

  <span class="p">{</span><span class="s2">&quot;Leiden&quot;</span><span class="p">,</span> <span class="s2">&quot;Ravenous Hunger&quot;</span><span class="p">},</span>

  <span class="p">{</span><span class="s2">&quot;Urmahlulu&quot;</span><span class="p">,</span> <span class="s2">&quot;Urmahlullu&quot;</span><span class="p">}</span>

<span class="p">}</span>

<span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span> <span class="o">=</span> <span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span> <span class="ow">or</span> <span class="p">{</span>

  <span class="n">refills</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

  <span class="n">rounds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

  <span class="n">time</span> <span class="o">=</span> <span class="p">{},</span>

  <span class="n">lastRefill</span> <span class="o">=</span> <span class="nb">os.time</span><span class="p">(),</span>

  <span class="n">refillTime</span> <span class="o">=</span> <span class="p">{}</span>

<span class="p">}</span>

<span class="kd">local</span> <span class="n">lootWorth</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">local</span> <span class="n">wasteWorth</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">local</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">local</span> <span class="n">balanceDesc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="kd">local</span> <span class="n">hourDesc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="kd">local</span> <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="kd">local</span> <span class="n">hour</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="kd">local</span> <span class="n">launchTime</span> <span class="o">=</span> <span class="n">now</span>

<span class="kd">local</span> <span class="n">startExp</span> <span class="o">=</span> <span class="n">exp</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">dmgTable</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">healTable</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">expTable</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">totalDmg</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">local</span> <span class="n">totalHeal</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">local</span> <span class="n">dmgDistribution</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">first</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

<span class="kd">local</span> <span class="n">second</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

<span class="kd">local</span> <span class="n">third</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

<span class="kd">local</span> <span class="n">fourth</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

<span class="kd">local</span> <span class="n">five</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

<span class="n">storage</span><span class="p">.</span><span class="n">bestHit</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">bestHit</span> <span class="ow">or</span> <span class="mi">0</span>

<span class="n">storage</span><span class="p">.</span><span class="n">bestHeal</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">bestHeal</span> <span class="ow">or</span> <span class="mi">0</span>

<span class="kd">local</span> <span class="n">lootedItems</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">useData</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">usedItems</span> <span class="o">=</span><span class="p">{}</span>

<span class="kd">local</span> <span class="n">lastDataSend</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">}</span>

<span class="kd">local</span> <span class="n">analyzerButton</span>

<span class="kd">local</span> <span class="n">killList</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">membersData</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">HuntingSessionStart</span> <span class="o">=</span> <span class="nb">os.date</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d, %H:%M:%S&#39;</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">trackedLoot</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="n">trackedBoss</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="n">outfits</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="n">customPrices</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="n">lootChannel</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

    <span class="n">rarityFrames</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span> <span class="ow">or</span> <span class="p">{}</span>

<span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">trackedLoot</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">trackedLoot</span> <span class="ow">or</span> <span class="p">{}</span>

<span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">trackedBoss</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">trackedBoss</span> <span class="ow">or</span> <span class="p">{}</span>

<span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">outfits</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">outfits</span> <span class="ow">or</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">trackedLoot</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">trackedLoot</span>

<span class="c1">--destroy old windows</span>

<span class="kd">local</span> <span class="n">windowsTable</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MainAnalyzerWindow&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;HuntingAnalyzerWindow&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;LootAnalyzerWindow&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;SupplyAnalyzerWindow&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;ImpactAnalyzerWindow&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;XPAnalyzerWindow&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;PartyAnalyzerWindow&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;DropTracker&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;CaveBotStats&quot;</span><span class="p">,</span>

                      <span class="s2">&quot;BossTracker&quot;</span>

<span class="p">}</span>

                      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">window</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">windowsTable</span><span class="p">)</span> <span class="kr">do</span>

  <span class="kd">local</span> <span class="n">element</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">():</span><span class="n">recursiveGetChildById</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">element</span> <span class="kr">then</span>

    <span class="n">element</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">mainWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;MainAnalyzerWindow&quot;</span><span class="p">)</span>

<span class="n">mainWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">mainWindow</span><span class="p">:</span><span class="n">setContentMaximumHeight</span><span class="p">(</span><span class="mi">267</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">huntingWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;HuntingAnalyzer&quot;</span><span class="p">)</span>

<span class="n">huntingWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">lootWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;LootAnalyzer&quot;</span><span class="p">)</span>

<span class="n">lootWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">supplyWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;SupplyAnalyzer&quot;</span><span class="p">)</span>

<span class="n">supplyWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">impactWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;ImpactAnalyzer&quot;</span><span class="p">)</span>

<span class="n">impactWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">impactWindow</span><span class="p">:</span><span class="n">setContentMaximumHeight</span><span class="p">(</span><span class="mi">615</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">xpWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;XPAnalyzer&quot;</span><span class="p">)</span>

<span class="n">xpWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">xpWindow</span><span class="p">:</span><span class="n">setContentMaximumHeight</span><span class="p">(</span><span class="mi">230</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">settingsWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s2">&quot;FeaturesWindow&quot;</span><span class="p">)</span>

<span class="n">settingsWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">partyHuntWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;PartyAnalyzerWindow&quot;</span><span class="p">)</span>

<span class="n">partyHuntWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">dropTrackerWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;DropTracker&quot;</span><span class="p">)</span>

<span class="n">dropTrackerWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">statsWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;CaveBotStats&quot;</span><span class="p">)</span>

<span class="n">statsWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">bossWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createMiniWindow</span><span class="p">(</span><span class="s2">&quot;BossTracker&quot;</span><span class="p">)</span>

<span class="n">bossWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="c1">--f</span>

<span class="kd">local</span> <span class="n">toggle</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">mainWindow</span><span class="p">:</span><span class="n">isVisible</span><span class="p">()</span> <span class="kr">then</span>

        <span class="n">analyzerButton</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>

    <span class="kr">else</span>

        <span class="n">analyzerButton</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="p">:</span><span class="n">open</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">drawGraph</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">graph</span><span class="p">:</span><span class="n">addValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">toggleAnalyzer</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">window</span><span class="p">:</span><span class="n">isVisible</span><span class="p">()</span> <span class="kr">then</span>

        <span class="n">window</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="kr">else</span>

        <span class="n">window</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">getSumStats</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">totalWaste</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kd">local</span> <span class="n">totalLoot</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">membersData</span><span class="p">)</span> <span class="kr">do</span>

    <span class="n">totalWaste</span> <span class="o">=</span> <span class="n">totalWaste</span> <span class="o">+</span> <span class="n">v</span><span class="p">.</span><span class="n">waste</span>

    <span class="n">totalLoot</span> <span class="o">=</span> <span class="n">totalLoot</span> <span class="o">+</span> <span class="n">v</span><span class="p">.</span><span class="n">loot</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">totalBalance</span> <span class="o">=</span> <span class="n">totalLoot</span> <span class="o">-</span> <span class="n">totalWaste</span>

  <span class="kr">return</span> <span class="n">totalWaste</span><span class="p">,</span> <span class="n">totalLoot</span><span class="p">,</span> <span class="n">totalBalance</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">clipboardData</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">totalWaste</span><span class="p">,</span> <span class="n">totalLoot</span><span class="p">,</span> <span class="n">totalBalance</span> <span class="o">=</span> <span class="n">getSumStats</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">final</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

  <span class="kd">local</span> <span class="n">first</span> <span class="o">=</span> <span class="s2">&quot;Session data: From &quot;</span> <span class="o">..</span> <span class="n">HuntingSessionStart</span> <span class="o">..</span><span class="s2">&quot; to &quot;</span><span class="o">..</span> <span class="nb">os.date</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d, %H:%M:%S&#39;</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">second</span> <span class="o">=</span> <span class="s2">&quot;Session: &quot;</span> <span class="o">..</span> <span class="n">sessionTime</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">third</span> <span class="o">=</span> <span class="s2">&quot;Loot Type: Market&quot;</span>

  <span class="kd">local</span> <span class="n">fourth</span> <span class="o">=</span> <span class="s2">&quot;Loot &quot;</span> <span class="o">..</span> <span class="n">format_thousand</span><span class="p">(</span><span class="n">totalLoot</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">fifth</span> <span class="o">=</span> <span class="s2">&quot;Supplies &quot;</span> <span class="o">..</span> <span class="n">format_thousand</span><span class="p">(</span><span class="n">totalWaste</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">six</span> <span class="o">=</span> <span class="s2">&quot;Balance &quot;</span> <span class="o">..</span> <span class="n">format_thousand</span><span class="p">(</span><span class="n">totalBalance</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">third</span><span class="p">,</span> <span class="n">fourth</span><span class="p">,</span> <span class="n">fifth</span><span class="p">,</span> <span class="n">six</span><span class="p">}</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">string</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">..</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">..</span><span class="n">string</span>

  <span class="kr">end</span>

  <span class="c1">--user data now</span>

  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">membersData</span><span class="p">)</span> <span class="kr">do</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">..</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">..</span> <span class="n">k</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">..</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Loot &quot;</span><span class="o">..</span><span class="n">v</span><span class="p">.</span><span class="n">loot</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">..</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Supplies &quot;</span><span class="o">..</span><span class="n">v</span><span class="p">.</span><span class="n">waste</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">..</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Balance &quot;</span><span class="o">..</span><span class="n">v</span><span class="p">.</span><span class="n">balance</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">..</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Damage &quot;</span><span class="o">..</span><span class="n">v</span><span class="p">.</span><span class="n">damage</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="o">..</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Healing &quot;</span><span class="o">..</span><span class="n">v</span><span class="p">.</span><span class="n">heal</span>

  <span class="kr">end</span>

  <span class="n">g_window</span><span class="p">.</span><span class="n">setClipboardText</span><span class="p">(</span><span class="n">final</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- create analyzers button</span>

<span class="n">analyzerButton</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_buttons</span><span class="p">.</span><span class="n">buttonsWindow</span><span class="p">.</span><span class="n">contentsPanel</span> <span class="ow">and</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_buttons</span><span class="p">.</span><span class="n">buttonsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">buttons</span><span class="p">.</span><span class="n">botAnalyzersButton</span>

<span class="n">analyzerButton</span> <span class="o">=</span> <span class="n">analyzerButton</span> <span class="ow">or</span> <span class="n">modules</span><span class="p">.</span><span class="n">client_topmenu</span><span class="p">.</span><span class="n">getButton</span><span class="p">(</span><span class="s2">&quot;botAnalyzersButton&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="n">analyzerButton</span> <span class="kr">then</span>

    <span class="n">analyzerButton</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

<span class="kr">end</span>

<span class="c1">--button</span>

<span class="n">analyzerButton</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">client_topmenu</span><span class="p">.</span><span class="n">addRightGameToggleButton</span><span class="p">(</span><span class="s1">&#39;botAnalyzersButton&#39;</span><span class="p">,</span> <span class="s1">&#39;vBot Analyzers&#39;</span><span class="p">,</span> <span class="s1">&#39;/images/topbuttons/analyzers&#39;</span><span class="p">,</span> <span class="n">toggle</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">999999</span><span class="p">)</span>

<span class="n">analyzerButton</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

<span class="c1">--toggles window</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">HuntingAnalyzer</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">huntingWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">onClose</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">analyzerButton</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">LootAnalyzer</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">lootWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">SupplyAnalyzer</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">supplyWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">ImpactAnalyzer</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">impactWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">XPAnalyzer</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">xpWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">PartyHunt</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">partyHuntWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">DropTracker</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">dropTrackerWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">Stats</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">statsWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">BossTracker</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">toggleAnalyzer</span><span class="p">(</span><span class="n">bossWindow</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- boss tracker</span>

<span class="n">bossWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">search</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">newText</span><span class="p">)</span>

  <span class="n">newText</span> <span class="o">=</span> <span class="n">newText</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">bossWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">text</span> <span class="o">=</span> <span class="n">child</span><span class="p">:</span><span class="n">getId</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">child</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">~=</span> <span class="s2">&quot;search&quot;</span> <span class="kr">then</span>

      <span class="n">child</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="n">newText</span><span class="p">))</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- on login</span>

<span class="n">newTimeFormat</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="c1">-- v in seconds</span>

  <span class="kd">local</span> <span class="n">hours</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%02.f&quot;</span><span class="p">,</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">3600</span><span class="p">))</span>

  <span class="kd">local</span> <span class="n">mins</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%02.f&quot;</span><span class="p">,</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">60</span> <span class="o">-</span> <span class="p">(</span><span class="n">hours</span><span class="o">*</span><span class="mi">60</span><span class="p">)))</span>

  <span class="kd">local</span> <span class="n">final</span> <span class="o">=</span> <span class="n">hours</span><span class="o">..</span> <span class="s2">&quot;h &quot;</span><span class="o">..</span><span class="n">mins</span><span class="o">..</span><span class="s2">&quot;min&quot;</span>

  <span class="kr">return</span> <span class="n">final</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">createBossPanel</span><span class="p">(</span><span class="n">bossName</span><span class="p">,</span> <span class="n">dueTime</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">bossWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">[</span><span class="n">bossName</span><span class="p">]</span> <span class="ow">or</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;BossCreaturePanel&quot;</span><span class="p">,</span> <span class="n">bossWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">outfit</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">outfits</span><span class="p">[</span><span class="n">bossName</span><span class="p">]</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">dueTime</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">bossName</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">outfit</span> <span class="kr">then</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">creature</span><span class="p">:</span><span class="n">setOutfit</span><span class="p">(</span><span class="n">outfit</span><span class="p">)</span>

  <span class="kr">else</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">creature</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;Outfit preview not available.</span><span class="se">\n</span><span class="s2">To get one you need to &#39;attack&#39; &quot;</span><span class="o">..</span> <span class="n">bossName</span><span class="o">..</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Or you need to correct the boss name inside analyzers.lua file, const BOSSES&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">bossName</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">timeLeft</span> <span class="o">=</span> <span class="nb">os.difftime</span><span class="p">(</span><span class="n">dueTime</span><span class="p">,</span> <span class="nb">os.time</span><span class="p">())</span>

  <span class="kr">if</span> <span class="n">timeLeft</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">cooldown</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">newTimeFormat</span><span class="p">(</span><span class="n">timeLeft</span><span class="p">))</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">cooldown</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#f29257&#39;</span><span class="p">)</span>

  <span class="kr">else</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">cooldown</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;No Cooldown&quot;</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">cooldown</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#b8b8b8&#39;</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">for</span> <span class="n">bossName</span><span class="p">,</span> <span class="n">dueTime</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">trackedBoss</span><span class="p">)</span> <span class="kr">do</span>

  <span class="n">createBossPanel</span><span class="p">(</span><span class="n">bossName</span><span class="p">,</span> <span class="n">dueTime</span><span class="p">)</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">bossRegex</span> <span class="o">=</span> <span class="s">[[You (?:can|may) challenge ([\w\W]*) again in ([\d]*)]]</span>

<span class="n">onTalk</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">34</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">re</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">bossRegex</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">re</span> <span class="ow">and</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

    <span class="kd">local</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">re</span> <span class="ow">and</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

    <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">BOSSES</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">bad</span> <span class="o">=</span> <span class="n">BOSSES</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

      <span class="kd">local</span> <span class="n">good</span> <span class="o">=</span> <span class="n">BOSSES</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

      <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">bad</span> <span class="kr">then</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">good</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">cd</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">cd</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="c1">-- cd in seconds</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">trackedBoss</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">os.time</span><span class="p">()</span> <span class="o">+</span> <span class="n">cd</span>

    <span class="n">createBossPanel</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">os.time</span><span class="p">()</span> <span class="o">+</span> <span class="n">cd</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- save outfits</span>

<span class="n">onAttackingCreatureChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">newCreature</span><span class="p">,</span> <span class="n">oldCreature</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">newCreature</span> <span class="ow">and</span> <span class="n">newCreature</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">outfit</span> <span class="o">=</span> <span class="n">newCreature</span> <span class="ow">and</span> <span class="n">newCreature</span><span class="p">:</span><span class="n">getOutfit</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">name</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">outfits</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">outfits</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">or</span> <span class="n">outfit</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">--stats window</span>

<span class="kd">local</span> <span class="n">totalRounds</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Total Rounds:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">avRoundTime</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Time by Round:&quot;</span><span class="p">,</span> <span class="s2">&quot;00:00h&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">totalRefills</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Total Refills:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">avRefillTime</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Time by Refill:&quot;</span><span class="p">,</span> <span class="s2">&quot;00:00h&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">lastRefill</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Time since Refill:&quot;</span><span class="p">,</span> <span class="s2">&quot;00:00h&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Supplies by Round:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">left</span>

<span class="n">label</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#EC9706&#39;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">suppliesByRound</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerItemsPanel&quot;</span><span class="p">,</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Supplies by Refill:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">left</span>

<span class="n">label</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#ED7117&#39;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">suppliesByRefill</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerItemsPanel&quot;</span><span class="p">,</span> <span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">statsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="c1">--huntig</span>

<span class="kd">local</span> <span class="n">sessionTimeLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Session:&quot;</span><span class="p">,</span> <span class="s2">&quot;00:00h&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">xpGainLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;XP Gain:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">xpHourLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;XP/h:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">lootLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Loot:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">suppliesLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Supplies:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">balanceLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Balance:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">damageLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Damage:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">damageHourLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Damage/h:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">healingLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Healing:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">healingHourLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Healing/h:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Killed Monsters:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">killedList</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerListPanel&quot;</span><span class="p">,</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Looted items:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">lootList</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerListPanel&quot;</span><span class="p">,</span> <span class="n">huntingWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="c1">--party</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Copy to Clipboard&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">clipboardData</span><span class="p">()</span> <span class="kr">end</span><span class="p">,</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Reset Sessions&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

    <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;partyHunt&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">,</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">switch</span> <span class="o">=</span> <span class="n">addSwitch</span><span class="p">(</span><span class="s2">&quot;sendData&quot;</span><span class="p">,</span> <span class="s2">&quot;Send Analyzer Data&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="ow">not</span> <span class="n">widget</span><span class="p">:</span><span class="n">isOn</span><span class="p">())</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">sendPartyAnalyzerData</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">isOn</span><span class="p">()</span>

<span class="kr">end</span><span class="p">,</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">switch</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">sendPartyAnalyzerData</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">partySessionTimeLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Session:&quot;</span><span class="p">,</span> <span class="s2">&quot;00:00h&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">partyLootLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Loot:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">partySuppliesLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Supplies:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">partyBalanceLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Balance:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">maintainDropTable</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">dropTrackerWindow</span><span class="p">.</span><span class="n">contentsPanel</span>

  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">trackedLoot</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">widget</span> <span class="kr">then</span>

      <span class="n">trackedLoot</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">createTrackedItems</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">dropTrackerWindow</span><span class="p">.</span><span class="n">contentsPanel</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">panel</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="kr">then</span>

      <span class="n">child</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">trackedLoot</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">dropLoot</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;TrackerItem&quot;</span><span class="p">,</span> <span class="n">dropTrackerWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">dropLoot</span><span class="p">.</span><span class="n">item</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">dropLoot</span><span class="p">.</span><span class="n">name</span>

    <span class="kd">local</span> <span class="n">drops</span> <span class="o">=</span> <span class="n">dropLoot</span><span class="p">.</span><span class="n">drops</span>

    <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">itemName</span> <span class="o">=</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3031</span> <span class="ow">and</span> <span class="s2">&quot;gold coin&quot;</span> <span class="ow">or</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3035</span> <span class="ow">and</span> <span class="s2">&quot;platinum coin&quot;</span> <span class="ow">or</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3043</span> <span class="ow">and</span> <span class="s2">&quot;crystal coin&quot;</span> <span class="ow">or</span> <span class="n">Item</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">id</span><span class="p">):</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span>

    <span class="n">dropLoot</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="n">item</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getItemCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

      <span class="n">item</span><span class="p">:</span><span class="n">setItemCount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">itemName</span><span class="p">)</span>

    <span class="n">drops</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Loot Drops: &quot;</span><span class="o">..</span><span class="n">v</span><span class="p">)</span>

    <span class="n">dropLoot</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">dropLoot</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

      <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="n">drops</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Loot Drops: 0&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">dropLoot</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

      <span class="n">child</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;Double click to reset or clear item to remove.&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">item</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">trackedLoot</span><span class="p">[</span><span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">nil</span>

        <span class="kr">if</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

          <span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">destroy</span><span class="p">()</span>

          <span class="kr">return</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="s1">&#39;/images/ui/item&#39;</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">setId</span><span class="p">(</span><span class="s2">&quot;blank&quot;</span><span class="p">)</span>

        <span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Set Item to start track.&quot;</span><span class="p">)</span>

        <span class="n">drops</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Loot Drops: 0&quot;</span><span class="p">)</span>

        <span class="kr">return</span>

      <span class="kr">end</span>

    <span class="c1">-- only amount have changed, ignore</span>

      <span class="kr">if</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">getId</span><span class="p">())</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kd">local</span> <span class="n">itemName</span> <span class="o">=</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3031</span> <span class="ow">and</span> <span class="s2">&quot;gold coin&quot;</span> <span class="ow">or</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3035</span> <span class="ow">and</span> <span class="s2">&quot;platinum coin&quot;</span> <span class="ow">or</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3043</span> <span class="ow">and</span> <span class="s2">&quot;crystal coin&quot;</span> <span class="ow">or</span> <span class="n">Item</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">id</span><span class="p">):</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span>

      <span class="kr">if</span> <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="kr">then</span>

        <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;vBot[Drop Tracker]: Item already added!&quot;</span><span class="p">)</span>

        <span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Set Item to start track.&quot;</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="kr">return</span>

      <span class="kr">end</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="n">drops</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Loot Drops: 0&quot;</span><span class="p">)</span>

      <span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">itemName</span><span class="p">)</span>

      <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="ow">or</span> <span class="mi">0</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">setId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

      <span class="n">maintainDropTable</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--drop tracker</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Add item to track drops&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">dropLoot</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;TrackerItem&quot;</span><span class="p">,</span> <span class="n">dropTrackerWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">dropLoot</span><span class="p">.</span><span class="n">item</span>

  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">dropLoot</span><span class="p">.</span><span class="n">name</span>

  <span class="kd">local</span> <span class="n">drops</span> <span class="o">=</span> <span class="n">dropLoot</span><span class="p">.</span><span class="n">drops</span>

  <span class="n">item</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="s1">&#39;/images/ui/item&#39;</span><span class="p">)</span>

  <span class="n">dropLoot</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">dropLoot</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

    <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">drops</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Loot Drops: 0&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">dropLoot</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="n">child</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;Double click to reset or clear item to remove.&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">item</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">trackedLoot</span><span class="p">[</span><span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">nil</span>

      <span class="kr">if</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">destroy</span><span class="p">()</span>

        <span class="kr">return</span>

      <span class="kr">end</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="s1">&#39;/images/ui/item&#39;</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">setId</span><span class="p">(</span><span class="s2">&quot;blank&quot;</span><span class="p">)</span>

      <span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Set Item to start track.&quot;</span><span class="p">)</span>

      <span class="n">drops</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Loot Drops: 0&quot;</span><span class="p">)</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="c1">-- only amount have changed, ignore</span>

    <span class="kr">if</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">getId</span><span class="p">())</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">itemName</span> <span class="o">=</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3031</span> <span class="ow">and</span> <span class="s2">&quot;gold coin&quot;</span> <span class="ow">or</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3035</span> <span class="ow">and</span> <span class="s2">&quot;platinum coin&quot;</span> <span class="ow">or</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3043</span> <span class="ow">and</span> <span class="s2">&quot;crystal coin&quot;</span> <span class="ow">or</span> <span class="n">Item</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">id</span><span class="p">):</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span>

    <span class="kr">if</span> <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="kr">then</span>

      <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;vBot[Drop Tracker]: Item already added!&quot;</span><span class="p">)</span>

      <span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Set Item to start track.&quot;</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">drops</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Loot Drops: 0&quot;</span><span class="p">)</span>

    <span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">itemName</span><span class="p">)</span>

    <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="ow">or</span> <span class="mi">0</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">():</span><span class="n">setId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="n">maintainDropTable</span><span class="p">()</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">,</span> <span class="n">dropTrackerWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">dropTrackerWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">createTrackedItems</span><span class="p">()</span>

<span class="c1">--loot</span>

<span class="kd">local</span> <span class="n">lootInLootAnalyzerLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Gold Value:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">lootWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">lootHourInLootAnalyzerLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Per Hour:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">lootWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">lootWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="c1">--//items panel</span>

<span class="kd">local</span> <span class="n">lootItems</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerItemsPanel&quot;</span><span class="p">,</span> <span class="n">lootWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">lootWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="c1">--//graph</span>

<span class="kd">local</span> <span class="n">lootGraph</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerGraph&quot;</span><span class="p">,</span> <span class="n">lootWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

      <span class="n">lootGraph</span><span class="p">:</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Loot/h&quot;</span><span class="p">)</span>

      <span class="n">drawGraph</span><span class="p">(</span><span class="n">lootGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">--supplies</span>

<span class="kd">local</span> <span class="n">suppliesInSuppliesAnalyzerLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Gold Value:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">supplyWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">suppliesHourInSuppliesAnalyzerLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Per Hour:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">supplyWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">supplyWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="c1">--//items panel</span>

<span class="kd">local</span> <span class="n">supplyItems</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerItemsPanel&quot;</span><span class="p">,</span> <span class="n">supplyWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">supplyWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="c1">--//graph</span>

<span class="kd">local</span> <span class="n">supplyGraph</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerGraph&quot;</span><span class="p">,</span> <span class="n">supplyWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

      <span class="n">supplyGraph</span><span class="p">:</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Waste/h&quot;</span><span class="p">)</span>

      <span class="n">drawGraph</span><span class="p">(</span><span class="n">supplyGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">-- impact</span>

<span class="c1">--- damage</span>

<span class="kd">local</span> <span class="n">title</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Damage&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">left</span>

<span class="n">title</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#E3242B&#39;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">totalDamageLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Total:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">maxDpsLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Max-DPS:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">bestHitLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;All-Time High:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">dmgGraph</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerGraph&quot;</span><span class="p">,</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

      <span class="n">dmgGraph</span><span class="p">:</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;DPS&quot;</span><span class="p">)</span>

      <span class="n">drawGraph</span><span class="p">(</span><span class="n">dmgGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">--- distribution</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">title2</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Damage Distribution&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">150</span><span class="p">},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">left</span>

<span class="n">title2</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#FABD02&#39;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">top1</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">top2</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">top3</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">top4</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">top5</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">top1</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">135</span><span class="p">)</span>

<span class="n">top2</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">135</span><span class="p">)</span>

<span class="n">top3</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">135</span><span class="p">)</span>

<span class="n">top4</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">135</span><span class="p">)</span>

<span class="n">top5</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">135</span><span class="p">)</span>

<span class="c1">--- healing</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">title3</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Healing&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">left</span>

<span class="n">title3</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#03C04A&#39;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">totalHealingLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Total:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">maxHpsLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Max-HPS:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">bestHealLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;All-Time High:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="c1">--//graph</span>

<span class="kd">local</span> <span class="n">healGraph</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerGraph&quot;</span><span class="p">,</span> <span class="n">impactWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

      <span class="n">healGraph</span><span class="p">:</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;HPS&quot;</span><span class="p">)</span>

      <span class="n">drawGraph</span><span class="p">(</span><span class="n">healGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">--xp</span>

<span class="kd">local</span> <span class="n">xpGrainInXpLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;XP Gain:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">xpWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">xpHourInXpLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;XP/h:&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">xpWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">nextLevelLabel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">DualLabel</span><span class="p">(</span><span class="s2">&quot;Next Level:&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">xpWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">).</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">progressBar</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerProgressBar&quot;</span><span class="p">,</span> <span class="n">xpWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="n">progressBar</span><span class="p">:</span><span class="n">setPercent</span><span class="p">(</span><span class="n">modules</span><span class="p">.</span><span class="n">game_skills</span><span class="p">.</span><span class="n">skillsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">level</span><span class="p">.</span><span class="n">percent</span><span class="p">:</span><span class="n">getPercent</span><span class="p">())</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">xpWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

<span class="c1">--//graph</span>

<span class="kd">local</span> <span class="n">xpGraph</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerGraph&quot;</span><span class="p">,</span> <span class="n">xpWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

      <span class="n">xpGraph</span><span class="p">:</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;XP/h&quot;</span><span class="p">)</span>

      <span class="n">drawGraph</span><span class="p">(</span><span class="n">xpGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">--#############################################</span>

<span class="c1">--#############################################   UI DONE</span>

<span class="c1">--#############################################</span>

<span class="c1">--#############################################</span>

<span class="c1">--#############################################</span>

<span class="c1">--#############################################</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">)</span>

<span class="c1">-- first, the variables</span>

<span class="kd">local</span> <span class="n">console</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_console</span>

<span class="kd">local</span> <span class="n">regex</span> <span class="o">=</span> <span class="s">[[ ([^,|^.]+)]]</span>

<span class="kd">local</span> <span class="n">noData</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">getColor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">10000000</span> <span class="kr">then</span> <span class="c1">-- 10kk, red</span>

        <span class="kr">return</span> <span class="s2">&quot;#FF0000&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">5000000</span> <span class="kr">then</span> <span class="c1">-- 5kk, orange</span>

        <span class="kr">return</span> <span class="s2">&quot;#FFA500&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">1000000</span> <span class="kr">then</span> <span class="c1">-- 1kk, yellow</span>

        <span class="kr">return</span> <span class="s2">&quot;#FFFF00&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">100000</span> <span class="kr">then</span> <span class="c1">-- 100k, purple</span>

        <span class="kr">return</span> <span class="s2">&quot;#F25AED&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">10000</span> <span class="kr">then</span> <span class="c1">-- 10k, blue</span>

        <span class="kr">return</span> <span class="s2">&quot;#5F8DF7&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="kr">then</span> <span class="c1">-- 1k, green</span>

        <span class="kr">return</span> <span class="s2">&quot;#00FF00&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="s2">&quot;#FFFFFF&quot;</span> <span class="c1">-- 50gp, white</span>

    <span class="kr">else</span>

      <span class="kr">return</span> <span class="s2">&quot;#aaaaaa&quot;</span> <span class="c1">-- less than 100gp, grey</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">formatStr</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">string</span><span class="p">.</span><span class="n">starts</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s2">&quot;a &quot;</span><span class="p">)</span> <span class="kr">then</span>

        <span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="p">:</span><span class="n">sub</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">#</span><span class="n">str</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="n">string</span><span class="p">.</span><span class="n">starts</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s2">&quot;an &quot;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="p">:</span><span class="n">sub</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">#</span><span class="n">str</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="n">getFirstNumberInText</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">n</span> <span class="kr">then</span>

        <span class="n">str</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">n</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="p">:</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">str</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">str</span><span class="p">:</span><span class="n">trim</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">getPrice</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">formatStr</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1">-- first check custom prices</span>

    <span class="kr">if</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">customPrices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">customPrices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="kr">end</span>

    <span class="c1">-- if already checked and no data skip looping items.lua</span>

    <span class="kr">if</span> <span class="n">noData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">0</span>

    <span class="kr">end</span>

    <span class="c1">-- maybe was already checked, if so, skip looping items.lua</span>

    <span class="kr">if</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="kr">end</span>

    <span class="c1">-- searching in items.lua - big table, if possible skip</span>

    <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">LootItems</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">k</span> <span class="kr">then</span>

            <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

            <span class="kr">return</span> <span class="n">v</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="c1">-- if no data, save it and return 0</span>

    <span class="n">noData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">return</span> <span class="mi">0</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">expGained</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">return</span> <span class="n">exp</span><span class="p">()</span> <span class="o">-</span> <span class="n">startExp</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">format_thousand</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">comma</span><span class="p">)</span>

  <span class="n">comma</span> <span class="o">=</span> <span class="n">comma</span> <span class="ow">and</span> <span class="s2">&quot;,&quot;</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="kr">then</span> <span class="kr">return</span> <span class="mi">0</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%d&quot;</span><span class="p">,</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

  <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="nb">string.len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>

  <span class="kr">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">3</span> <span class="kr">end</span>

  <span class="kr">return</span> <span class="nb">string.sub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

  <span class="o">..</span> <span class="nb">string.gsub</span><span class="p">(</span><span class="nb">string.sub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;(...)&quot;</span><span class="p">,</span> <span class="n">comma</span><span class="o">..</span><span class="s2">&quot;%1&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">expLeft</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">level</span> <span class="o">=</span> <span class="n">lvl</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>

  <span class="kr">return</span> <span class="nb">math.floor</span><span class="p">((</span><span class="mi">50</span><span class="o">*</span><span class="n">level</span><span class="o">*</span><span class="n">level</span><span class="o">*</span><span class="n">level</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">100</span><span class="o">*</span><span class="n">level</span><span class="o">*</span><span class="n">level</span> <span class="o">+</span> <span class="p">(</span><span class="mi">850</span><span class="o">*</span><span class="n">level</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">200</span><span class="p">)</span> <span class="o">-</span> <span class="n">exp</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">niceTimeFormat</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span> <span class="c1">-- v in seconds</span>

  <span class="kd">local</span> <span class="n">hours</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%02.f&quot;</span><span class="p">,</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">3600</span><span class="p">))</span>

  <span class="kd">local</span> <span class="n">mins</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%02.f&quot;</span><span class="p">,</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">60</span> <span class="o">-</span> <span class="p">(</span><span class="n">hours</span><span class="o">*</span><span class="mi">60</span><span class="p">)))</span>

  <span class="kd">local</span> <span class="n">secs</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%02.f&quot;</span><span class="p">,</span> <span class="nb">math.floor</span><span class="p">(</span><span class="nb">math.fmod</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">60</span><span class="p">)))</span>

  <span class="kd">local</span> <span class="n">final</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s1">&#39;%s:%s%s&#39;</span><span class="p">,</span><span class="n">hours</span><span class="p">,</span><span class="n">mins</span><span class="p">,</span><span class="n">seconds</span> <span class="ow">and</span> <span class="s2">&quot;:&quot;</span><span class="o">..</span><span class="n">secs</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

 <span class="kr">return</span> <span class="n">final</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">uptime</span>

<span class="n">sessionTime</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">uptime</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">((</span><span class="n">now</span> <span class="o">-</span> <span class="n">launchTime</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>

  <span class="kr">return</span> <span class="n">niceTimeFormat</span><span class="p">(</span><span class="n">uptime</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">sessionTime</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">expPerHour</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">calculation</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kr">if</span> <span class="o">#</span><span class="n">expTable</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">r</span> <span class="o">=</span> <span class="n">exp</span><span class="p">()</span> <span class="o">-</span> <span class="n">expTable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

  <span class="kr">else</span>

      <span class="kr">return</span> <span class="s2">&quot;-&quot;</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">uptime</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="o">*</span><span class="mi">60</span> <span class="kr">then</span>

      <span class="n">r</span> <span class="o">=</span> <span class="nb">math.ceil</span><span class="p">((</span><span class="n">r</span><span class="o">/</span><span class="n">uptime</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

  <span class="kr">else</span>

      <span class="n">r</span> <span class="o">=</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">calculation</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">r</span>

  <span class="kr">else</span>

      <span class="kr">return</span> <span class="n">format_thousand</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>

    <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">last</span> <span class="kr">then</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- Bot Server</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">sendData</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">totalDmg</span><span class="p">,</span> <span class="n">totalHeal</span><span class="p">,</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">getHuntingData</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">outfit</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getOutfit</span><span class="p">()</span>

    <span class="n">outfit</span><span class="p">.</span><span class="n">mount</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">totalDmg</span><span class="p">,</span>

      <span class="n">totalHeal</span><span class="p">,</span>

      <span class="n">balance</span><span class="p">,</span>

      <span class="n">hppercent</span><span class="p">(),</span>

      <span class="n">manapercent</span><span class="p">(),</span>

      <span class="n">outfit</span><span class="p">,</span>

      <span class="n">player</span><span class="p">:</span><span class="n">isPartyLeader</span><span class="p">(),</span>

      <span class="n">lootWorth</span><span class="p">,</span>

      <span class="n">wasteWorth</span><span class="p">,</span>

      <span class="n">modules</span><span class="p">.</span><span class="n">game_skills</span><span class="p">.</span><span class="n">skillsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">stamina</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span>

      <span class="n">format_thousand</span><span class="p">(</span><span class="n">expGained</span><span class="p">()),</span>

      <span class="n">expPerHour</span><span class="p">(),</span>

      <span class="n">balanceDesc</span> <span class="o">..</span> <span class="s2">&quot; (&quot;</span> <span class="o">..</span> <span class="n">hourDesc</span> <span class="o">..</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span>

      <span class="n">sessionTime</span><span class="p">()</span>

<span class="p">}</span>

    <span class="c1">-- validation</span>

    <span class="kr">if</span> <span class="n">lastDataSend</span><span class="p">.</span><span class="n">totalDmg</span> <span class="o">~=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">lastDataSend</span><span class="p">.</span><span class="n">totalHeal</span> <span class="o">~=</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="kr">then</span>

      <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;partyHunt&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

      <span class="n">lastDataSend</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

      <span class="n">lastDataSend</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- process data</span>

<span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;partyHunt&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">message</span> <span class="o">==</span> <span class="kc">true</span> <span class="kr">then</span>

      <span class="n">sendData</span><span class="p">()</span>

    <span class="kr">elseif</span> <span class="n">message</span> <span class="o">==</span> <span class="kc">false</span> <span class="kr">then</span>

      <span class="n">resetAnalyzerSessionData</span><span class="p">()</span>

    <span class="kr">else</span>

      <span class="n">membersData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">damage</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>

        <span class="n">heal</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>

        <span class="n">balance</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>

        <span class="n">hp</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>

        <span class="n">mana</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>

        <span class="n">outfit</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>

        <span class="n">leader</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>

        <span class="n">loot</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>

        <span class="n">waste</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>

        <span class="n">stamina</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>

        <span class="n">expGained</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span>

        <span class="n">expH</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>

        <span class="n">balanceH</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>

<span class="p">}</span>

      <span class="kd">local</span> <span class="n">widgetName</span> <span class="o">=</span> <span class="s2">&quot;Widget&quot;</span><span class="o">..</span><span class="n">name</span>

      <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">[</span><span class="n">widgetName</span><span class="p">]</span> <span class="ow">or</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;MemberWidget&quot;</span><span class="p">,</span> <span class="n">partyHuntWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">widgetName</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">lastUpdate</span> <span class="o">=</span> <span class="n">now</span>

      <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">membersData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">t</span><span class="p">.</span><span class="n">leader</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#f8db38&#39;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">schedule</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">widget</span> <span class="ow">and</span> <span class="n">widget</span><span class="p">.</span><span class="n">lastUpdate</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">-</span> <span class="n">widget</span><span class="p">.</span><span class="n">lastUpdate</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="kr">then</span>

          <span class="n">widget</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">widget</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span><span class="o">..</span> <span class="s2">&quot; [inactive]&quot;</span><span class="p">)</span>

          <span class="n">widget</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;#aeaeae&quot;</span><span class="p">)</span>

          <span class="n">widget</span><span class="p">.</span><span class="n">health</span><span class="p">:</span><span class="n">setBackgroundColor</span><span class="p">(</span><span class="s2">&quot;#aeaeae&quot;</span><span class="p">)</span>

          <span class="n">widget</span><span class="p">.</span><span class="n">mana</span><span class="p">:</span><span class="n">setBackgroundColor</span><span class="p">(</span><span class="s2">&quot;#aeaeae&quot;</span><span class="p">)</span>

          <span class="n">widget</span><span class="p">.</span><span class="n">balance</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

          <span class="n">widget</span><span class="p">.</span><span class="n">damage</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

          <span class="n">widget</span><span class="p">.</span><span class="n">healing</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

          <span class="n">widget</span><span class="p">.</span><span class="n">creature</span><span class="p">:</span><span class="n">disable</span><span class="p">()</span>

        <span class="kr">end</span>

      <span class="kr">end</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">creature</span><span class="p">:</span><span class="n">setOutfit</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">outfit</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">health</span><span class="p">:</span><span class="n">setPercent</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">hp</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">health</span><span class="p">:</span><span class="n">setBackgroundColor</span><span class="p">(</span><span class="s2">&quot;#00c000&quot;</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">mana</span><span class="p">:</span><span class="n">setPercent</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">mana</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">mana</span><span class="p">:</span><span class="n">setBackgroundColor</span><span class="p">(</span><span class="s2">&quot;#0000FF&quot;</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">balance</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">balance</span><span class="p">))</span>

      <span class="kr">if</span> <span class="n">t</span><span class="p">.</span><span class="n">balance</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">balance</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#ff9854&#39;</span><span class="p">)</span>

      <span class="kr">elseif</span> <span class="n">t</span><span class="p">.</span><span class="n">balance</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">balance</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#45ad25&#39;</span><span class="p">)</span>

      <span class="kr">else</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">balance</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">damage</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">damage</span><span class="p">))</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">healing</span><span class="p">.</span><span class="n">value</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">heal</span><span class="p">))</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">membersData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

      <span class="kr">end</span>

      <span class="c1">--tooltip</span>

      <span class="kd">local</span> <span class="n">tooltip</span> <span class="o">=</span> <span class="s2">&quot;Session: &quot;</span><span class="o">..</span><span class="n">t</span><span class="p">.</span><span class="n">session</span><span class="o">..</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">..</span>

                      <span class="s2">&quot;Stamina: &quot;</span><span class="o">..</span><span class="n">t</span><span class="p">.</span><span class="n">stamina</span><span class="o">..</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">..</span>

                      <span class="s2">&quot;Exp Gained: &quot;</span><span class="o">..</span><span class="n">t</span><span class="p">.</span><span class="n">expGained</span><span class="o">..</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">..</span>

                      <span class="s2">&quot;Exp per Hour: &quot;</span><span class="o">..</span><span class="n">t</span><span class="p">.</span><span class="n">expH</span><span class="o">..</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">..</span>

                      <span class="s2">&quot;Balance: &quot;</span><span class="o">..</span><span class="n">t</span><span class="p">.</span><span class="n">balanceH</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">creature</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">hightlightText</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>

  <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">duration</span> <span class="kr">do</span>

    <span class="n">schedule</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">250</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">duration</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;#FFFFFF&quot;</span><span class="p">)</span>

      <span class="kr">else</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">nameRegex</span> <span class="o">=</span> <span class="s">[[Loot of (?:an |a |the |)([^:]+)]]</span>

<span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">lootChannel</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Loot of&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;The following items are available in your reward chest&quot;</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">name</span>

    <span class="c1">-- adding monster to killed list</span>

    <span class="kr">if</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Loot of&quot;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">name</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">nameRegex</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">killList</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

        <span class="n">killList</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

      <span class="kr">else</span>

        <span class="n">killList</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">killList</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="kr">end</span>

      <span class="n">refreshKills</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="c1">-- variables</span>

    <span class="kd">local</span> <span class="n">split</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">re</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">regex</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">combinedWorth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">local</span> <span class="n">formatted</span>

    <span class="kd">local</span> <span class="n">div</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kd">local</span> <span class="n">messageT</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">-- add timestamp, creature part and color it as white</span>

    <span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">os.date</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">)</span> <span class="o">..</span> <span class="s1">&#39; &#39;</span> <span class="o">..</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">..</span><span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="n">add</span><span class="p">(</span><span class="n">messageT</span><span class="p">,</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">..</span><span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="c1">-- main part</span>

    <span class="kr">if</span> <span class="n">re</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">re</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="c1">-- each looted item</span>

            <span class="kd">local</span> <span class="n">formattedLoot</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">[[(^[^(]+)]]</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">formattedLoot</span> <span class="o">=</span> <span class="n">formattedLoot</span><span class="p">:</span><span class="n">trim</span><span class="p">()</span>

            <span class="kd">local</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">getFirstNumberInText</span><span class="p">(</span><span class="n">formattedLoot</span><span class="p">)</span> <span class="c1">-- amount found in data</span>

            <span class="kd">local</span> <span class="n">price</span> <span class="o">=</span> <span class="n">amount</span> <span class="ow">and</span> <span class="n">getPrice</span><span class="p">(</span><span class="n">formattedLoot</span><span class="p">)</span> <span class="o">*</span> <span class="n">amount</span> <span class="ow">or</span> <span class="n">getPrice</span><span class="p">(</span><span class="n">formattedLoot</span><span class="p">)</span> <span class="c1">-- if amount then multity price, else just take price</span>

            <span class="kd">local</span> <span class="n">color</span> <span class="o">=</span> <span class="n">getColor</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="c1">-- generate hex string based off price</span>

            <span class="kd">local</span> <span class="n">messageColor</span> <span class="o">=</span> <span class="n">getColor</span><span class="p">(</span><span class="n">getPrice</span><span class="p">(</span><span class="n">formattedLoot</span><span class="p">))</span>

            <span class="n">combinedWorth</span> <span class="o">=</span> <span class="n">combinedWorth</span> <span class="o">+</span> <span class="n">price</span> <span class="c1">-- add all prices to calculate total worth</span>

            <span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">i</span><span class="o">==#</span><span class="n">re</span><span class="p">)</span>

            <span class="n">add</span><span class="p">(</span><span class="n">messageT</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">i</span><span class="o">==#</span><span class="n">re</span><span class="p">)</span>

            <span class="c1">--drop tracker</span>

            <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">dropTrackerWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

              <span class="kd">local</span> <span class="n">childName</span> <span class="o">=</span> <span class="n">child</span><span class="p">.</span><span class="n">name</span>

              <span class="n">childName</span> <span class="o">=</span> <span class="n">childName</span> <span class="ow">and</span> <span class="n">childName</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

              <span class="kr">if</span> <span class="n">childName</span> <span class="ow">and</span> <span class="n">formattedLoot</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="n">childName</span><span class="p">)</span> <span class="kr">then</span>

                <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">getItemId</span><span class="p">())]</span> <span class="o">=</span> <span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">getItemId</span><span class="p">())]</span> <span class="o">+</span> <span class="p">(</span><span class="n">amount</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">child</span><span class="p">.</span><span class="n">drops</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Loot Drops: &quot;</span><span class="o">..</span><span class="n">trackedLoot</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">getItemId</span><span class="p">())])</span>

                <span class="n">hightlightText</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;#f0b400&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

                <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">messagesPanel</span><span class="p">.</span><span class="n">statusLabel</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

                <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">messagesPanel</span><span class="p">.</span><span class="n">statusLabel</span><span class="p">:</span><span class="n">setColoredText</span><span class="p">({</span>

                  <span class="s2">&quot;Valuable loot: &quot;</span><span class="p">,</span> <span class="s2">&quot;#f0b400&quot;</span><span class="p">,</span>

                  <span class="n">childName</span><span class="o">..</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">messageColor</span><span class="p">,</span>

                  <span class="s2">&quot; dropped by &quot;</span><span class="o">..</span><span class="n">name</span><span class="o">..</span><span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;#f0b400&quot;</span>

<span class="p">})</span>

                <span class="n">schedule</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                  <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">messagesPanel</span><span class="p">.</span><span class="n">statusLabel</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

                <span class="kr">end</span><span class="p">)</span>

              <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="c1">-- format total worth so it wont look obnoxious</span>

    <span class="kr">if</span> <span class="n">combinedWorth</span> <span class="o">&gt;=</span> <span class="mi">1000000</span> <span class="kr">then</span>

        <span class="n">div</span> <span class="o">=</span> <span class="n">combinedWorth</span><span class="o">/</span><span class="mi">1000000</span>

        <span class="n">formatted</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;.&quot;</span> <span class="o">..</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">..</span> <span class="s2">&quot;kk&quot;</span>

    <span class="kr">elseif</span> <span class="n">combinedWorth</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="kr">then</span>

        <span class="n">div</span> <span class="o">=</span> <span class="n">combinedWorth</span><span class="o">/</span><span class="mi">1000</span>

        <span class="n">formatted</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;.&quot;</span> <span class="o">..</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">..</span> <span class="s2">&quot;k&quot;</span>

    <span class="kr">else</span>

        <span class="n">formatted</span> <span class="o">=</span> <span class="n">combinedWorth</span> <span class="o">..</span> <span class="s2">&quot;gp&quot;</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">messagesPanel</span><span class="p">.</span><span class="n">centerTextMessagePanel</span><span class="p">.</span><span class="n">highCenterLabel</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="n">text</span> <span class="kr">then</span>

      <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">messagesPanel</span><span class="p">.</span><span class="n">centerTextMessagePanel</span><span class="p">.</span><span class="n">highCenterLabel</span><span class="p">:</span><span class="n">setColoredText</span><span class="p">(</span><span class="n">messageT</span><span class="p">)</span>

      <span class="n">schedule</span><span class="p">(</span><span class="nb">math.max</span><span class="p">(</span><span class="o">#</span><span class="n">text</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">messagesPanel</span><span class="p">.</span><span class="n">centerTextMessagePanel</span><span class="p">.</span><span class="n">highCenterLabel</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

      <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="c1">-- add total worth to string</span>

    <span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&quot; - (&quot;</span><span class="p">,</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">formatted</span><span class="p">,</span> <span class="n">getColor</span><span class="p">(</span><span class="n">combinedWorth</span><span class="p">),</span> <span class="kc">true</span><span class="p">)</span>

    <span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="c1">-- get/create tab and write raw message</span>

    <span class="kd">local</span> <span class="n">tabName</span> <span class="o">=</span> <span class="s2">&quot;vBot Loot&quot;</span>

    <span class="kd">local</span> <span class="n">tab</span> <span class="o">=</span> <span class="n">console</span><span class="p">.</span><span class="n">getTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span> <span class="ow">or</span> <span class="n">console</span><span class="p">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="n">console</span><span class="p">.</span><span class="n">addText</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">console</span><span class="p">.</span><span class="n">SpeakTypesSettings</span><span class="p">,</span> <span class="n">tabName</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1">-- find last message in given tab and rewrite it with formatted string</span>

    <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">console</span><span class="p">.</span><span class="n">consoleTabBar</span><span class="p">:</span><span class="n">getTabPanel</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">consoleBuffer</span> <span class="o">=</span> <span class="n">panel</span><span class="p">:</span><span class="n">getChildById</span><span class="p">(</span><span class="s1">&#39;consoleBuffer&#39;</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">message</span> <span class="o">=</span> <span class="n">consoleBuffer</span><span class="p">:</span><span class="n">getLastChild</span><span class="p">()</span>

    <span class="n">message</span><span class="p">:</span><span class="n">setColoredText</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">niceFormat</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">div</span>

  <span class="kd">local</span> <span class="n">formatted</span>

    <span class="kr">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">10000000</span> <span class="kr">then</span>

      <span class="n">div</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="mi">10000000</span>

      <span class="n">formatted</span> <span class="o">=</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">div</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;M&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">1000000</span> <span class="kr">then</span>

      <span class="n">div</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="mi">1000000</span>

      <span class="n">formatted</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;.&quot;</span> <span class="o">..</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">..</span> <span class="s2">&quot;M&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">10000</span> <span class="kr">then</span>

      <span class="n">div</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="mi">1000</span>

      <span class="n">formatted</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;k&quot;</span>

    <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="kr">then</span>

        <span class="n">div</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="mi">1000</span>

        <span class="n">formatted</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;.&quot;</span> <span class="o">..</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">div</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">..</span> <span class="s2">&quot;k&quot;</span>

    <span class="kr">else</span>

        <span class="n">formatted</span> <span class="o">=</span> <span class="n">v</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">formatted</span>

<span class="kr">end</span>

<span class="n">resetAnalyzerSessionData</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span> <span class="o">=</span> <span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span> <span class="ow">or</span> <span class="p">{</span>

      <span class="n">refills</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

      <span class="n">rounds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

      <span class="n">time</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">lastRefill</span> <span class="o">=</span> <span class="nb">os.time</span><span class="p">(),</span>

      <span class="n">refillTime</span> <span class="o">=</span> <span class="p">{}</span>

<span class="p">}</span>

    <span class="n">launchTime</span> <span class="o">=</span> <span class="n">now</span>

    <span class="n">startExp</span> <span class="o">=</span> <span class="n">exp</span><span class="p">()</span>

    <span class="n">dmgTable</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">healTable</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">expTable</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">totalDmg</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">totalHeal</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">dmgDistribution</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">first</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">second</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">third</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">fourth</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">five</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">lootedItems</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">useData</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">usedItems</span> <span class="o">=</span><span class="p">{}</span>

    <span class="n">refreshLoot</span><span class="p">()</span>

    <span class="n">refreshWaste</span><span class="p">()</span>

    <span class="n">xpGraph</span><span class="p">:</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">drawGraph</span><span class="p">(</span><span class="n">xpGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">lootGraph</span><span class="p">:</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">drawGraph</span><span class="p">(</span><span class="n">lootGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">supplyGraph</span><span class="p">:</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">drawGraph</span><span class="p">(</span><span class="n">supplyGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">dmgGraph</span><span class="p">:</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">drawGraph</span><span class="p">(</span><span class="n">dmgGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">healGraph</span><span class="p">:</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">drawGraph</span><span class="p">(</span><span class="n">healGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">killList</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">refreshKills</span><span class="p">()</span>

    <span class="n">HuntingSessionStart</span> <span class="o">=</span> <span class="nb">os.date</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d, %H:%M:%S&#39;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">ResetSession</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">resetAnalyzerSessionData</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">mainWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">Settings</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">settingsWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="n">settingsWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

  <span class="n">settingsWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="c1">-- extras window</span>

<span class="n">settingsWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">settingsWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">getFrame</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">1000000</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="s1">&#39;/images/ui/rarity_gold&#39;</span>

  <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">100000</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="s1">&#39;/images/ui/rarity_purple&#39;</span>

  <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">10000</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="s1">&#39;/images/ui/rarity_blue&#39;</span>

  <span class="kr">elseif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="s1">&#39;/images/ui/rarity_green&#39;</span>

  <span class="kr">else</span>

      <span class="kr">return</span> <span class="s1">&#39;/images/ui/item&#39;</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">displayCondition</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">menuPosition</span><span class="p">,</span> <span class="n">lookThing</span><span class="p">,</span> <span class="n">useThing</span><span class="p">,</span> <span class="n">creatureThing</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">lookThing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lookThing</span><span class="p">:</span><span class="n">isCreature</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lookThing</span><span class="p">:</span><span class="n">isNotMoveable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">lookThing</span><span class="p">:</span><span class="n">isPickupable</span><span class="p">()</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="kc">true</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">interface</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_interface</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">setFrames</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">rarityFrames</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">window</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">itemsPanel</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">window</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

          <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">child</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

          <span class="kd">local</span> <span class="n">price</span> <span class="o">=</span> <span class="mi">0</span>

          <span class="kr">if</span> <span class="n">id</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span> <span class="c1">-- there&#39;s item</span>

              <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

              <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

              <span class="n">price</span> <span class="o">=</span> <span class="n">getPrice</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

              <span class="c1">-- set rarity frame</span>

              <span class="n">child</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="n">getFrame</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>

          <span class="kr">else</span> <span class="c1">-- empty widget</span>

              <span class="c1">-- revert any possible changes</span>

              <span class="n">child</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="s2">&quot;/images/ui/item&quot;</span><span class="p">)</span>

          <span class="kr">end</span>

          <span class="n">child</span><span class="p">.</span><span class="n">onHoverChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">hovered</span><span class="p">)</span>

            <span class="kr">if</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">hovered</span> <span class="kr">then</span>

              <span class="kr">return</span> <span class="n">interface</span><span class="p">.</span><span class="n">removeMenuHook</span><span class="p">(</span><span class="s1">&#39;analyzer&#39;</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="n">interface</span><span class="p">.</span><span class="n">addMenuHook</span><span class="p">(</span><span class="s1">&#39;analyzer&#39;</span><span class="p">,</span> <span class="s1">&#39;Price:&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">end</span><span class="p">,</span> <span class="n">displayCondition</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">setFrames</span><span class="p">()</span>

<span class="n">onContainerOpen</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">previousContainer</span><span class="p">)</span>

  <span class="n">setFrames</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onAddItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

  <span class="n">setFrames</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onRemoveItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

  <span class="n">setFrames</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onContainerUpdateItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

  <span class="n">setFrames</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">smallNumbers</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">^</span> <span class="mi">6</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%.1fkk&quot;</span><span class="p">,</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">^</span> <span class="mi">6</span><span class="p">)</span>

  <span class="kr">elseif</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">^</span> <span class="mi">3</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%.1fk&quot;</span><span class="p">,</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">^</span> <span class="mi">3</span><span class="p">)</span>

  <span class="kr">else</span>

      <span class="kr">return</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">refreshList</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="n">settingsWindow</span><span class="p">.</span><span class="n">CustomPrices</span>

  <span class="n">list</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">price</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">customPrices</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerPriceLabel&quot;</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span>

    <span class="n">label</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">customPrices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

      <span class="n">label</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

      <span class="n">schedule</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">setFrames</span><span class="p">()</span>

      <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="o">..</span><span class="n">name</span><span class="o">..</span><span class="s2">&quot;] = &quot;</span><span class="o">..</span><span class="n">smallNumbers</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="o">..</span><span class="s2">&quot; gp&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">refreshList</span><span class="p">()</span>

<span class="n">settingsWindow</span><span class="p">.</span><span class="n">addItem</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">newPrices</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">customPrices</span>

  <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">settingsWindow</span><span class="p">.</span><span class="n">ID</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">newPrice</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">settingsWindow</span><span class="p">.</span><span class="n">NewPrice</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

  <span class="kr">if</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;No item added!&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">Item</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">id</span><span class="p">):</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span>

  <span class="kr">if</span> <span class="n">newPrices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;Item already added! Remove it from the list to set a new price!&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">newPrices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">newPrice</span>

  <span class="n">settingsWindow</span><span class="p">.</span><span class="n">ID</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="n">settingsWindow</span><span class="p">.</span><span class="n">NewPrice</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="n">schedule</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">setFrames</span><span class="p">()</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">refreshList</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">settingsWindow</span><span class="p">.</span><span class="n">LootChannel</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">lootChannel</span><span class="p">)</span>

<span class="n">settingsWindow</span><span class="p">.</span><span class="n">LootChannel</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">lootChannel</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">lootChannel</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">lootChannel</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">settingsWindow</span><span class="p">.</span><span class="n">RarityFrames</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">rarityFrames</span><span class="p">)</span>

<span class="n">settingsWindow</span><span class="p">.</span><span class="n">RarityFrames</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">rarityFrames</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">rarityFrames</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">rarityFrames</span><span class="p">)</span>

  <span class="n">setFrames</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">timeToLevel</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="n">expPerHour</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">expPerHour</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="s2">&quot;-&quot;</span>

    <span class="kr">else</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">expLeft</span><span class="p">()</span><span class="o">/</span><span class="n">expPerHour</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

        <span class="kr">return</span> <span class="n">niceTimeFormat</span><span class="p">(</span><span class="nb">math.ceil</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">sumT</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">v</span><span class="p">.</span><span class="n">d</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">s</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">valueInSeconds</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">local</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">v</span><span class="p">.</span><span class="n">t</span> <span class="o">&lt;=</span> <span class="mi">3000</span> <span class="kr">then</span>

                <span class="kr">if</span> <span class="n">time</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

                    <span class="n">time</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">t</span>

                <span class="kr">end</span>

                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">v</span><span class="p">.</span><span class="n">d</span>

            <span class="kr">else</span>

              <span class="nb">table.remove</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="p">((</span><span class="n">now</span><span class="o">-</span><span class="n">time</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">regex</span> <span class="o">=</span> <span class="s2">&quot;You lose ([0-9]*) hitpoints due to an attack by ([a-z]*) ([a-z A-z-]*)&quot;</span>

<span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="n">getFirstNumberInText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">21</span> <span class="kr">then</span> <span class="c1">-- damage dealt</span>

      <span class="n">totalDmg</span> <span class="o">=</span> <span class="n">totalDmg</span> <span class="o">+</span> <span class="n">value</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">dmgTable</span><span class="p">,</span> <span class="p">{</span><span class="n">d</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">now</span><span class="p">})</span>

        <span class="kr">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">storage</span><span class="p">.</span><span class="n">bestHit</span> <span class="kr">then</span>

            <span class="n">storage</span><span class="p">.</span><span class="n">bestHit</span> <span class="o">=</span> <span class="n">value</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">23</span> <span class="kr">then</span> <span class="c1">-- healing</span>

      <span class="n">totalHeal</span> <span class="o">=</span> <span class="n">totalHeal</span> <span class="o">+</span> <span class="n">value</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">healTable</span><span class="p">,</span> <span class="p">{</span><span class="n">d</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">now</span><span class="p">})</span>

        <span class="kr">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">storage</span><span class="p">.</span><span class="n">bestHeal</span> <span class="kr">then</span>

            <span class="n">storage</span><span class="p">.</span><span class="n">bestHeal</span> <span class="o">=</span> <span class="n">value</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="c1">-- damage distribution part</span>

    <span class="kr">if</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;You lose&quot;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">regex</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

      <span class="kr">if</span> <span class="n">data</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">monster</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="kd">local</span> <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">dmgDistribution</span><span class="p">,</span> <span class="p">{</span><span class="n">v</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="n">monster</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">now</span><span class="p">})</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">capitalFistLetter</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>

  <span class="kr">return</span> <span class="p">(</span><span class="nb">string.gsub</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s2">&quot;^%l&quot;</span><span class="p">,</span> <span class="nb">string.upper</span><span class="p">))</span>

<span class="kr">end</span>

<span class="c1">-- tables maintance</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">dmgFinal</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kd">local</span> <span class="n">labelTable</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kd">local</span> <span class="n">dmgSum</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nb">table.insert</span><span class="p">(</span><span class="n">expTable</span><span class="p">,</span> <span class="n">exp</span><span class="p">())</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">expTable</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="o">*</span><span class="mi">60</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">expTable</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

              <span class="nb">table.remove</span><span class="p">(</span><span class="n">expTable</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">dmgDistribution</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">v</span><span class="p">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="mi">10</span> <span class="kr">then</span>

        <span class="nb">table.remove</span><span class="p">(</span><span class="n">dmgDistribution</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

      <span class="kr">else</span>

        <span class="n">dmgSum</span> <span class="o">=</span> <span class="n">dmgSum</span> <span class="o">+</span> <span class="n">v</span><span class="p">.</span><span class="n">v</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">dmgFinal</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">m</span><span class="p">]</span> <span class="kr">then</span>

          <span class="n">dmgFinal</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">v</span>

        <span class="kr">else</span>

          <span class="n">dmgFinal</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmgFinal</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">.</span><span class="n">v</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">first</span> <span class="o">=</span> <span class="n">dmgFinal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">second</span> <span class="o">=</span> <span class="n">dmgFinal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">third</span> <span class="o">=</span> <span class="n">dmgFinal</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">fourth</span> <span class="o">=</span> <span class="n">dmgFinal</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">or</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="n">five</span> <span class="o">=</span> <span class="n">dmgFinal</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">or</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">}</span>

    <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">dmgFinal</span><span class="p">)</span> <span class="kr">do</span>

      <span class="nb">table.insert</span><span class="p">(</span><span class="n">labelTable</span><span class="p">,</span> <span class="p">{</span><span class="n">m</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="nb">tonumber</span><span class="p">(</span><span class="n">v</span><span class="p">)})</span>

    <span class="kr">end</span>

    <span class="nb">table.sort</span><span class="p">(</span><span class="n">labelTable</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="kr">return</span> <span class="n">a</span><span class="p">.</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">d</span> <span class="kr">end</span><span class="p">)</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">labelTable</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">val</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">((</span><span class="n">v</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">dmgSum</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;%&quot;</span>

      <span class="kd">local</span> <span class="n">words</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

      <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="kr">do</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">..</span> <span class="s2">&quot; &quot;</span> <span class="o">..</span> <span class="n">capitalFistLetter</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">20</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">name</span><span class="p">:</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span><span class="o">..</span><span class="s2">&quot;...&quot;</span>

      <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">:</span><span class="n">trim</span><span class="p">()</span><span class="o">..</span><span class="s2">&quot;: &quot;</span>

      <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">first</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">val</span><span class="p">}</span>

      <span class="kr">elseif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

        <span class="n">second</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">val</span><span class="p">}</span>

      <span class="kr">elseif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

        <span class="n">third</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">val</span><span class="p">}</span>

      <span class="kr">elseif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span>

        <span class="n">fourth</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">val</span><span class="p">}</span>

      <span class="kr">elseif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">5</span> <span class="kr">then</span>

        <span class="n">five</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">val</span><span class="p">}</span>

      <span class="kr">else</span>

        <span class="kr">break</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">getPanelHeight</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">List</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">elements</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="mi">0</span>

  <span class="kr">else</span>

    <span class="kd">local</span> <span class="n">rows</span> <span class="o">=</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">elements</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">height</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">*</span> <span class="mi">35</span>

    <span class="kr">return</span> <span class="n">height</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">refreshLoot</span><span class="p">()</span>

    <span class="n">lootItems</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

    <span class="n">lootList</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">lootedItems</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">label1</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerLootItem&quot;</span><span class="p">,</span> <span class="n">lootItems</span><span class="p">)</span>

      <span class="kd">local</span> <span class="n">price</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">count</span> <span class="ow">and</span> <span class="n">getPrice</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">count</span> <span class="ow">or</span> <span class="n">getPrice</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

      <span class="n">label1</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

      <span class="n">label1</span><span class="p">:</span><span class="n">setItemCount</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

      <span class="n">label1</span><span class="p">:</span><span class="n">setShowCount</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

      <span class="n">label1</span><span class="p">.</span><span class="n">count</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">niceFormat</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">count</span><span class="p">))</span>

      <span class="n">label1</span><span class="p">.</span><span class="n">count</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">getColor</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>

      <span class="kd">local</span> <span class="n">tooltipName</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">&quot;s&quot;</span> <span class="ow">or</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span>

      <span class="n">label1</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">count</span> <span class="o">..</span> <span class="s2">&quot;x &quot;</span> <span class="o">..</span> <span class="n">tooltipName</span> <span class="o">..</span> <span class="s2">&quot; (Value: &quot;</span><span class="o">..</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">getPrice</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">))</span><span class="o">..</span><span class="s2">&quot;gp, Sum: &quot;</span><span class="o">..</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="o">..</span><span class="s2">&quot;gp)&quot;</span><span class="p">)</span>

      <span class="c1">--hunting window loot list</span>

      <span class="kd">local</span> <span class="n">label2</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;ListLabel&quot;</span><span class="p">,</span> <span class="n">lootList</span><span class="p">)</span>

      <span class="n">label2</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">count</span> <span class="o">..</span> <span class="s2">&quot;x &quot;</span> <span class="o">..</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">lootItems</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;ListLabel&quot;</span><span class="p">,</span> <span class="n">lootList</span><span class="p">)</span>

      <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">refreshLoot</span><span class="p">()</span>

<span class="kr">function</span> <span class="nf">refreshKills</span><span class="p">()</span>

    <span class="n">killedList</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">kills</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">killList</span><span class="p">)</span> <span class="kr">do</span>

      <span class="n">kills</span> <span class="o">=</span> <span class="n">kills</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;ListLabel&quot;</span><span class="p">,</span> <span class="n">killedList</span><span class="p">)</span>

      <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">v</span> <span class="o">..</span> <span class="s2">&quot;x &quot;</span> <span class="o">..</span> <span class="n">k</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">kills</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;ListLabel&quot;</span><span class="p">,</span> <span class="n">killedList</span><span class="p">)</span>

      <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">refreshKills</span><span class="p">()</span>

<span class="kr">function</span> <span class="nf">refreshWaste</span><span class="p">()</span>

    <span class="n">supplyItems</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

    <span class="n">suppliesByRefill</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

    <span class="n">suppliesByRound</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">parents</span> <span class="o">=</span> <span class="p">{</span><span class="n">supplyItems</span><span class="p">,</span> <span class="n">suppliesByRound</span><span class="p">,</span> <span class="n">suppliesByRefill</span><span class="p">}</span>

    <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">usedItems</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">parents</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">v</span><span class="p">.</span><span class="n">count</span> <span class="ow">or</span>

                       <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">v</span><span class="p">.</span><span class="n">count</span><span class="o">/</span><span class="p">(</span><span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span><span class="p">.</span><span class="n">rounds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>

                       <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">v</span><span class="p">.</span><span class="n">count</span><span class="o">/</span><span class="p">(</span><span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span><span class="p">.</span><span class="n">refills</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">amount</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">label1</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;AnalyzerLootItem&quot;</span><span class="p">,</span> <span class="n">parents</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="kd">local</span> <span class="n">price</span> <span class="o">=</span> <span class="n">amount</span> <span class="ow">and</span> <span class="n">getPrice</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">*</span> <span class="n">amount</span> <span class="ow">or</span> <span class="n">getPrice</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">label1</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="n">label1</span><span class="p">:</span><span class="n">setItemCount</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

        <span class="n">label1</span><span class="p">:</span><span class="n">setShowCount</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

        <span class="n">label1</span><span class="p">.</span><span class="n">count</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">niceFormat</span><span class="p">(</span><span class="n">amount</span><span class="p">))</span>

        <span class="n">label1</span><span class="p">.</span><span class="n">count</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">getColor</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>

        <span class="kd">local</span> <span class="n">tooltipName</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">&quot;s&quot;</span> <span class="ow">or</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span>

        <span class="n">label1</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">amount</span> <span class="o">..</span> <span class="s2">&quot;x &quot;</span> <span class="o">..</span> <span class="n">tooltipName</span> <span class="o">..</span> <span class="s2">&quot; (Value: &quot;</span><span class="o">..</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">getPrice</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">))</span><span class="o">..</span><span class="s2">&quot;gp, Sum: &quot;</span><span class="o">..</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="o">..</span><span class="s2">&quot;gp)&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- loot analyzer</span>

<span class="c1">-- adding</span>

<span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">GetLootContainers</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">lastCap</span> <span class="o">=</span> <span class="n">freecap</span><span class="p">()</span>

<span class="n">onAddItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">containers</span><span class="p">,</span> <span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">isInPz</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">slot</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">freecap</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">lastCap</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">tmpname</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3031</span> <span class="ow">and</span> <span class="s2">&quot;gold coin&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3035</span> <span class="ow">and</span> <span class="s2">&quot;platinum coin&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3043</span> <span class="ow">and</span> <span class="s2">&quot;crystal coin&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">:</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">lootedItems</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

    <span class="n">lootedItems</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">count</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">(),</span> <span class="n">name</span> <span class="o">=</span> <span class="n">tmpname</span> <span class="p">}</span>

  <span class="kr">else</span>

    <span class="n">lootedItems</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">count</span> <span class="o">=</span>  <span class="n">lootedItems</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">count</span> <span class="o">+</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">lastCap</span> <span class="o">=</span> <span class="n">freecap</span><span class="p">()</span>

  <span class="n">refreshLoot</span><span class="p">()</span>

  <span class="c1">-- drop tracker</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onContainerUpdateItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">containers</span><span class="p">,</span> <span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">oldItem</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">isInPz</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">freecap</span><span class="p">()</span> <span class="o">==</span> <span class="n">lastCap</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">tmpname</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3031</span> <span class="ow">and</span> <span class="s2">&quot;gold coin&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3035</span> <span class="ow">and</span> <span class="s2">&quot;platinum coin&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3043</span> <span class="ow">and</span> <span class="s2">&quot;crystal coin&quot;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">:</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span>

  <span class="kd">local</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">()</span> <span class="o">-</span> <span class="n">oldItem</span><span class="p">:</span><span class="n">getCount</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">amount</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="kr">return</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">lootedItems</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

      <span class="n">lootedItems</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">count</span> <span class="o">=</span> <span class="n">amount</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">tmpname</span> <span class="p">}</span>

  <span class="kr">else</span>

      <span class="n">lootedItems</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">count</span> <span class="o">=</span> <span class="n">lootedItems</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">count</span> <span class="o">+</span> <span class="n">amount</span>

  <span class="kr">end</span>

  <span class="n">lastCap</span> <span class="o">=</span> <span class="n">freecap</span><span class="p">()</span>

  <span class="n">refreshLoot</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- ammo</span>

<span class="kd">local</span> <span class="n">ammo</span> <span class="o">=</span> <span class="p">{</span><span class="mi">16143</span><span class="p">,</span> <span class="mi">763</span><span class="p">,</span> <span class="mi">761</span><span class="p">,</span> <span class="mi">7365</span><span class="p">,</span> <span class="mi">3448</span><span class="p">,</span> <span class="mi">762</span><span class="p">,</span> <span class="mi">21470</span><span class="p">,</span> <span class="mi">7364</span><span class="p">,</span> <span class="mi">14251</span><span class="p">,</span> <span class="mi">3447</span><span class="p">,</span> <span class="mi">3449</span><span class="p">,</span> <span class="mi">15793</span><span class="p">,</span> <span class="mi">25757</span><span class="p">,</span> <span class="mi">774</span><span class="p">,</span> <span class="mi">35901</span><span class="p">,</span> <span class="mi">6528</span><span class="p">,</span> <span class="mi">7363</span><span class="p">,</span> <span class="mi">3450</span><span class="p">,</span> <span class="mi">16141</span><span class="p">,</span> <span class="mi">25758</span><span class="p">,</span> <span class="mi">14252</span><span class="p">,</span> <span class="mi">3446</span><span class="p">,</span> <span class="mi">16142</span><span class="p">,</span> <span class="mi">35902</span><span class="p">}</span>

<span class="n">onContainerUpdateItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">ammo</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">newCount</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">oldCount</span> <span class="o">=</span> <span class="n">oldItem</span><span class="p">:</span><span class="n">getCount</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span>

  <span class="kr">if</span> <span class="n">oldCount</span> <span class="o">-</span> <span class="n">newCount</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">usedItems</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="kr">then</span>

      <span class="n">usedItems</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">}</span>

    <span class="kr">else</span>

      <span class="n">usedItems</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">count</span> <span class="o">=</span> <span class="n">usedItems</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="kr">end</span>

    <span class="n">refreshWaste</span><span class="p">()</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- waste</span>

<span class="kd">local</span> <span class="n">regex3</span> <span class="o">=</span> <span class="s">[[\d ([a-z A-Z]*)s...]]</span>

<span class="kd">local</span> <span class="n">lackOfData</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

  <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;using one of&quot;</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">getFirstNumberInText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">re</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">regex3</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

  <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">WasteItems</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">id</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">lackOfData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

      <span class="n">lackOfData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>

      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Analyzer] no data for item: &quot;</span><span class="o">..</span><span class="n">name</span><span class="o">..</span> <span class="s2">&quot;inside items.lua → WasteItems&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">return</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">useData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

    <span class="n">useData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount</span>

  <span class="kr">else</span>

    <span class="kr">if</span> <span class="nb">math.abs</span><span class="p">(</span><span class="n">useData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">-</span><span class="n">amount</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

      <span class="n">useData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">usedItems</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="kr">then</span>

        <span class="n">usedItems</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">}</span>

      <span class="kr">else</span>

        <span class="n">usedItems</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">count</span> <span class="o">=</span> <span class="n">usedItems</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="kr">end</span>

    <span class="kr">else</span>

      <span class="n">useData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="kr">end</span>

    <span class="n">refreshWaste</span><span class="p">()</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">hourVal</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

  <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="ow">or</span> <span class="mi">0</span>

  <span class="kr">return</span> <span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="n">uptime</span><span class="p">)</span><span class="o">*</span><span class="mi">3600</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">bottingStats</span><span class="p">()</span>

  <span class="n">lootWorth</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="n">wasteWorth</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">lootedItems</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">LootItems</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

      <span class="n">lootWorth</span> <span class="o">=</span> <span class="n">lootWorth</span> <span class="o">+</span> <span class="p">(</span><span class="n">LootItems</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">.</span><span class="n">count</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">usedItems</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">LootItems</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

      <span class="n">wasteWorth</span> <span class="o">=</span> <span class="n">wasteWorth</span> <span class="o">+</span> <span class="p">(</span><span class="n">LootItems</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">.</span><span class="n">count</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">balance</span> <span class="o">=</span> <span class="n">lootWorth</span> <span class="o">-</span> <span class="n">wasteWorth</span>

  <span class="kr">return</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">bottingLabels</span><span class="p">(</span><span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span><span class="p">)</span>

  <span class="n">balanceDesc</span> <span class="o">=</span> <span class="kc">nil</span>

  <span class="n">hourDesc</span> <span class="o">=</span> <span class="kc">nil</span>

  <span class="n">desc</span> <span class="o">=</span> <span class="kc">nil</span>

  <span class="kr">if</span> <span class="n">balance</span> <span class="o">&gt;=</span> <span class="mi">1000000</span> <span class="ow">or</span> <span class="n">balance</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1000000</span> <span class="kr">then</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">/</span> <span class="mi">1000000</span>

    <span class="n">balanceDesc</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;.&quot;</span> <span class="o">..</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">desc</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">..</span> <span class="s2">&quot;kk&quot;</span>

  <span class="kr">elseif</span> <span class="n">balance</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="ow">or</span> <span class="n">balance</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1000</span> <span class="kr">then</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">balanceDesc</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;.&quot;</span> <span class="o">..</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">desc</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">..</span><span class="s2">&quot;k&quot;</span>

  <span class="kr">else</span>

    <span class="n">balanceDesc</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">..</span> <span class="s2">&quot;gp&quot;</span>

  <span class="kr">end</span>

  <span class="n">hour</span> <span class="o">=</span> <span class="n">hourVal</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">1000000</span> <span class="ow">or</span> <span class="n">hour</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1000000</span> <span class="kr">then</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">/</span> <span class="mi">1000000</span>

    <span class="n">hourDesc</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">hourVal</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span> <span class="o">..</span> <span class="s2">&quot;.&quot;</span> <span class="o">..</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">hourVal</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">..</span> <span class="s2">&quot;kk/h&quot;</span>

  <span class="kr">elseif</span> <span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="ow">or</span> <span class="n">hour</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1000</span> <span class="kr">then</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">hourDesc</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">hourVal</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span> <span class="o">..</span> <span class="s2">&quot;.&quot;</span> <span class="o">..</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">hourVal</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">..</span> <span class="s2">&quot;k/h&quot;</span>

  <span class="kr">else</span>

    <span class="n">hourDesc</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">hourVal</span><span class="p">(</span><span class="n">balance</span><span class="p">))</span> <span class="o">..</span> <span class="s2">&quot;gp/h&quot;</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">balanceDesc</span><span class="p">,</span> <span class="n">hourDesc</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">reportStats</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">bottingStats</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">balanceDesc</span><span class="p">,</span> <span class="n">hourDesc</span> <span class="o">=</span> <span class="n">bottingLabels</span><span class="p">(</span><span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

  <span class="n">a</span> <span class="o">=</span> <span class="s2">&quot;Session Time: &quot;</span> <span class="o">..</span> <span class="n">sessionTime</span><span class="p">()</span> <span class="o">..</span> <span class="s2">&quot;, Exp Gained: &quot;</span> <span class="o">..</span> <span class="n">format_thousand</span><span class="p">(</span><span class="n">expGained</span><span class="p">())</span> <span class="o">..</span> <span class="s2">&quot;, Exp/h: &quot;</span> <span class="o">..</span> <span class="n">expPerHour</span><span class="p">()</span>

  <span class="n">b</span> <span class="o">=</span> <span class="s2">&quot; | Balance: &quot;</span> <span class="o">..</span> <span class="n">balanceDesc</span> <span class="o">..</span> <span class="s2">&quot; (&quot;</span> <span class="o">..</span> <span class="n">hourDesc</span> <span class="o">..</span> <span class="s2">&quot;)&quot;</span>

  <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">..</span><span class="n">b</span>

  <span class="kr">return</span> <span class="n">c</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">damageHour</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">uptime</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">*</span><span class="mi">60</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">totalDmg</span>

  <span class="kr">else</span>

    <span class="kr">return</span> <span class="n">hourVal</span><span class="p">(</span><span class="n">totalDmg</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">healHour</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">uptime</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">*</span><span class="mi">60</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">totalHeal</span>

  <span class="kr">else</span>

    <span class="kr">return</span> <span class="n">hourVal</span><span class="p">(</span><span class="n">totalHeal</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">wasteHour</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">bottingStats</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">uptime</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">*</span><span class="mi">60</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">wasteWorth</span>

  <span class="kr">else</span>

    <span class="kr">return</span> <span class="n">hourVal</span><span class="p">(</span><span class="n">wasteWorth</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">lootHour</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">bottingStats</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">uptime</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">*</span><span class="mi">60</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">lootWorth</span>

  <span class="kr">else</span>

    <span class="kr">return</span> <span class="n">hourVal</span><span class="p">(</span><span class="n">lootWorth</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">getHuntingData</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">bottingStats</span><span class="p">()</span>

  <span class="kr">return</span> <span class="n">totalDmg</span><span class="p">,</span> <span class="n">totalHeal</span><span class="p">,</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">avgTable</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

  <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">~=</span> <span class="s1">&#39;table&#39;</span> <span class="kr">then</span> <span class="kr">return</span> <span class="mi">0</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">v</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="o">#</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="mi">0</span>

  <span class="kr">else</span>

    <span class="kr">return</span> <span class="n">val</span><span class="o">/#</span><span class="n">t</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--bestdps/hps</span>

<span class="kd">local</span> <span class="n">bestDPS</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">local</span> <span class="n">bestHPS</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">--main loop</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">bottingStats</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">balanceDesc</span><span class="p">,</span> <span class="n">hourDesc</span> <span class="o">=</span> <span class="n">bottingLabels</span><span class="p">(</span><span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span><span class="p">)</span>

    <span class="c1">-- hps and dps</span>

    <span class="kd">local</span> <span class="n">curHPS</span> <span class="o">=</span> <span class="n">valueInSeconds</span><span class="p">(</span><span class="n">healTable</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">curDPS</span> <span class="o">=</span> <span class="n">valueInSeconds</span><span class="p">(</span><span class="n">dmgTable</span><span class="p">)</span>

    <span class="n">bestHPS</span> <span class="o">=</span> <span class="n">bestHPS</span> <span class="o">&gt;</span> <span class="n">curHPS</span> <span class="ow">and</span> <span class="n">bestHPS</span> <span class="ow">or</span> <span class="n">curHPS</span>

    <span class="n">bestDPS</span> <span class="o">=</span> <span class="n">bestDPS</span> <span class="o">&gt;</span> <span class="n">curDPS</span> <span class="ow">and</span> <span class="n">bestDPS</span> <span class="ow">or</span> <span class="n">curDPS</span>

    <span class="c1">--hunt window</span>

    <span class="n">sessionTimeLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">sessionTime</span><span class="p">())</span>

    <span class="n">xpGainLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">expGained</span><span class="p">()))</span>

    <span class="n">xpHourLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">expPerHour</span><span class="p">())</span>

    <span class="n">lootLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">lootWorth</span><span class="p">))</span>

    <span class="n">suppliesLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">wasteWorth</span><span class="p">))</span>

    <span class="n">balanceLabel</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">balance</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;#45ad25&quot;</span> <span class="ow">or</span> <span class="s2">&quot;#ff9854&quot;</span><span class="p">)</span>

    <span class="n">balanceLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">balanceDesc</span> <span class="o">..</span> <span class="s2">&quot; (&quot;</span> <span class="o">..</span> <span class="n">hourDesc</span> <span class="o">..</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>

    <span class="n">damageLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">totalDmg</span><span class="p">))</span>

    <span class="n">damageHourLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">damageHour</span><span class="p">()))</span>

    <span class="n">healingLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">totalHeal</span><span class="p">))</span>

    <span class="n">healingHourLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">healHour</span><span class="p">()))</span>

    <span class="c1">--loot window</span>

    <span class="n">lootInLootAnalyzerLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">lootWorth</span><span class="p">))</span>

    <span class="n">lootHourInLootAnalyzerLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">lootHour</span><span class="p">()))</span>

    <span class="c1">--supply window</span>

    <span class="n">suppliesInSuppliesAnalyzerLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">wasteWorth</span><span class="p">))</span>

    <span class="n">suppliesHourInSuppliesAnalyzerLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">wasteHour</span><span class="p">()))</span>

    <span class="c1">--impact window</span>

    <span class="n">totalDamageLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">totalDmg</span><span class="p">))</span>

    <span class="n">maxDpsLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">bestDPS</span><span class="p">))</span>

    <span class="n">bestHitLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">bestHit</span><span class="p">)</span>

    <span class="n">top1</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">first</span><span class="p">.</span><span class="n">l</span><span class="p">)</span>

    <span class="n">top1</span><span class="p">.</span><span class="n">right</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">first</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>

    <span class="n">top2</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">second</span><span class="p">.</span><span class="n">l</span><span class="p">)</span>

    <span class="n">top2</span><span class="p">.</span><span class="n">right</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">second</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>

    <span class="n">top3</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">third</span><span class="p">.</span><span class="n">l</span><span class="p">)</span>

    <span class="n">top3</span><span class="p">.</span><span class="n">right</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">third</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>

    <span class="n">top4</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">fourth</span><span class="p">.</span><span class="n">l</span><span class="p">)</span>

    <span class="n">top4</span><span class="p">.</span><span class="n">right</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">fourth</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>

    <span class="n">top5</span><span class="p">.</span><span class="n">left</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">five</span><span class="p">.</span><span class="n">l</span><span class="p">)</span>

    <span class="n">top5</span><span class="p">.</span><span class="n">right</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">five</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>

    <span class="n">totalHealingLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">totalHeal</span><span class="p">))</span>

    <span class="n">maxHpsLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">bestHPS</span><span class="p">))</span>

    <span class="n">bestHealLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">bestHeal</span><span class="p">)</span>

    <span class="c1">--xp window</span>

    <span class="n">xpGrainInXpLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">expGained</span><span class="p">()))</span>

    <span class="n">xpHourInXpLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">expPerHour</span><span class="p">())</span>

    <span class="n">nextLevelLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">timeToLevel</span><span class="p">())</span>

    <span class="n">progressBar</span><span class="p">:</span><span class="n">setPercent</span><span class="p">(</span><span class="n">modules</span><span class="p">.</span><span class="n">game_skills</span><span class="p">.</span><span class="n">skillsWindow</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">level</span><span class="p">.</span><span class="n">percent</span><span class="p">:</span><span class="n">getPercent</span><span class="p">())</span>

    <span class="c1">--stats</span>

    <span class="n">totalRounds</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span><span class="p">.</span><span class="n">rounds</span><span class="p">)</span>

    <span class="n">avRoundTime</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">niceTimeFormat</span><span class="p">(</span><span class="n">avgTable</span><span class="p">(</span><span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span><span class="p">.</span><span class="n">time</span><span class="p">),</span><span class="kc">true</span><span class="p">))</span>

    <span class="n">totalRefills</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span><span class="p">.</span><span class="n">refills</span><span class="p">)</span>

    <span class="n">avRefillTime</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">niceTimeFormat</span><span class="p">(</span><span class="n">avgTable</span><span class="p">(</span><span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span><span class="p">.</span><span class="n">refillTime</span><span class="p">),</span><span class="kc">true</span><span class="p">))</span>

    <span class="n">lastRefill</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">niceTimeFormat</span><span class="p">(</span><span class="nb">os.difftime</span><span class="p">(</span><span class="nb">os.time</span><span class="p">()</span><span class="o">-</span><span class="n">vBot</span><span class="p">.</span><span class="n">CaveBotData</span><span class="p">.</span><span class="n">lastRefill</span><span class="p">),</span><span class="kc">true</span><span class="p">))</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">--graphs, draw each minute</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">drawGraph</span><span class="p">(</span><span class="n">xpGraph</span><span class="p">,</span> <span class="n">expPerHour</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

  <span class="n">drawGraph</span><span class="p">(</span><span class="n">lootGraph</span><span class="p">,</span> <span class="n">lootHour</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

  <span class="n">drawGraph</span><span class="p">(</span><span class="n">supplyGraph</span><span class="p">,</span> <span class="n">wasteHour</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

  <span class="n">drawGraph</span><span class="p">(</span><span class="n">dmgGraph</span><span class="p">,</span> <span class="n">valueInSeconds</span><span class="p">(</span><span class="n">dmgTable</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

  <span class="n">drawGraph</span><span class="p">(</span><span class="n">healGraph</span><span class="p">,</span> <span class="n">valueInSeconds</span><span class="p">(</span><span class="n">healTable</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">--party hunt analyzer</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="c1">-- send data</span>

  <span class="kr">if</span> <span class="n">storage</span><span class="p">.</span><span class="n">sendPartyAnalyzerData</span> <span class="kr">then</span>

    <span class="n">sendData</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">totalWaste</span><span class="p">,</span> <span class="n">totalLoot</span><span class="p">,</span> <span class="n">totalBalance</span> <span class="o">=</span> <span class="n">getSumStats</span><span class="p">()</span>

  <span class="n">partySessionTimeLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">sessionTime</span><span class="p">())</span>

  <span class="n">partyLootLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">totalLoot</span><span class="p">))</span>

  <span class="n">partySuppliesLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">totalWaste</span><span class="p">))</span>

  <span class="n">partyBalanceLabel</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">format_thousand</span><span class="p">(</span><span class="n">totalBalance</span><span class="p">))</span>

  <span class="kr">if</span> <span class="n">totalBalance</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="n">partyBalanceLabel</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#ff9854&#39;</span><span class="p">)</span>

  <span class="kr">elseif</span> <span class="n">totalBalance</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="n">partyBalanceLabel</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#45ad25&#39;</span><span class="p">)</span>

  <span class="kr">else</span>

    <span class="n">partyBalanceLabel</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">bossName</span><span class="p">,</span> <span class="n">dueTime</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">analyzers</span><span class="p">.</span><span class="n">trackedBoss</span><span class="p">)</span> <span class="kr">do</span>

    <span class="n">createBossPanel</span><span class="p">(</span><span class="n">bossName</span><span class="p">,</span> <span class="n">dueTime</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- public functions</span>

<span class="c1">-- global namespace</span>

<span class="n">Analyzer</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getKillsAmount</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

  <span class="kr">return</span> <span class="n">killList</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span>

<span class="kr">end</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getLootedAmount</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">nameOrId</span><span class="p">)</span>

  <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nameOrId</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">lootedItems</span><span class="p">[</span><span class="n">nameOrId</span><span class="p">].</span><span class="n">count</span> <span class="ow">or</span> <span class="mi">0</span>

  <span class="kr">else</span>

    <span class="kd">local</span> <span class="n">nameOrId</span> <span class="o">=</span> <span class="n">nameOrId</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">lootedItems</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">nameOrId</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">v</span><span class="p">.</span><span class="n">count</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="mi">0</span>

<span class="kr">end</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getTotalProfit</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">bottingStats</span><span class="p">()</span>

  <span class="kr">return</span> <span class="n">lootWorth</span>

<span class="kr">end</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getTotalWaste</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">bottingStats</span><span class="p">()</span>

  <span class="kr">return</span> <span class="n">wasteWorth</span>

<span class="kr">end</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getBalance</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">lootWorth</span><span class="p">,</span> <span class="n">wasteWorth</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">bottingStats</span><span class="p">()</span>

  <span class="kr">return</span> <span class="n">balance</span>

<span class="kr">end</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getXpGained</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">return</span> <span class="n">expGained</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getXpHour</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">return</span> <span class="n">expPerHour</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getTimeToNextLevel</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">return</span> <span class="n">timeToLevel</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">Analyzer</span><span class="p">.</span><span class="n">getCaveBotStats</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">parents</span> <span class="o">=</span> <span class="p">{</span><span class="n">suppliesByRound</span><span class="p">,</span> <span class="n">suppliesByRefill</span><span class="p">}</span>

  <span class="kd">local</span> <span class="n">round</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kd">local</span> <span class="n">refill</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">child</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">count</span> <span class="o">=</span> <span class="n">child</span><span class="p">.</span><span class="n">count</span>

      <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">round</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

      <span class="kr">else</span>

        <span class="n">refill</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="p">{</span>

    <span class="n">totalRounds</span> <span class="o">=</span> <span class="n">totalRounds</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span>

    <span class="n">avRoundTime</span> <span class="o">=</span> <span class="n">avRoundTime</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span>

    <span class="n">totalRefills</span> <span class="o">=</span> <span class="n">totalRefills</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span>

    <span class="n">avRefillTime</span> <span class="o">=</span> <span class="n">avRefillTime</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span>

    <span class="n">lastRefill</span> <span class="o">=</span> <span class="n">lastRefill</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span>

    <span class="n">roundSupplies</span> <span class="o">=</span> <span class="n">round</span><span class="p">,</span> <span class="c1">-- { [id] = amount, [id2] = amount ...}</span>

    <span class="n">refillSupplies</span> <span class="o">=</span> <span class="n">refill</span> <span class="c1">-- { [id] = amount, [id2] = amount ...}</span>

<span class="p">}</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="analyzer-otui">
<h1>analyzer.otui<a class="headerlink" href="#analyzer-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
BossCreaturePanel &lt; Panel

  height: 38

  UICreature

    id: creature

    size: 35 35

    anchors.left: parent.left

    anchors.verticalCenter: parent.verticalCenter

    old-scaling: true

    margin-left: 3

  Label

    id: name

    anchors.left: creature.right

    margin: 1

    margin-left: 5

    margin-top: 4

    anchors.top: parent.top

    anchors.bottom: creature.verticalCenter

    anchors.right: parent.right

    font: verdana-11px-rounded

    color: #FFFFFF

    text: Duke Krule

  Label

    id: cooldown

    anchors.left: creature.right

    margin: 1

    margin-left: 5

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    anchors.top: creature.verticalCenter

    font: verdana-11px-rounded

    text: 19h 20min

SearchPanel &lt; TextEdit

  placeholder: Type to search

  margin-top: 1

  @onClick: modules.client_textedit.show(self)

  Button

    id: clear

    anchors.right: parent.right

    margin-right: -2

    anchors.verticalCenter: parent.verticalCenter

    size: 18 18

    text: X

    @onClick: |

      self:getParent():setText(&quot;&quot;)

TrackerItem &lt; Panel

  height: 40

  BotItem

    id: item

    anchors.top: parent.top

    margin-top: 2

    anchors.left: parent.left

    image-source:

  UIWidget

    id: name

    anchors.top: prev.top

    margin-top: 1

    anchors.bottom: prev.verticalCenter

    anchors.left: prev.right

    anchors.right: parent.right

    margin-left: 5

    text: Set Item to start track.

    text-align:left

    font: verdana-11px-rounded

    color: #FFFFFF

  UIWidget

    id: drops

    anchors.top: prev.bottom

    margin-top: 3

    anchors.bottom: Item.bottom

    anchors.left: prev.left

    anchors.right: parent.right

    font: verdana-11px-rounded

    text-align:left

    text: Loot Drops: 0

    color: #CCCCCC

DualLabel &lt; Label

  height: 15

  text-offset: 4 0

  font: verdana-11px-rounded

  text-align: left

  width: 50

  Label

    id: value

    anchors.right: parent.right

    margin-right: 4

    anchors.verticalCenter: parent.verticalCenter

    width: 200

    font: verdana-11px-rounded

    text-align: right

    text: 0

MemberWidget &lt; Panel

  height: 85

  margin-top: 3

  UICreature

    id: creature

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.bottom: parent.bottom

    size: 28 28

  UIWidget

    id: name

    anchors.left: prev.right

    margin-left: 5

    anchors.top: parent.top

    height: 12

    anchors.right: parent.right

    text: Player Name

    font: verdana-11px-rounded

    text-align: left

  ProgressBar

    id: health

    anchors.left: prev.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 2

    height: 7

    background-color: #00c000

    phantom: false

  ProgressBar

    id: mana

    anchors.left: prev.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    height: 7

    background-color: #0000FF

    phantom: false

  DualLabel

    id: balance

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 5

    text: Balance:

  DualLabel

    id: damage

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 2

    text: Damage:

  DualLabel

    id: healing

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 2

    text: Healing:

AnalyzerPriceLabel &lt; Label

  background-color: alpha

  text-offset: 2 0

  focusable: true

  height: 16

  $focus:

    background-color: #00000055

  Button

    id: remove

    !text: tr(&#39;x&#39;)

    anchors.right: parent.right

    margin-right: 15

    width: 15

    height: 15

AnalyzerListPanel &lt; Panel

  padding-left: 4

  padding-right: 4

  layout:

    type: verticalBox

    fit-children: true

ListLabel &lt; Label

  height: 15

  font: verdana-11px-rounded

  text-offset: 15 0

AnalyzerItemsPanel &lt; Panel

  id: List

  padding: 2

  layout:

    type: grid

    cell-size: 33 33

    cell-spacing: 1

    num-columns: 5

    fit-children: true

AnalyzerLootItem &lt; UIItem

  opacity: 0.87

  height: 37

  margin-left: 1

  virtual: true

  background-color: alpha

  Label

    id: count

    font: verdana-11px-rounded

    color: white

    opacity: 0.87

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    margin-right: 2

    text-align: right

    text: 0

AnalyzerGraph &lt; UIGraph

  height: 140

  capacity: 400

  line-width: 1

  color: red

  margin-top: 5

  margin-left: 5

  margin-right: 5

  background-color: #383636

  padding: 5

  font: verdana-11px-rounded

  image-source: /images/ui/graph_background

AnalyzerProgressBar &lt; ProgressBar

  background-color: green

  height: 5

  margin-top: 3

  phantom: false

  margin-left: 3

  margin-right: 3

  border: 1 black

AnalyzerButton &lt; Button

  height: 22

  margin-bottom: 2

  font: verdana-11px-rounded

  text-offset: 0 4

MainAnalyzerWindow &lt; MiniWindow

  id: MainAnalyzerWindow

  text: Analytics Selector

  height: 293

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-left: 5

    padding-right: 5

    padding-top: 5

    layout: verticalBox

    AnalyzerButton

      id: HuntingAnalyzer

      text: Hunting Analyzer

    AnalyzerButton

      id: LootAnalyzer

      text: Loot Analyzer

    AnalyzerButton

      id: SupplyAnalyzer

      text: Supply Analyzer

    AnalyzerButton

      id: ImpactAnalyzer

      text: Impact Analyzer

    AnalyzerButton

      id: XPAnalyzer

      text: XP Analyzer

    AnalyzerButton

      id: DropTracker

      text: Drop Tracker

    AnalyzerButton

      id: Stats

      text: CaveBot Stats

      color: #74B73E

    AnalyzerButton

      id: PartyHunt

      text: Party Hunt

      color: #3895D3

    AnalyzerButton

      id: BossTracker

      text: Boss Cooldowns

      color: #df3afb

    AnalyzerButton

      id: Settings

      text: Features &amp; Settings

      color: #FABD02

    AnalyzerButton

      id: ResetSession

      text: Reset Session

      color: #FF0000

HuntingAnalyzer &lt; MiniWindow

  id: HuntingAnalyzerWindow

  text: Hunt Analyzer

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-top: 3

    layout: verticalBox

LootAnalyzer &lt; MiniWindow

  id: LootAnalyzerWindow

  text: Loot Analyzer

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-top: 3

    layout: verticalBox

SupplyAnalyzer &lt; MiniWindow

  id: SupplyAnalyzerWindow

  text: Supply Analyzer

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-top: 3

    layout: verticalBox

ImpactAnalyzer &lt; MiniWindow

  id: ImpactAnalyzerWindow

  text: Impact Analyzer

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-top: 3

    layout: verticalBox

XPAnalyzer &lt; MiniWindow

  id: XPAnalyzerWindow

  text: XP Analyzer

  height: 150

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-top: 3

    layout: verticalBox

PartyAnalyzerWindow &lt; MiniWindow

  id: PartyAnalyzerWindow

  text: Party Hunt

  height: 200

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-left: 3

    padding-right: 3

    padding-top: 1

    layout: verticalBox

DropTracker &lt; MiniWindow

  id: DropTracker

  text: Drop Tracker

  height: 200

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-left: 3

    padding-right: 3

    padding-top: 1

    layout: verticalBox

CaveBotStats &lt; MiniWindow

  id: CaveBotStats

  text: CaveBot Stats

  height: 200

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-left: 3

    padding-right: 3

    padding-top: 1

    layout: verticalBox

BossTracker &lt; MiniWindow

  id: BossTracker

  text: Boss Cooldowns

  height: 200

  icon: /images/topbuttons/analyzers

  MiniWindowContents

    padding-left: 3

    padding-right: 3

    padding-top: 1

    layout: verticalBox

    SearchPanel

      id: search

FeaturesWindow &lt; MainWindow

  id: FeaturesWindow

  size: 250 370

  padding: 15

  text: Analyzers Features

  @onEscape: self:hide()

  TextList

    id: CustomPrices

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 10

    padding: 1

    height: 220

    vertical-scrollbar: CustomPricesScrollBar

  VerticalScrollBar

    id: CustomPricesScrollBar

    anchors.top: CustomPrices.top

    anchors.bottom: CustomPrices.bottom

    anchors.right: CustomPrices.right

    step: 14

    pixels-scroll: true

  BotItem

    id: ID

    anchors.left: CustomPrices.left

    anchors.top: CustomPrices.bottom

    margin-top: 5

  SpinBox

    id: NewPrice

    anchors.left: prev.right

    margin-left: 5

    anchors.verticalCenter: prev.verticalCenter

    width: 100

    minimum: 0

    maximum: 1000000000

    step: 1

    text-align: center

    focusable: true

  Button

    id: addItem

    anchors.left: prev.right

    margin-left: 5

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: CustomPrices.right

    text: Add

    font: verdana-11px-rounded

  HorizontalSeparator

    anchors.left: ID.right

    margin-left: 5

    anchors.right: CustomPrices.right

    anchors.verticalCenter: ID.top

  HorizontalSeparator

    id: secondSeparator

    anchors.left: ID.right

    margin-left: 5

    anchors.right: CustomPrices.right

    anchors.bottom: ID.bottom

  BotSwitch

    id: LootChannel

    anchors.left: CustomPrices.left

    anchors.right: parent.horizontalCenter

    margin-right: 2

    anchors.top: prev.top

    margin-top: 20

    text: Loot Channel

    font: verdana-11px-rounded

  BotSwitch

    id: RarityFrames

    anchors.left: parent.horizontalCenter

    margin-left: 2

    anchors.right: CustomPrices.right

    anchors.top: secondSeparator.top

    margin-top: 20

    text: Rarity Frames

    font: verdana-11px-rounded

  HorizontalSeparator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-top: 15

    margin-right: 5

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="antirs-lua">
<h1>antiRs.lua<a class="headerlink" href="#antirs-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

<span class="n">g_game</span><span class="p">.</span><span class="n">cancelAttackAndFollow</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">frags</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kd">local</span> <span class="n">unequip</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kd">local</span> <span class="n">m</span> <span class="o">=</span> <span class="n">macro</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;AntiRS &amp; Msg&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">end</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">safeExit</span><span class="p">()</span>

    <span class="n">CaveBot</span><span class="p">.</span><span class="n">setOff</span><span class="p">()</span>

    <span class="n">TargetBot</span><span class="p">.</span><span class="n">setOff</span><span class="p">()</span>

    <span class="n">g_game</span><span class="p">.</span><span class="n">cancelAttackAndFollow</span><span class="p">()</span>

    <span class="n">g_game</span><span class="p">.</span><span class="n">cancelAttackAndFollow</span><span class="p">()</span>

    <span class="n">g_game</span><span class="p">.</span><span class="n">cancelAttackAndFollow</span><span class="p">()</span>

    <span class="n">modules</span><span class="p">.</span><span class="n">game_interface</span><span class="p">.</span><span class="n">forceExit</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Warning! The murder of&quot;</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">frags</span> <span class="o">=</span> <span class="n">frags</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="kr">if</span> <span class="n">killsToRs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">frags</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">EquipManager</span><span class="p">.</span><span class="n">setOff</span><span class="p">()</span>

        <span class="n">schedule</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

            <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">getLeft</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getLeft</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

            <span class="kr">if</span> <span class="n">id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unequip</span> <span class="kr">then</span>

                <span class="n">unequip</span> <span class="o">=</span> <span class="kc">true</span>

                <span class="n">g_game</span><span class="p">.</span><span class="n">equipItemId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="n">safeExit</span><span class="p">()</span>

        <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cast-food-lua">
<h1>cast_food.lua<a class="headerlink" href="#cast-food-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;HP&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="n">voc</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">voc</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">11</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="kr">then</span>

                <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kd">local</span> <span class="n">foodItems</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">3607</span><span class="p">,</span> <span class="mi">3585</span><span class="p">,</span> <span class="mi">3592</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">3601</span> <span class="p">}</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">foodItems</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

                <span class="nb">table.insert</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;Cast Food&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">player</span><span class="p">:</span><span class="n">getRegenerationTime</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">400</span> <span class="kr">then</span>

            <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;exevo pan&quot;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cavebot-lua">
<h1>cavebot.lua<a class="headerlink" href="#cavebot-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Cavebot by otclient@otclient.ovh</span>

<span class="c1">-- visit http://bot.otclient.ovh/</span>

<span class="kd">local</span> <span class="n">cavebotTab</span> <span class="o">=</span> <span class="s2">&quot;Cave&quot;</span>

<span class="kd">local</span> <span class="n">targetingTab</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">extras</span><span class="p">.</span><span class="n">joinBot</span> <span class="ow">and</span> <span class="s2">&quot;Cave&quot;</span> <span class="ow">or</span> <span class="s2">&quot;Target&quot;</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="n">cavebotTab</span><span class="p">)</span>

<span class="n">CaveBot</span><span class="p">.</span><span class="n">Extensions</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">importStyle</span><span class="p">(</span><span class="s2">&quot;/cavebot/cavebot.otui&quot;</span><span class="p">)</span>

<span class="n">importStyle</span><span class="p">(</span><span class="s2">&quot;/cavebot/config.otui&quot;</span><span class="p">)</span>

<span class="n">importStyle</span><span class="p">(</span><span class="s2">&quot;/cavebot/editor.otui&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/actions.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/config.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/editor.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/example_functions.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/recorder.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/walking.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/minimap.lua&quot;</span><span class="p">)</span>

<span class="c1">-- in this section you can add extensions, check extension_template.lua</span>

<span class="c1">--dofile(&quot;/cavebot/extension_template.lua&quot;)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/sell_all.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/depositor.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/buy_supplies.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/d_withdraw.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/supply_check.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/travel.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/doors.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/pos_check.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/withdraw.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/inbox_withdraw.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/lure.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/bank.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/clear_tile.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/tasker.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/imbuing.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/stand_lure.lua&quot;</span><span class="p">)</span>

<span class="c1">-- main cavebot file, must be last</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/cavebot/cavebot.lua&quot;</span><span class="p">)</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="n">targetingTab</span><span class="p">)</span>

<span class="kr">if</span> <span class="n">storage</span><span class="p">.</span><span class="n">extras</span><span class="p">.</span><span class="n">joinBot</span> <span class="kr">then</span> <span class="n">UI</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;-- [[ TargetBot ]] --&quot;</span><span class="p">)</span> <span class="kr">end</span>

<span class="n">TargetBot</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- global namespace</span>

<span class="n">importStyle</span><span class="p">(</span><span class="s2">&quot;/targetbot/looting.otui&quot;</span><span class="p">)</span>

<span class="n">importStyle</span><span class="p">(</span><span class="s2">&quot;/targetbot/target.otui&quot;</span><span class="p">)</span>

<span class="n">importStyle</span><span class="p">(</span><span class="s2">&quot;/targetbot/creature_editor.otui&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/targetbot/creature.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/targetbot/creature_attack.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/targetbot/creature_editor.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/targetbot/creature_priority.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/targetbot/looting.lua&quot;</span><span class="p">)</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/targetbot/walking.lua&quot;</span><span class="p">)</span>

<span class="c1">-- main targetbot file, must be last</span>

<span class="nb">dofile</span><span class="p">(</span><span class="s2">&quot;/targetbot/target.lua&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="cavebot-control-panel-lua">
<h1>cavebot_control_panel.lua<a class="headerlink" href="#cavebot-control-panel-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Cave&quot;</span><span class="p">)</span>

<span class="n">g_ui</span><span class="p">.</span><span class="n">loadUIFromString</span><span class="p">(</span><span class="s">[[</span>

<span class="s">CaveBotControlPanel &lt; Panel</span>

<span class="s">  margin-top: 5</span>

<span class="s">  layout:</span>

<span class="s">    type: verticalBox</span>

<span class="s">    fit-children: true</span>

<span class="s">  HorizontalSeparator</span>

<span class="s">  Label</span>

<span class="s">    text-align: center</span>

<span class="s">    text: CaveBot Control Panel</span>

<span class="s">    font: verdana-11px-rounded</span>

<span class="s">    margin-top: 3</span>

<span class="s">  HorizontalSeparator</span>

<span class="s">  Panel</span>

<span class="s">    id: buttons</span>

<span class="s">    margin-top: 2</span>

<span class="s">    layout:</span>

<span class="s">      type: grid</span>

<span class="s">      cell-size: 86 20</span>

<span class="s">      cell-spacing: 1</span>

<span class="s">      flow: true</span>

<span class="s">      fit-children: true</span>

<span class="s">  HorizontalSeparator</span>

<span class="s">    margin-top: 3</span>

<span class="s">]]</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;CaveBotControlPanel&quot;</span><span class="p">)</span>

<span class="n">storage</span><span class="p">.</span><span class="n">caveBot</span> <span class="o">=</span> <span class="p">{</span>

  <span class="n">forceRefill</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

  <span class="n">backStop</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

  <span class="n">backTrainers</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

  <span class="n">backOffline</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">}</span>

<span class="c1">-- [[ B U T T O N S ]] --</span>

<span class="kd">local</span> <span class="n">forceRefill</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Force Refill&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">caveBot</span><span class="p">.</span><span class="n">forceRefill</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CaveBot] Going back on refill on next supply check.&quot;</span><span class="p">)</span>

<span class="kr">end</span><span class="p">,</span> <span class="n">panel</span><span class="p">.</span><span class="n">buttons</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">backStop</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Back &amp; Stop&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">caveBot</span><span class="p">.</span><span class="n">backStop</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CaveBot] Going back to city on next supply check and turning off CaveBot on depositer action.&quot;</span><span class="p">)</span>

<span class="kr">end</span><span class="p">,</span> <span class="n">panel</span><span class="p">.</span><span class="n">buttons</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">backTrainers</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;To Trainers&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">caveBot</span><span class="p">.</span><span class="n">backTrainers</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CaveBot] Going back to city on next supply check and going to label &#39;toTrainers&#39; on depositer action.&quot;</span><span class="p">)</span>

<span class="kr">end</span><span class="p">,</span> <span class="n">panel</span><span class="p">.</span><span class="n">buttons</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">backOffline</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Offline&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">caveBot</span><span class="p">.</span><span class="n">backOffline</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CaveBot] Going back to city on next supply check and going to label &#39;toOfflineTraining&#39; on depositer action.&quot;</span><span class="p">)</span>

<span class="kr">end</span><span class="p">,</span> <span class="n">panel</span><span class="p">.</span><span class="n">buttons</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="combo-lua">
<h1>combo.lua<a class="headerlink" href="#combo-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;combobot&quot;</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 19</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;ComboBot&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: combos</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Setup</span>

<span class="s">]]</span><span class="p">)</span>

<span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">onSayEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">onShootEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">onCastEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">followLeaderEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">attackLeaderTargetEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">attackSpellEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">attackItemToggle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">sayLeader</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

    <span class="n">shootLeader</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

    <span class="n">castLeader</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

    <span class="n">sayPhrase</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

    <span class="n">spell</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

    <span class="n">serverLeader</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

    <span class="n">item</span> <span class="o">=</span> <span class="mi">3155</span><span class="p">,</span>

    <span class="n">attack</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

    <span class="n">follow</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>

    <span class="n">commandsEnabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

    <span class="n">serverEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">serverLeaderTarget</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

    <span class="n">serverTriggers</span> <span class="o">=</span> <span class="kc">true</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

<span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

<span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">ui</span><span class="p">.</span><span class="n">combos</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="n">comboWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

  <span class="n">comboWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">rootWidget</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">()</span>

<span class="kr">if</span> <span class="n">rootWidget</span> <span class="kr">then</span>

  <span class="n">comboWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;ComboWindow&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="c1">-- bot item</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackItem</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">item</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackItem</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="c1">-- switches</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">commandsToggle</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">commandsEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">commandsToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">commandsEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">commandsEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">commandsEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">botServerToggle</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">botServerToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">Triggers</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">serverTriggers</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">Triggers</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">serverTriggers</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">serverTriggers</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">serverTriggers</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">targetServerLeaderToggle</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">serverLeaderTarget</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">targetServerLeaderToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">serverLeaderTarget</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeaderTarget</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">serverLeaderTarget</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="c1">-- buttons</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">comboWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="c1">-- combo boxes</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">followLeader</span><span class="p">:</span><span class="n">setOption</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">follow</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">followLeader</span><span class="p">.</span><span class="n">onOptionChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">follow</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getCurrentOption</span><span class="p">().</span><span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackLeaderTarget</span><span class="p">:</span><span class="n">setOption</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">attack</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackLeaderTarget</span><span class="p">.</span><span class="n">onOptionChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">attack</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getCurrentOption</span><span class="p">().</span><span class="n">text</span>

  <span class="kr">end</span>

  <span class="c1">-- checkboxes</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onSayToggle</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">onSayEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onSayToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">onSayEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">onSayEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">onSayEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onShootToggle</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">onShootEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onShootToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">onShootEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">onShootEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">onShootEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onCastToggle</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">onCastEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onCastToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">onCastEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">onCastEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">onCastEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">followLeaderToggle</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">followLeaderEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">followLeaderToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">followLeaderEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">followLeaderEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">followLeaderEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackLeaderTargetToggle</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">attackLeaderTargetEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackLeaderTargetToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">attackLeaderTargetEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">attackLeaderTargetEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">attackLeaderTargetEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackSpellToggle</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">attackSpellEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackSpellToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">attackSpellEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">attackSpellEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">attackSpellEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackItemToggle</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">attackItemEnabled</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackItemToggle</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">attackItemEnabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">attackItemEnabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">attackItemEnabled</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="c1">-- text edits</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onSayLeader</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">sayLeader</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onSayLeader</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">sayLeader</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onShootLeader</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onShootLeader</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onCastLeader</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">castLeader</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onCastLeader</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">castLeader</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onSayPhrase</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">sayPhrase</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">trigger</span><span class="p">.</span><span class="n">onSayPhrase</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">sayPhrase</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackSpell</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">attackSpell</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">spell</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">botServerLeader</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">)</span>

  <span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">botServerLeader</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- bot server</span>

<span class="c1">-- [[ join party made by Frosty ]] --</span>

<span class="kd">local</span> <span class="n">shouldCloseWindow</span> <span class="o">=</span> <span class="kc">false</span>

<span class="kd">local</span> <span class="n">firstInvitee</span> <span class="o">=</span> <span class="kc">true</span>

<span class="kd">local</span> <span class="n">isInComboTeam</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">shouldCloseWindow</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">channelsWindow</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_console</span><span class="p">.</span><span class="n">channelsWindow</span>

    <span class="kr">if</span> <span class="n">channelsWindow</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">child</span> <span class="o">=</span> <span class="n">channelsWindow</span><span class="p">:</span><span class="n">getChildById</span><span class="p">(</span><span class="s2">&quot;buttonCancel&quot;</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">child</span> <span class="kr">then</span>

        <span class="n">child</span><span class="p">:</span><span class="n">onClick</span><span class="p">()</span>

        <span class="n">shouldCloseWindow</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="n">isInComboTeam</span> <span class="o">=</span> <span class="kc">true</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">comboWindow</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">partyButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">talkPrivate</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">,</span> <span class="s2">&quot;request invite &quot;</span> <span class="o">..</span> <span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span><span class="p">)</span>

    <span class="kr">else</span>

      <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;Request failed. Lack of data.&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">20</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;invited you to&quot;</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">regex</span> <span class="o">=</span> <span class="s2">&quot;[a-zA-Z]*&quot;</span>

        <span class="kd">local</span> <span class="n">regexData</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">regexData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">leader</span> <span class="o">=</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">regexData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

          <span class="kr">if</span> <span class="n">leader</span> <span class="kr">then</span>

            <span class="n">g_game</span><span class="p">.</span><span class="n">partyJoin</span><span class="p">(</span><span class="n">leader</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span>

            <span class="n">g_game</span><span class="p">.</span><span class="n">requestChannels</span><span class="p">()</span>

            <span class="n">g_game</span><span class="p">.</span><span class="n">joinChannel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">shouldCloseWindow</span> <span class="o">=</span> <span class="kc">true</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onTalk</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;request invite&quot;</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">access</span> <span class="o">=</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;%d.*&quot;</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">access</span> <span class="ow">and</span> <span class="n">access</span> <span class="o">==</span> <span class="n">storage</span><span class="p">.</span><span class="n">BotServerChannel</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">minion</span> <span class="o">=</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

          <span class="kr">if</span> <span class="n">minion</span> <span class="kr">then</span>

            <span class="n">g_game</span><span class="p">.</span><span class="n">partyInvite</span><span class="p">(</span><span class="n">minion</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span>

            <span class="kr">if</span> <span class="n">firstInvitee</span> <span class="kr">then</span>

              <span class="n">g_game</span><span class="p">.</span><span class="n">requestChannels</span><span class="p">()</span>

              <span class="n">g_game</span><span class="p">.</span><span class="n">joinChannel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

              <span class="n">shouldCloseWindow</span> <span class="o">=</span> <span class="kc">true</span>

              <span class="n">firstInvitee</span> <span class="o">=</span> <span class="kc">false</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">else</span>

          <span class="n">talkPrivate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Incorrect access key!&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="c1">-- [[ End of Frosty&#39;s Code ]] --</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">sayLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">config</span><span class="p">.</span><span class="n">sayPhrase</span><span class="p">)</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">onSayEnabled</span> <span class="kr">then</span>

      <span class="n">startCombo</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">castLeader</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">castLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">())</span> <span class="ow">and</span> <span class="n">isAttSpell</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">onCastEnabled</span> <span class="kr">then</span>

      <span class="n">startCombo</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">commandsEnabled</span> <span class="ow">and</span> <span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">sayLeader</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">sayLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">castLeader</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">castLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">())</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ue&quot;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">say</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">params</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>

      <span class="kr">if</span> <span class="o">#</span><span class="n">params</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">target</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">trim</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="kr">then</span>

          <span class="n">useWith</span><span class="p">(</span><span class="mi">3155</span><span class="p">,</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;att&quot;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">attParams</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>

      <span class="kr">if</span> <span class="o">#</span><span class="n">attParams</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">atTarget</span> <span class="o">=</span> <span class="n">attParams</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">trim</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">atTarget</span><span class="p">)</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">attack</span> <span class="o">==</span> <span class="s2">&quot;COMMAND TARGET&quot;</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">attack</span><span class="p">(</span><span class="n">getCreatureByName</span><span class="p">(</span><span class="n">atTarget</span><span class="p">))</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">isAttSpell</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="kr">then</span>

    <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;trigger&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onMissle</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">missle</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">onShootEnabled</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span> <span class="ow">or</span> <span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">src</span> <span class="o">=</span> <span class="n">missle</span><span class="p">:</span><span class="n">getSource</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">src</span><span class="p">.</span><span class="n">z</span> <span class="o">~=</span> <span class="n">posz</span><span class="p">()</span> <span class="kr">then</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">from</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">to</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">missle</span><span class="p">:</span><span class="n">getDestination</span><span class="p">())</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">from</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">to</span> <span class="kr">then</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">fromCreatures</span> <span class="o">=</span> <span class="n">from</span><span class="p">:</span><span class="n">getCreatures</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">toCreatures</span> <span class="o">=</span> <span class="n">to</span><span class="p">:</span><span class="n">getCreatures</span><span class="p">()</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">fromCreatures</span> <span class="o">~=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="o">#</span><span class="n">toCreatures</span> <span class="o">~=</span> <span class="mi">1</span> <span class="kr">then</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">fromCreatures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="kd">local</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">toCreatures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">leaderTarget</span> <span class="o">=</span> <span class="n">t1</span>

    <span class="kr">if</span> <span class="n">c1</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">attackItemEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">item</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">findItem</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

        <span class="n">useWith</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">attackSpellEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">spell</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="n">say</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">attackLeaderTargetEnabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">leaderTarget</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">attack</span> <span class="o">==</span> <span class="s2">&quot;LEADER TARGET&quot;</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">getTarget</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">getTarget</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getTarget</span><span class="p">():</span><span class="n">getName</span><span class="p">()</span> <span class="o">~=</span> <span class="n">leaderTarget</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="kr">then</span>

      <span class="n">g_game</span><span class="p">.</span><span class="n">attack</span><span class="p">(</span><span class="n">leaderTarget</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">attack</span> <span class="o">==</span> <span class="s2">&quot;SERVER LEADER TARGET&quot;</span> <span class="ow">and</span> <span class="n">serverTarget</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">serverTarget</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">getTarget</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">getTarget</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getTarget</span><span class="p">():</span><span class="n">getname</span><span class="p">()</span> <span class="o">~=</span> <span class="n">serverTarget</span><span class="p">)</span>

    <span class="kr">then</span>

      <span class="n">g_game</span><span class="p">.</span><span class="n">attack</span><span class="p">(</span><span class="n">serverTarget</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">toFollow</span>

<span class="kd">local</span> <span class="n">toFollowPos</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">toFollow</span> <span class="o">=</span> <span class="kc">nil</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">followLeaderEnabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">leaderTarget</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">follow</span> <span class="o">==</span> <span class="s2">&quot;LEADER TARGET&quot;</span> <span class="ow">and</span> <span class="n">leaderTarget</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="kr">then</span>

    <span class="n">toFollow</span> <span class="o">=</span> <span class="n">leaderTarget</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>

  <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">follow</span> <span class="o">==</span> <span class="s2">&quot;SERVER LEADER TARGET&quot;</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="n">toFollow</span> <span class="o">=</span> <span class="n">serverTarget</span>

  <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">follow</span> <span class="o">==</span> <span class="s2">&quot;SERVER LEADER&quot;</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="n">toFollow</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span>

  <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">follow</span> <span class="o">==</span> <span class="s2">&quot;LEADER&quot;</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">onSayEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">sayLeader</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">toFollow</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">sayLeader</span>

    <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">onCastEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">castLeader</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">toFollow</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">castLeader</span>

    <span class="kr">elseif</span> <span class="n">config</span><span class="p">.</span><span class="n">onShootEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">toFollow</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">shootLeader</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">toFollow</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">target</span> <span class="o">=</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">toFollow</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">target</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">tpos</span> <span class="o">=</span> <span class="n">target</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="n">toFollowPos</span><span class="p">[</span><span class="n">tpos</span><span class="p">.</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpos</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">player</span><span class="p">:</span><span class="n">isWalking</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">p</span> <span class="o">=</span> <span class="n">toFollowPos</span><span class="p">[</span><span class="n">posz</span><span class="p">()]</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">walkTo</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">{</span><span class="n">ignoreNonPathable</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignoreStairs</span><span class="o">=</span><span class="kc">false</span><span class="p">})</span> <span class="kr">then</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onCreaturePositionChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">creature</span><span class="p">,</span> <span class="n">oldPos</span><span class="p">,</span> <span class="n">newPos</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">creature</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">toFollow</span> <span class="ow">and</span> <span class="n">newPos</span> <span class="kr">then</span>

    <span class="n">toFollowPos</span><span class="p">[</span><span class="n">newPos</span><span class="p">.</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">newPos</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">now</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">startCombo</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">attackItemEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">item</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">findItem</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">useWith</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">getTarget</span><span class="p">())</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">attackSpellEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">spell</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

      <span class="n">say</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">spell</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">startCombo</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="kr">end</span>

  <span class="c1">-- attack part / server</span>

  <span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">target</span><span class="p">()</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timeout</span> <span class="o">&gt;</span> <span class="mi">500</span> <span class="kr">then</span>

      <span class="n">targetPos</span> <span class="o">=</span> <span class="n">target</span><span class="p">():</span><span class="n">getName</span><span class="p">()</span>

      <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">targetPos</span><span class="p">)</span>

      <span class="n">timeout</span> <span class="o">=</span> <span class="n">now</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onUseWith</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">itemId</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">subType</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="ow">and</span> <span class="n">itemId</span> <span class="o">==</span> <span class="mi">3155</span> <span class="kr">then</span>

    <span class="n">BotServer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;useWith&quot;</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kr">if</span> <span class="n">BotServer</span><span class="p">.</span><span class="n">_websocket</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">serverEnabled</span> <span class="kr">then</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;trigger&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;start&quot;</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">~=</span> <span class="n">player</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">serverTriggers</span> <span class="kr">then</span>

      <span class="n">startCombo</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">~=</span> <span class="n">player</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">()</span> <span class="ow">or</span> <span class="n">target</span><span class="p">():</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeaderTarget</span> <span class="kr">then</span>

          <span class="n">serverTarget</span> <span class="o">=</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">attack</span><span class="p">(</span><span class="n">getCreatureByName</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">BotServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;useWith&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

   <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

   <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">serverTriggers</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">~=</span> <span class="n">player</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config</span><span class="p">.</span><span class="n">serverLeader</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">attackItemEnabled</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">item</span> <span class="ow">and</span> <span class="n">findItem</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

    <span class="n">useWith</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">item</span><span class="p">,</span> <span class="n">tile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">())</span>

   <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="combo-otui">
<h1>combo.otui<a class="headerlink" href="#combo-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
AttackComboBoxPopupMenu &lt; ComboBoxPopupMenu

AttackComboBoxPopupMenuButton &lt; ComboBoxPopupMenuButton

AttackComboBox &lt; ComboBox

  @onSetup: |

    self:addOption(&quot;LEADER TARGET&quot;)

    self:addOption(&quot;COMMAND TARGET&quot;)

FollowComboBoxPopupMenu &lt; ComboBoxPopupMenu

FollowComboBoxPopupMenuButton &lt; ComboBoxPopupMenuButton

FollowComboBox &lt; ComboBox

  @onSetup: |

    self:addOption(&quot;LEADER TARGET&quot;)

    self:addOption(&quot;SERVER LEADER TARGET&quot;)

    self:addOption(&quot;LEADER&quot;)

    self:addOption(&quot;SERVER LEADER&quot;)

ComboTrigger &lt; Panel

  id: trigger

  image-source: /images/ui/panel_flat

  image-border: 6

  padding: 3

  size: 450 72

  Label

    id: triggerLabel1

    anchors.left: parent.left

    anchors.top: parent.top

    text: On Say

    margin-top: 8

    margin-left: 5

    color: #ffaa00

  Label

    id: leaderLabel

    anchors.left: triggerLabel1.right

    anchors.top: triggerLabel1.top

    text: Leader:

    margin-left: 35

  TextEdit

    id: onSayLeader

    anchors.left: leaderLabel.right

    anchors.top: leaderLabel.top

    anchors.bottom: leaderLabel.bottom

    margin-left: 5

    width: 120

    font: cipsoftFont

  Label

    id: phrase

    anchors.left: onSayLeader.right

    anchors.top: onSayLeader.top

    text: Phrase:

    margin-left: 5

  TextEdit

    id: onSayPhrase

    anchors.left: phrase.right

    anchors.top: leaderLabel.top

    anchors.bottom: leaderLabel.bottom

    margin-left: 5

    width: 120

    font: cipsoftFont

  CheckBox

    id: onSayToggle

    anchors.left: onSayPhrase.right

    anchors.top: onSayPhrase.top

    margin-top: 1

    margin-left: 5

  Label

    id: triggerLabel2

    anchors.left: triggerLabel1.left

    anchors.top: triggerLabel1.bottom

    text: On Shoot

    margin-top: 5

    color: #ffaa00

  Label

    id: leaderLabel1

    anchors.left: triggerLabel2.right

    anchors.top: triggerLabel2.top

    text: Leader:

    margin-left: 24

  TextEdit

    id: onShootLeader

    anchors.left: leaderLabel1.right

    anchors.top: leaderLabel1.top

    anchors.bottom: leaderLabel1.bottom

    anchors.right: onSayPhrase.right

    margin-left: 5

    width: 120

    font: cipsoftFont

  CheckBox

    id: onShootToggle

    anchors.left: onShootLeader.right

    anchors.top: onShootLeader.top

    margin-top: 1

    margin-left: 5

  Label

    id: triggerLabel3

    anchors.left: triggerLabel2.left

    anchors.top: triggerLabel2.bottom

    text: On Cast

    margin-top: 5

    color: #ffaa00

  Label

    id: leaderLabel2

    anchors.left: triggerLabel3.right

    anchors.top: triggerLabel3.top

    text: Leader:

    margin-left: 32

  TextEdit

    id: onCastLeader

    anchors.left: leaderLabel2.right

    anchors.top: leaderLabel2.top

    anchors.bottom: leaderLabel2.bottom

    anchors.right: onSayPhrase.right

    margin-left: 5

    width: 120

    font: cipsoftFont

  CheckBox

    id: onCastToggle

    anchors.left: onCastLeader.right

    anchors.top: onCastLeader.top

    margin-top: 1

    margin-left: 5

ComboActions &lt; Panel

  id: actions

  image-source: /images/ui/panel_flat

  image-border: 6

  padding: 3

  size: 220 100

  Label

    id: label1

    anchors.left: parent.left

    anchors.top: parent.top

    text: Follow:

    margin-top: 5

    margin-left: 3

    height: 15

    color: #ffaa00

  FollowComboBox

    id: followLeader

    anchors.left: prev.right

    anchors.top: prev.top

    margin-left: 7

    height: 15

    width: 145

    font: cipsoftFont

  CheckBox

    id: followLeaderToggle

    anchors.left: followLeader.right

    anchors.top: followLeader.top

    margin-top: 2

    margin-left: 5

  Label

    id: label2

    anchors.left: label1.left

    anchors.top: label1.bottom

    margin-top: 5

    text: Attack:

    color: #ffaa00

  AttackComboBox

    id: attackLeaderTarget

    anchors.left: prev.right

    anchors.top: prev.top

    margin-left: 5

    height: 15

    width: 145

    font: cipsoftFont

  CheckBox

    id: attackLeaderTargetToggle

    anchors.left: attackLeaderTarget.right

    anchors.top: attackLeaderTarget.top

    margin-top: 2

    margin-left: 5

  Label

    id: label3

    anchors.left: label2.left

    anchors.top: label2.bottom

    margin-top: 5

    text: Spell:

    color: #ffaa00

  TextEdit

    id: attackSpell

    anchors.left: prev.right

    anchors.top: prev.top

    anchors.right: attackLeaderTarget.right

    margin-left: 17

    height: 15

    width: 145

    font: cipsoftFont

  CheckBox

    id: attackSpellToggle

    anchors.left: attackSpell.right

    anchors.top: attackSpell.top

    margin-top: 2

    margin-left: 5

  Label

    id: label4

    anchors.left: label3.left

    anchors.top: label3.bottom

    margin-top: 15

    text: Attack Item:

    color: #ffaa00

  BotItem

    id: attackItem

    anchors.left: prev.right

    anchors.verticalCenter: prev.verticalCenter

    margin-left: 10

  CheckBox

    id: attackItemToggle

    anchors.left: prev.right

    anchors.verticalCenter: prev.verticalCenter

    margin-left: 5

  BotSwitch

    id: commandsToggle

    anchors.left: prev.right

    anchors.top: attackItem.top

    anchors.right: attackSpellToggle.right

    anchors.bottom: attackItem.bottom

    margin-left: 5

    text: Leader Commands

    text-wrap: true

    multiline: true

BotServer &lt; Panel

  id: server

  image-source: /images/ui/panel_flat

  image-border: 6

  padding: 3

  size: 220 100

  Label

    id: labelX

    anchors.left: parent.left

    anchors.top: parent.top

    text: Leader:

    height: 15

    color: #ffaa00

    margin-left: 3

    margin-top: 5

  TextEdit

    id: botServerLeader

    anchors.left: prev.right

    anchors.top: prev.top

    anchors.right: parent.right

    margin-right: 3

    margin-left: 9

    height: 15

    font: cipsoftFont

  Button

    id: partyButton

    anchors.left: labelX.left

    anchors.top: botServerLeader.bottom

    margin-top: 5

    height: 30

    text: Join Party

    text-wrap: true

    multiline: true

  BotSwitch

    id: botServerToggle

    anchors.left: prev.right

    anchors.top: botServerLeader.bottom

    anchors.right: parent.right

    height: 30

    margin-left: 3

    margin-right: 3

    margin-top: 5

    text: Server Enabled

  BotSwitch

    id: targetServerLeaderToggle

    anchors.left: partyButton.left

    anchors.top: partyButton.bottom

    anchors.right: partyButton.right

    margin-top: 3

    height: 30

    text: Leader Targets

  BotSwitch

    id: Triggers

    anchors.left: prev.right

    anchors.top: partyButton.bottom

    anchors.right: parent.right

    margin-top: 3

    height: 30

    margin-left: 3

    margin-right: 3

    text: Triggers

ComboWindow &lt; MainWindow

  !text: tr(&#39;Combo Options&#39;)

  size: 500 280

  @onEscape: self:hide()

  ComboTrigger

    id: trigger

    anchors.top: parent.top

    anchors.horizontalCenter: parent.horizontalCenter

    margin-top: 7

  Label

    id: title

    anchors.top: parent.top

    anchors.left: parent.left

    margin-left: 10

    text: Combo Trigger

    color: #ff7700

  ComboActions

    id: actions

    anchors.top: trigger.bottom

    anchors.left: trigger.left

    margin-top: 15

  Label

    id: title

    anchors.top: parent.top

    anchors.left: parent.left

    margin-left: 10

    margin-top: 85

    text: Combo Actions

    color: #ff7700

  BotServer

    id: server

    anchors.top: actions.top

    anchors.left: actions.right

    margin-left: 10

  Label

    id: title

    anchors.top: parent.top

    anchors.left: server.left

    margin-left: 3

    margin-top: 85

    text: BotServer

    color: #ff7700

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-top: 15

    margin-right: 5

  Button

    id: toolsButton

    !text: tr(&#39;Help&#39;)

    font: cipsoftFont

    anchors.right: closeButton.left

    anchors.top: closeButton.top

    margin-right: 10

    size: 45 21

    @onClick: g_platform.openUrl(&quot;http://bot.otclient.ovh/books/scripts/page/combobot&quot;)

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="configs-lua">
<h1>configs.lua<a class="headerlink" href="#configs-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cm">--[[</span>

<span class="cm">    Configs for modules</span>

<span class="cm">    Based on Kondrah storage method</span>

<span class="cm">--]]</span>

<span class="kd">local</span> <span class="n">configName</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_bot</span><span class="p">.</span><span class="n">contentsPanel</span><span class="p">.</span><span class="n">config</span><span class="p">:</span><span class="n">getCurrentOption</span><span class="p">().</span><span class="n">text</span>

<span class="c1">-- make vBot config dir</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">g_resources</span><span class="p">.</span><span class="n">directoryExists</span><span class="p">(</span><span class="s2">&quot;/bot/&quot;</span><span class="o">..</span> <span class="n">configName</span> <span class="o">..</span><span class="s2">&quot;/vBot_configs/&quot;</span><span class="p">)</span> <span class="kr">then</span>

  <span class="n">g_resources</span><span class="p">.</span><span class="n">makeDir</span><span class="p">(</span><span class="s2">&quot;/bot/&quot;</span><span class="o">..</span> <span class="n">configName</span> <span class="o">..</span><span class="s2">&quot;/vBot_configs/&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- make profile dirs</span>

<span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span> <span class="kr">do</span>

  <span class="kd">local</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/bot/&quot;</span><span class="o">..</span> <span class="n">configName</span> <span class="o">..</span><span class="s2">&quot;/vBot_configs/profile_&quot;</span><span class="o">..</span><span class="n">i</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">g_resources</span><span class="p">.</span><span class="n">directoryExists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="kr">then</span>

    <span class="n">g_resources</span><span class="p">.</span><span class="n">makeDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">g_settings</span><span class="p">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">)</span>

<span class="n">HealBotConfig</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">healBotFile</span> <span class="o">=</span> <span class="s2">&quot;/bot/&quot;</span> <span class="o">..</span> <span class="n">configName</span> <span class="o">..</span> <span class="s2">&quot;/vBot_configs/profile_&quot;</span><span class="o">..</span> <span class="n">profile</span> <span class="o">..</span> <span class="s2">&quot;/HealBot.json&quot;</span>

<span class="n">AttackBotConfig</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">attackBotFile</span> <span class="o">=</span> <span class="s2">&quot;/bot/&quot;</span> <span class="o">..</span> <span class="n">configName</span> <span class="o">..</span> <span class="s2">&quot;/vBot_configs/profile_&quot;</span><span class="o">..</span> <span class="n">profile</span> <span class="o">..</span> <span class="s2">&quot;/AttackBot.json&quot;</span>

<span class="n">SuppliesConfig</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">suppliesFile</span> <span class="o">=</span> <span class="s2">&quot;/bot/&quot;</span> <span class="o">..</span> <span class="n">configName</span> <span class="o">..</span> <span class="s2">&quot;/vBot_configs/profile_&quot;</span><span class="o">..</span> <span class="n">profile</span> <span class="o">..</span> <span class="s2">&quot;/Supplies.json&quot;</span>

<span class="c1">--healbot</span>

<span class="kr">if</span> <span class="n">g_resources</span><span class="p">.</span><span class="n">fileExists</span><span class="p">(</span><span class="n">healBotFile</span><span class="p">)</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

      <span class="kr">return</span> <span class="n">json</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">g_resources</span><span class="p">.</span><span class="n">readFileContents</span><span class="p">(</span><span class="n">healBotFile</span><span class="p">))</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">onError</span><span class="p">(</span><span class="s2">&quot;Error while reading config file (&quot;</span> <span class="o">..</span> <span class="n">healBotFile</span> <span class="o">..</span> <span class="s2">&quot;). To fix this problem you can delete HealBot.json. Details: &quot;</span> <span class="o">..</span> <span class="n">result</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">HealBotConfig</span> <span class="o">=</span> <span class="n">result</span>

<span class="kr">end</span>

<span class="c1">--attackbot</span>

<span class="kr">if</span> <span class="n">g_resources</span><span class="p">.</span><span class="n">fileExists</span><span class="p">(</span><span class="n">attackBotFile</span><span class="p">)</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

      <span class="kr">return</span> <span class="n">json</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">g_resources</span><span class="p">.</span><span class="n">readFileContents</span><span class="p">(</span><span class="n">attackBotFile</span><span class="p">))</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">onError</span><span class="p">(</span><span class="s2">&quot;Error while reading config file (&quot;</span> <span class="o">..</span> <span class="n">attackBotFile</span> <span class="o">..</span> <span class="s2">&quot;). To fix this problem you can delete HealBot.json. Details: &quot;</span> <span class="o">..</span> <span class="n">result</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">AttackBotConfig</span> <span class="o">=</span> <span class="n">result</span>

<span class="kr">end</span>

<span class="c1">--supplies</span>

<span class="kr">if</span> <span class="n">g_resources</span><span class="p">.</span><span class="n">fileExists</span><span class="p">(</span><span class="n">suppliesFile</span><span class="p">)</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

      <span class="kr">return</span> <span class="n">json</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">g_resources</span><span class="p">.</span><span class="n">readFileContents</span><span class="p">(</span><span class="n">suppliesFile</span><span class="p">))</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">onError</span><span class="p">(</span><span class="s2">&quot;Error while reading config file (&quot;</span> <span class="o">..</span> <span class="n">suppliesFile</span> <span class="o">..</span> <span class="s2">&quot;). To fix this problem you can delete HealBot.json. Details: &quot;</span> <span class="o">..</span> <span class="n">result</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">SuppliesConfig</span> <span class="o">=</span> <span class="n">result</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">vBotConfigSave</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

  <span class="c1">-- file can be either</span>

  <span class="c1">--- heal</span>

  <span class="c1">--- atk</span>

  <span class="c1">--- supply</span>

  <span class="kd">local</span> <span class="n">configFile</span>

  <span class="kd">local</span> <span class="n">configTable</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">file</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;heal&quot;</span> <span class="kr">then</span>

      <span class="n">configFile</span> <span class="o">=</span> <span class="n">healBotFile</span>

      <span class="n">configTable</span> <span class="o">=</span> <span class="n">HealBotConfig</span>

  <span class="kr">elseif</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;atk&quot;</span> <span class="kr">then</span>

      <span class="n">configFile</span> <span class="o">=</span> <span class="n">attackBotFile</span>

      <span class="n">configTable</span> <span class="o">=</span> <span class="n">AttackBotConfig</span>

  <span class="kr">elseif</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;supply&quot;</span> <span class="kr">then</span>

      <span class="n">configFile</span> <span class="o">=</span> <span class="n">suppliesFile</span>

      <span class="n">configTable</span> <span class="o">=</span> <span class="n">SuppliesConfig</span>

  <span class="kr">else</span>

    <span class="kr">return</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">json</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="n">configTable</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">onError</span><span class="p">(</span><span class="s2">&quot;Error while saving config. it won&#39;t be saved. Details: &quot;</span> <span class="o">..</span> <span class="n">result</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">result</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">onError</span><span class="p">(</span><span class="s2">&quot;config file is too big, above 100MB, it won&#39;t be saved&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">g_resources</span><span class="p">.</span><span class="n">writeFileContents</span><span class="p">(</span><span class="n">configFile</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="depositer-config-lua">
<h1>depositer_config.lua<a class="headerlink" href="#depositer-config-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Cave&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;specialDeposit&quot;</span>

<span class="kd">local</span> <span class="n">depositerPanel</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Stashing Settings&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">depositerPanel</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="n">depositerPanel</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

    <span class="n">depositerPanel</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">items</span> <span class="o">=</span> <span class="p">{},</span>

        <span class="n">height</span> <span class="o">=</span> <span class="mi">380</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="n">depositerPanel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;DepositerPanel&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

<span class="n">depositerPanel</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="c1">-- basic one</span>

<span class="n">depositerPanel</span><span class="p">.</span><span class="n">CloseButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">depositerPanel</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">depositerPanel</span><span class="p">:</span><span class="n">setHeight</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">height</span> <span class="ow">or</span> <span class="mi">380</span><span class="p">)</span>

<span class="n">depositerPanel</span><span class="p">.</span><span class="n">onGeometryChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">old</span><span class="p">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">config</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">new</span><span class="p">.</span><span class="n">height</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">arabicToRoman</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;II&quot;</span><span class="p">,</span> <span class="s2">&quot;III&quot;</span><span class="p">,</span> <span class="s2">&quot;IV&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;VI&quot;</span><span class="p">,</span> <span class="s2">&quot;VII&quot;</span><span class="p">,</span> <span class="s2">&quot;VIII&quot;</span><span class="p">,</span> <span class="s2">&quot;IX&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;XI&quot;</span><span class="p">,</span> <span class="s2">&quot;XI&quot;</span><span class="p">,</span> <span class="s2">&quot;XII&quot;</span><span class="p">,</span> <span class="s2">&quot;XIV&quot;</span><span class="p">,</span> <span class="s2">&quot;XV&quot;</span><span class="p">,</span> <span class="s2">&quot;XVI&quot;</span><span class="p">,</span> <span class="s2">&quot;XVII&quot;</span><span class="p">}</span>

    <span class="kr">return</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">refreshEntries</span><span class="p">()</span>

    <span class="n">depositerPanel</span><span class="p">.</span><span class="n">DepositerList</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;StashItem&quot;</span><span class="p">,</span> <span class="n">depositerPanel</span><span class="p">.</span><span class="n">DepositerList</span><span class="p">)</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">Item</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">id</span><span class="p">):</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span><span class="p">)</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">panel</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

          <span class="kr">if</span> <span class="n">child</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">~=</span> <span class="s2">&quot;slot&quot;</span> <span class="kr">then</span>

            <span class="n">child</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;Clear item or double click to remove entry.&quot;</span><span class="p">)</span>

            <span class="n">child</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

              <span class="nb">table.remove</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>

              <span class="n">panel</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

      <span class="kr">end</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">item</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="kr">then</span>

            <span class="nb">table.remove</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>

            <span class="n">panel</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

        <span class="kr">else</span>

            <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="kr">do</span>

                <span class="kr">if</span> <span class="n">data</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

                    <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[Depositer Panel] Item already added!&quot;</span><span class="p">)</span>

                    <span class="kr">return</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

            <span class="n">entry</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span>

            <span class="n">panel</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">setImageSource</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">panel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">Item</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">id</span><span class="p">):</span><span class="n">getMarketData</span><span class="p">().</span><span class="n">name</span><span class="p">)</span>

            <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

                <span class="kd">local</span> <span class="n">window</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">client_textedit</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="n">slot</span><span class="p">,</span> <span class="p">{</span>

                    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Set depot for &quot;</span><span class="o">..</span><span class="n">panel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span>

                    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Select depot to which item should be stashed, choose between 3 and 17&quot;</span><span class="p">,</span>

                    <span class="n">validation</span> <span class="o">=</span> <span class="s">[[^([3-9]|1[0-7])$]]</span>

<span class="p">})</span>

                <span class="n">window</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>

                <span class="n">schedule</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                  <span class="n">window</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

                  <span class="n">window</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

                <span class="kr">end</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">entry</span><span class="p">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">slot</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Stash to depot: &quot;</span><span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">slot</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;Click to set stashing destination.&quot;</span><span class="p">)</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">slot</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">window</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">client_textedit</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="p">{</span>

            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Set depot for &quot;</span><span class="o">..</span><span class="n">panel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span>

            <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Select depot to which item should be stashed, choose between 3 and 17&quot;</span><span class="p">,</span>

            <span class="n">validation</span> <span class="o">=</span> <span class="s">[[^([3-9]|1[0-7])$]]</span>

<span class="p">})</span>

        <span class="n">window</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">schedule</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

          <span class="n">window</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

          <span class="n">window</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

        <span class="kr">end</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">panel</span><span class="p">.</span><span class="n">slot</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">n</span> <span class="kr">then</span>

            <span class="n">entry</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">n</span>

            <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Stash to depot: &quot;</span><span class="o">..</span><span class="n">entry</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">refreshEntries</span><span class="p">()</span>

<span class="n">depositerPanel</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="nb">table.insert</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">,</span> <span class="p">{</span><span class="n">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">})</span>

    <span class="n">refreshEntries</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">getStashingIndex</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">v</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">v</span><span class="p">.</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Sell Exeptions&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">cavebotSell</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">cavebotSell</span> <span class="o">=</span> <span class="p">{</span><span class="mi">23544</span><span class="p">,</span> <span class="mi">3081</span><span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">sellContainer</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">Container</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">cavebotSell</span> <span class="o">=</span> <span class="n">items</span>

<span class="kr">end</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

<span class="n">sellContainer</span><span class="p">:</span><span class="n">setHeight</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>

<span class="n">sellContainer</span><span class="p">:</span><span class="n">setItems</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">cavebotSell</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="depositer-config-otui">
<h1>depositer_config.otui<a class="headerlink" href="#depositer-config-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
StashItem &lt; Panel

  height: 40

  BotItem

    id: item

    anchors.top: parent.top

    margin-top: 2

    anchors.left: parent.left

  UIWidget

    id: name

    anchors.top: prev.top

    margin-top: 1

    anchors.bottom: prev.verticalCenter

    anchors.left: prev.right

    anchors.right: parent.right

    margin-left: 5

    text-align:left

    text: item name

    font: verdana-11px-rounded

    color: #FFFFFF

  UIWidget

    id: slot

    anchors.top: prev.bottom

    margin-top: 3

    anchors.bottom: Item.bottom

    anchors.left: prev.left

    anchors.right: parent.right

    font: verdana-11px-rounded

    text-align:left

    text: Add item to select locker.

    color: #CCCCCC

DepositerPanel &lt; MainWindow

  size: 230 380

  !text: tr(&#39;Depositer Panel&#39;)

  @onEscape: self:hide()

  UIWidget

    id: title

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.right: parent.right

    text: Double click here to add item.

    text-align: left

    font: verdana-11px-rounded

    color: #aeaeae

  ScrollablePanel

    id: DepositerList

    image-source: /images/ui/panel_flat

    image-border: 1

    anchors.top: prev.bottom

    margin-top: 5

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: sep.top

    margin-bottom: 10

    padding: 2

    padding-left: 4

    vertical-scrollbar: DepositerScrollBar

    layout:

      type: verticalBox

  VerticalScrollBar

    id: DepositerScrollBar

    anchors.top: DepositerList.top

    anchors.bottom: DepositerList.bottom

    anchors.right: DepositerList.right

    step: 14

    pixels-scroll: true

  ResizeBorder

    id: bottomResizeBorder

    anchors.fill: next

    height: 3

    minimum: 180

    maximum: 800

    margin-left: 3

    margin-right: 3

    background: #ffffff88

  HorizontalSeparator

    id: sep

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: CloseButton.top

    margin-bottom: 8

  Button

    id: CloseButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-right: 5

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="depot-withdraw-lua">
<h1>depot_withdraw.lua<a class="headerlink" href="#depot-withdraw-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- config</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">defaultBp</span> <span class="o">=</span> <span class="s2">&quot;shopping bag&quot;</span>

<span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">21411</span>

<span class="c1">-- script</span>

<span class="kd">local</span> <span class="n">playerContainer</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="kd">local</span> <span class="n">depotContainer</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="kd">local</span> <span class="n">mailContainer</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="kr">function</span> <span class="nf">reopenLootContainer</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">defaultBp</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="kr">then</span>

      <span class="n">g_game</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">lootItem</span> <span class="o">=</span> <span class="n">findItem</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">lootItem</span> <span class="kr">then</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">lootItem</span><span class="p">)</span> <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;Depot Withdraw&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="c1">-- set the containers</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">potionsContainer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">runesContainer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ammoContainer</span> <span class="kr">then</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">defaultBp</span> <span class="kr">then</span>

        <span class="n">playerContainer</span> <span class="o">=</span> <span class="n">container</span>

      <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;Depot&quot;</span><span class="p">)</span> <span class="kr">then</span>

        <span class="n">depotContainer</span> <span class="o">=</span> <span class="n">container</span>

      <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;your inbox&quot;</span><span class="p">)</span> <span class="kr">then</span>

        <span class="n">mailContainer</span> <span class="o">=</span> <span class="n">container</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">playerContainer</span> <span class="ow">and</span> <span class="o">#</span><span class="n">playerContainer</span><span class="p">:</span><span class="n">getItems</span><span class="p">()</span> <span class="o">==</span> <span class="mi">20</span> <span class="kr">then</span>

    <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">playerContainer</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

        <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">playerContainer</span><span class="p">)</span>

       <span class="kr">return</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">if</span> <span class="n">playerContainer</span> <span class="ow">and</span> <span class="n">freecap</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="kr">if</span> <span class="n">depotContainer</span> <span class="kr">then</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;Depot&quot;</span><span class="p">)</span> <span class="kr">then</span>

          <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">playerContainer</span><span class="p">:</span><span class="n">getSlotPosition</span><span class="p">(</span><span class="n">playerContainer</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">()),</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

            <span class="kr">return</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">mailContainer</span> <span class="kr">then</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">(),</span> <span class="s2">&quot;your inbox&quot;</span><span class="p">)</span> <span class="kr">then</span>

          <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">playerContainer</span><span class="p">:</span><span class="n">getSlotPosition</span><span class="p">(</span><span class="n">playerContainer</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">()),</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

            <span class="kr">return</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="eat-food-lua">
<h1>eat_food.lua<a class="headerlink" href="#eat-food-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;HP&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="n">voc</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">voc</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">11</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="kr">then</span>

                <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kd">local</span> <span class="n">foodItems</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">3607</span><span class="p">,</span> <span class="mi">3585</span><span class="p">,</span> <span class="mi">3592</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">3601</span> <span class="p">}</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">foodItems</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="kr">then</span>

                <span class="nb">table.insert</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;Cast Food&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">player</span><span class="p">:</span><span class="n">getRegenerationTime</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">400</span> <span class="kr">then</span>

            <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;exevo pan&quot;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Eatable items:&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3582</span><span class="p">,</span> <span class="mi">3577</span><span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">foodContainer</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">Container</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span> <span class="o">=</span> <span class="n">items</span>

<span class="kr">end</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

<span class="n">foodContainer</span><span class="p">:</span><span class="n">setHeight</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>

<span class="n">foodContainer</span><span class="p">:</span><span class="n">setItems</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span><span class="p">)</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;Eat Food&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">player</span><span class="p">:</span><span class="n">getRegenerationTime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">400</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="c1">-- search for food in containers</span>

  <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">for</span> <span class="n">__</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">foodItem</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">foodItems</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">foodItem</span><span class="p">.</span><span class="n">id</span> <span class="kr">then</span>

          <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="equip-lua">
<h1>equip.lua<a class="headerlink" href="#equip-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- config</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;HP&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">scripts</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">-- if you want more auto equip panels you can change 2 to higher value</span>

<span class="c1">-- script by kondrah, don&#39;t edit below unless you know what you are doing</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Auto equip&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">autoEquip</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">autoEquip</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kr">end</span>

<span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">scripts</span> <span class="kr">do</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">autoEquip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">autoEquip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">on</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Auto Equip&quot;</span><span class="p">,</span> <span class="n">item1</span><span class="o">=</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">3052</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">item2</span><span class="o">=</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">3089</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">9</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">}</span>

  <span class="kr">end</span>

  <span class="n">UI</span><span class="p">.</span><span class="n">TwoItemsAndSlotPanel</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">autoEquip</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">newParams</span><span class="p">)</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">autoEquip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">newParams</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getContainers</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">autoEquip</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">autoEquip</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">autoEquip</span><span class="p">.</span><span class="n">on</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">slotItem</span> <span class="o">=</span> <span class="n">getSlot</span><span class="p">(</span><span class="n">autoEquip</span><span class="p">.</span><span class="n">slot</span><span class="p">)</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">slotItem</span> <span class="ow">or</span> <span class="p">(</span><span class="n">slotItem</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">~=</span> <span class="n">autoEquip</span><span class="p">.</span><span class="n">item1</span> <span class="ow">and</span> <span class="n">slotItem</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">~=</span> <span class="n">autoEquip</span><span class="p">.</span><span class="n">item2</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span> <span class="kr">do</span>

          <span class="kr">for</span> <span class="n">__</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">autoEquip</span><span class="p">.</span><span class="n">item1</span> <span class="ow">or</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">autoEquip</span><span class="p">.</span><span class="n">item2</span> <span class="kr">then</span>

              <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">{</span><span class="n">x</span><span class="o">=</span><span class="mi">65535</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">autoEquip</span><span class="p">.</span><span class="n">slot</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">},</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

              <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">-- don&#39;t call it too often</span>

              <span class="kr">return</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="equipper-otui">
<h1>equipper.otui<a class="headerlink" href="#equipper-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
SlotBotItem &lt; BotItem

  border-width: 0

  $on:

    image-source: /images/ui/item

  $checked:

    border-width: 1

    border-color: #FF0000

BossLabel &lt; UIWidget

  background-color: alpha

  text-offset: 3 1

  focusable: true

  height: 16

  font: verdana-11px-rounded

  text-align: left

  $focus:

    background-color: #00000055

  Button

    id: remove

    !text: tr(&#39;X&#39;)

    anchors.right: parent.right

    anchors.verticalCenter: parent.verticalCenter

    width: 14

    height: 14

    margin-right: 15

    text-align: center

    text-offset: 0 1

    tooltip: Remove profile from the list.

ConditionBoxPopupMenu &lt; ComboBoxPopupMenu

ConditionBoxPopupMenuButton &lt; ComboBoxPopupMenuButton

ConditionBox &lt; ComboBox

  @onSetup: |

    self:addOption(&quot;-&quot;)

    self:addOption(&quot;and&quot;)

    self:addOption(&quot;or&quot;)

PreButton &lt; PreviousButton

  background: #363636

  height: 15

NexButton &lt; NextButton

  background: #363636

  height: 15

CondidionLabel &lt; FlatPanel

  padding: 1

  height: 15

  Label

    id: text

    anchors.fill: parent

    text-align: center

    font: verdana-11px-rounded

    background: #363636

Rule &lt; UIWidget

  background-color: alpha

  text-offset: 18 2

  focusable: true

  height: 16

  text-align: left

  font: verdana-11px-rounded

  CheckBox

    id: enabled

    anchors.left: parent.left

    anchors.verticalCenter: parent.verticalCenter

    width: 15

    height: 15

    margin-top: 2

    margin-left: 3

    tooltip: Entry enabled/disabled

  $focus:

    background-color: #00000055

  Button

    id: remove

    text: X

    anchors.right: parent.right

    margin-right: 15

    width: 14

    height: 14

    text-align: center

    tooltip: Remove entry

    anchors.verticalCenter: parent.verticalCenter

  Button

    id: visible

    text: V

    anchors.right: prev.left

    margin-right: 3

    width: 14

    height: 14

    text-align: center

    tooltip: Items must be visible

    anchors.verticalCenter: parent.verticalCenter

ConditionPanel &lt; Panel

  height: 58

  NexButton

    id: nex

    anchors.top: parent.top

    margin-top: 5

    anchors.right: parent.right

  PreButton

    id: pre

    anchors.top: parent.top

    margin-top: 5

    anchors.left: parent.left

  CondidionLabel

    id: description

    anchors.top: parent.top

    margin-top: 5

    anchors.left: prev.right

    anchors.right: nex.left

    margin-left: 3

    margin-right: 3

  SpinBox

    id: spinbox

    anchors.top: description.bottom

    margin-top: 10

    anchors.horizontalCenter: parent.horizontalCenter

    width: 100

    text-align: center

    minimum: 0

    maximum: 100

    step: 1

    focusable: true

  BotTextEdit

    id: text

    anchors.top: description.bottom

    margin-top: 10

    anchors.horizontalCenter: parent.horizontalCenter

    width: 200

    text-align: center

ListPanel &lt; FlatPanel

  size: 270 300

  padding-left: 10

  padding-right: 10

  padding-bottom: 10

  Label

    id: title

    anchors.verticalCenter: parent.top

    anchors.left: parent.left

    text: Rules List

    font: verdana-11px-rounded

    color: #FABD02

  Label

    id: mainLabel

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: parent.top

    margin-top: 10

    margin-left: 2

    !text: tr(&#39;More important methods come first.&#39;)

    text-align: left

    font: verdana-11px-rounded

    color: #aeaeae

  TextList

    id: list

    anchors.fill: parent

    margin-top: 25

    margin-bottom: 18

    vertical-scrollbar: listScrollBar

    padding: 2

  VerticalScrollBar

    id: listScrollBar

    anchors.top: list.top

    anchors.bottom: list.bottom

    anchors.right: list.right

    step: 14

    pixels-scroll: true

  Button

    id: up

    anchors.right: parent.right

    anchors.top: list.bottom

    size: 60 17

    text: Move Up

    text-align: center

    font: cipsoftFont

    margin-top: 5

    tooltip: Increase priority of selected rule.

  Button

    id: down

    anchors.right: prev.left

    anchors.verticalCenter: prev.verticalCenter

    size: 60 17

    margin-right: 5

    text: Move Down

    text-align: center

    font: cipsoftFont

    tooltip: Decrease priority of selected rule.

InputPanel &lt; FlatPanel

  size: 270 300

  padding-left: 10

  padding-right: 10

  padding-bottom: 10

  Label

    id: title

    anchors.verticalCenter: parent.top

    anchors.left: parent.left

    text: Condition Panel

    font: verdana-11px-rounded

    color: #FF0000

  Label

    id: mainLabel

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 10

    text: Equip selected items when:

    text-align: center

    font: verdana-11px-rounded

    color: #aeaeae

  HorizontalSeparator

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 4

  ConditionPanel

    id: condition

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: mainLabel.bottom

    margin-top: 15

  HorizontalSeparator

    anchors.verticalCenter: next.verticalCenter

    anchors.left: parent.left

    anchors.right: parent.right

  ConditionBox

    id: useSecondCondition

    anchors.top: condition.bottom

    margin-top: 10

    anchors.horizontalCenter: parent.horizontalCenter

    width: 50

  ConditionPanel

    id: optionalCondition

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 10

  HorizontalSeparator

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

  BotButton

    id: add

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.bottom: parent.bottom

    margin-bottom: 10

    text: Add Rule

EQPanel &lt; FlatPanel

  size: 160 230

  padding-left: 10

  padding-right: 10

  padding-bottom: 10

  Label

    id: title

    anchors.verticalCenter: parent.top

    anchors.left: parent.left

    text: Equipment Setup

    font: verdana-11px-rounded

    color: #03C04A

  SlotBotItem

    id: head

    image-source: /images/game/slots/head

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: prev.bottom

    margin-top: 15

    $on:

      image-source: /images/ui/item

  SlotBotItem

    id: body

    image-source: /images/game/slots/body

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: prev.bottom

    margin-top: 5

    $on:

      image-source: /images/ui/item

  SlotBotItem

    id: legs

    image-source: /images/game/slots/legs

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: prev.bottom

    margin-top: 5

    $on:

      image-source: /images/ui/item

  SlotBotItem

    id: feet

    image-source: /images/game/slots/feet

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: prev.bottom

    margin-top: 5

    $on:

      image-source: /images/ui/item

  SlotBotItem

    id: neck

    image-source: /images/game/slots/neck

    anchors.top: head.top

    margin-top: 13

    anchors.right: head.left

    margin-right: 5

    $on:

      image-source: /images/ui/item

  SlotBotItem

    id: left-hand

    image-source: /images/game/slots/left-hand

    anchors.horizontalCenter: prev.horizontalCenter

    anchors.top: prev.bottom

    margin-top: 5

    $on:

      image-source: /images/ui/item

  SlotBotItem

    id: finger

    image-source: /images/game/slots/finger

    anchors.horizontalCenter: prev.horizontalCenter

    anchors.top: prev.bottom

    margin-top: 5

    $on:

      image-source: /images/ui/item

  Item

    id: back

    image-source: /images/game/slots/back-blessed

    anchors.top: head.top

    margin-top: 13

    anchors.left: head.right

    margin-left: 5

    tooltip: Main back container modifications are unavailable.

  SlotBotItem

    id: right-hand

    image-source: /images/game/slots/right-hand

    anchors.horizontalCenter: prev.horizontalCenter

    anchors.top: prev.bottom

    margin-top: 5

    $on:

      image-source: /images/ui/item

  SlotBotItem

    id: ammo

    image-source: /images/game/slots/ammo

    anchors.horizontalCenter: prev.horizontalCenter

    anchors.top: prev.bottom

    margin-top: 5

  BotButton

    id: cloneEq

    anchors.top: feet.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 15

    text: Clone Current EQ

    font: verdana-11px-rounded

    tooltip: Copy currently equipped and non-equipped items.

  BotButton

    id: default

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 3

    text: Reset fields

    font: verdana-11px-rounded

    tooltip: Reset all fields to the blank state

Profile &lt; FlatPanel

  size: 160 35

  Label

    id: title

    anchors.verticalCenter: parent.top

    anchors.left: parent.left

    margin-left: 10

    text: Profile Name

    font: verdana-11px-rounded

  BotTextEdit

    id: profileName

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    margin: 5

BossList &lt; FlatPanel

  padding-left: 10

  padding-right: 10

  padding-bottom: 10

  Label

    id: title

    anchors.verticalCenter: parent.top

    anchors.left: parent.left

    text: Boss List

    font: verdana-11px-rounded

    color: #FABD02

  TextList

    id: list

    anchors.fill: parent

    margin-top: 10

    margin-bottom: 20

    vertical-scrollbar: listScrollBar

    padding: 2

  VerticalScrollBar

    id: listScrollBar

    anchors.top: list.top

    anchors.bottom: list.bottom

    anchors.right: list.right

    step: 14

    pixels-scroll: true

  BotTextEdit

    id: name

    anchors.left: list.left

    anchors.top: list.bottom

    margin-top: 4

    anchors.right: next.left

  Button

    id: add

    anchors.right: list.right

    anchors.top: list.bottom

    margin-top: 3

    height: 21

    text: Add Boss

    text-align: center

    font: verdana-11px-rounded

    tooltip: Creature with given name will be considered as boss.

EquipWindow &lt; MainWindow

  size: 750 350

  text: Equipment Manager

  @onEscape: self:hide()

  ListPanel

    id: listPanel

    anchors.left: parent.left

    anchors.top: parent.top

    anchors.bottom: bottomSep.top

    margin-bottom: 5

    margin-left: -2

    visible: false

  BossList

    id: bossPanel

    anchors.fill: prev

    visible: true

  VerticalSeparator

    anchors.top: parent.top

    anchors.bottom: bottomSep.top

    margin-bottom: 5

    anchors.left: prev.right

    margin-left: 10

  Profile

    id: profileName

    anchors.top: parent.top

    anchors.left: prev.right

    margin-left: 10

  EQPanel

    id: setup

    anchors.left: prev.left

    anchors.top: prev.bottom

    anchors.bottom: bottomSep.top

    margin-bottom: 5

    margin-top: 10

  InputPanel

    id: inputPanel

    anchors.left: prev.right

    anchors.top: parent.top

    anchors.bottom: bottomSep.top

    margin-bottom: 5

    margin-left: 5

  HorizontalSeparator

    id: bottomSep

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

  Button

    id: bossList

    !text: tr(&#39;Boss list&#39;)

    font: cipsoftFont

    anchors.left: parent.left

    anchors.bottom: parent.bottom

    size: 65 21

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="exeta-lua">
<h1>exeta.lua<a class="headerlink" href="#exeta-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">voc</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getVocation</span><span class="p">()</span>

<span class="kr">if</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">11</span> <span class="kr">then</span>

    <span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Cave&quot;</span><span class="p">)</span>

    <span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">m</span> <span class="o">=</span> <span class="n">macro</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;Exeta when low hp&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">end</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">lastCast</span> <span class="o">=</span> <span class="n">now</span>

    <span class="n">onCreatureHealthPercentChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">creature</span><span class="p">,</span> <span class="n">healthPercent</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">m</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">healthPercent</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="ow">or</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_cooldown</span><span class="p">.</span><span class="n">isGroupCooldownIconActive</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">creature</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getDistanceBetween</span><span class="p">(</span><span class="n">pos</span><span class="p">(),</span><span class="n">creature</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">canCast</span><span class="p">(</span><span class="s2">&quot;exeta res&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">-</span> <span class="n">lastCast</span> <span class="o">&gt;</span> <span class="mi">6000</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;exeta res&quot;</span><span class="p">)</span>

            <span class="n">lastCast</span> <span class="o">=</span> <span class="n">now</span>

        <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;ExetaIfPlayer&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    	<span class="kr">if</span> <span class="n">getMonsters</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">getPlayers</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

    		<span class="n">say</span><span class="p">(</span><span class="s2">&quot;exeta res&quot;</span><span class="p">)</span>

    		<span class="n">delay</span><span class="p">(</span><span class="mi">6000</span><span class="p">)</span>

    	<span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="extras-lua">
<h1>extras.lua<a class="headerlink" href="#extras-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">)</span>

<span class="c1">-- securing storage namespace</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;extras&quot;</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="c1">-- basic elements</span>

<span class="n">extrasWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;ExtrasWindow&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

<span class="n">extrasWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">extrasWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">extrasWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">extrasWindow</span><span class="p">.</span><span class="n">onGeometryChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">old</span><span class="p">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="n">settings</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">new</span><span class="p">.</span><span class="n">height</span>

<span class="kr">end</span>

<span class="n">extrasWindow</span><span class="p">:</span><span class="n">setHeight</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">height</span> <span class="ow">or</span> <span class="mi">360</span><span class="p">)</span>

<span class="c1">-- available options for dest param</span>

<span class="kd">local</span> <span class="n">rightPanel</span> <span class="o">=</span> <span class="n">extrasWindow</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">right</span>

<span class="kd">local</span> <span class="n">leftPanel</span> <span class="o">=</span> <span class="n">extrasWindow</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">left</span>

<span class="c1">-- objects made by Kondrah - taken from creature editor, minor changes to adapt</span>

<span class="kd">local</span> <span class="n">addCheckBox</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">tooltip</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;ExtrasCheckBox&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="ow">not</span> <span class="n">widget</span><span class="p">:</span><span class="n">isOn</span><span class="p">())</span>

    <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">isOn</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">id</span> <span class="o">==</span> <span class="s2">&quot;checkPlayer&quot;</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">rootWidget</span><span class="p">.</span><span class="n">newHealer</span><span class="p">.</span><span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">title</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">widget</span><span class="p">:</span><span class="n">isOn</span><span class="p">()</span> <span class="kr">then</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;#d9321f&quot;</span><span class="p">)</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;! WARNING ! </span><span class="se">\n</span><span class="s2">Turn on check players in extras to use this feature!&quot;</span><span class="p">)</span>

      <span class="kr">else</span>

          <span class="n">label</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;#dfdfdf&quot;</span><span class="p">)</span>

          <span class="n">label</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">defaultValue</span><span class="p">)</span>

  <span class="kr">else</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">])</span>

  <span class="kr">end</span>

  <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">isOn</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">addItem</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">defaultItem</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">tooltip</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;ExtrasItem&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="ow">or</span> <span class="n">defaultItem</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">item</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="ow">or</span> <span class="n">defaultItem</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">addTextEdit</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">tooltip</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;ExtrasTextEdit&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">textEdit</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="ow">or</span> <span class="n">defaultValue</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">textEdit</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>

    <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="ow">or</span> <span class="n">defaultValue</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">addScrollBar</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">tooltip</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;ExtrasScrollBar&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">scroll</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">title</span> <span class="o">..</span> <span class="s2">&quot;: &quot;</span> <span class="o">..</span> <span class="n">value</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="kr">end</span>

    <span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

  <span class="kr">end</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">:</span><span class="n">setRange</span><span class="p">(</span><span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">max</span><span class="o">-</span><span class="n">min</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="kr">then</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">:</span><span class="n">setStep</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

  <span class="kr">elseif</span> <span class="n">max</span><span class="o">-</span><span class="n">min</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="kr">then</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">:</span><span class="n">setStep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="ow">or</span> <span class="n">defaultValue</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">.</span><span class="n">onValueChange</span><span class="p">(</span><span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">,</span> <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">:</span><span class="n">getValue</span><span class="p">())</span>

<span class="kr">end</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;vBot Settings and Scripts&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">extrasWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="n">extrasWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

  <span class="n">extrasWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

<span class="c1">---- to maintain order, add options right after another:</span>

<span class="c1">--- add object</span>

<span class="c1">--- add variables for function (optional)</span>

<span class="c1">--- add callback (optional)</span>

<span class="c1">--- optionals should be addionaly sandboxed (if true then end)</span>

<span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;rope&quot;</span><span class="p">,</span> <span class="s2">&quot;Rope Item&quot;</span><span class="p">,</span> <span class="mi">9596</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;This item will be used in various bot related scripts as default rope item.&quot;</span><span class="p">)</span>

<span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;shovel&quot;</span><span class="p">,</span> <span class="s2">&quot;Shovel Item&quot;</span><span class="p">,</span> <span class="mi">9596</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;This item will be used in various bot related scripts as default shovel item.&quot;</span><span class="p">)</span>

<span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;machete&quot;</span><span class="p">,</span> <span class="s2">&quot;Machete Item&quot;</span><span class="p">,</span> <span class="mi">9596</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;This item will be used in various bot related scripts as default machete item.&quot;</span><span class="p">)</span>

<span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;scythe&quot;</span><span class="p">,</span> <span class="s2">&quot;Scythe Item&quot;</span><span class="p">,</span> <span class="mi">9596</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;This item will be used in various bot related scripts as default scythe item.&quot;</span><span class="p">)</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;pathfinding&quot;</span><span class="p">,</span> <span class="s2">&quot;CaveBot Pathfinding&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Cavebot will automatically search for first reachable waypoint after missing 10 goto&#39;s.&quot;</span><span class="p">)</span>

<span class="n">addScrollBar</span><span class="p">(</span><span class="s2">&quot;talkDelay&quot;</span><span class="p">,</span> <span class="s2">&quot;Global NPC Talk Delay&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Breaks between each talk action in cavebot (time in miliseconds).&quot;</span><span class="p">)</span>

<span class="n">addScrollBar</span><span class="p">(</span><span class="s2">&quot;looting&quot;</span><span class="p">,</span> <span class="s2">&quot;Max Loot Distance&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Every loot corpse futher than set distance (in sqm) will be ignored and forgotten.&quot;</span><span class="p">)</span>

<span class="n">addScrollBar</span><span class="p">(</span><span class="s2">&quot;lootDelay&quot;</span><span class="p">,</span> <span class="s2">&quot;Loot Delay&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Wait time for loot container to open. Lower value means faster looting. </span><span class="se">\n</span><span class="s2"> WARNING if you are having looting issues(e.g. container is locked in closing/opnening), increase this value.&quot;</span><span class="p">)</span>

<span class="n">addScrollBar</span><span class="p">(</span><span class="s2">&quot;huntRoutes&quot;</span><span class="p">,</span> <span class="s2">&quot;Hunting Rounds Limit&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Round limit for supply check, if character already made more rounds than set, on next supply check will return to city.&quot;</span><span class="p">)</span>

<span class="n">addScrollBar</span><span class="p">(</span><span class="s2">&quot;killUnder&quot;</span><span class="p">,</span> <span class="s2">&quot;Kill monsters below&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Force TargetBot to kill added creatures when they are below set percentage of health - will ignore all other TargetBot settings.&quot;</span><span class="p">)</span>

<span class="n">addScrollBar</span><span class="p">(</span><span class="s2">&quot;gotoMaxDistance&quot;</span><span class="p">,</span> <span class="s2">&quot;Max GoTo Distance&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Maximum distance to next goto waypoint for the bot to try to reach.&quot;</span><span class="p">)</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;lootLast&quot;</span><span class="p">,</span> <span class="s2">&quot;Start loot from last corpse&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Looting sequence will be reverted and bot will start looting newest bodies.&quot;</span><span class="p">)</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;joinBot&quot;</span><span class="p">,</span> <span class="s2">&quot;Join TargetBot and CaveBot&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Cave and Target tabs will be joined into one.&quot;</span><span class="p">)</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;reachable&quot;</span><span class="p">,</span> <span class="s2">&quot;Target only pathable mobs&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Ignore monsters that can&#39;t be reached.&quot;</span><span class="p">)</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Custom Window Title&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Personalize OTCv8 window name according to character specific.&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">vocText</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

  <span class="kr">if</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">11</span> <span class="kr">then</span>

      <span class="n">vocText</span> <span class="o">=</span> <span class="s2">&quot;- EK&quot;</span>

  <span class="kr">elseif</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">12</span> <span class="kr">then</span>

      <span class="n">vocText</span> <span class="o">=</span> <span class="s2">&quot;- RP&quot;</span>

  <span class="kr">elseif</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">13</span> <span class="kr">then</span>

      <span class="n">vocText</span> <span class="o">=</span> <span class="s2">&quot;- MS&quot;</span>

  <span class="kr">elseif</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">14</span> <span class="kr">then</span>

      <span class="n">vocText</span> <span class="o">=</span> <span class="s2">&quot;- ED&quot;</span>

  <span class="kr">end</span>

  <span class="n">macro</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">settings</span><span class="p">.</span><span class="n">title</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

          <span class="n">g_window</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Tibia - &quot;</span> <span class="o">..</span> <span class="n">name</span><span class="p">()</span> <span class="o">..</span> <span class="s2">&quot; - &quot;</span> <span class="o">..</span> <span class="n">lvl</span><span class="p">()</span> <span class="o">..</span> <span class="s2">&quot;lvl &quot;</span> <span class="o">..</span> <span class="n">vocText</span><span class="p">)</span>

      <span class="kr">else</span>

          <span class="n">g_window</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Tibia - &quot;</span> <span class="o">..</span> <span class="n">name</span><span class="p">()</span> <span class="o">..</span> <span class="s2">&quot; - DEAD&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">else</span>

      <span class="n">g_window</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Tibia - &quot;</span> <span class="o">..</span> <span class="n">name</span><span class="p">())</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;separatePm&quot;</span><span class="p">,</span> <span class="s2">&quot;Open PM&#39;s in new Window&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;PM&#39;s will be automatically opened in new tab after receiving one.&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="n">onTalk</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">settings</span><span class="p">.</span><span class="n">separatePm</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">g_console</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_console</span>

        <span class="kd">local</span> <span class="n">privateTab</span> <span class="o">=</span> <span class="n">g_console</span><span class="p">.</span><span class="n">getTab</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">privateTab</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>

            <span class="n">privateTab</span> <span class="o">=</span> <span class="n">g_console</span><span class="p">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

            <span class="n">g_console</span><span class="p">.</span><span class="n">addPrivateText</span><span class="p">(</span><span class="n">g_console</span><span class="p">.</span><span class="n">applyMessagePrefixies</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">text</span><span class="p">),</span> <span class="n">g_console</span><span class="p">.</span><span class="n">SpeakTypesSettings</span><span class="p">[</span><span class="s1">&#39;private&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="kr">return</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addTextEdit</span><span class="p">(</span><span class="s2">&quot;useAll&quot;</span><span class="p">,</span> <span class="s2">&quot;Use All Hotkey&quot;</span><span class="p">,</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Set hotkey for universal actions - rope, shovel, scythe, use, open doors&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">useId</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">34847</span><span class="p">,</span> <span class="mi">1764</span><span class="p">,</span> <span class="mi">21051</span><span class="p">,</span> <span class="mi">30823</span><span class="p">,</span> <span class="mi">6264</span><span class="p">,</span> <span class="mi">5282</span><span class="p">,</span> <span class="mi">20453</span><span class="p">,</span> <span class="mi">20454</span><span class="p">,</span> <span class="mi">20474</span><span class="p">,</span> <span class="mi">11708</span><span class="p">,</span> <span class="mi">11705</span><span class="p">,</span>

                  <span class="mi">6257</span><span class="p">,</span> <span class="mi">6256</span><span class="p">,</span> <span class="mi">2772</span><span class="p">,</span> <span class="mi">27260</span><span class="p">,</span> <span class="mi">2773</span><span class="p">,</span> <span class="mi">1632</span><span class="p">,</span> <span class="mi">1633</span><span class="p">,</span> <span class="mi">1948</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">6252</span><span class="p">,</span> <span class="mi">6253</span><span class="p">,</span> <span class="mi">5007</span><span class="p">,</span> <span class="mi">4911</span><span class="p">,</span>

                  <span class="mi">1629</span><span class="p">,</span> <span class="mi">1630</span><span class="p">,</span> <span class="mi">5108</span><span class="p">,</span> <span class="mi">5107</span><span class="p">,</span> <span class="mi">5281</span><span class="p">,</span> <span class="mi">1968</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">1948</span><span class="p">,</span> <span class="mi">5542</span><span class="p">,</span> <span class="mi">31116</span><span class="p">,</span> <span class="mi">31120</span><span class="p">,</span> <span class="mi">30742</span><span class="p">,</span> <span class="mi">31115</span><span class="p">,</span>

                  <span class="mi">31118</span><span class="p">,</span> <span class="mi">20474</span><span class="p">,</span> <span class="mi">5737</span><span class="p">,</span> <span class="mi">5736</span><span class="p">,</span> <span class="mi">5734</span><span class="p">,</span> <span class="mi">5733</span><span class="p">,</span> <span class="mi">31202</span><span class="p">,</span> <span class="mi">31228</span><span class="p">,</span> <span class="mi">31199</span><span class="p">,</span> <span class="mi">31200</span><span class="p">,</span> <span class="mi">33262</span><span class="p">,</span> <span class="mi">30824</span><span class="p">,</span>

                  <span class="mi">5125</span><span class="p">,</span> <span class="mi">5126</span><span class="p">,</span> <span class="mi">5116</span><span class="p">,</span> <span class="mi">5117</span><span class="p">,</span> <span class="mi">8257</span><span class="p">,</span> <span class="mi">8258</span><span class="p">,</span> <span class="mi">8255</span><span class="p">,</span> <span class="mi">8256</span><span class="p">,</span> <span class="mi">5120</span><span class="p">,</span> <span class="mi">30777</span><span class="p">,</span> <span class="mi">30776</span><span class="p">,</span> <span class="mi">23873</span><span class="p">,</span> <span class="mi">23877</span><span class="p">,</span>

                  <span class="mi">5736</span><span class="p">,</span> <span class="mi">6264</span><span class="p">,</span> <span class="mi">31262</span><span class="p">,</span> <span class="mi">31130</span><span class="p">,</span> <span class="mi">31129</span><span class="p">,</span> <span class="mi">6250</span><span class="p">,</span> <span class="mi">6249</span><span class="p">,</span> <span class="mi">5122</span><span class="p">,</span> <span class="mi">30049</span><span class="p">,</span> <span class="mi">7131</span><span class="p">,</span> <span class="mi">7132</span><span class="p">,</span> <span class="mi">7727</span> <span class="p">}</span>

  <span class="kd">local</span> <span class="n">shovelId</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">606</span><span class="p">,</span> <span class="mi">593</span><span class="p">,</span> <span class="mi">867</span><span class="p">,</span> <span class="mi">608</span> <span class="p">}</span>

  <span class="kd">local</span> <span class="n">ropeId</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">17238</span><span class="p">,</span> <span class="mi">12202</span><span class="p">,</span> <span class="mi">12935</span><span class="p">,</span> <span class="mi">386</span><span class="p">,</span> <span class="mi">421</span><span class="p">,</span> <span class="mi">21966</span><span class="p">,</span> <span class="mi">14238</span> <span class="p">}</span>

  <span class="kd">local</span> <span class="n">macheteId</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">2130</span><span class="p">,</span> <span class="mi">3696</span> <span class="p">}</span>

  <span class="kd">local</span> <span class="n">scytheId</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">3653</span> <span class="p">}</span>

  <span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

  <span class="c1">-- script</span>

  <span class="kr">if</span> <span class="n">settings</span><span class="p">.</span><span class="n">useAll</span> <span class="ow">and</span> <span class="n">settings</span><span class="p">.</span><span class="n">useAll</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="n">hotkey</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">useAll</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_walking</span><span class="p">.</span><span class="n">wsadWalking</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="kr">then</span>

                <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                    <span class="c1">-- use</span>

                    <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">useId</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                        <span class="n">use</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                        <span class="kr">return</span>

                    <span class="kr">elseif</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">shovelId</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                        <span class="n">useWith</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">shovel</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

                        <span class="kr">return</span>

                    <span class="kr">elseif</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">ropeId</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                        <span class="n">useWith</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">rope</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

                        <span class="kr">return</span>

                    <span class="kr">elseif</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">macheteId</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                        <span class="n">useWith</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">machete</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

                        <span class="kr">return</span>

                    <span class="kr">elseif</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">scytheId</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                        <span class="n">useWith</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">scythe</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

                        <span class="kr">return</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;timers&quot;</span><span class="p">,</span> <span class="s2">&quot;MW &amp; WG Timers&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Show times for Magic Walls and Wild Growths.&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">activeTimers</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="n">onAddThing</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">timers</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">thing</span><span class="p">:</span><span class="n">isItem</span><span class="p">()</span> <span class="kr">then</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">timer</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="n">thing</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2129</span> <span class="kr">then</span> <span class="c1">-- mwall id</span>

      <span class="n">timer</span> <span class="o">=</span> <span class="mi">20000</span> <span class="c1">-- mwall time</span>

    <span class="kr">elseif</span> <span class="n">thing</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2130</span> <span class="kr">then</span> <span class="c1">-- wg id</span>

      <span class="n">timer</span> <span class="o">=</span> <span class="mi">45000</span> <span class="c1">-- wg time</span>

    <span class="kr">else</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">x</span> <span class="o">..</span> <span class="s2">&quot;,&quot;</span> <span class="o">..</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">y</span> <span class="o">..</span> <span class="s2">&quot;,&quot;</span> <span class="o">..</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">activeTimers</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">or</span> <span class="n">activeTimers</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">now</span> <span class="kr">then</span>

      <span class="n">activeTimers</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timer</span>

    <span class="kr">end</span>

    <span class="n">tile</span><span class="p">:</span><span class="n">setTimer</span><span class="p">(</span><span class="n">activeTimers</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">onRemoveThing</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">timers</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">thing</span><span class="p">:</span><span class="n">isItem</span><span class="p">()</span> <span class="kr">then</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="p">(</span><span class="n">thing</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2129</span> <span class="ow">or</span> <span class="n">thing</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2130</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tile</span><span class="p">:</span><span class="n">getGround</span><span class="p">()</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">x</span> <span class="o">..</span> <span class="s2">&quot;,&quot;</span> <span class="o">..</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">y</span> <span class="o">..</span> <span class="s2">&quot;,&quot;</span> <span class="o">..</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span>

      <span class="n">activeTimers</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

      <span class="n">tile</span><span class="p">:</span><span class="n">setTimer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;antiKick&quot;</span><span class="p">,</span> <span class="s2">&quot;Anti - Kick&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Turn every 10 minutes to prevent kick.&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="n">macro</span><span class="p">(</span><span class="mi">600</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">antiKick</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getDirection</span><span class="p">()</span>

    <span class="n">turn</span><span class="p">((</span><span class="n">dir</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">turn</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span> <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;stake&quot;</span><span class="p">,</span> <span class="s2">&quot;Skin Monsters&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Automatically skin &amp; stake corpses when cavebot is enabled&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">knifeBodies</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4286</span><span class="p">,</span> <span class="mi">4272</span><span class="p">,</span> <span class="mi">4173</span><span class="p">,</span> <span class="mi">4011</span><span class="p">,</span> <span class="mi">4025</span><span class="p">,</span> <span class="mi">4047</span><span class="p">,</span> <span class="mi">4052</span><span class="p">,</span> <span class="mi">4057</span><span class="p">,</span> <span class="mi">4062</span><span class="p">,</span> <span class="mi">4112</span><span class="p">,</span> <span class="mi">4212</span><span class="p">,</span> <span class="mi">4321</span><span class="p">,</span> <span class="mi">4324</span><span class="p">,</span> <span class="mi">4327</span><span class="p">,</span> <span class="mi">10352</span><span class="p">,</span> <span class="mi">10356</span><span class="p">,</span> <span class="mi">10360</span><span class="p">,</span> <span class="mi">10364</span><span class="p">}</span>

  <span class="kd">local</span> <span class="n">stakeBodies</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4097</span><span class="p">,</span> <span class="mi">4137</span><span class="p">,</span> <span class="mi">8738</span><span class="p">,</span> <span class="mi">18958</span><span class="p">}</span>

  <span class="kd">local</span> <span class="n">fishingBodies</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9582</span><span class="p">}</span>

  <span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">stake</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getTopThing</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">:</span><span class="n">isContainer</span><span class="p">()</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">knifeBodies</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="ow">and</span> <span class="n">findItem</span><span class="p">(</span><span class="mi">5908</span><span class="p">)</span> <span class="kr">then</span>

              <span class="n">CaveBot</span><span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">550</span><span class="p">)</span>

              <span class="n">useWith</span><span class="p">(</span><span class="mi">5908</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

              <span class="kr">return</span>

          <span class="kr">end</span>

          <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">stakeBodies</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="ow">and</span> <span class="n">findItem</span><span class="p">(</span><span class="mi">5942</span><span class="p">)</span> <span class="kr">then</span>

              <span class="n">CaveBot</span><span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">550</span><span class="p">)</span>

              <span class="n">useWith</span><span class="p">(</span><span class="mi">5942</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

              <span class="kr">return</span>

          <span class="kr">end</span>

          <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">fishingBodies</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="ow">and</span> <span class="n">findItem</span><span class="p">(</span><span class="mi">3483</span><span class="p">)</span> <span class="kr">then</span>

              <span class="n">CaveBot</span><span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">550</span><span class="p">)</span>

              <span class="n">useWith</span><span class="p">(</span><span class="mi">3483</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

              <span class="kr">return</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;oberon&quot;</span><span class="p">,</span> <span class="s2">&quot;Auto Reply Oberon&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Auto reply to Grand Master Oberon talk minigame.&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="n">onTalk</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">oberon</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">34</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;world will suffer for&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Are you ever going to fight or do you prefer talking?&quot;</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;feet when they see me&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Even before they smell your breath?&quot;</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;from this plane&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Too bad you barely exist at all!&quot;</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ESDO LO&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;SEHWO ASIMO, TOLIDO ESD&quot;</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;will soon rule this world&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Excuse me but I still do not get the message!&quot;</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;honourable and formidable&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Then why are we fighting alone right now?&quot;</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;appear like a worm&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;How appropriate, you look like something worms already got the better of!&quot;</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;will be the end of mortal&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Then let me show you the concept of mortality before it!&quot;</span><span class="p">)</span>

        <span class="kr">elseif</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;virtues of chivalry&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">say</span><span class="p">(</span><span class="s2">&quot;Dare strike up a Minnesang and you will receive your last accolade!&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;autoOpenDoors&quot;</span><span class="p">,</span> <span class="s2">&quot;Auto Open Doors&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Open doors when trying to step on them.&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">doorsIds</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">5007</span><span class="p">,</span> <span class="mi">8265</span><span class="p">,</span> <span class="mi">1629</span><span class="p">,</span> <span class="mi">1632</span><span class="p">,</span> <span class="mi">5129</span><span class="p">,</span> <span class="mi">6252</span><span class="p">,</span> <span class="mi">6249</span><span class="p">,</span> <span class="mi">7715</span><span class="p">,</span> <span class="mi">7712</span><span class="p">,</span> <span class="mi">7714</span><span class="p">,</span>

                     <span class="mi">7719</span><span class="p">,</span> <span class="mi">6256</span><span class="p">,</span> <span class="mi">1669</span><span class="p">,</span> <span class="mi">1672</span><span class="p">,</span> <span class="mi">5125</span><span class="p">,</span> <span class="mi">5115</span><span class="p">,</span> <span class="mi">5124</span><span class="p">,</span> <span class="mi">17701</span><span class="p">,</span> <span class="mi">17710</span><span class="p">,</span> <span class="mi">1642</span><span class="p">,</span>

                     <span class="mi">6260</span><span class="p">,</span> <span class="mi">5107</span><span class="p">,</span> <span class="mi">4912</span><span class="p">,</span> <span class="mi">6251</span><span class="p">,</span> <span class="mi">5291</span><span class="p">,</span> <span class="mi">1683</span><span class="p">,</span> <span class="mi">1696</span><span class="p">,</span> <span class="mi">1692</span><span class="p">,</span> <span class="mi">5006</span><span class="p">,</span> <span class="mi">2179</span><span class="p">,</span> <span class="mi">5116</span><span class="p">,</span>

                     <span class="mi">1632</span><span class="p">,</span> <span class="mi">11705</span><span class="p">,</span> <span class="mi">30772</span><span class="p">,</span> <span class="mi">30774</span><span class="p">,</span> <span class="mi">6248</span><span class="p">,</span> <span class="mi">5735</span><span class="p">,</span> <span class="mi">5732</span><span class="p">,</span> <span class="mi">5120</span><span class="p">,</span> <span class="mi">23873</span><span class="p">,</span> <span class="mi">5736</span><span class="p">,</span>

                     <span class="mi">6264</span><span class="p">,</span> <span class="mi">5122</span><span class="p">,</span> <span class="mi">30049</span><span class="p">,</span> <span class="mi">30042</span><span class="p">,</span> <span class="mi">7727</span> <span class="p">}</span>

  <span class="kr">function</span> <span class="nf">checkForDoors</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">tile</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">useThing</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">useThing</span> <span class="ow">and</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">doorsIds</span><span class="p">,</span> <span class="n">useThing</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

        <span class="n">g_game</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">useThing</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">onKeyPress</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">wsadWalking</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_walking</span><span class="p">.</span><span class="n">wsadWalking</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">autoOpenDoors</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;Up&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">wsadWalking</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;W&#39;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;Down&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">wsadWalking</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;Left&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">wsadWalking</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;Right&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">wsadWalking</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">wsadWalking</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">==</span> <span class="s2">&quot;Q&quot;</span> <span class="kr">then</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">wsadWalking</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">==</span> <span class="s2">&quot;E&quot;</span> <span class="kr">then</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">wsadWalking</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span> <span class="kr">then</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="kr">elseif</span> <span class="n">wsadWalking</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="kr">then</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="kr">end</span>

    <span class="n">checkForDoors</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;bless&quot;</span><span class="p">,</span> <span class="s2">&quot;Buy bless at login&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Say !bless at login.&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">blessed</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">bless</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;you already have all blessings.&quot;</span> <span class="kr">then</span>

      <span class="n">blessed</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">settings</span><span class="p">.</span><span class="n">bless</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">player</span><span class="p">:</span><span class="n">getBlessings</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

      <span class="n">say</span><span class="p">(</span><span class="s2">&quot;!bless&quot;</span><span class="p">)</span>

      <span class="n">schedule</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

          <span class="kr">if</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">blessed</span> <span class="ow">and</span> <span class="n">player</span><span class="p">:</span><span class="n">getBlessings</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

                <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;!! Blessings not bought !!&quot;</span><span class="p">)</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

      <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;reUse&quot;</span><span class="p">,</span> <span class="s2">&quot;Keep Crosshair&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Keep crosshair after using with item&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">excluded</span> <span class="o">=</span> <span class="p">{</span><span class="mi">268</span><span class="p">,</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">23373</span><span class="p">,</span> <span class="mi">266</span><span class="p">,</span> <span class="mi">236</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">7643</span><span class="p">,</span> <span class="mi">23375</span><span class="p">,</span> <span class="mi">7642</span><span class="p">,</span> <span class="mi">23374</span><span class="p">,</span> <span class="mi">5908</span><span class="p">,</span> <span class="mi">5942</span><span class="p">}</span>

  <span class="n">onUseWith</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">itemId</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">subType</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">settings</span><span class="p">.</span><span class="n">reUse</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">excluded</span><span class="p">,</span> <span class="n">itemId</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">schedule</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">findItem</span><span class="p">(</span><span class="n">itemId</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">item</span> <span class="kr">then</span>

          <span class="n">modules</span><span class="p">.</span><span class="n">game_interface</span><span class="p">.</span><span class="n">startUseWith</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;suppliesControl&quot;</span><span class="p">,</span> <span class="s2">&quot;TargetBot off if low supply&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Turn off TargetBot if either one of supply amount is below 50% of minimum.&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="n">macro</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">suppliesControl</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">hasSupplies</span><span class="p">())</span> <span class="o">==</span> <span class="s1">&#39;table&#39;</span> <span class="kr">then</span>

        <span class="n">TargetBot</span><span class="p">.</span><span class="n">setOff</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;holdMwall&quot;</span><span class="p">,</span> <span class="s2">&quot;Hold MW/WG&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Mark tiles with below hotkeys to automatically use Magic Wall or Wild Growth&quot;</span><span class="p">)</span>

<span class="n">addTextEdit</span><span class="p">(</span><span class="s2">&quot;holdMwHot&quot;</span><span class="p">,</span> <span class="s2">&quot;Magic Wall Hotkey: &quot;</span><span class="p">,</span> <span class="s2">&quot;F5&quot;</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">)</span>

<span class="n">addTextEdit</span><span class="p">(</span><span class="s2">&quot;holdWgHot&quot;</span><span class="p">,</span> <span class="s2">&quot;Wild Growth Hotkey: &quot;</span><span class="p">,</span> <span class="s2">&quot;F6&quot;</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">hold</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kd">local</span> <span class="n">mwHot</span>

  <span class="kd">local</span> <span class="n">wgHot</span>

  <span class="kd">local</span> <span class="n">candidates</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kd">local</span> <span class="n">m</span> <span class="o">=</span> <span class="n">macro</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">mwHot</span> <span class="o">=</span> <span class="n">settings</span><span class="p">.</span><span class="n">holdMwHot</span>

    <span class="n">wgHot</span> <span class="o">=</span> <span class="n">settings</span><span class="p">.</span><span class="n">holdWgHot</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">holdMwall</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">if</span> <span class="o">#</span><span class="n">candidates</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pos</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">tile</span> <span class="kr">then</span>

          <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

            <span class="nb">table.remove</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

          <span class="kr">end</span>

          <span class="kd">local</span> <span class="n">rune</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;HOLD MW&quot;</span> <span class="ow">and</span> <span class="mi">3180</span> <span class="ow">or</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;HOLD WG&quot;</span> <span class="ow">and</span> <span class="mi">3156</span>

          <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">canShoot</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isInPz</span><span class="p">()</span> <span class="ow">and</span> <span class="n">tile</span><span class="p">:</span><span class="n">isWalkable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">tile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">2130</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="nb">math.abs</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">x</span><span class="o">-</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="ow">and</span> <span class="nb">math.abs</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">y</span><span class="o">-</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="kr">then</span>

              <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">rune</span><span class="p">,</span> <span class="n">tile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">())</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">onRemoveThing</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">holdMwall</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">thing</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">2129</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;HOLD&quot;</span><span class="p">)</span> <span class="kr">then</span>

          <span class="nb">table.insert</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

          <span class="kd">local</span> <span class="n">rune</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;HOLD MW&quot;</span> <span class="ow">and</span> <span class="mi">3180</span> <span class="ow">or</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;HOLD WG&quot;</span> <span class="ow">and</span> <span class="mi">3156</span>

          <span class="kr">if</span> <span class="nb">math.abs</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">x</span><span class="o">-</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="ow">and</span> <span class="nb">math.abs</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">y</span><span class="o">-</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">rune</span><span class="p">,</span> <span class="n">tile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">())</span>

          <span class="kr">end</span>

      <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">onAddThing</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">holdMwall</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">m</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">thing</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">2129</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

          <span class="nb">table.remove</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span><span class="n">tile</span><span class="p">))</span>

      <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">onKeyDown</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">wsadWalking</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_walking</span><span class="p">.</span><span class="n">wsadWalking</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">wsadWalking</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">holdMwall</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">m</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">keys</span> <span class="o">~=</span> <span class="n">mwHot</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">~=</span> <span class="n">wgHot</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">hold</span> <span class="o">=</span> <span class="n">now</span>

    <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span> <span class="n">getTileUnderCursor</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">tile</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">tile</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="kr">else</span>

        <span class="kr">if</span> <span class="n">keys</span> <span class="o">==</span> <span class="n">mwHot</span> <span class="kr">then</span>

            <span class="n">tile</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;HOLD MW&quot;</span><span class="p">)</span>

        <span class="kr">else</span>

            <span class="n">tile</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;HOLD WG&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">onKeyPress</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">wsadWalking</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_walking</span><span class="p">.</span><span class="n">wsadWalking</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">wsadWalking</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">holdMwall</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">m</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">keys</span> <span class="o">~=</span> <span class="n">mwHot</span> <span class="ow">and</span> <span class="n">keys</span> <span class="o">~=</span> <span class="n">wgHot</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="p">(</span><span class="n">hold</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1000</span> <span class="kr">then</span>

      <span class="n">candidates</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">text</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;HOLD&quot;</span><span class="p">)</span> <span class="kr">then</span>

          <span class="n">tile</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;checkPlayer&quot;</span><span class="p">,</span> <span class="s2">&quot;Check Players&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Auto look on players and mark level and vocation on character model&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="n">found</span>

  <span class="kd">local</span> <span class="kr">function</span> <span class="nf">checkPlayers</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span> <span class="o">==</span> <span class="n">posz</span><span class="p">()</span> <span class="ow">and</span> <span class="n">spec</span> <span class="o">~=</span> <span class="n">player</span> <span class="kr">then</span>

          <span class="n">g_game</span><span class="p">.</span><span class="n">look</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

          <span class="n">found</span> <span class="o">=</span> <span class="n">now</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">settings</span><span class="p">.</span><span class="n">checkPlayer</span> <span class="kr">then</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">checkPlayers</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">onPlayerPositionChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">checkPlayer</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">x</span><span class="p">.</span><span class="n">z</span> <span class="o">~=</span> <span class="n">y</span><span class="p">.</span><span class="n">z</span> <span class="kr">then</span>

      <span class="n">schedule</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">checkPlayers</span><span class="p">()</span> <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">onCreatureAppear</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">creature</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">checkPlayer</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">creature</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">creature</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">creature</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span> <span class="o">==</span> <span class="n">posz</span><span class="p">()</span> <span class="ow">and</span> <span class="n">creature</span> <span class="o">~=</span> <span class="n">player</span> <span class="kr">then</span>

        <span class="n">g_game</span><span class="p">.</span><span class="n">look</span><span class="p">(</span><span class="n">creature</span><span class="p">)</span>

        <span class="n">found</span> <span class="o">=</span> <span class="n">now</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">regex</span> <span class="o">=</span> <span class="s">[[You see ([^\(]*) \(Level ([0-9]*)\)((?:.)* of the ([\w ]*),|)]]</span>

  <span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">checkPlayer</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">re</span> <span class="o">=</span> <span class="n">regexMatch</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">re</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="kd">local</span> <span class="n">level</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

        <span class="kd">local</span> <span class="n">guild</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

        <span class="kr">if</span> <span class="n">guild</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="kr">then</span>

          <span class="n">guild</span> <span class="o">=</span> <span class="n">guild</span><span class="p">:</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="c1">-- change to proper (last) values</span>

          <span class="n">guild</span> <span class="o">=</span> <span class="n">guild</span><span class="o">..</span><span class="s2">&quot;...&quot;</span>

        <span class="kr">end</span>

        <span class="kd">local</span> <span class="n">voc</span>

        <span class="kr">if</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;sorcerer&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">voc</span> <span class="o">=</span> <span class="s2">&quot;MS&quot;</span>

        <span class="kr">elseif</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;druid&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">voc</span> <span class="o">=</span> <span class="s2">&quot;ED&quot;</span>

        <span class="kr">elseif</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;knight&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">voc</span> <span class="o">=</span> <span class="s2">&quot;EK&quot;</span>

        <span class="kr">elseif</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;paladin&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">voc</span> <span class="o">=</span> <span class="s2">&quot;RP&quot;</span>

        <span class="kr">end</span>

        <span class="kd">local</span> <span class="n">creature</span> <span class="o">=</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">creature</span> <span class="kr">then</span>

            <span class="n">creature</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">..</span><span class="n">level</span><span class="o">..</span><span class="n">voc</span><span class="o">..</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">..</span><span class="n">guild</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">found</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">-</span> <span class="n">found</span> <span class="o">&lt;</span> <span class="mi">500</span> <span class="kr">then</span>

          <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">clearMessages</span><span class="p">()</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;nextBackpack&quot;</span><span class="p">,</span> <span class="s2">&quot;Open Next Loot Container&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">leftPanel</span><span class="p">,</span> <span class="s2">&quot;Auto open next loot container if full - has to have the same ID.&quot;</span><span class="p">)</span>

  <span class="kd">local</span> <span class="kr">function</span> <span class="nf">openNextLootContainer</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">nextBackpack</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">getContainers</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">lootCotaniersIds</span> <span class="o">=</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">GetLootContainers</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">cId</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">containerIsFull</span><span class="p">(</span><span class="n">container</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">lootCotaniersIds</span><span class="p">,</span> <span class="n">cId</span><span class="p">)</span> <span class="kr">then</span>

          <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">cId</span> <span class="kr">then</span>

              <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">container</span><span class="p">)</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="n">onContainerOpen</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">previousContainer</span><span class="p">)</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">openNextLootContainer</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">onAddItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">openNextLootContainer</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">addCheckBox</span><span class="p">(</span><span class="s2">&quot;highlightTarget&quot;</span><span class="p">,</span> <span class="s2">&quot;Highlight Current Target&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">rightPanel</span><span class="p">,</span> <span class="s2">&quot;Additionaly hightlight current target with red glow&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="kc">true</span> <span class="kr">then</span>

  <span class="kd">local</span> <span class="kr">function</span> <span class="nf">forceMarked</span><span class="p">(</span><span class="n">creature</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">target</span><span class="p">()</span> <span class="o">==</span> <span class="n">creature</span> <span class="kr">then</span>

        <span class="n">creature</span><span class="p">:</span><span class="n">setMarked</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

        <span class="kr">return</span> <span class="n">schedule</span><span class="p">(</span><span class="mi">333</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">forceMarked</span><span class="p">(</span><span class="n">creature</span><span class="p">)</span> <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">onAttackingCreatureChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">newCreature</span><span class="p">,</span> <span class="n">oldCreature</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">.</span><span class="n">highlightTarget</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">oldCreature</span> <span class="kr">then</span>

          <span class="n">oldCreature</span><span class="p">:</span><span class="n">setMarked</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">newCreature</span> <span class="kr">then</span>

          <span class="n">forceMarked</span><span class="p">(</span><span class="n">newCreature</span><span class="p">)</span>

      <span class="kr">end</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="extras-otui">
<h1>extras.otui<a class="headerlink" href="#extras-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
ExtrasScrollBar &lt; Panel

  height: 28

  margin-top: 3

  UIWidget

    id: text

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: parent.top

    text-align: center

  HorizontalScrollBar

    id: scroll

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 3

    minimum: 0

    maximum: 10

    step: 1

ExtrasTextEdit &lt; Panel

  height: 40

  margin-top: 7

  UIWidget

    id: text

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: parent.top

    text-align: center

  TextEdit

    id: textEdit

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 5

    minimum: 0

    maximum: 10

    step: 1

    text-align: center

ExtrasItem &lt; Panel

  height: 34

  margin-top: 7

  margin-left: 25

  margin-right: 25

  UIWidget

    id: text

    anchors.left: parent.left

    anchors.verticalCenter: next.verticalCenter

  BotItem

    id: item

    anchors.top: parent.top

    anchors.right: parent.right

ExtrasCheckBox &lt; BotSwitch

  height: 20

  margin-top: 7

ExtrasWindow &lt; MainWindow

  !text: tr(&#39;Extras&#39;)

  size: 440 360

  padding: 25

  Label

    anchors.left: parent.left

    anchors.right: parent.horizontalCenter

    anchors.top: parent.top

    text-align: center

    text: &lt; CaveBot &gt;

  Label

    anchors.left: parent.horizontalCenter

    anchors.right: parent.right

    anchors.top: parent.top

    text-align: center

    text: &lt; Miscellaneous &gt;

  VerticalScrollBar

    id: contentScroll

    anchors.top: prev.bottom

    margin-top: 3

    anchors.right: parent.right

    anchors.bottom: separator.top

    step: 28

    pixels-scroll: true

    margin-right: -10

    margin-top: 5

    margin-bottom: 5

  ScrollablePanel

    id: content

    anchors.top: prev.top

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: separator.top

    vertical-scrollbar: contentScroll

    margin-bottom: 10

    Panel

      id: left

      anchors.top: parent.top

      anchors.left: parent.left

      anchors.right: parent.horizontalCenter

      margin-top: 5

      margin-left: 10

      margin-right: 10

      layout:

        type: verticalBox

        fit-children: true

    Panel

      id: right

      anchors.top: parent.top

      anchors.left: parent.horizontalCenter

      anchors.right: parent.right

      margin-top: 5

      margin-left: 10

      margin-right: 10

      layout:

        type: verticalBox

        fit-children: true

    VerticalSeparator

      anchors.top: parent.top

      anchors.bottom: parent.bottom

      anchors.left: parent.horizontalCenter

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  ResizeBorder

    id: bottomResizeBorder

    anchors.fill: separator

    height: 3

    minimum: 260

    maximum: 600

    margin-left: 3

    margin-right: 3

    background: #ffffff88

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-right: 5

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="hold-target-lua">
<h1>hold_target.lua<a class="headerlink" href="#hold-target-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">targetID</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="c1">-- escape when attacking will reset hold target</span>

<span class="n">onKeyPress</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">keys</span> <span class="o">==</span> <span class="s2">&quot;Escape&quot;</span> <span class="ow">and</span> <span class="n">targetID</span> <span class="kr">then</span>

        <span class="n">targetID</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Hold Target&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="c1">-- if attacking then save it as target, but check pos z in case of marking by mistake on other floor</span>

    <span class="kr">if</span> <span class="n">target</span><span class="p">()</span> <span class="ow">and</span> <span class="n">target</span><span class="p">():</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span> <span class="o">==</span> <span class="n">posz</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">target</span><span class="p">():</span><span class="n">isNpc</span><span class="p">()</span> <span class="kr">then</span>

        <span class="n">targetID</span> <span class="o">=</span> <span class="n">target</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

    <span class="kr">elseif</span> <span class="ow">not</span> <span class="n">target</span><span class="p">()</span> <span class="kr">then</span>

        <span class="c1">-- there is no saved data, do nothing</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">targetID</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="c1">-- look for target</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">sameFloor</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span> <span class="o">==</span> <span class="n">posz</span><span class="p">()</span>

            <span class="kd">local</span> <span class="n">oldTarget</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">targetID</span>

            <span class="kr">if</span> <span class="n">sameFloor</span> <span class="ow">and</span> <span class="n">oldTarget</span> <span class="kr">then</span>

                <span class="n">attack</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="ingame-editor-lua">
<h1>ingame_editor.lua<a class="headerlink" href="#ingame-editor-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

<span class="c1">-- allows to test/edit bot lua scripts ingame, you can have multiple scripts like this, just change storage.ingame_lua</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Ingame script editor&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">newText</span><span class="p">)</span>

    <span class="n">UI</span><span class="p">.</span><span class="n">MultilineEditorWindow</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">ingame_hotkeys</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hotkeys editor&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;You can add your custom scrupts here&quot;</span><span class="p">},</span> <span class="kr">function</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

      <span class="n">storage</span><span class="p">.</span><span class="n">ingame_hotkeys</span> <span class="o">=</span> <span class="n">text</span>

      <span class="n">reload</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

  <span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">scripts</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">({</span><span class="n">storage</span><span class="p">.</span><span class="n">ingame_hotkeys</span><span class="p">})</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">scripts</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="ow">and</span> <span class="n">scripts</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>

        <span class="nb">assert</span><span class="p">(</span><span class="nb">load</span><span class="p">(</span><span class="n">scripts</span><span class="p">,</span> <span class="s2">&quot;ingame_editor&quot;</span><span class="p">))()</span>

      <span class="kr">end</span><span class="p">)</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>

        <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;Ingame edior error:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">..</span> <span class="n">result</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="items-lua">
<h1>items.lua<a class="headerlink" href="#items-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">LootItems</span> <span class="o">=</span> <span class="p">{</span>

    <span class="p">[</span><span class="s2">&quot;gold coin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;platinum coin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal coin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;abyss hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;acorn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;albino plate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;alloy legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;alptramun&#39;s toothbrush&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;amber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;amber staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;amber with a bug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">41000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;amber with a dragonfly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">56000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ancient amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ancient belt buckle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">260</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ancient coin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ancient liche bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">28000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ancient shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ancient stone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;angel figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">36000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;angelic axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ankh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;antlers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ape fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;apron&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;arbalest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;arcane staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;assassin dagger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;axe ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;baby seal doll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;badger boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;badger fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bamboo stick&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;banana sash&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;banana staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bandana&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bar of gold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;basalt fetish&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;basalt figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bast skirt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bat decoration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bat wing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;battle axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;battle hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;battle shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">95</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;battle stone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">290</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;batwing hat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bear paw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;beast&#39;s nightmare-cushion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">630000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;beastslayer axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bed of nails&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;beer tap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;beetle carapace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;beetle necklace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;behemoth claw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;behemoth trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bejeweled ship&#39;s telescope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;berserk potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;berserker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;black hood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">190</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;black pearl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;black shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;black wool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blacksteel sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blade of corruption&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blazing bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">610</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blessed sceptre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blood preservation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blood tincture in a vial&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bloody dwarven beard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">110</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bloody edge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bloody pincers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bloody tears&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue crystal shard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue crystal splinter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue gem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue glass plate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue goanna scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">230</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue piece of cloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blue rose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;boggy dreads&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bola&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bone club&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bone fetish&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bone shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bone shoulderplate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bone sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bone toothpick&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bonebeast trophy3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bonebreaker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bonecarving knife&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">190</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bonelord eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bonelord helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bonelord shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bones of zorvorax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bony tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;book of necromantic rituals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;book of prayers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;book page&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;boots of haste&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bowl of terror sweat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brain head&#39;s giant neuron&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brain head&#39;s left hemisphere&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brain head&#39;s right hemisphere&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brass armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brass helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brass legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">49</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brass shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bright bell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">220</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bright sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brimstone fangs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">380</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brimstone shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broadsword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken crossbow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken draken mail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">340</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken gladiator shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">190</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken halberd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken key ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken longbow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken ring of ending&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken shamanic staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken slicer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken throwing axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">230</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;broken visor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bronze amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brooch of embracement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brown crystal splinter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brown piece of cloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brutetamer&#39;s staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;buckle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bullseye potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bunch of ripe rice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">75</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bunch of troll hair&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bundle of cursed straw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;butcher&#39;s axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">18000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;calopteryx cape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;capricious heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;capricious robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;carapace shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;carlin sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">118</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;carniphila seeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;carrion worm fang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;castle shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cat&#39;s paw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cave devourer eyes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">550</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cave devourer legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cave devourer maw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cavebear skull&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">550</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;centipede leg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ceremonial ankh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chain armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chain bolter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chain helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chain legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chaos mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;charmer&#39;s tiara&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chasm spawn abdomen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chasm spawn head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">850</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chasm spawn tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cheese cutter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cheesy figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chicken feather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chitinous mouth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;claw of &#39;the noxious spawn&#39;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cliff strider claw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;closed trap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">75</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;club&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;club ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;coal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;coat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cobra crest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cobra crown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cobra tongue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;coconut shoes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;collar of blue plasma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;collar of green plasma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;collar of red plasma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;colourful feather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">110</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;colourful feathers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;colourful snail shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;compass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;composite hornbow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;compound eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;condensed energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">260</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;copper shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;coral brooch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;corrupted flag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;countess sorrow&#39;s frozen tear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cow bell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cowtana&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crab pincers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cracked alabaster vase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cranial basher&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crawler head plating&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crawler&#39;s essence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crest of the deep seas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crocodile boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crossbow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crowbar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crown armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crown helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crown legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crown shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cruelty&#39;s chest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">720000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cruelty&#39;s claw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">640000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crunor idol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crusader helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal crossbow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal necklace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal of balance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal of focus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal of power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal pedestal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystal wand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystalline armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystalline spikes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">440</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystallized anger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cultish mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cultish robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cultish symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;curious matter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">430</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cursed bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cursed shoulder spikes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cyan crystal fragment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cyclops toe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cyclops trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dagger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;damaged armor plates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;damaged worm head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;damselfly eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;damselfly wing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dandelion seeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dangerous proto matter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;daramian mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">110</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;daramian waraxe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dark armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dark bell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dark helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dark mushroom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dark rosary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dark shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dead rat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dead weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">450</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;death ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling breaktime snack&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling claw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">430</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling guard belt buckle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">230</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling ridge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling scales&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling squelcher&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepling warts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deeptags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">290</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepworm jaws&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepworm spike roots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deepworm spikes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;deer trophy3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demon dust&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demon helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demon horn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demon shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demon trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demonbone amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demonic essence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demonic finger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demonic skeletal hand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;demonrage sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">36000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;depth calcei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;depth galea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;depth lorica&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;depth ocrea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;depth scutum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">36000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;devil helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;diabolic skull&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">19000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;diamond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;diamond sceptre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;diremaw brainpan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;diremaw legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dirty turban&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;disgusting trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;distorted heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;distorted robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;divine plate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">55000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;djinn blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;doll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;double axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">260</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;doublet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;downy feather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dowser&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;drachaku&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dracola&#39;s eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dracoyle statue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon blood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon claw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon lance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon lord trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon necklace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon priest&#39;s wandtip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">175</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon scale mail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon slayer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon tongue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">550</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragonbone staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dragon&#39;s tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;draken boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;draken sulphur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">550</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;draken trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;draken wristbands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">430</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;drakinata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;draptor scales&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dreaded cleaver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dream essence egg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">205</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dung ball&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">130</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dwarven armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dwarven axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dwarven legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dwarven ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;dwarven shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earflap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth blacksteel sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth cranial basher&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth crystal mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth dragon slayer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth headchopper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth heroic axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth knight axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth mystic blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth orcish maul&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth relic sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth spike sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth war axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth war hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ectoplasmic sushi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;egg of the many&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;elder bonelord tentacle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;elite draken mail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;elven amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;elven astral observer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;elven hoof&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">115</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;elven scouting glass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;elvish bow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;elvish talisman&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;emerald bangle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;empty honey glass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;empty potion flask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;enchanted chicken wing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy ball&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy blacksteel sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy cranial basher&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy crystal mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy dragon slayer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy headchopper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy heroic axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy knight axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy mystic blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy orcish maul&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy relic sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy spike sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy vein&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy war axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy war hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ensouled essence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">820</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;epee&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;essence of a bad dream&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ethno coat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;execowtioner axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;executioner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">55000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;explorer brooch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;eye of a deepling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;eye of a weeper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;eye of corruption&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">390</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fafnar symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">950</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fairy wings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;falcon crest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;feather headdress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">850</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery blacksteel sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery cranial basher&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery crystal mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery dragon slayer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery headchopper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">375</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery heroic axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery knight axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery mystic blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery orcish maul&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery relic sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery spike sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery war axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fiery war hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fig leaf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;figurine of cruelty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3100000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;figurine of greed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2900000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;figurine of hatred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2700000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;figurine of malice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;figurine of megalomania&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;figurine of spite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fir cone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire mushroom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fish fin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fishing rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flask of embalming fluid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flask of warrior&#39;s sweat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flintstone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flower dress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flower wreath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;focus cape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fox paw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;frazzle skin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;frazzle tongue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;frost giant pelt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;frosty ear of a troll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;frosty heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;frozen lightning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;frozen starlight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fur armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fur boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fur shred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;furry club&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;garlic necklace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gauze bandage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gear crystal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gear wheel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gearwheel chain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gemmed figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;geomancer&#39;s robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;geomancer&#39;s staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ghastly dragon head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ghostly tissue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ghoul snack&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant amethyst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant crab pincer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">950</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant emerald&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">380</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant ruby&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant sapphire&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant shimmering pearl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant smithhammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant tentacle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;giant topaz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;girlish hair decoration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glacial rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glacier amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glacier kilt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glacier mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glacier robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glacier shoes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gland&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glistening bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glob of acid slime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glob of mercury&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glob of tar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gloom wolf fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glooth amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glooth axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glooth blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glooth cape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glooth club&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glooth whip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glorious axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;glowing rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;goanna claw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">260</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;goanna meat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">190</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;goat grass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;goblet of gloom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;goblin ear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gold ingot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gold nugget&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">850</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gold ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden brush&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden fafnar trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden lotus brooch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">38000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden mug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;golden sickle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;goo shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;goosebump leather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;grant of arms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">950</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;grasshopper legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;grave flower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;greed&#39;s arm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">950000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green bandage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green crystal fragment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green crystal shard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green crystal splinter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green dragon leather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green dragon scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green gem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green glass plate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green mushroom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;green piece of cloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;greenwood coat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;griffin shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;grimace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;gruesome fan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;guardian axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;guardian boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;guardian halberd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;guardian shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;guidebook&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hailstorm rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hair of a banshee&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;halberd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;half-digested piece of meat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;half-digested stones&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;half-eaten brain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">85</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ham&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hammer of wrath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1450</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hand axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hardened bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;harpoon of a giant snail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hatched rorc egg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hatchet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;haunted blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;haunted piece of wood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">115</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hazardous heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hazardous robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;headchopper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;heat core&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;heaven blossom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;heavy mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;heavy machete&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;heavy trident&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hellhound slobber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hellspawn tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">475</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;helmet of the lost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hemp rope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;heroic axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hexagonal ruby&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hibiscus dress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hideous chunk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">510</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hieroglyph banner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;high guard flag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">550</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;high guard shoulderplates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">130</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hive bow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">28000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hive scythe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hollow stampor hoof&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;holy ash&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;holy orchid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;honeycomb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;horn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;horn of kalyassa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;horoscope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;horseman helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;huge chunk of crude iron&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;huge shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;huge spiky snail shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;humongous chunk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">540</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hunter&#39;s quiver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hunting spear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hydra egg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;hydra head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ice flower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">370</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ice rapier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy blacksteel sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy cranial basher&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy crystal mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy dragon slayer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy headchopper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy heroic axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy knight axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy mystic blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy orcish maul&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy relic sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy spike sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy war axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icy war hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;incantation notes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;infernal heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;infernal robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;inkwell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;instable proto matter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;iron helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;iron ore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ivory carving&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ivory comb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;izcandar&#39;s snow globe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;izcandar&#39;s sundial&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">225000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;jacket&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;jade hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;jade hat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;jagged sickle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;jaws&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;jewelled belt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;katana&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;katex&#39; blood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;key to the drowned library&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">330</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;knight armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;knight axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;knight legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;kollos shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;kongra&#39;s shoulderpad&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;krimhorn helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lamassu hoof&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">330</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lamassu horn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lancer beetle shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lancet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lavos armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;leaf legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;leather armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;leather boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;leather harness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;leather helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;leather legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;legion helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;legionnaire flags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;leopard armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;leviathan&#39;s amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;life crystal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;life preserver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;life ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;light shovel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lightning boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lightning headband&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lightning legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lightning pendant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lightning robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lion cloak patch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">190</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lion crest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lion figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lion seal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lion trophy3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lion&#39;s mane&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;little bowl of myrrh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lizard essence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lizard heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">530</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lizard leather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lizard scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lizard trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;longing eyes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;longsword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">51</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lost basher&#39;s spike&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lost bracers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">140</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lost husher&#39;s staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lost soul&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;luminescent crystal pickaxe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;luminous orb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lump of dirt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lump of earth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">130</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lunar staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;machete&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mad froth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magic light wand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magic plate armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magic sulphur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magma amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magma boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magma clump&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">570</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magma coat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magma legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magma monocle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;malice&#39;s horn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">620000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;malice&#39;s spine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">850000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;malofur&#39;s lunchbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mammoth fur cape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mammoth fur shorts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">850</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mammoth tusk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mammoth whopper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mantassin tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;manticore ear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">310</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;manticore tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">220</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;marlin trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;marsh stalker beak&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;marsh stalker feather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mastermind potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mastermind shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;maxilla&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;maxxenius head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;meat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;meat hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;medal of valiance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">410000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;medusa shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;megalomania&#39;s essence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1900000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;megalomania&#39;s skull&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mercenary sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;metal bat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;metal spats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;metal spike&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;might ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;milk churn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mind stone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mino lance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mino shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;minotaur horn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">75</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;minotaur leather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;minotaur trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;miraculum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mirror&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;model ship&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;modified crossbow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mooh&#39;tah plate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;moohtant cudgel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;moonlight rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;moonstone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">13000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;morbid tapestry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;morgaroth&#39;s heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;morning star&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mould heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mould robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mr. punish&#39;s handcuffs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;muck rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mucus plug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mutated bat ear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mutated flesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mutated rat tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mycological bow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mysterious fetish&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mystic blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mystic turban&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;mystical hourglass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;naginata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;necklace of the deep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;necromantic robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;necrotic rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;nettle blossom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">75</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;nettle spit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;nightmare blade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;noble amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">430000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;noble armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;noble axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;noble cape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">425000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;noble turban&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">430</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;norse shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;northwind rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;nose ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;obsidian lance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;odd organ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">410</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ogre ear stud&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ogre nose ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;old parchment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;onyx chip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;onyx flail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;onyx pendant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;opal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orange mushroom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orc leather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orc tooth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orc trophy3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orcish axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orcish gear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">85</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orcish maul&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orichalcum pearl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;oriental shoes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ornamented axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ornamented shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ornate chestplate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ornate crossbow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ornate legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ornate locket&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">18000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ornate mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ornate shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;orshabaal&#39;s brain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pair of hellflayer horns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pair of iron fists&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pair of old bracers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;paladin armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pale worm&#39;s scalp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">489000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;panda teddy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;panther head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;panther paw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;patch of fine cloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;patched boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;peacock feather fan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pelvis bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;perfect behemoth fang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pet pig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;petrified scream&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;phantasmal hair&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pharaoh banner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pharaoh sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">23000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;phoenix shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pick&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of archer armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of crocodile leather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of dead brain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of draconian steel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of hell steel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of hellfire armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">550</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of massacre&#39;s shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of royal steel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of scarab shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of swampling wood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piece of warrior armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pieces of magic chalk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pig foot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pile of grave earth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pirate boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pirate hat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pirate knee breeches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pirate shirt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pirate voodoo doll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;plagueroot offshoot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;plasma pearls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;plasmatic lightning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;plate armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;plate legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">115</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;plate shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;platinum amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison dagger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison gland&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison spider shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poisonous slime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;polar bear paw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pool of chitinous glue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;porcelain mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;powder herb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;power ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;prismatic quartz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">450</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pristine worm head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;protection amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;protective charm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;pulverized ore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;purified soul&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">530</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;purple robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">110</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;purple tome&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;quara bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;quara eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;quara pincers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">410</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;quara tentacle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">140</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;queen&#39;s sceptre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;quill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rabbit&#39;s foot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ragnir helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rainbow quartz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rapier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rare earth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ratana&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ravenous circlet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">220000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red crystal fragment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red dragon leather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red dragon scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red gem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red goanna scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red hair dye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red lantern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red piece of cloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;red tome&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;relic sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rhino hide&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">175</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rhino horn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">265</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rhino horn carving&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rift bow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rift crossbow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rift lance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rift shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ring of blue plasma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ring of green plasma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ring of healing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ring of red plasma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ring of the sky&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ripper lance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;roots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rope belt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">66</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rorc egg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rorc feather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rotten heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">74000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rotten piece of cloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;royal axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;royal helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;royal tapestry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;rubber cap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ruby necklace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;runed sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ruthless axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sabre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sabretooth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sacred tree amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;safety pin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sai&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;salamander shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sample of monster blood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sandcrawler shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sapphire hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scale armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">75</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scale of corruption&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">680</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scale of gelidrazah&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scarab amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scarab pincers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scarab shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scimitar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scorpion tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scroll of heroic deeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">230</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scythe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scythe leg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">450</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sea horse figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sea serpent scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">520</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sea serpent trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;seeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sentinel shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;serpent sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shadow herb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shadow sceptre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shaggy tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shamanic hood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shamanic talisman&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shimmering beetles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shiny stone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shockwave amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;short sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shovel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sickle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sight of surrender&#39;s eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;signet ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">480000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silencer claws&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">390</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silencer resonating chamber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silken bookmark&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silkweaver bow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silky fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silver amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silver brooch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silver dagger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silver fafnar trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;silver hand mirror&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;simple dress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;single human eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skeleton decoration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skull belt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skull coin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skull fetish&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skull helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skull of ratha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skull shatterer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">170</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skull staff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skullcracker armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">18000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;skunk tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;slime mould&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">175</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;slimy leg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sling herb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small amethyst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small diamond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small emerald&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small enchanted amethyst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small enchanted emerald&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small enchanted ruby&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small enchanted sapphire&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small energy ball&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small flask of eyedrops&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">95</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small notebook&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small oil lamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small pitchfork&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small ruby&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small sapphire&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;small topaz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;snake skin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;snakebite rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sniper gloves&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;soldier helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;solid rage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">310</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;some grimeleech wings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;soul orb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;soul stone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;souleater trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spark sphere&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sparkion claw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">290</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sparkion legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">310</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sparkion stings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sparkion tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spectral gold nugget&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spectral silver nugget&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spellsinger&#39;s seal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spellweaver&#39;s robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sphinx feather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">470</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sphinx tiara&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spider fangs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spider silk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spidris mandible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">450</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spike shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spike sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spiked iron ball&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spiked squelcher&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spiky club&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spirit cloak&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spirit container&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spite&#39;s spirit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">840000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spitter nose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">340</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spooky blue eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">95</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spool of yarn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;springsprout rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;srezz&#39; eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stampor horn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stampor talons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;star amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;star herb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;statue of abyssador&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;statue of deathstrike&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;statue of devovorga&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;statue of gnomevil&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stealth ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;steel boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;steel helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">293</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;steel shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stone herb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stone nose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">590</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stone skin amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stone wing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stonerefiner&#39;s skull&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strand of medusa hair&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strange helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strange proto matter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strange symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strange talisman&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;striped fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;studded armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;studded club&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;studded helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;studded legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;studded shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stuffed dragon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sulphurous stone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;swamp grass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;swamplair armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;swampling club&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;swampling moss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;swarmer antenna&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">130</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sword ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tail of corruption&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;talon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tarantula egg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tarnished rhino figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tattered piece of robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;taurus mace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;telescope eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tempest shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;templar scytheblade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tentacle piece&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terra amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terra boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terra hood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terra legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terra mantle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terra rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terramite eggs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terramite legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terramite shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">170</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;terrorbird beak&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">95</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;thaian sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;the avenger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;the handmaiden&#39;s protector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;the imperor&#39;s trident&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;the ironworker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;the justice seeker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;the plasmother&#39;s remains&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;thick fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;thorn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;throwing knife&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tiger eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;time ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;titan axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;token of love&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">440000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tooth file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tooth of tazhadur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;torn shirt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tortoise shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tower shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;trapped bad dream monster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;trashed draken boots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tribal mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;troll green&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;trollroot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;trophy of jaul&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;trophy of obujos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;trophy of tanjis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tunnel tyrant head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tunnel tyrant shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;turtle shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tusk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tusk shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">850</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;twiceslicer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">28000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;twin hooks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;two handed sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">450</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;undead heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;underworld rod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;unholy bone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;unholy book&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;unicorn figurine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;urmahlullu&#39;s mane&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">490000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;urmahlullu&#39;s paw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">245000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;urmahlullu&#39;s tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;utua&#39;s poison&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">230</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vampire dust&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vampire shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vampire teeth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">275</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vampire&#39;s cape chain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;veal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vein of ore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">330</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;velvet tapestry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;venison&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vexclaw talon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vial&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vial of hatred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">737000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vibrant heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vibrant robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;viking helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">66</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;viking shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">85</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vile axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;violet crystal shard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;violet gem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;violet glass plate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;volatile proto matter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;voodoo doll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wailing widow&#39;s necklace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;walnut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of cosmic energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of decay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of defiance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of draconia&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of dragonbreath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of everblazing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of inferno&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of starstorm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of voodoo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wand of vortex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;war axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;war crystal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">460</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;war hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">470</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;war horn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;warmaster&#39;s wristguards&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;warrior helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;warrior&#39;s axe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;warrior&#39;s shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;warwolf fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;waspoid claw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;waspoid wing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">190</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;watch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;watermelon tourmaline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;weaver&#39;s wandtip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wedding ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werebadger claws&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werebadger skull&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">185</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werebadger trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werebear fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">185</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werebear skull&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">195</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werebear trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wereboar hooves&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">175</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wereboar loincloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wereboar trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wereboar tusks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">165</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werefox tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werefox trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werehyaena nose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">220</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werehyaena talisman&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werehyaena trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werewolf amulet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werewolf fangs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;werewolf fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">380</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;white deer antlers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;white deer skin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">245</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;white gem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;white pearl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;white piece of cloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;white silk flower&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;widow&#39;s mandibles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">110</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wild flowers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wimp tooth chain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;windborn colossus armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;winged tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;winter wolf fur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;witch broom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;witch hat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;withered pauldrons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">850</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;withered scalp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wolf paw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wolf tooth chain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wolf trophy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wood mushroom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wooden hammer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wooden shield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;writhing brain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">370000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;writhing heart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">185000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wyrm scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wyvern fang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wyvern talisman&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">265</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;yellow gem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;yellow piece of cloth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;yielocks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;yielowax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;yirkas&#39; egg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">280</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;young lich worm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaoan armor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaoan halberd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaoan helmet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaoan legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaoan robe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaoan shoes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaoan sword&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaogun flag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;zaogun shoulderplates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>

    <span class="c1">-- 12.70</span>

    <span class="p">[</span><span class="s2">&quot;carnisylvan bark&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">230</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;carnisylvan finger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;human teeth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;abomination&#39;s eye&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">650000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;abomination&#39;s tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;abomination&#39;s tongue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">950000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;afflicted strider head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;afflicted strider worms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bashmu fang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bashmu feather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bashmu tongue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blemished spawn abdomen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">550</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blemished spawn head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;blemished spawn tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brainstealer&#39;s brain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brainstealer&#39;s brainwave&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">440000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;brainstealer&#39;s tissue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cave chimera head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;cave chimera leg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;curl of hair&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">320000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;eyeless devourer legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;eyeless devourer maw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;eyeless devourer tongue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;girtablilu warrior carapace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">520</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lavafungus head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lavafungus ring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">390</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lavaworm jaws&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lavaworm spike roots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;lavaworm spikes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;old girtablilu carapace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">570</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;old royal diary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">220000</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;scorpion charm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">620</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tremendous tyrant head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">930</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tremendous tyrant shell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">740</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;varnished diremaw brainpan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;varnished diremaw legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">670</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;streaked devourer eyes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;streaked devourer legs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;streaked devourer maw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;eldritch crystal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">48000</span><span class="p">,</span>

    <span class="c1">-- supplies</span>

    <span class="p">[</span><span class="s2">&quot;mana potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">56</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strong mana potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">93</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;great mana potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">144</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ultimate mana potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">438</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strong health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">115</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;great health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">225</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ultimate health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">379</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;supreme health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">625</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;great spirit potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">228</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ultimate spirit potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">438</span><span class="p">,</span>

    <span class="c1">-- runes</span>

    <span class="p">[</span><span class="s2">&quot;cure poison rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison field rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire field rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;intense healing rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">95</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;destroy field rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy field rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">38</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stalagmite rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;heavy magic missile rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;disintegrate rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">26</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ultimate healing rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">175</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison bomb rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">85</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;animate death rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">375</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chameleon rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">210</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fireball rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;holy missile rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icicle rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stone shower rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">37</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;thunderstorm rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">47</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;avalanche rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">57</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;great fireball rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">57</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;convince creature rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire bomb rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">147</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison wall rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">52</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;explosion rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">31</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire wall rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">61</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;soulfire rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">46</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wild growth rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magic wall rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">116</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy wall rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">85</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy bomb rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">203</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sudden death rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">135</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;paralyse rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;envenomed arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flaming arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flash arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;onyx arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shiver arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;simple arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sniper arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tarsal arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;burst arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystalline arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;diamond arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;infernal bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piercing bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;power bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;prismatic bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spectral bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vortex bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;drill bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>

<span class="p">}</span>

<span class="n">WasteItems</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">-- supplies</span>

    <span class="p">[</span><span class="s2">&quot;mana potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">268</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strong mana potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">237</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;great mana potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">238</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ultimate mana potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">23373</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">266</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;strong health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">236</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;great health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">239</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ultimate health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7643</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;supreme health potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">23375</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;great spirit potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7642</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ultimate spirit potion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">23374</span><span class="p">,</span>

    <span class="c1">-- ammo</span>

    <span class="p">[</span><span class="s2">&quot;envenomed arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16143</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flaming arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">763</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;flash arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">761</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;onyx arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7365</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3448</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;shiver arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">762</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;simple arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">21470</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sniper arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7364</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;tarsal arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14251</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3447</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;burst arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3449</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;crystalline arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15793</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;diamond arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35901</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;earth arrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">774</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;infernal bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6528</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;piercing bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7363</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;power bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3450</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;prismatic bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16141</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;spectral bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35902</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;vortex bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14252</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3446</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;drill bolt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16142</span><span class="p">,</span>

    <span class="c1">-- runes</span>

    <span class="p">[</span><span class="s2">&quot;cure poison rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3153</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison field rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3172</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire field rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3188</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;intense healing rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3152</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;destroy field rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3148</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy field rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3164</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stalagmite rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3179</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;heavy magic missile rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3198</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;disintegrate rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3197</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;ultimate healing rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3160</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison bomb rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3173</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;animate death rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3203</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;chameleon rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3178</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fireball rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3189</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;holy missile rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3182</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;icicle rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3158</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;stone shower rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3175</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;thunderstorm rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3202</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;avalanche rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3161</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;great fireball rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3191</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;convince creature rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3177</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire bomb rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3192</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;poison wall rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3176</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;explosion rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3200</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;fire wall rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3190</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;soulfire rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3195</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;wild growth rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3156</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;magic wall rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3180</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy wall rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3166</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;energy bomb rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3149</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;sudden death rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3155</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;paralyse rune&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3165</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="main-lua">
<h1>main.lua<a class="headerlink" href="#main-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;4.8&quot;</span>

<span class="kd">local</span> <span class="n">currentVersion</span>

<span class="kd">local</span> <span class="n">available</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">storage</span><span class="p">.</span><span class="n">checkVersion</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">checkVersion</span> <span class="ow">or</span> <span class="mi">0</span>

<span class="c1">-- check max once per 12hours</span>

<span class="kr">if</span> <span class="nb">os.time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">storage</span><span class="p">.</span><span class="n">checkVersion</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">.</span><span class="n">checkVersion</span> <span class="o">=</span> <span class="nb">os.time</span><span class="p">()</span>

    <span class="n">HTTP</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/Vithrax/vBot/main/vBot/version.txt&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>

          <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[vBot updater]: Unable to check version:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>

          <span class="kr">return</span>

        <span class="kr">end</span>

        <span class="n">currentVersion</span> <span class="o">=</span> <span class="n">data</span>

        <span class="n">available</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;vBot v&quot;</span><span class="o">..</span> <span class="n">version</span> <span class="o">..</span><span class="s2">&quot; </span><span class="se">\n</span><span class="s2"> Vithrax#5814&quot;</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Official OTCv8 Discord!&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">g_platform</span><span class="p">.</span><span class="n">openUrl</span><span class="p">(</span><span class="s2">&quot;https://discord.gg/yhqBE4A&quot;</span><span class="p">)</span> <span class="kr">end</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

<span class="n">schedule</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">available</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">currentVersion</span> <span class="o">~=</span> <span class="n">version</span> <span class="kr">then</span>

        <span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

        <span class="n">UI</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;New vBot is available for download! v&quot;</span><span class="o">..</span><span class="n">currentVersion</span><span class="p">)</span>

        <span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Go to vBot GitHub Page&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">g_platform</span><span class="p">.</span><span class="n">openUrl</span><span class="p">(</span><span class="s2">&quot;https://github.com/Vithrax/vBot&quot;</span><span class="p">)</span> <span class="kr">end</span><span class="p">)</span>

        <span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="new-cavebot-lib-lua">
<h1>new_cavebot_lib.lua<a class="headerlink" href="#new-cavebot-lib-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">CaveBot</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- global namespace</span>

<span class="c1">-------------------------------------------------------------------</span>

<span class="c1">-- CaveBot lib 1.0</span>

<span class="c1">-- Contains a universal set of functions to be used in CaveBot</span>

<span class="c1">----------------------[[ basic assumption ]]-----------------------</span>

<span class="c1">-- in general, functions cannot be slowed from within, only externally, by event calls, delays etc.</span>

<span class="c1">-- considering that and the fact that there is no while loop, every function return action</span>

<span class="c1">-- thus, functions will need to be verified outside themselfs or by another function</span>

<span class="c1">-- overall tips to creating extension:</span>

<span class="c1">--   - functions return action(nil) or true(done)</span>

<span class="c1">--   - extensions are controlled by retries var</span>

<span class="c1">-------------------------------------------------------------------</span>

<span class="c1">-- local variables, constants and functions, used by global functions</span>

<span class="kd">local</span> <span class="n">LOCKERS_LIST</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3497</span><span class="p">,</span> <span class="mi">3498</span><span class="p">,</span> <span class="mi">3499</span><span class="p">,</span> <span class="mi">3500</span><span class="p">}</span>

<span class="kd">local</span> <span class="n">LOCKER_ACCESSTILE_MODIFIERS</span> <span class="o">=</span> <span class="p">{</span>

    <span class="p">[</span><span class="mi">3497</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span>

    <span class="p">[</span><span class="mi">3498</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span>

    <span class="p">[</span><span class="mi">3499</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span>

    <span class="p">[</span><span class="mi">3500</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">}</span>

<span class="p">}</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">CaveBotConfigParse</span><span class="p">()</span>

	<span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="s2">&quot;_configs&quot;</span><span class="p">][</span><span class="s2">&quot;targetbot_configs&quot;</span><span class="p">][</span><span class="s2">&quot;selected&quot;</span><span class="p">]</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[vBot] Please create a new TargetBot config and reset bot&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

	<span class="kd">local</span> <span class="n">file</span> <span class="o">=</span> <span class="n">configDir</span> <span class="o">..</span> <span class="s2">&quot;/targetbot_configs/&quot;</span> <span class="o">..</span> <span class="n">name</span> <span class="o">..</span> <span class="s2">&quot;.json&quot;</span>

	<span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">g_resources</span><span class="p">.</span><span class="n">readFileContents</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

	<span class="kr">return</span> <span class="n">Config</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="s1">&#39;looting&#39;</span><span class="p">]</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">getNearTiles</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">tiles</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kd">local</span> <span class="n">dirs</span> <span class="o">=</span> <span class="p">{</span>

        <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>

        <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>

        <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>

        <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

        <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

        <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>

        <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>

        <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>

<span class="p">}</span>

    <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">dirs</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span>

            <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span>

<span class="p">{</span>

                <span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">dirs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>

                <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">dirs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>

                <span class="n">z</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">z</span>

<span class="p">}</span>

<span class="p">)</span>

        <span class="kr">if</span> <span class="n">tile</span> <span class="kr">then</span>

            <span class="nb">table.insert</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">tile</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">tiles</span>

<span class="kr">end</span>

<span class="c1">-- ##################### --</span>

<span class="c1">-- [[ Information class ]] --</span>

<span class="c1">-- ##################### --</span>

<span class="c1">--- global variable to reflect current CaveBot status</span>

<span class="n">CaveBot</span><span class="p">.</span><span class="n">Status</span> <span class="o">=</span> <span class="s2">&quot;waiting&quot;</span>

<span class="c1">--- Parses config and extracts loot list.</span>

<span class="c1">-- @return table</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">GetLootItems</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">CaveBotConfigParse</span><span class="p">()</span> <span class="ow">and</span> <span class="n">CaveBotConfigParse</span><span class="p">()[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="kc">nil</span>

    <span class="kd">local</span> <span class="n">returnTable</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

            <span class="nb">table.insert</span><span class="p">(</span><span class="n">returnTable</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">returnTable</span>

<span class="kr">end</span>

<span class="c1">--- Checks whether player has any visible items to be stashed</span>

<span class="c1">-- @return boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">HasLootItems</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;depot&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;your inbox&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

                <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">CaveBot</span><span class="p">.</span><span class="n">GetLootItems</span><span class="p">(),</span> <span class="n">id</span><span class="p">)</span> <span class="kr">then</span>

                    <span class="kr">return</span> <span class="kc">true</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--- Parses config and extracts loot containers.</span>

<span class="c1">-- @return table</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">GetLootContainers</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="n">CaveBotConfigParse</span><span class="p">()</span> <span class="ow">and</span> <span class="n">CaveBotConfigParse</span><span class="p">()[</span><span class="s2">&quot;containers&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="kc">nil</span>

    <span class="kd">local</span> <span class="n">returnTable</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

            <span class="nb">table.insert</span><span class="p">(</span><span class="n">returnTable</span><span class="p">,</span> <span class="n">container</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">returnTable</span>

<span class="kr">end</span>

<span class="c1">--- Information about open containers.</span>

<span class="c1">-- @param amount is boolean</span>

<span class="c1">-- @return table or integer</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">GetOpenedLootContainers</span><span class="p">(</span><span class="n">containerTable</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">GetLootContainers</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">containerId</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">containers</span><span class="p">,</span> <span class="n">containerId</span><span class="p">)</span> <span class="kr">then</span>

            <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">container</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">containerTable</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">or</span> <span class="o">#</span><span class="n">t</span>

<span class="kr">end</span>

<span class="c1">--- Some actions needs to be additionally slowed down in case of high ping.</span>

<span class="c1">-- Maximum at 2000ms in case of lag spike.</span>

<span class="c1">-- @param multiplayer is integer</span>

<span class="c1">-- @return void</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">PingDelay</span><span class="p">(</span><span class="n">multiplayer</span><span class="p">)</span>

    <span class="n">multiplayer</span> <span class="o">=</span> <span class="n">multiplayer</span> <span class="ow">or</span> <span class="mi">1</span>

    <span class="kr">if</span> <span class="n">ping</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ping</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="kr">then</span> <span class="c1">-- in most cases ping above 150 affects CaveBot</span>

        <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">math.min</span><span class="p">(</span><span class="n">ping</span><span class="p">()</span> <span class="o">*</span> <span class="n">multiplayer</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>

        <span class="kr">return</span> <span class="n">delay</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- ##################### --</span>

<span class="c1">-- [[ Container class ]] --</span>

<span class="c1">-- ##################### --</span>

<span class="c1">--- Closes any loot container that is open.</span>

<span class="c1">-- @return void or boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">CloseLootContainer</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">GetLootContainers</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">containerId</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">containers</span><span class="p">,</span> <span class="n">containerId</span><span class="p">)</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="kc">true</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">CloseAllLootContainers</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">GetLootContainers</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">containerId</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">containers</span><span class="p">,</span> <span class="n">containerId</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">g_game</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="kc">true</span>

<span class="kr">end</span>

<span class="c1">--- Opens any loot container that isn&#39;t already opened.</span>

<span class="c1">-- @return void or boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">OpenLootContainer</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">GetLootContainers</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">containerId</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">containerId</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

            <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">containers</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="kc">true</span>

<span class="kr">end</span>

<span class="c1">-- ##################### --</span>

<span class="c1">-- [[[ Position class ]] --</span>

<span class="c1">-- ##################### --</span>

<span class="c1">--- Compares distance between player position and given pos.</span>

<span class="c1">-- @param position is table</span>

<span class="c1">-- @param distance is integer</span>

<span class="c1">-- @return boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">MatchPosition</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">pPos</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span> <span class="ow">or</span> <span class="mi">1</span>

    <span class="kr">return</span> <span class="n">getDistanceBetween</span><span class="p">(</span><span class="n">pPos</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">distance</span>

<span class="kr">end</span>

<span class="c1">--- Stripped down to take less space.</span>

<span class="c1">-- Use only to safe position, like pz movement or reaching npc.</span>

<span class="c1">-- Needs to be called between 200-500ms to achieve fluid movement.</span>

<span class="c1">-- @param position is table</span>

<span class="c1">-- @param distance is integer</span>

<span class="c1">-- @return void</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">GoTo</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">precision</span> <span class="kr">then</span>

        <span class="n">precision</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">walkTo</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">{</span><span class="n">ignoreCreatures</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span><span class="p">})</span>

<span class="kr">end</span>

<span class="c1">--- Finds position of npc by name and reaches its position.</span>

<span class="c1">-- @return void(acion) or boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">ReachNPC</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">npc</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isNpc</span><span class="p">()</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span> <span class="kr">then</span>

            <span class="n">npc</span> <span class="o">=</span> <span class="n">spec</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">MatchPosition</span><span class="p">(</span><span class="n">npc</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span> <span class="kr">then</span>

        <span class="n">CaveBot</span><span class="p">.</span><span class="n">GoTo</span><span class="p">(</span><span class="n">npc</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- ##################### --</span>

<span class="c1">-- [[[[ Depot class ]]]] --</span>

<span class="c1">-- ##################### --</span>

<span class="c1">--- Reaches closest locker.</span>

<span class="c1">-- @return void(acion) or boolean</span>

<span class="kd">local</span> <span class="n">depositerLockerTarget</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="kd">local</span> <span class="n">depositerLockerReachRetries</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">ReachDepot</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">pPos</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">tiles</span> <span class="o">=</span> <span class="n">getNearTiles</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tiles</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">LOCKERS_LIST</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                <span class="n">depositerLockerTarget</span> <span class="o">=</span> <span class="kc">nil</span>

                <span class="n">depositerLockerReachRetries</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="kr">return</span> <span class="kc">true</span> <span class="c1">-- if near locker already then return function</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">depositerLockerReachRetries</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="kr">then</span>

        <span class="n">depositerLockerTarget</span> <span class="o">=</span> <span class="kc">nil</span>

        <span class="n">depositerLockerReachRetries</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">candidates</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">depositerLockerTarget</span> <span class="ow">or</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">depositerLockerTarget</span><span class="p">,</span> <span class="n">pPos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">tPos</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

            <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">LOCKERS_LIST</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                    <span class="kd">local</span> <span class="n">lockerTilePos</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

                          <span class="n">lockerTilePos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">lockerTilePos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">LOCKER_ACCESSTILE_MODIFIERS</span><span class="p">[</span><span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()][</span><span class="mi">1</span><span class="p">]</span>

                          <span class="n">lockerTilePos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">lockerTilePos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">LOCKER_ACCESSTILE_MODIFIERS</span><span class="p">[</span><span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()][</span><span class="mi">2</span><span class="p">]</span>

                    <span class="kd">local</span> <span class="n">lockerTile</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">lockerTilePos</span><span class="p">)</span>

                    <span class="kr">if</span> <span class="ow">not</span> <span class="n">lockerTile</span><span class="p">:</span><span class="n">hasCreature</span><span class="p">()</span> <span class="kr">then</span>

                        <span class="kr">if</span> <span class="n">findPath</span><span class="p">(</span><span class="n">pos</span><span class="p">(),</span> <span class="n">tPos</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">{</span><span class="n">ignoreNonPathable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ignoreCreatures</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span> <span class="kr">then</span>

                            <span class="kd">local</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">getDistanceBetween</span><span class="p">(</span><span class="n">tPos</span><span class="p">,</span> <span class="n">pPos</span><span class="p">)</span>

                            <span class="nb">table.insert</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="p">{</span><span class="n">pos</span><span class="o">=</span><span class="n">tPos</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">distance</span><span class="p">})</span>

                        <span class="kr">end</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kr">if</span> <span class="o">#</span><span class="n">candidates</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

            <span class="nb">table.sort</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="kr">return</span> <span class="n">a</span><span class="p">.</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">dist</span> <span class="kr">end</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">depositerLockerTarget</span> <span class="o">=</span> <span class="n">depositerLockerTarget</span> <span class="ow">or</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">pos</span>

    <span class="kr">if</span> <span class="n">depositerLockerTarget</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">MatchPosition</span><span class="p">(</span><span class="n">depositerLockerTarget</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">depositerLockerReachRetries</span> <span class="o">=</span> <span class="n">depositerLockerReachRetries</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">GoTo</span><span class="p">(</span><span class="n">depositerLockerTarget</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="kr">else</span>

            <span class="n">depositerLockerReachRetries</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">depositerLockerTarget</span> <span class="o">=</span> <span class="kc">nil</span>

            <span class="kr">return</span> <span class="kc">true</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--- Opens locker item.</span>

<span class="c1">-- @return void(acion) or boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">OpenLocker</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">pPos</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">tiles</span> <span class="o">=</span> <span class="n">getNearTiles</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

    <span class="kd">local</span> <span class="n">locker</span> <span class="o">=</span> <span class="n">getContainerByName</span><span class="p">(</span><span class="s2">&quot;Locker&quot;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">locker</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tiles</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">LOCKERS_LIST</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                    <span class="kd">local</span> <span class="n">topThing</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">()</span>

                    <span class="kr">if</span> <span class="ow">not</span> <span class="n">topThing</span><span class="p">:</span><span class="n">isNotMoveable</span><span class="p">()</span> <span class="kr">then</span>

                        <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">topThing</span><span class="p">,</span> <span class="n">pPos</span><span class="p">,</span> <span class="n">topThing</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

                    <span class="kr">else</span>

                        <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--- Opens depot chest.</span>

<span class="c1">-- @return void(acion) or boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">OpenDepotChest</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">depot</span> <span class="o">=</span> <span class="n">getContainerByName</span><span class="p">(</span><span class="s2">&quot;Depot chest&quot;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">depot</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">locker</span> <span class="o">=</span> <span class="n">getContainerByName</span><span class="p">(</span><span class="s2">&quot;Locker&quot;</span><span class="p">)</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">locker</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">OpenLocker</span><span class="p">()</span>

        <span class="kr">end</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">locker</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3502</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">locker</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--- Opens inbox inside locker.</span>

<span class="c1">-- @return void(acion) or boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">OpenInbox</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">inbox</span> <span class="o">=</span> <span class="n">getContainerByName</span><span class="p">(</span><span class="s2">&quot;Your inbox&quot;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">inbox</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">locker</span> <span class="o">=</span> <span class="n">getContainerByName</span><span class="p">(</span><span class="s2">&quot;Locker&quot;</span><span class="p">)</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">locker</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">OpenLocker</span><span class="p">()</span>

        <span class="kr">end</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">locker</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">12902</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--- Opens depot box of given number.</span>

<span class="c1">-- @param index is integer</span>

<span class="c1">-- @return void or boolean</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">OpenDepotBox</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">depot</span> <span class="o">=</span> <span class="n">getContainerByName</span><span class="p">(</span><span class="s2">&quot;Depot chest&quot;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">depot</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">ReachAndOpenDepot</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">foundParent</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;depot box&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">foundParent</span> <span class="o">=</span> <span class="n">container</span>

            <span class="kr">break</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">foundParent</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">true</span> <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">depot</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">index</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--- Reaches and opens depot.</span>

<span class="c1">-- Combined for shorthand usage.</span>

<span class="c1">-- @return boolean whether succeed to reach and open depot</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">ReachAndOpenDepot</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">ReachDepot</span><span class="p">()</span> <span class="ow">and</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">OpenDepotChest</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="kc">false</span>

<span class="kr">end</span>

<span class="c1">--- Reaches and opens imbox.</span>

<span class="c1">-- Combined for shorthand usage.</span>

<span class="c1">-- @return boolean whether succeed to reach and open depot</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">ReachAndOpenInbox</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">ReachDepot</span><span class="p">()</span> <span class="ow">and</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">OpenInbox</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="kc">false</span>

<span class="kr">end</span>

<span class="c1">--- Stripped down function to stash item.</span>

<span class="c1">-- @param item is object</span>

<span class="c1">-- @param index is integer</span>

<span class="c1">-- @param destination is object</span>

<span class="c1">-- @return void</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">StashItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

    <span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span> <span class="ow">or</span> <span class="n">getContainerByName</span><span class="p">(</span><span class="s2">&quot;Depot chest&quot;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">destination</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span><span class="n">getSlotPosition</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

<span class="kr">end</span>

<span class="c1">--- Withdraws item from depot chest or mail inbox.</span>

<span class="c1">-- main function for depositer/withdrawer</span>

<span class="c1">-- @param id is integer</span>

<span class="c1">-- @param amount is integer</span>

<span class="c1">-- @param fromDepot is boolean or integer</span>

<span class="c1">-- @param destination is object</span>

<span class="c1">-- @return void</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">WithdrawItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">fromDepot</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">destination</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span>

        <span class="n">destination</span> <span class="o">=</span> <span class="n">getContainerByName</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="n">itemAmount</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">depot</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;depot box&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;your inbox&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">depot</span> <span class="o">=</span> <span class="n">container</span>

            <span class="kr">break</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">depot</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">fromDepot</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">OpenDepotBox</span><span class="p">(</span><span class="n">fromDepot</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kr">else</span>

            <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">ReachAndOpenInbox</span><span class="p">()</span>

        <span class="kr">end</span>

        <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">destination</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">container</span><span class="p">:</span><span class="n">getCapacity</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">#</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;quiver&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;depot&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;loot&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;inbox&quot;</span><span class="p">)</span> <span class="kr">then</span>

                <span class="n">destination</span> <span class="o">=</span> <span class="n">container</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">itemCount</span> <span class="o">&gt;=</span> <span class="n">amount</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">toMove</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">itemCount</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">depot</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span><span class="n">getSlotPosition</span><span class="p">(</span><span class="n">destination</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">()),</span> <span class="nb">math.min</span><span class="p">(</span><span class="n">toMove</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">()))</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- ##################### --</span>

<span class="c1">-- [[[[[ Talk class ]]]] --</span>

<span class="c1">-- ##################### --</span>

<span class="c1">--- Controlled by event caller.</span>

<span class="c1">-- Simple way to build npc conversations instead of multiline overcopied code.</span>

<span class="c1">-- @return void</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">Conversation</span><span class="p">(...)</span>

    <span class="kd">local</span> <span class="n">expressions</span> <span class="o">=</span> <span class="p">{...}</span>

    <span class="kd">local</span> <span class="n">delay</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="n">extras</span><span class="p">.</span><span class="n">talkDelay</span> <span class="ow">or</span> <span class="mi">1000</span>

    <span class="kd">local</span> <span class="n">talkDelay</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">expr</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">expressions</span><span class="p">)</span> <span class="kr">do</span>

        <span class="n">schedule</span><span class="p">(</span><span class="n">talkDelay</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">NPC</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="kr">end</span><span class="p">)</span>

        <span class="n">talkDelay</span> <span class="o">=</span> <span class="n">talkDelay</span> <span class="o">+</span> <span class="n">delay</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">--- Says hi trade to NPC.</span>

<span class="c1">-- Used as shorthand to open NPC trade window.</span>

<span class="c1">-- @return void</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">OpenNpcTrade</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">Conversation</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="s2">&quot;trade&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">--- Says hi destination yes to NPC.</span>

<span class="c1">-- Used as shorthand to travel.</span>

<span class="c1">-- @param destination is string</span>

<span class="c1">-- @return void</span>

<span class="kr">function</span> <span class="nc">CaveBot</span><span class="p">.</span><span class="nf">Travel</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

    <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">Conversation</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="new-healer-lua">
<h1>new_healer.lua<a class="headerlink" href="#new-healer-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;newHealer&quot;</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 19</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;Friend Healer&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: edit</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Setup</span>

<span class="s">]]</span><span class="p">)</span>

<span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

<span class="c1">-- validate current settings</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">priorities</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="kr">end</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

        <span class="n">customPlayers</span> <span class="o">=</span> <span class="p">{},</span>

        <span class="n">vocations</span> <span class="o">=</span> <span class="p">{},</span>

        <span class="n">groups</span> <span class="o">=</span> <span class="p">{},</span>

        <span class="n">priorities</span> <span class="o">=</span> <span class="p">{</span>

            <span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Custom Spell&quot;</span><span class="p">,</span>           <span class="n">enabled</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="n">custom</span><span class="o">=</span><span class="kc">true</span><span class="p">},</span>

            <span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Exura Gran Sio&quot;</span><span class="p">,</span>         <span class="n">enabled</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span>              <span class="n">strong</span> <span class="o">=</span> <span class="kc">true</span><span class="p">},</span>

            <span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Exura Sio&quot;</span><span class="p">,</span>              <span class="n">enabled</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span>                            <span class="n">normal</span> <span class="o">=</span> <span class="kc">true</span><span class="p">},</span>

            <span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Exura Gran Mas Res&quot;</span><span class="p">,</span>     <span class="n">enabled</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span>                                          <span class="n">area</span> <span class="o">=</span> <span class="kc">true</span><span class="p">},</span>

            <span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Health Item&quot;</span><span class="p">,</span>            <span class="n">enabled</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span>                                                      <span class="n">health</span><span class="o">=</span><span class="kc">true</span><span class="p">},</span>

            <span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mana Item&quot;</span><span class="p">,</span>              <span class="n">enabled</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span>                                                                  <span class="n">mana</span><span class="o">=</span><span class="kc">true</span><span class="p">}</span>

<span class="p">},</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>

            <span class="p">{</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HealItem&quot;</span><span class="p">,</span>       <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Mana Item &quot;</span><span class="p">,</span>                   <span class="n">value</span><span class="o">=</span><span class="mi">268</span><span class="p">},</span>

            <span class="p">{</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HealScroll&quot;</span><span class="p">,</span>     <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Item Range: &quot;</span><span class="p">,</span>                 <span class="n">value</span><span class="o">=</span><span class="mi">6</span><span class="p">},</span>

            <span class="p">{</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HealItem&quot;</span><span class="p">,</span>       <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Health Item &quot;</span><span class="p">,</span>                 <span class="n">value</span><span class="o">=</span><span class="mi">3160</span><span class="p">},</span>

            <span class="p">{</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HealScroll&quot;</span><span class="p">,</span>     <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Mas Res Players: &quot;</span><span class="p">,</span>            <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">},</span>

            <span class="p">{</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HealScroll&quot;</span><span class="p">,</span>     <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Heal Friend at: &quot;</span><span class="p">,</span>             <span class="n">value</span><span class="o">=</span><span class="mi">80</span><span class="p">},</span>

            <span class="p">{</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HealScroll&quot;</span><span class="p">,</span>     <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Use Gran Sio at: &quot;</span><span class="p">,</span>            <span class="n">value</span><span class="o">=</span><span class="mi">80</span><span class="p">},</span>

            <span class="p">{</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HealScroll&quot;</span><span class="p">,</span>     <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Min Player HP%: &quot;</span><span class="p">,</span>             <span class="n">value</span><span class="o">=</span><span class="mi">80</span><span class="p">},</span>

            <span class="p">{</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HealScroll&quot;</span><span class="p">,</span>     <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Min Player MP%: &quot;</span><span class="p">,</span>             <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">},</span>

<span class="p">},</span>

        <span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span>

            <span class="n">knights</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

            <span class="n">paladins</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

            <span class="n">druids</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

            <span class="n">sorcerers</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

            <span class="n">party</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

            <span class="n">guild</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

            <span class="n">botserver</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

            <span class="n">friends</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">}</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="kd">local</span> <span class="n">healerWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;FriendHealer&#39;</span><span class="p">)</span>

<span class="n">healerWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">healerWindow</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">ui</span><span class="p">.</span><span class="n">edit</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">healerWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

    <span class="n">healerWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

    <span class="n">healerWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">conditions</span> <span class="o">=</span> <span class="n">healerWindow</span><span class="p">.</span><span class="n">conditions</span>

<span class="kd">local</span> <span class="n">targetSettings</span> <span class="o">=</span> <span class="n">healerWindow</span><span class="p">.</span><span class="n">targetSettings</span>

<span class="kd">local</span> <span class="n">customList</span> <span class="o">=</span> <span class="n">healerWindow</span><span class="p">.</span><span class="n">customList</span>

<span class="kd">local</span> <span class="n">priority</span> <span class="o">=</span> <span class="n">healerWindow</span><span class="p">.</span><span class="n">priority</span>

<span class="c1">-- customList</span>

<span class="c1">-- create entries on the list</span>

<span class="kr">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">health</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;HealerPlayerEntry&quot;</span><span class="p">,</span> <span class="n">customList</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="o">..</span><span class="n">health</span><span class="o">..</span><span class="s2">&quot;%]  &quot;</span><span class="o">..</span><span class="n">name</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">customList</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">customList</span><span class="p">.</span><span class="n">playerList</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">clearFields</span><span class="p">()</span>

    <span class="n">customList</span><span class="p">.</span><span class="n">addPanel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;friend name&quot;</span><span class="p">)</span>

    <span class="n">customList</span><span class="p">.</span><span class="n">addPanel</span><span class="p">.</span><span class="n">health</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>

    <span class="n">customList</span><span class="p">.</span><span class="n">playerList</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">capitalFistLetter</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>

    <span class="kr">return</span> <span class="p">(</span><span class="nb">string.gsub</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s2">&quot;^%l&quot;</span><span class="p">,</span> <span class="nb">string.upper</span><span class="p">))</span>

  <span class="kr">end</span>

<span class="n">customList</span><span class="p">.</span><span class="n">addPanel</span><span class="p">.</span><span class="n">add</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="kd">local</span> <span class="n">words</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">customList</span><span class="p">.</span><span class="n">addPanel</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">health</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">customList</span><span class="p">.</span><span class="n">addPanel</span><span class="p">.</span><span class="n">health</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="kr">do</span>

      <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">..</span> <span class="s2">&quot; &quot;</span> <span class="o">..</span> <span class="n">capitalFistLetter</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">health</span> <span class="kr">then</span>

        <span class="n">clearFields</span><span class="p">()</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[Friend Healer] Please enter health percent value!&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">name</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;friend name&quot;</span> <span class="kr">then</span>

        <span class="n">clearFields</span><span class="p">()</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[Friend Healer] Please enter friend name to be added!&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">or</span> <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()]</span> <span class="kr">then</span>

        <span class="n">clearFields</span><span class="p">()</span>

        <span class="kr">return</span> <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;[Friend Healer] Player already added to custom list.&quot;</span><span class="p">)</span>

    <span class="kr">else</span>

        <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">health</span>

        <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;HealerPlayerEntry&quot;</span><span class="p">,</span> <span class="n">customList</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

            <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

            <span class="n">widget</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="o">..</span><span class="n">health</span><span class="o">..</span><span class="s2">&quot;%]  &quot;</span><span class="o">..</span><span class="n">name</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">clearFields</span><span class="p">()</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getParent</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">list</span><span class="p">:</span><span class="n">getParent</span><span class="p">().</span><span class="n">title</span>

    <span class="c1">-- 1 - priorities | 2 - vocation</span>

    <span class="n">category</span> <span class="o">=</span> <span class="n">category</span> <span class="ow">or</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">extras</span><span class="p">.</span><span class="n">checkPlayer</span> <span class="kr">then</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;#d9321f&quot;</span><span class="p">)</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;! WARNING ! </span><span class="se">\n</span><span class="s2">Turn on check players in extras to use this feature!&quot;</span><span class="p">)</span>

        <span class="kr">return</span>

    <span class="kr">else</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;#dfdfdf&quot;</span><span class="p">)</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">checked</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">child</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">or</span> <span class="n">child</span><span class="p">:</span><span class="n">isChecked</span><span class="p">()</span> <span class="kr">then</span>

            <span class="n">checked</span> <span class="o">=</span> <span class="kc">true</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">checked</span> <span class="kr">then</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;#d9321f&quot;</span><span class="p">)</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;! WARNING ! </span><span class="se">\n</span><span class="s2">No category selected!&quot;</span><span class="p">)</span>

    <span class="kr">else</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;#dfdfdf&quot;</span><span class="p">)</span>

        <span class="n">label</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- targetSettings</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">knights</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">knights</span><span class="p">)</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">knights</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">knights</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">knights</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">knights</span><span class="p">)</span>

    <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">paladins</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">paladins</span><span class="p">)</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">paladins</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">paladins</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">paladins</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">paladins</span><span class="p">)</span>

    <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">druids</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">druids</span><span class="p">)</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">druids</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">druids</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">druids</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">druids</span><span class="p">)</span>

    <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">sorcerers</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">sorcerers</span><span class="p">)</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">sorcerers</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">sorcerers</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">sorcerers</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">sorcerers</span><span class="p">)</span>

    <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">friends</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">friends</span><span class="p">)</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">friends</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">friends</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">friends</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">friends</span><span class="p">)</span>

    <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">party</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">party</span><span class="p">)</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">party</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">party</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">party</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">party</span><span class="p">)</span>

    <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">guild</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">guild</span><span class="p">)</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">guild</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">guild</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">guild</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">guild</span><span class="p">)</span>

    <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">botserver</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">botserver</span><span class="p">)</span>

<span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">botserver</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">botserver</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">botserver</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">botserver</span><span class="p">)</span>

    <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">validate</span><span class="p">(</span><span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">knights</span><span class="p">)</span>

<span class="n">validate</span><span class="p">(</span><span class="n">targetSettings</span><span class="p">.</span><span class="n">groups</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">friends</span><span class="p">)</span>

<span class="n">validate</span><span class="p">(</span><span class="n">targetSettings</span><span class="p">.</span><span class="n">vocations</span><span class="p">.</span><span class="n">box</span><span class="p">.</span><span class="n">sorcerers</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">-- conditions</span>

<span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">setting</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">type</span><span class="p">,</span> <span class="n">conditions</span><span class="p">.</span><span class="n">box</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">text</span> <span class="o">=</span> <span class="n">setting</span><span class="p">.</span><span class="n">text</span>

    <span class="kd">local</span> <span class="n">val</span> <span class="o">=</span> <span class="n">setting</span><span class="p">.</span><span class="n">value</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">setting</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;HealScroll&quot;</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span><span class="o">..</span><span class="n">val</span><span class="p">)</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Range&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Mas Res&quot;</span><span class="p">))</span> <span class="kr">then</span>

            <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span><span class="o">..</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">scroll</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="n">setting</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

            <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="o">..</span><span class="n">value</span><span class="p">)</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Range&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Mas Res&quot;</span><span class="p">))</span> <span class="kr">then</span>

                <span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">widget</span><span class="p">.</span><span class="n">text</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span><span class="o">..</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Range&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Mas Res&quot;</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">widget</span><span class="p">.</span><span class="n">scroll</span><span class="p">:</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">item</span><span class="p">:</span><span class="n">setShowCount</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">item</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

            <span class="n">setting</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- priority and toggles</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">setCrementalButtons</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">priority</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

            <span class="n">child</span><span class="p">.</span><span class="n">increment</span><span class="p">:</span><span class="n">disable</span><span class="p">()</span>

        <span class="kr">elseif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">6</span> <span class="kr">then</span>

            <span class="n">child</span><span class="p">.</span><span class="n">decrement</span><span class="p">:</span><span class="n">disable</span><span class="p">()</span>

        <span class="kr">else</span>

            <span class="n">child</span><span class="p">.</span><span class="n">increment</span><span class="p">:</span><span class="n">enable</span><span class="p">()</span>

            <span class="n">child</span><span class="p">.</span><span class="n">decrement</span><span class="p">:</span><span class="n">enable</span><span class="p">()</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">action</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">priorities</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;PriorityEntry&quot;</span><span class="p">,</span> <span class="n">priority</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">increment</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">index</span> <span class="o">=</span> <span class="n">priority</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">table</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">priorities</span>

        <span class="n">priority</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="n">setCrementalButtons</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">decrement</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">index</span> <span class="o">=</span> <span class="n">priority</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">getChildIndex</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">table</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">priorities</span>

        <span class="n">priority</span><span class="p">.</span><span class="n">list</span><span class="p">:</span><span class="n">moveChildToIndex</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="n">setCrementalButtons</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="s2">&quot;#98BF64&quot;</span> <span class="ow">or</span> <span class="s2">&quot;#dfdfdf&quot;</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">action</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">action</span><span class="p">.</span><span class="n">enabled</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="s2">&quot;#98BF64&quot;</span> <span class="ow">or</span> <span class="s2">&quot;#dfdfdf&quot;</span><span class="p">)</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">enabled</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

        <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">action</span><span class="p">.</span><span class="n">custom</span> <span class="kr">then</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

            <span class="kd">local</span> <span class="n">window</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">client_textedit</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="p">{</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Custom Spell&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Enter below formula for a custom healing spell&quot;</span><span class="p">})</span>

            <span class="n">schedule</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

              <span class="n">window</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

              <span class="n">window</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

            <span class="kr">end</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>

            <span class="n">action</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">text</span>

        <span class="kr">end</span>

        <span class="n">widget</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;Double click to set spell formula.&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">#</span><span class="n">config</span><span class="p">.</span><span class="n">priorities</span> <span class="kr">then</span>

        <span class="n">validate</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">setCrementalButtons</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">lastItemUse</span> <span class="o">=</span> <span class="n">now</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">friendHealerAction</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">targetsInRange</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">health</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getHealthPercent</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">mana</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getManaPercent</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

    <span class="n">targetsInRange</span> <span class="o">=</span> <span class="n">targetsInRange</span> <span class="ow">or</span> <span class="mi">0</span>

    <span class="kd">local</span> <span class="n">masResAmount</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">value</span>

    <span class="kd">local</span> <span class="n">itemRange</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">value</span>

    <span class="kd">local</span> <span class="n">healItem</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">value</span>

    <span class="kd">local</span> <span class="n">manaItem</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">value</span>

    <span class="kd">local</span> <span class="n">normalHeal</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">or</span> <span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">value</span>

    <span class="kd">local</span> <span class="n">strongHeal</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">and</span> <span class="n">normalHeal</span><span class="o">/</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">value</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">action</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">priorities</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">action</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">action</span><span class="p">.</span><span class="n">area</span> <span class="ow">and</span> <span class="n">masResAmount</span> <span class="o">&lt;=</span> <span class="n">targetsInRange</span> <span class="ow">and</span> <span class="n">canCast</span><span class="p">(</span><span class="s2">&quot;exura gran mas res&quot;</span><span class="p">)</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">say</span><span class="p">(</span><span class="s2">&quot;exura gran mas res&quot;</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="kr">if</span> <span class="n">action</span><span class="p">.</span><span class="n">mana</span> <span class="ow">and</span> <span class="n">findItem</span><span class="p">(</span><span class="n">manaItem</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mana</span> <span class="o">&lt;=</span> <span class="n">normalHeal</span> <span class="ow">and</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">itemRange</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">-</span> <span class="n">lastItemUse</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="kr">then</span>

                <span class="n">lastItemUse</span> <span class="o">=</span> <span class="n">now</span>

                <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">manaItem</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="kr">if</span> <span class="n">action</span><span class="p">.</span><span class="n">health</span> <span class="ow">and</span> <span class="n">findItem</span><span class="p">(</span><span class="n">healItem</span><span class="p">)</span> <span class="ow">and</span> <span class="n">health</span> <span class="o">&lt;=</span> <span class="n">normalHeal</span> <span class="ow">and</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">itemRange</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">-</span> <span class="n">lastItemUse</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="kr">then</span>

                <span class="n">lastItemUse</span> <span class="o">=</span> <span class="n">now</span>

                <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">healItem</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="kr">if</span> <span class="n">action</span><span class="p">.</span><span class="n">strong</span> <span class="ow">and</span> <span class="n">health</span> <span class="o">&lt;=</span> <span class="n">strongHeal</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_cooldown</span><span class="p">.</span><span class="n">isCooldownIconActive</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">say</span><span class="p">(</span><span class="s1">&#39;exura gran sio &quot;&#39;</span><span class="o">..</span><span class="n">name</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="kr">if</span> <span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">normal</span> <span class="ow">or</span> <span class="n">action</span><span class="p">.</span><span class="n">custom</span><span class="p">)</span> <span class="ow">and</span> <span class="n">health</span> <span class="o">&lt;=</span> <span class="n">normalHeal</span> <span class="ow">and</span> <span class="n">canCast</span><span class="p">(</span><span class="s1">&#39;exura sio &quot;&#39;</span><span class="o">..</span><span class="n">name</span><span class="p">)</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="n">say</span><span class="p">(</span><span class="s1">&#39;exura sio &quot;&#39;</span><span class="o">..</span><span class="n">name</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">isCandidate</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">nil</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">canShoot</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">curHp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getHealthPercent</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">curHp</span> <span class="o">==</span> <span class="mi">100</span> <span class="ow">or</span> <span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">and</span> <span class="n">curHp</span> <span class="o">&gt;</span> <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">specText</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>

    <span class="c1">-- check players is enabled and spectator already verified</span>

    <span class="kr">if</span> <span class="n">storage</span><span class="p">.</span><span class="n">extras</span><span class="p">.</span><span class="n">checkPlayer</span> <span class="ow">and</span> <span class="n">specText</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">specText</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;EK&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">knights</span> <span class="ow">or</span>

           <span class="n">specText</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;RP&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">paladins</span> <span class="ow">or</span>

           <span class="n">specText</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ED&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">druids</span> <span class="ow">or</span>

           <span class="n">specText</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">sorcerers</span> <span class="kr">then</span>

           <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>

               <span class="kr">return</span> <span class="kc">nil</span>

           <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">okParty</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">party</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPartyMember</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">okFriend</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">friends</span> <span class="ow">and</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">okGuild</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">guild</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">getEmblem</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="kd">local</span> <span class="n">okBotServer</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">conditions</span><span class="p">.</span><span class="n">botserver</span> <span class="ow">and</span> <span class="n">vBot</span><span class="p">.</span><span class="n">BotServerMembers</span><span class="p">[</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">()]</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">okParty</span> <span class="ow">or</span> <span class="n">okFriend</span> <span class="ow">or</span> <span class="n">okGuild</span> <span class="ow">or</span> <span class="n">okBotServer</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">nil</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">health</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">customPlayers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">and</span> <span class="n">curHp</span><span class="o">/</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">curHp</span>

    <span class="kd">local</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

    <span class="kr">return</span> <span class="n">health</span><span class="p">,</span> <span class="n">dist</span>

<span class="kr">end</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_cooldown</span><span class="p">.</span><span class="n">isGroupCooldownIconActive</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">minHp</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">value</span>

    <span class="kd">local</span> <span class="n">minMp</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">value</span>

    <span class="kd">local</span> <span class="n">healTarget</span> <span class="o">=</span> <span class="p">{</span><span class="n">creature</span><span class="o">=</span><span class="kc">nil</span><span class="p">,</span> <span class="n">hp</span><span class="o">=</span><span class="mi">100</span><span class="p">}</span>

    <span class="kd">local</span> <span class="n">inMasResRange</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">-- check basic</span>

    <span class="kr">if</span> <span class="n">hppercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">minHp</span> <span class="ow">or</span> <span class="n">manapercent</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">minMp</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="c1">-- get all spectators</span>

    <span class="kd">local</span> <span class="n">spectators</span> <span class="o">=</span> <span class="n">getSpectators</span><span class="p">()</span>

    <span class="c1">-- main check</span>

    <span class="kd">local</span> <span class="n">healtR</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">spectators</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">health</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">isCandidate</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="c1">--mas san</span>

        <span class="kr">if</span> <span class="n">dist</span> <span class="kr">then</span>

            <span class="n">inMasResRange</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">inMasResRange</span><span class="o">+</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">inMasResRange</span>

            <span class="c1">-- best target</span>

            <span class="kr">if</span> <span class="n">health</span> <span class="o">&lt;</span> <span class="n">healTarget</span><span class="p">.</span><span class="n">hp</span> <span class="kr">then</span>

                <span class="n">healTarget</span> <span class="o">=</span> <span class="p">{</span><span class="n">creature</span> <span class="o">=</span> <span class="n">spec</span><span class="p">,</span> <span class="n">hp</span> <span class="o">=</span> <span class="n">health</span><span class="p">}</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="c1">-- action</span>

    <span class="kr">if</span> <span class="n">healTarget</span><span class="p">.</span><span class="n">creature</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">friendHealerAction</span><span class="p">(</span><span class="n">healTarget</span><span class="p">.</span><span class="n">creature</span><span class="p">,</span> <span class="n">inMasResRange</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="new-healer-otui">
<h1>new_healer.otui<a class="headerlink" href="#new-healer-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
CategoryCheckBox &lt; CheckBox

  font: verdana-11px-rounded

  margin-top: 3

  $checked:

    color: #98BF64

HealScroll &lt; Panel

  ToolTipLabel

    id: text

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: parent.top

    text-align: center

    text: test

  HorizontalScrollBar

    id: scroll

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 3

    minimum: 0

    maximum: 100

    step: 1

HealItem &lt; Panel

  BotItem

    id: item

    anchors.left: parent.left

    anchors.verticalCenter: parent.verticalCenter

    size: 34 34

  ToolTipLabel

    id: text

    anchors.fill: parent

    anchors.left: prev.right

    margin-left: 8

    text-wrap: true

    text-align: left

ToolTipLabel &lt; UIWidget

  font: verdana-11px-rounded

  color: #dfdfdf

  height: 14

  text-align: center

HealerPlayerEntry &lt; Label

  background-color: alpha

  text-offset: 5 1

  focusable: true

  height: 16

  font: verdana-11px-rounded

  text-align: left

  $focus:

    background-color: #00000055

  Button

    id: remove

    anchors.right: parent.right

    margin-right: 2

    anchors.verticalCenter: parent.verticalCenter

    size: 15 15

    margin-right: 15

    text: X

    tooltip: Remove player from the list

PriorityEntry &lt; ToolTipLabel

  background-color: alpha

  text-offset: 18 1

  focusable: true

  height: 16

  font: verdana-11px-rounded

  text-align: left

  $focus:

    background-color: #00000055

  CheckBox

    id: enabled

    anchors.left: parent.left

    anchors.verticalCenter: parent.verticalCenter

    size: 15 15

    margin-top: 2

    margin-left: 3

  Button

    id: increment

    anchors.right: parent.right

    margin-right: 2

    anchors.verticalCenter: parent.verticalCenter

    size: 14 14

    text: +

    tooltip: Increase Priority

  Button

    id: decrement

    anchors.right: prev.left

    margin-right: 2

    anchors.verticalCenter: parent.verticalCenter

    size: 14 14

    text: -

    tooltip: Decrease Priority

TargetSettings &lt; Panel

  size: 280 125

  padding: 3

  image-source: /images/ui/window

  image-border: 6

  Label

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: parent.top

    font: verdana-11px-rounded

    text: Heal Target Settings

  Groups

    id: groups

    anchors.top: prev.bottom

    margin-top: 8

    anchors.left: parent.left

    margin-left: 9

  Vocations

    id: vocations

    anchors.left: prev.right

    margin-left: 5

    anchors.verticalCenter: prev.verticalCenter

Groups &lt; FlatPanel

  size: 150 90

  padding: 3

  padding-top: 5

  ToolTipLabel

    id: title

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: parent.top

    text: Groups

    tooltip: Players added in custom list will always be in scope

  HorizontalSeparator

    anchors.top: prev.bottom

    margin-top: 2

    anchors.left: parent.left

    anchors.right: parent.right

  Panel

    id: box

    anchors.top: prev.bottom

    margin-top: 2

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    padding: 2

    layout:

      type: verticalBox

    CategoryCheckBox

      id: friends

      text: Friends

    CategoryCheckBox

      id: party

      text: Party Members

    CategoryCheckBox

      id: guild

      text: Guild Members

    CategoryCheckBox

      id: botserver

      text: BotServer Members

Vocations &lt; FlatPanel

  size: 100 90

  padding: 3

  padding-top: 5

  ToolTipLabel

    id: title

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: parent.top

    font: verdana-11px-rounded

    text: Vocations

  HorizontalSeparator

    anchors.top: prev.bottom

    margin-top: 2

    anchors.left: parent.left

    anchors.right: parent.right

  Panel

    id: box

    anchors.top: prev.bottom

    margin-top: 2

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    padding: 2

    layout:

      type: verticalBox

    CategoryCheckBox

      id: knights

      text: Knights

    CategoryCheckBox

      id: paladins

      text: Paladins

    CategoryCheckBox

      id: druids

      text: Druids

    CategoryCheckBox

      id: sorcerers

      text: Sorcerers

Priority &lt; Panel

  size: 190 123

  padding: 6

  padding-top: 3

  image-source: /images/ui/window

  image-border: 6

  ToolTipLabel

    id: title

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: parent.top

    font: verdana-11px-rounded

    text: Priority &amp; Toggles

  TextList

    id: list

    anchors.top: prev.bottom

    margin-top: 3

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    fit-children: true

    padding-top: 1

AddPlayer &lt; FlatPanel

  padding: 5

  Label

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.right: parent.right

    font: verdana-11px-rounded

    text: Add Player to Custom List

    text-align: center

    text-wrap: true

  HorizontalSeparator

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 2

  SpinBox

    id: health

    anchors.left: parent.left

    anchors.top: prev.bottom

    margin-top: 20

    width: 50

    minimum: 1

    maximum: 99

    step: 1

    focusable: true

    text-align: center

  Label

    anchors.verticalCenter: prev.verticalCenter

    anchors.left: prev.right

    margin-left: 3

    font: verdana-11px-rounded

    text: %HP - heal if below

  TextEdit

    id: name

    anchors.top: health.bottom

    margin-top: 5

    anchors.left: health.left

    anchors.right: parent.right

    font: verdana-11px-rounded

    text-align: center

    text: friend name

  Button

    id: add

    anchors.left: health.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 5

    font: verdana-11px-rounded

    text: Add Player

PlayerList &lt; Panel

  TextList

    id: list

    anchors.fill: parent

    fit-children: true

    padding-top: 2

    vertical-scrollbar: listScrollBar

  VerticalScrollBar

    id: listScrollBar

    anchors.top: list.top

    anchors.bottom: list.bottom

    anchors.right: list.right

    step: 14

    pixels-scroll: true

CustomList &lt; Panel

  size: 190 172

  padding: 6

  padding-top: 3

  image-source: /images/ui/window

  image-border: 6

  ToolTipLabel

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: parent.top

    font: verdana-11px-rounded

    text: Custom Player List

    tooltip: Double click on the list below to add new player.

  AddPlayer

    id: addPanel

    anchors.top: prev.bottom

    margin-top: 3

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: parent.bottom

  PlayerList

    id: playerList

    anchors.fill: prev

Conditions &lt; Panel

  size: 280 170

  padding: 3

  image-source: /images/ui/window

  image-border: 6

  Label

    anchors.horizontalCenter: parent.horizontalCenter

    anchors.top: parent.top

    font: verdana-11px-rounded

    text: Player Conditions

  Panel

    id: box

    anchors.fill: parent

    margin-top: 16

    padding: 5

    padding-top: 3

    layout:

      type: grid

      cell-size: 128 31

      cell-spacing: 5

      num-columns: 2

FriendHealer &lt; MainWindow

  !text: tr(&#39;Friend Healer&#39;)

  size: 512 390

  padding-top: 30

  @onEscape: self:hide()

  Conditions

    id: conditions

    anchors.top: parent.top

    anchors.right: parent.right

  TargetSettings

    id: targetSettings

    anchors.top: prev.bottom

    margin-top: 10

    anchors.left: prev.left

  Priority

    id: priority

    anchors.top: parent.top

    anchors.left: parent.left

  CustomList

    id: customList

    anchors.top: priority.bottom

    margin-top: 10

    anchors.left: priority.left

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    @onClick: self:getParent():hide()

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="npc-talk-lua">
<h1>npc_talk.lua<a class="headerlink" href="#npc-talk-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">onAttackingCreatureChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">creature</span><span class="p">,</span> <span class="n">OldCreature</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">creature</span> <span class="ow">and</span> <span class="n">creature</span><span class="p">:</span><span class="n">isNpc</span><span class="p">()</span> <span class="ow">and</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">creature</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="kr">then</span>

        <span class="n">CaveBot</span><span class="p">.</span><span class="n">Conversation</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="s2">&quot;trade&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="playerlist-lua">
<h1>playerlist.lua<a class="headerlink" href="#playerlist-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cm">--[[</span>

<span class="cm">  configuration for check players</span>

<span class="cm">  example made on server Gunzodus</span>

<span class="cm">  example link for player overview:</span>

<span class="cm">  https://www.gunzodus.net/character/show/Sir_Vithrax</span>

<span class="cm">  *note that space in character name was replaced with underscore (_) - this character will be important</span>

<span class="cm">  in this case:</span>

<span class="cm">  link = &quot;https://www.gunzodus.net/character/show/&quot; -- everything with all the characters up to the start of the name</span>

<span class="cm">  spacing = &quot;_&quot; -- space replacement in character name</span>

<span class="cm">]]</span>

<span class="kd">local</span> <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;https://www.gunzodus.net/character/show/&quot;</span>

<span class="kd">local</span> <span class="n">spacing</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span>

<span class="c1">-- do not edit below</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">tabs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Friends&quot;</span><span class="p">,</span> <span class="s2">&quot;Enemies&quot;</span><span class="p">,</span> <span class="s2">&quot;BlackList&quot;</span><span class="p">}</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;playerList&quot;</span>

<span class="kd">local</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;#03C04A&quot;</span><span class="p">,</span> <span class="s2">&quot;#fc4c4e&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">}</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

    <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="n">enemyList</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">friendList</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">blackList</span> <span class="o">=</span> <span class="p">{},</span>

      <span class="n">groupMembers</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

      <span class="n">outfits</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">marks</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>

      <span class="n">highlight</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="kd">local</span> <span class="n">playerTables</span> <span class="o">=</span> <span class="p">{</span><span class="n">config</span><span class="p">.</span><span class="n">friendList</span><span class="p">,</span> <span class="n">config</span><span class="p">.</span><span class="n">enemyList</span><span class="p">,</span> <span class="n">config</span><span class="p">.</span><span class="n">blackList</span><span class="p">}</span>

<span class="c1">-- functions</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">clearCachedPlayers</span><span class="p">()</span>

  <span class="n">CachedFriends</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="n">CachedEnemies</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">refreshStatus</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">outfits</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">specOutfit</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getOutfit</span><span class="p">()</span>

          <span class="kr">if</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">highlight</span> <span class="kr">then</span>

              <span class="n">spec</span><span class="p">:</span><span class="n">setMarked</span><span class="p">(</span><span class="s1">&#39;#0000FF&#39;</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="mi">88</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="mi">88</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">legs</span> <span class="o">=</span> <span class="mi">88</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">feet</span> <span class="o">=</span> <span class="mi">88</span>

            <span class="kr">if</span> <span class="n">storage</span><span class="p">.</span><span class="n">BOTserver</span><span class="p">.</span><span class="n">outfit</span> <span class="kr">then</span>

              <span class="kd">local</span> <span class="n">voc</span> <span class="o">=</span> <span class="n">vBot</span><span class="p">.</span><span class="n">BotServerMembers</span><span class="p">[</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">()]</span>

              <span class="n">specOutfit</span><span class="p">.</span><span class="n">addons</span> <span class="o">=</span> <span class="mi">3</span>

              <span class="kr">if</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

                <span class="n">specOutfit</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">131</span>

              <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

                <span class="n">specOutfit</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">129</span>

              <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

                <span class="n">specOutfit</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">130</span>

              <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span>

                <span class="n">specOutfit</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">144</span>

              <span class="kr">end</span>

            <span class="kr">end</span>

            <span class="n">spec</span><span class="p">:</span><span class="n">setOutfit</span><span class="p">(</span><span class="n">specOutfit</span><span class="p">)</span>

          <span class="kr">elseif</span> <span class="n">isEnemy</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">highlight</span> <span class="kr">then</span>

              <span class="n">spec</span><span class="p">:</span><span class="n">setMarked</span><span class="p">(</span><span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span>

            <span class="kr">end</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="mi">94</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="mi">94</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">legs</span> <span class="o">=</span> <span class="mi">94</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">feet</span> <span class="o">=</span> <span class="mi">94</span>

            <span class="n">spec</span><span class="p">:</span><span class="n">setOutfit</span><span class="p">(</span><span class="n">specOutfit</span><span class="p">)</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">refreshStatus</span><span class="p">()</span>

<span class="kd">local</span> <span class="n">checkStatus</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">creature</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">creature</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">or</span> <span class="n">creature</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">specName</span> <span class="o">=</span> <span class="n">creature</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">specOutfit</span> <span class="o">=</span> <span class="n">creature</span><span class="p">:</span><span class="n">getOutfit</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">specName</span><span class="p">)</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">highlight</span> <span class="kr">then</span>

        <span class="n">creature</span><span class="p">:</span><span class="n">setMarked</span><span class="p">(</span><span class="s1">&#39;#0000FF&#39;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">outfits</span> <span class="kr">then</span>

        <span class="n">specOutfit</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="mi">88</span>

        <span class="n">specOutfit</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="mi">88</span>

        <span class="n">specOutfit</span><span class="p">.</span><span class="n">legs</span> <span class="o">=</span> <span class="mi">88</span>

        <span class="n">specOutfit</span><span class="p">.</span><span class="n">feet</span> <span class="o">=</span> <span class="mi">88</span>

        <span class="kr">if</span> <span class="n">storage</span><span class="p">.</span><span class="n">BOTserver</span><span class="p">.</span><span class="n">outfit</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">voc</span> <span class="o">=</span> <span class="n">vBot</span><span class="p">.</span><span class="n">BotServerMembers</span><span class="p">[</span><span class="n">creature</span><span class="p">:</span><span class="n">getName</span><span class="p">()]</span>

          <span class="n">specOutfit</span><span class="p">.</span><span class="n">addons</span> <span class="o">=</span> <span class="mi">3</span>

          <span class="kr">if</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">131</span>

          <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">129</span>

          <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">130</span>

          <span class="kr">elseif</span> <span class="n">voc</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span>

            <span class="n">specOutfit</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">144</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="n">creature</span><span class="p">:</span><span class="n">setOutfit</span><span class="p">(</span><span class="n">specOutfit</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">elseif</span> <span class="n">isEnemy</span><span class="p">(</span><span class="n">specName</span><span class="p">)</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">highlight</span> <span class="kr">then</span>

        <span class="n">creature</span><span class="p">:</span><span class="n">setMarked</span><span class="p">(</span><span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="kr">if</span> <span class="n">config</span><span class="p">.</span><span class="n">outfits</span> <span class="kr">then</span>

        <span class="n">specOutfit</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="mi">94</span>

        <span class="n">specOutfit</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="mi">94</span>

        <span class="n">specOutfit</span><span class="p">.</span><span class="n">legs</span> <span class="o">=</span> <span class="mi">94</span>

        <span class="n">specOutfit</span><span class="p">.</span><span class="n">feet</span> <span class="o">=</span> <span class="mi">94</span>

        <span class="n">creature</span><span class="p">:</span><span class="n">setOutfit</span><span class="p">(</span><span class="n">specOutfit</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">rootWidget</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">()</span>

<span class="kr">if</span> <span class="n">rootWidget</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">ListWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;PlayerListWindow&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

    <span class="n">ListWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

    <span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Player Lists&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">ListWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

        <span class="n">ListWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

        <span class="n">ListWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="c1">-- settings</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">Members</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">groupMembers</span><span class="p">)</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">Members</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">groupMembers</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">groupMembers</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">groupMembers</span> <span class="kr">then</span>

        <span class="n">clearCachedPlayers</span><span class="p">()</span>

      <span class="kr">end</span>

      <span class="n">refreshStatus</span><span class="p">()</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">groupMembers</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">Outfit</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">outfits</span><span class="p">)</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">Outfit</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">outfits</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">outfits</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">outfits</span><span class="p">)</span>

      <span class="n">refreshStatus</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">NeutralsAreEnemy</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">marks</span><span class="p">)</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">NeutralsAreEnemy</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">marks</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">marks</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">marks</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">Highlight</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">highlight</span><span class="p">)</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">Highlight</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">highlight</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">highlight</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">AutoAdd</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">autoAdd</span><span class="p">)</span>

    <span class="n">ListWindow</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">AutoAdd</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

      <span class="n">config</span><span class="p">.</span><span class="n">autoAdd</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">autoAdd</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setChecked</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">autoAdd</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">TabBar</span> <span class="o">=</span> <span class="n">ListWindow</span><span class="p">.</span><span class="n">tmpTabBar</span>

    <span class="n">TabBar</span><span class="p">:</span><span class="n">setContentWidget</span><span class="p">(</span><span class="n">ListWindow</span><span class="p">.</span><span class="n">tmpTabContent</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">blacklistList</span>

    <span class="kr">for</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">listPanel</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;tPanel&quot;</span><span class="p">)</span> <span class="c1">-- Creates Panel</span>

        <span class="kd">local</span> <span class="n">playerList</span> <span class="o">=</span> <span class="n">playerTables</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>

        <span class="n">listPanel</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">tabs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">..</span><span class="s2">&quot;Tab&quot;</span><span class="p">)</span>

        <span class="n">TabBar</span><span class="p">:</span><span class="n">addTab</span><span class="p">(</span><span class="n">tabs</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">listPanel</span><span class="p">)</span>

        <span class="c1">-- elements</span>

        <span class="kd">local</span> <span class="n">addButton</span> <span class="o">=</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">add</span>

        <span class="kd">local</span> <span class="n">nameTab</span> <span class="o">=</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">name</span>

        <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="n">listPanel</span><span class="p">.</span><span class="n">list</span>

        <span class="kr">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">3</span> <span class="kr">then</span>

          <span class="n">blacklistList</span> <span class="o">=</span> <span class="n">list</span>

        <span class="kr">end</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">playerList</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;PlayerLabel&quot;</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span>

            <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">label</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

                <span class="nb">table.remove</span><span class="p">(</span><span class="n">playerList</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">playerList</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

                <span class="n">label</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

                <span class="n">clearCachedPlayers</span><span class="p">()</span>

                <span class="n">refreshStatus</span><span class="p">()</span>

            <span class="kr">end</span>

            <span class="n">label</span><span class="p">.</span><span class="n">onMouseRelease</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">mousePos</span><span class="p">,</span> <span class="n">mouseButton</span><span class="p">)</span>

              <span class="kr">if</span> <span class="n">mouseButton</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

                <span class="kd">local</span> <span class="n">child</span> <span class="o">=</span> <span class="n">rootWidget</span><span class="p">:</span><span class="n">recursiveGetChildByPos</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>

                <span class="kr">if</span> <span class="n">child</span> <span class="o">==</span> <span class="n">widget</span> <span class="kr">then</span>

                  <span class="kd">local</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;PopupMenu&#39;</span><span class="p">)</span>

                  <span class="n">menu</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="s2">&quot;blzMenu&quot;</span><span class="p">)</span>

                  <span class="n">menu</span><span class="p">:</span><span class="n">setGameMenu</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

                  <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;Check Player&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">spacing</span><span class="p">)</span>

                    <span class="n">g_platform</span><span class="p">.</span><span class="n">openUrl</span><span class="p">(</span><span class="n">link</span><span class="o">..</span><span class="n">name</span><span class="p">)</span>

                  <span class="kr">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                  <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;Copy Name&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                    <span class="n">g_window</span><span class="p">.</span><span class="n">setClipboardText</span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

                  <span class="kr">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                  <span class="n">menu</span><span class="p">:</span><span class="n">display</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>

                  <span class="kr">return</span> <span class="kc">true</span>

                <span class="kr">end</span>

              <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kd">local</span> <span class="n">tabButton</span> <span class="o">=</span> <span class="n">TabBar</span><span class="p">.</span><span class="n">buttonsPanel</span><span class="p">:</span><span class="n">getChildren</span><span class="p">()[</span><span class="n">v</span><span class="p">]</span>

        <span class="n">tabButton</span><span class="p">.</span><span class="n">onStyleApply</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

            <span class="kr">if</span> <span class="n">TabBar</span><span class="p">:</span><span class="n">getCurrentTab</span><span class="p">()</span> <span class="o">==</span> <span class="n">widget</span> <span class="kr">then</span>

                <span class="n">widget</span><span class="p">:</span><span class="n">setColor</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="c1">-- callbacks</span>

        <span class="n">addButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

            <span class="kd">local</span> <span class="n">names</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">nameTab</span><span class="p">:</span><span class="n">getText</span><span class="p">(),</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="kr">if</span> <span class="o">#</span><span class="n">names</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

              <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;vBot[PlayerList]: Name is missing!&quot;</span><span class="p">)</span>

              <span class="kr">return</span>

            <span class="kr">end</span>

            <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">names</span> <span class="kr">do</span>

              <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">trim</span><span class="p">()</span>

              <span class="kr">if</span> <span class="n">name</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>

                  <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;vBot[PlayerList]: Name is missing!&quot;</span><span class="p">)</span>

              <span class="kr">else</span>

                  <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">playerList</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="kr">then</span>

                      <span class="nb">table.insert</span><span class="p">(</span><span class="n">playerList</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

                      <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;PlayerLabel&quot;</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span>

                      <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                      <span class="n">label</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

                          <span class="nb">table.remove</span><span class="p">(</span><span class="n">playerList</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">playerList</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

                          <span class="n">label</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

                      <span class="kr">end</span>

                      <span class="n">label</span><span class="p">.</span><span class="n">onMouseRelease</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">mousePos</span><span class="p">,</span> <span class="n">mouseButton</span><span class="p">)</span>

                        <span class="kr">if</span> <span class="n">mouseButton</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

                          <span class="kd">local</span> <span class="n">child</span> <span class="o">=</span> <span class="n">rootWidget</span><span class="p">:</span><span class="n">recursiveGetChildByPos</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>

                          <span class="kr">if</span> <span class="n">child</span> <span class="o">==</span> <span class="n">widget</span> <span class="kr">then</span>

                            <span class="kd">local</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;PopupMenu&#39;</span><span class="p">)</span>

                            <span class="n">menu</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="s2">&quot;blzMenu&quot;</span><span class="p">)</span>

                            <span class="n">menu</span><span class="p">:</span><span class="n">setGameMenu</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

                            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;Check Player&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                              <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

                              <span class="kd">local</span> <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;https://www.gunzodus.net/character/show/&quot;</span>

                              <span class="n">g_platform</span><span class="p">.</span><span class="n">openUrl</span><span class="p">(</span><span class="n">link</span><span class="o">..</span><span class="n">name</span><span class="p">)</span>

                            <span class="kr">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;Copy Name&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                              <span class="n">g_window</span><span class="p">.</span><span class="n">setClipboardText</span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

                            <span class="kr">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                            <span class="n">menu</span><span class="p">:</span><span class="n">display</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>

                            <span class="kr">return</span> <span class="kc">true</span>

                          <span class="kr">end</span>

                        <span class="kr">end</span>

                      <span class="kr">end</span>

                      <span class="n">nameTab</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                  <span class="kr">else</span>

                      <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;vBot[PlayerList]: Player &quot;</span><span class="o">..</span> <span class="n">name</span> <span class="o">..</span><span class="s2">&quot; is already added!&quot;</span><span class="p">)</span>

                      <span class="n">nameTab</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                  <span class="kr">end</span>

                  <span class="n">clearCachedPlayers</span><span class="p">()</span>

                  <span class="n">refreshStatus</span><span class="p">()</span>

              <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="n">nameTab</span><span class="p">.</span><span class="n">onKeyPress</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">keyCode</span><span class="p">,</span> <span class="n">keyboardModifiers</span><span class="p">)</span>

          <span class="kr">if</span> <span class="n">keyCode</span> <span class="o">~=</span> <span class="mi">5</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="kc">false</span>

          <span class="kr">end</span>

          <span class="n">addButton</span><span class="p">.</span><span class="n">onClick</span><span class="p">()</span>

          <span class="kr">return</span> <span class="kc">true</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">function</span> <span class="nf">addBlackListPlayer</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">blackList</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="nb">table.insert</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">blackList</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

      <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;PlayerLabel&quot;</span><span class="p">,</span> <span class="n">blacklistList</span><span class="p">)</span>

      <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

      <span class="n">label</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

          <span class="nb">table.remove</span><span class="p">(</span><span class="n">playerList</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">playerList</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

          <span class="n">label</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

      <span class="kr">end</span>

      <span class="n">label</span><span class="p">.</span><span class="n">onMouseRelease</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">mousePos</span><span class="p">,</span> <span class="n">mouseButton</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">mouseButton</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

          <span class="kd">local</span> <span class="n">child</span> <span class="o">=</span> <span class="n">rootWidget</span><span class="p">:</span><span class="n">recursiveGetChildByPos</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>

          <span class="kr">if</span> <span class="n">child</span> <span class="o">==</span> <span class="n">widget</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;PopupMenu&#39;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="s2">&quot;blzMenu&quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">setGameMenu</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;Check Player&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

              <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getText</span><span class="p">():</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

              <span class="kd">local</span> <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;https://www.gunzodus.net/character/show/&quot;</span>

              <span class="n">g_platform</span><span class="p">.</span><span class="n">openUrl</span><span class="p">(</span><span class="n">link</span><span class="o">..</span><span class="n">name</span><span class="p">)</span>

            <span class="kr">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;Copy Name&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

              <span class="n">g_window</span><span class="p">.</span><span class="n">setClipboardText</span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

            <span class="kr">end</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">display</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>

            <span class="kr">return</span> <span class="kc">true</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">autoAdd</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="ow">or</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isOff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Warning! The murder of&quot;</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;Warning! The murder of &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot; was not justified.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">addBlackListPlayer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onCreatureAppear</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">creature</span><span class="p">)</span>

    <span class="n">checkStatus</span><span class="p">(</span><span class="n">creature</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>

<span class="n">onPlayerPositionChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">x</span><span class="p">.</span><span class="n">z</span> <span class="o">~=</span> <span class="n">y</span><span class="p">.</span><span class="n">z</span> <span class="kr">then</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

      <span class="n">refreshStatus</span><span class="p">()</span>

    <span class="kr">end</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="playerlist-otui">
<h1>playerlist.otui<a class="headerlink" href="#playerlist-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
PlayerLabel &lt; UIWidget

  background-color: alpha

  text-offset: 3 1

  focusable: true

  height: 16

  font: verdana-11px-rounded

  text-align: left

  $focus:

    background-color: #00000055

  Button

    id: remove

    !text: tr(&#39;X&#39;)

    anchors.right: parent.right

    anchors.verticalCenter: parent.verticalCenter

    width: 14

    height: 14

    margin-right: 15

    text-align: center

    text-offset: 0 1

    tooltip: Remove profile from the list.

SettingCheckBox &lt; CheckBox

  text-wrap: true

  text-auto-resize: true

  margin-top: 3

  font: verdana-11px-rounded

Settings &lt; FlatPanel

  padding: 6

  layout:

    type: verticalBox

  Label

    text: Additional Settings

    text-align: center

    font: verdana-11px-rounded

  HorizontalSeparator

  SettingCheckBox

    id: Members

    margin-top: 6

    text: Consider group members as friends.

  SettingCheckBox

    id: Outfit

    text: Color listed player outfits to red or blue.

  SettingCheckBox

    id: NeutralsAreEnemy

    text: Consider every non friend player as enemy.

  SettingCheckBox

    id: Highlight

    text: Hightlight listed players in red or blue color.

  SettingCheckBox

    id: AutoAdd

    text: Automatically add killed players while cave botting to blacklist.

tPanel &lt; Panel

  margin: 3

  padding: 3

  TextList

    id: list

    height: 200

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: parent.top

    vertical-scrollbar: listScrollBar

  VerticalScrollBar

    id: listScrollBar

    anchors.top: list.top

    anchors.bottom: list.bottom

    anchors.right: list.right

    step: 14

    pixels-scroll: true

  TextEdit

    id: name

    anchors.top: list.bottom

    margin-top: 3

    anchors.left: parent.left

    anchors.right: parent.right

  Button

    id: add

    text: Add Player

    anchors.top: prev.bottom

    margin-top: 3

    anchors.left: parent.left

    anchors.right: parent.right

    font: verdana-11px-rounded

PlayerListWindow &lt; MainWindow

  !text: tr(&#39;Player List&#39;)

  size: 405 356

  @onEscape: self:hide()

  TabBar

    id: tmpTabBar

    anchors.top: parent.top

    anchors.left: parent.left

    width: 180

  FlatPanel

    id: tmpTabContent

    anchors.top: tmpTabBar.bottom

    anchors.left: parent.left

    width: 180

    anchors.bottom: separator.top

    margin-bottom: 5

  VerticalSeparator

    id: verticalSep

    anchors.top: parent.top

    anchors.bottom: separator.top

    margin-bottom: 5

    anchors.horizontalCenter: parent.horizontalCenter

  Settings

    id: settings

    anchors.left: prev.right

    anchors.top: parent.top

    anchors.right: parent.right

    anchors.bottom: next.top

    margin: 3

    margin-left: 6

    margin-bottom: 4

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-top: 15

    margin-right: 5

    @onClick: self:getParent():hide()

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pushmax-lua">
<h1>pushmax.lua<a class="headerlink" href="#pushmax-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">---@diagnostic disable: undefined-global</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Main&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;pushmax&quot;</span>

<span class="kd">local</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">setupUI</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Panel</span>

<span class="s">  height: 19</span>

<span class="s">  BotSwitch</span>

<span class="s">    id: title</span>

<span class="s">    anchors.top: parent.top</span>

<span class="s">    anchors.left: parent.left</span>

<span class="s">    text-align: center</span>

<span class="s">    width: 130</span>

<span class="s">    !text: tr(&#39;PUSHMAX&#39;)</span>

<span class="s">  Button</span>

<span class="s">    id: push</span>

<span class="s">    anchors.top: prev.top</span>

<span class="s">    anchors.left: prev.right</span>

<span class="s">    anchors.right: parent.right</span>

<span class="s">    margin-left: 3</span>

<span class="s">    height: 17</span>

<span class="s">    text: Setup</span>

<span class="s">]]</span><span class="p">)</span>

<span class="n">ui</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

    <span class="n">pushDelay</span> <span class="o">=</span> <span class="mi">1060</span><span class="p">,</span>

    <span class="n">pushMaxRuneId</span> <span class="o">=</span> <span class="mi">3188</span><span class="p">,</span>

    <span class="n">mwallBlockId</span> <span class="o">=</span> <span class="mi">2128</span><span class="p">,</span>

    <span class="n">pushMaxKey</span> <span class="o">=</span> <span class="s2">&quot;PageUp&quot;</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">storage</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="n">ui</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

<span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span>

<span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">ui</span><span class="p">.</span><span class="n">push</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">pushWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="n">pushWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

  <span class="n">pushWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">rootWidget</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">()</span>

<span class="kr">if</span> <span class="n">rootWidget</span> <span class="kr">then</span>

  <span class="n">pushWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s1">&#39;PushMaxWindow&#39;</span><span class="p">,</span> <span class="n">rootWidget</span><span class="p">)</span>

  <span class="n">pushWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">closeButton</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">pushWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">updateDelayText</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">pushWindow</span><span class="p">.</span><span class="n">delayText</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Push Delay: &quot;</span><span class="o">..</span> <span class="n">config</span><span class="p">.</span><span class="n">pushDelay</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">updateDelayText</span><span class="p">()</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">delay</span><span class="p">.</span><span class="n">onValueChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">scroll</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">pushDelay</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">updateDelayText</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">delay</span><span class="p">:</span><span class="n">setValue</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">pushDelay</span><span class="p">)</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">runeId</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">pushMaxRuneId</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">runeId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">pushMaxRuneId</span><span class="p">)</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">mwallId</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">mwallBlockId</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">mwallId</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">mwallBlockId</span><span class="p">)</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">hotkey</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">pushMaxKey</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

  <span class="n">pushWindow</span><span class="p">.</span><span class="n">hotkey</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">pushMaxKey</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- variables for config</span>

<span class="kd">local</span> <span class="n">fieldTable</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2118</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">2122</span><span class="p">}</span>

<span class="kd">local</span> <span class="n">cleanTile</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="c1">-- scripts</span>

<span class="kd">local</span> <span class="n">targetTile</span>

<span class="kd">local</span> <span class="n">pushTarget</span>

<span class="kd">local</span> <span class="n">resetData</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TARGET&quot;</span> <span class="ow">or</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DEST&quot;</span> <span class="ow">or</span> <span class="n">tile</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;CLEAR&quot;</span> <span class="kr">then</span>

      <span class="n">tile</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">pushTarget</span> <span class="o">=</span> <span class="kc">nil</span>

  <span class="n">targetTile</span> <span class="o">=</span> <span class="kc">nil</span>

  <span class="n">cleanTile</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">getCreatureById</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">spec</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="kc">false</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">isNotOk</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tile</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">tileItems</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

    <span class="nb">table.insert</span><span class="p">(</span><span class="n">tileItems</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span>

  <span class="kr">end</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">tileItems</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="kc">false</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">isOk</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

  <span class="kr">return</span> <span class="n">getDistanceBetween</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

<span class="kr">end</span>

<span class="c1">-- to mark</span>

<span class="kd">local</span> <span class="n">hold</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">onKeyDown</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">keys</span> <span class="o">~=</span> <span class="n">config</span><span class="p">.</span><span class="n">pushMaxKey</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="n">hold</span> <span class="o">=</span> <span class="n">now</span>

  <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span> <span class="n">getTileUnderCursor</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">tile</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">pushTarget</span> <span class="ow">and</span> <span class="n">targetTile</span> <span class="kr">then</span>

    <span class="n">resetData</span><span class="p">()</span>

    <span class="kr">return</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">creature</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getCreatures</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">pushTarget</span> <span class="ow">and</span> <span class="n">creature</span> <span class="kr">then</span>

    <span class="n">pushTarget</span> <span class="o">=</span> <span class="n">creature</span>

    <span class="kr">if</span> <span class="n">pushTarget</span> <span class="kr">then</span>

      <span class="n">tile</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;TARGET&#39;</span><span class="p">)</span>

      <span class="n">pushTarget</span><span class="p">:</span><span class="n">setMarked</span><span class="p">(</span><span class="s1">&#39;#00FF00&#39;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">elseif</span> <span class="ow">not</span> <span class="n">targetTile</span> <span class="ow">and</span> <span class="n">pushTarget</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">pushTarget</span> <span class="ow">and</span> <span class="n">getDistanceBetween</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span><span class="n">pushTarget</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">~=</span> <span class="mi">1</span> <span class="kr">then</span>

      <span class="n">resetData</span><span class="p">()</span>

      <span class="kr">return</span>

    <span class="kr">else</span>

      <span class="n">tile</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;DEST&#39;</span><span class="p">)</span>

      <span class="n">targetTile</span> <span class="o">=</span> <span class="n">tile</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- mark tile to throw anything from it</span>

<span class="n">onKeyPress</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">keys</span> <span class="o">~=</span> <span class="n">config</span><span class="p">.</span><span class="n">pushMaxKey</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span> <span class="n">getTileUnderCursor</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">tile</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="p">(</span><span class="n">hold</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">2500</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">cleanTile</span> <span class="ow">and</span> <span class="n">tile</span> <span class="o">~=</span> <span class="n">cleanTile</span> <span class="kr">then</span>

      <span class="n">resetData</span><span class="p">()</span>

    <span class="kr">elseif</span> <span class="ow">not</span> <span class="n">cleanTile</span> <span class="kr">then</span>

      <span class="n">cleanTile</span> <span class="o">=</span> <span class="n">tile</span>

      <span class="n">tile</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;CLEAR&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="n">hold</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onCreaturePositionChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">creature</span><span class="p">,</span> <span class="n">newPos</span><span class="p">,</span> <span class="n">oldPos</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">creature</span> <span class="o">==</span> <span class="n">player</span> <span class="kr">then</span>

    <span class="n">resetData</span><span class="p">()</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">pushTarget</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">targetTile</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">creature</span> <span class="o">==</span> <span class="n">pushTarget</span> <span class="ow">and</span> <span class="n">newPos</span> <span class="o">==</span> <span class="n">targetTile</span> <span class="kr">then</span>

    <span class="n">resetData</span><span class="p">()</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">enabled</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">pushDelay</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">pushDelay</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">rune</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">pushMaxRuneId</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">customMwall</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">mwallBlockId</span>

  <span class="kr">if</span> <span class="n">cleanTile</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">tilePos</span> <span class="o">=</span> <span class="n">cleanTile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">pPos</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">isOk</span><span class="p">(</span><span class="n">tilePos</span><span class="p">,</span> <span class="n">pPos</span><span class="p">)</span> <span class="kr">then</span>

      <span class="n">resetData</span><span class="p">()</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">cleanTile</span><span class="p">:</span><span class="n">hasCreature</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">tiles</span> <span class="o">=</span> <span class="n">getNearTiles</span><span class="p">(</span><span class="n">tilePos</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">destTile</span>

    <span class="kd">local</span> <span class="n">forbidden</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">-- unfortunately double loop</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tiles</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">minimapColor</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getMinimapColor</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

      <span class="kd">local</span> <span class="n">stairs</span> <span class="o">=</span> <span class="p">(</span><span class="n">minimapColor</span> <span class="o">&gt;=</span> <span class="mi">210</span> <span class="ow">and</span> <span class="n">minimapColor</span> <span class="o">&lt;=</span> <span class="mi">213</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">stairs</span> <span class="kr">then</span>

        <span class="nb">table.insert</span><span class="p">(</span><span class="n">forbidden</span><span class="p">,</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">tiles</span><span class="p">)</span> <span class="kr">do</span>

      <span class="kd">local</span> <span class="n">minimapColor</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getMinimapColor</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

      <span class="kd">local</span> <span class="n">stairs</span> <span class="o">=</span> <span class="p">(</span><span class="n">minimapColor</span> <span class="o">&gt;=</span> <span class="mi">210</span> <span class="ow">and</span> <span class="n">minimapColor</span> <span class="o">&lt;=</span> <span class="mi">213</span><span class="p">)</span>

      <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">isWalkable</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isNotOk</span><span class="p">(</span><span class="n">fieldTable</span><span class="p">,</span> <span class="n">tile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tile</span><span class="p">:</span><span class="n">hasCreature</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stairs</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">tooClose</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="kr">if</span> <span class="o">#</span><span class="n">forbidden</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

          <span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">#</span><span class="n">forbidden</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">forbidden</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="kr">if</span> <span class="n">isOk</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="kr">then</span>

              <span class="n">tooClose</span> <span class="o">=</span> <span class="kc">true</span>

              <span class="kr">break</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">tooClose</span> <span class="kr">then</span>

          <span class="n">destTile</span> <span class="o">=</span> <span class="n">tile</span>

          <span class="kr">break</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">destTile</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">parcel</span> <span class="o">=</span> <span class="n">cleanTile</span><span class="p">:</span><span class="n">getCreatures</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

    <span class="kr">if</span> <span class="n">parcel</span> <span class="kr">then</span>

      <span class="n">test</span><span class="p">()</span>

      <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">parcel</span><span class="p">,</span><span class="n">destTile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

      <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">else</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">pushTarget</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">targetTile</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">tilePos</span> <span class="o">=</span> <span class="n">targetTile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">targetPos</span> <span class="o">=</span> <span class="n">pushTarget</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">isOk</span><span class="p">(</span><span class="n">tilePos</span><span class="p">,</span><span class="n">targetPos</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">tileOfTarget</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">targetPos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">targetTile</span><span class="p">:</span><span class="n">isWalkable</span><span class="p">()</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">topThing</span> <span class="o">=</span> <span class="n">targetTile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">topThing</span> <span class="o">==</span> <span class="mi">2129</span> <span class="ow">or</span> <span class="n">topThing</span> <span class="o">==</span> <span class="mi">2130</span> <span class="ow">or</span> <span class="n">topThing</span> <span class="o">==</span> <span class="n">customMwall</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">targetTile</span><span class="p">:</span><span class="n">getTimer</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">pushDelay</span><span class="o">+</span><span class="mi">500</span> <span class="kr">then</span>

          <span class="n">vBot</span><span class="p">.</span><span class="n">isUsing</span> <span class="o">=</span> <span class="kc">true</span>

          <span class="n">schedule</span><span class="p">(</span><span class="n">pushDelay</span><span class="o">+</span><span class="mi">700</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

            <span class="n">vBot</span><span class="p">.</span><span class="n">isUsing</span> <span class="o">=</span> <span class="kc">false</span>

          <span class="kr">end</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">targetTile</span><span class="p">:</span><span class="n">getTimer</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">pushDelay</span> <span class="kr">then</span>

          <span class="kr">return</span>

        <span class="kr">end</span>

      <span class="kr">else</span>

        <span class="kr">return</span> <span class="n">resetData</span><span class="p">()</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">tileOfTarget</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">():</span><span class="n">isNotMoveable</span><span class="p">()</span> <span class="ow">and</span> <span class="n">targetTile</span><span class="p">:</span><span class="n">getTimer</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">pushDelay</span><span class="o">+</span><span class="mi">500</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">rune</span><span class="p">,</span> <span class="n">pushTarget</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">isNotOk</span><span class="p">(</span><span class="n">fieldTable</span><span class="p">,</span> <span class="n">targetTile</span><span class="p">)</span> <span class="kr">then</span>

      <span class="kr">if</span> <span class="n">targetTile</span><span class="p">:</span><span class="n">canShoot</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="mi">3148</span><span class="p">,</span> <span class="n">targetTile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">())</span>

      <span class="kr">else</span>

        <span class="kr">return</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

      <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">pushTarget</span><span class="p">,</span><span class="n">tilePos</span><span class="p">)</span>

      <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pushmax-otui">
<h1>pushmax.otui<a class="headerlink" href="#pushmax-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
PushMaxWindow &lt; MainWindow

  !text: tr(&#39;Pushmax Settings&#39;)

  size: 200 240

  @onEscape: self:hide()

  BotLabel

    id: delayText

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.right: parent.right

    text-align: center

  HorizontalScrollBar

    id: delay

    anchors.left: delayText.left

    anchors.right: delayText.right

    anchors.top: delayText.bottom

    margin-top: 5

    minimum: 800

    maximum: 2000

    step: 10

  Label

    id: label2

    anchors.top: delay.bottom

    anchors.left: parent.horizontalCenter

    anchors.right: parent.right

    text-align: center

    text: Custom WallID

    margin-top: 5

  Label

    id: label3

    anchors.top: delay.bottom

    anchors.right: parent.horizontalCenter

    anchors.left: parent.left

    text-align: center

    text: VS AntiPush

    margin-top: 5

  BotItem

    id: runeId

    anchors.horizontalCenter: label3.horizontalCenter

    anchors.top: label3.bottom

    margin-top: 5

  BotItem

    id: mwallId

    anchors.horizontalCenter: label2.horizontalCenter

    anchors.top: label2.bottom

    margin-top: 5

  Label

    id: label1

    anchors.top: mwallId.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 10

    text-align: center

    text: Hotkey for PUSHMAX

  TextEdit

    id: hotkey

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: label1.bottom

    margin-top: 5

    text-align: center

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-top: 15

    margin-right: 5

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="quiver-label-lua">
<h1>quiver_label.lua<a class="headerlink" href="#quiver-label-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">quiverSlot</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_inventory</span><span class="p">.</span><span class="n">inventoryWindow</span><span class="p">:</span><span class="n">recursiveGetChildById</span><span class="p">(</span><span class="s1">&#39;slot5&#39;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">quiverSlot</span><span class="p">.</span><span class="n">count</span>

<span class="n">label</span> <span class="o">=</span> <span class="n">label</span> <span class="ow">or</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">loadUIFromString</span><span class="p">(</span><span class="s">[[</span>

<span class="s">Label</span>

<span class="s">  id: count</span>

<span class="s">  color: #bfbfbf</span>

<span class="s">  font: verdana-11px-rounded</span>

<span class="s">  anchors.left: parent.left</span>

<span class="s">  anchors.right: parent.right</span>

<span class="s">  anchors.bottom: parent.bottom</span>

<span class="s">  text-align: right</span>

<span class="s">  margin-right: 3</span>

<span class="s">  margin-left: 3</span>

<span class="s">  text:</span>

<span class="s">]]</span><span class="p">,</span> <span class="n">quiverSlot</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">getQuiverAmount</span><span class="p">()</span>

    <span class="c1">-- old tibia</span>

    <span class="kr">if</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">isQuiverEquipped</span> <span class="o">=</span> <span class="n">getRight</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getRight</span><span class="p">():</span><span class="n">isContainer</span><span class="p">()</span> <span class="ow">or</span> <span class="kc">false</span>

    <span class="kd">local</span> <span class="n">quiver</span> <span class="o">=</span> <span class="n">isQuiverEquipped</span> <span class="ow">and</span> <span class="n">getContainerByItem</span><span class="p">(</span><span class="n">getRight</span><span class="p">():</span><span class="n">getId</span><span class="p">())</span>

    <span class="kd">local</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="n">quiver</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">quiver</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">()</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">getQuiverAmount</span><span class="p">()</span>

<span class="n">onContainerOpen</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">previousContainer</span><span class="p">)</span>

    <span class="n">getQuiverAmount</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onContainerClose</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

    <span class="n">getQuiverAmount</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onAddItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

    <span class="n">getQuiverAmount</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onRemoveItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="n">getQuiverAmount</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onContainerUpdateItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

    <span class="n">getQuiverAmount</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="quiver-manager-lua">
<h1>quiver_manager.lua<a class="headerlink" href="#quiver-manager-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">if</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">voc</span><span class="p">()</span> <span class="o">==</span> <span class="mi">12</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">bows</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">3350</span><span class="p">,</span> <span class="mi">31581</span><span class="p">,</span> <span class="mi">27455</span><span class="p">,</span> <span class="mi">8027</span><span class="p">,</span> <span class="mi">20082</span><span class="p">,</span> <span class="mi">36664</span><span class="p">,</span> <span class="mi">7438</span><span class="p">,</span> <span class="mi">28718</span><span class="p">,</span> <span class="mi">36665</span><span class="p">,</span> <span class="mi">14246</span><span class="p">,</span> <span class="mi">19362</span><span class="p">,</span> <span class="mi">35518</span><span class="p">,</span> <span class="mi">34150</span><span class="p">,</span> <span class="mi">29417</span><span class="p">,</span> <span class="mi">9378</span><span class="p">,</span> <span class="mi">16164</span><span class="p">,</span> <span class="mi">22866</span><span class="p">,</span> <span class="mi">12733</span><span class="p">,</span> <span class="mi">8029</span><span class="p">,</span> <span class="mi">20083</span><span class="p">,</span> <span class="mi">20084</span><span class="p">,</span> <span class="mi">8026</span><span class="p">,</span> <span class="mi">8028</span><span class="p">,</span> <span class="mi">34088</span><span class="p">}</span>

    <span class="kd">local</span> <span class="n">xbows</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">30393</span><span class="p">,</span> <span class="mi">3349</span><span class="p">,</span> <span class="mi">27456</span><span class="p">,</span> <span class="mi">20085</span><span class="p">,</span> <span class="mi">16163</span><span class="p">,</span> <span class="mi">5947</span><span class="p">,</span> <span class="mi">8021</span><span class="p">,</span> <span class="mi">14247</span><span class="p">,</span> <span class="mi">22867</span><span class="p">,</span> <span class="mi">8023</span><span class="p">,</span> <span class="mi">22711</span><span class="p">,</span> <span class="mi">19356</span><span class="p">,</span> <span class="mi">20086</span><span class="p">,</span> <span class="mi">20087</span><span class="p">,</span> <span class="mi">34089</span><span class="p">}</span>

    <span class="kd">local</span> <span class="n">arrows</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">16143</span><span class="p">,</span> <span class="mi">763</span><span class="p">,</span> <span class="mi">761</span><span class="p">,</span> <span class="mi">7365</span><span class="p">,</span> <span class="mi">3448</span><span class="p">,</span> <span class="mi">762</span><span class="p">,</span> <span class="mi">21470</span><span class="p">,</span> <span class="mi">7364</span><span class="p">,</span> <span class="mi">14251</span><span class="p">,</span> <span class="mi">3447</span><span class="p">,</span> <span class="mi">3449</span><span class="p">,</span> <span class="mi">15793</span><span class="p">,</span> <span class="mi">25757</span><span class="p">,</span> <span class="mi">774</span><span class="p">,</span> <span class="mi">35901</span> <span class="p">}</span>

    <span class="kd">local</span> <span class="n">bolts</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">6528</span><span class="p">,</span> <span class="mi">7363</span><span class="p">,</span> <span class="mi">3450</span><span class="p">,</span> <span class="mi">16141</span><span class="p">,</span> <span class="mi">25758</span><span class="p">,</span> <span class="mi">14252</span><span class="p">,</span> <span class="mi">3446</span><span class="p">,</span> <span class="mi">16142</span><span class="p">,</span> <span class="mi">35902</span> <span class="p">}</span>

    <span class="kd">local</span> <span class="n">hold</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="n">onContainerOpen</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">previousContainer</span><span class="p">)</span>

        <span class="n">hold</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="n">onContainerClose</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

        <span class="n">hold</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="n">onAddItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

        <span class="n">hold</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="n">onRemoveItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="n">hold</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="n">onContainerUpdateItem</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">oldItem</span><span class="p">)</span>

        <span class="n">hold</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="kd">local</span> <span class="kr">function</span> <span class="nf">manageQuiver</span><span class="p">(</span><span class="n">isBowEquipped</span><span class="p">,</span> <span class="n">quiverContainer</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">ammo</span> <span class="o">=</span> <span class="n">isBowEquipped</span> <span class="ow">and</span> <span class="n">arrows</span> <span class="ow">or</span> <span class="n">bolts</span>

        <span class="kd">local</span> <span class="n">dest</span> <span class="o">=</span> <span class="kc">nil</span>

        <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">getContainers</span><span class="p">()</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">container</span> <span class="o">~=</span> <span class="n">quiverContainer</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">containerIsFull</span><span class="p">(</span><span class="n">container</span><span class="p">)</span> <span class="kr">then</span>

                <span class="kd">local</span> <span class="n">cname</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span>

                <span class="kr">if</span> <span class="ow">not</span> <span class="n">cname</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;loot&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cname</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;backpack&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cname</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;bag&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cname</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;chess&quot;</span><span class="p">))</span> <span class="kr">then</span>

                    <span class="n">dest</span> <span class="o">=</span> <span class="n">container</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="c1">-- clearing</span>

        <span class="kr">if</span> <span class="n">dest</span> <span class="kr">then</span>

            <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">quiverContainer</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">ammo</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                    <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">dest</span><span class="p">:</span><span class="n">getSlotPosition</span><span class="p">(</span><span class="n">dest</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">())</span>

                    <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">containerIsFull</span><span class="p">(</span><span class="n">quiverContainer</span><span class="p">)</span> <span class="kr">then</span>

            <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span> <span class="kr">do</span>

                <span class="kr">if</span> <span class="n">container</span> <span class="o">~=</span> <span class="n">quiverContainer</span> <span class="kr">then</span>

                    <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                        <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">ammo</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">())</span> <span class="kr">then</span>

                            <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">quiverContainer</span><span class="p">:</span><span class="n">getSlotPosition</span><span class="p">(</span><span class="n">quiverContainer</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">())</span>

                            <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

                        <span class="kr">end</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

    <span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

    <span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Quiver Manager&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">hold</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span> <span class="c1">-- do nothing if nothing to do</span>

        <span class="kd">local</span> <span class="n">hand</span> <span class="o">=</span> <span class="n">getLeft</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getLeft</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">quiverEquipped</span> <span class="o">=</span> <span class="n">getRight</span><span class="p">()</span> <span class="ow">and</span> <span class="n">getRight</span><span class="p">():</span><span class="n">isContainer</span><span class="p">()</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">hand</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">quiverEquipped</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kd">local</span> <span class="n">quiverContainer</span> <span class="o">=</span> <span class="n">getContainerByItem</span><span class="p">(</span><span class="n">getRight</span><span class="p">():</span><span class="n">getId</span><span class="p">())</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">quiverContainer</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

        <span class="kd">local</span> <span class="n">isBowEquipped</span> <span class="o">=</span> <span class="n">getLeft</span><span class="p">()</span> <span class="ow">and</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">bows</span><span class="p">,</span> <span class="n">hand</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">true</span> <span class="ow">or</span> <span class="kc">false</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">isBowEquipped</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">xbows</span><span class="p">,</span> <span class="n">hand</span><span class="p">)</span> <span class="kr">then</span>

                <span class="kr">return</span> <span class="c1">-- neither bow and xbow is equipped</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">manageQuiver</span><span class="p">(</span><span class="n">isBowEquipped</span><span class="p">,</span> <span class="n">quiverContainer</span><span class="p">)</span> <span class="kr">then</span> <span class="c1">-- if true then it didn&#39;t do anything</span>

            <span class="n">hold</span> <span class="o">=</span> <span class="kc">true</span>

        <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="siolist-otui">
<h1>siolist.otui<a class="headerlink" href="#siolist-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
VocationPanel &lt; Panel

  padding: 3

  image-source: /images/ui/panel_flat

  image-border: 6

  size: 190 55

  Label

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.right: parent.right

    text-align: center

    text: for BotServer, Heal only:

  BotSwitch

    id: ED

    anchors.bottom: parent.bottom

    anchors.left: parent.left

    anchors.right: parent.horizontalCenter

    text: Druids

  BotSwitch

    id: MS

    anchors.bottom: parent.bottom

    anchors.left: parent.horizontalCenter

    anchors.right: parent.right

    text: Sorcerers

  BotSwitch

    id: EK

    anchors.bottom: ED.top

    anchors.left: parent.left

    anchors.right: parent.horizontalCenter

    text: Knights

  BotSwitch

    id: RP

    anchors.bottom: ED.top

    anchors.left: parent.horizontalCenter

    anchors.right: parent.right

    text: Paladins

SioListWindow &lt; MainWindow

  !text: tr(&#39;Healer Options&#39;)

  size: 220 360

  @onEscape: self:hide()

  BotSwitch

    id: exuraSio

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.right: parent.horizontalCenter

    text: Exura Sio

    margin-right: 2

  BotSwitch

    id: exuraGranSio

    anchors.top: parent.top

    anchors.left: prev.right

    anchors.right: parent.right

    text: Exura Gran Sio

    margin-left: 2

  BotSwitch

    id: exuraMasRes

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    text: Exura Gran Mas Res

    margin-top: 3

  BotSwitch

    id: spell

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    text: Custom Spell

    margin-top: 3

    text-align: center

  BotTextEdit

    id: spellName

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 3

  HorizontalSeparator

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 10

  BotItem

    id: itemId

    anchors.top: prev.bottom

    anchors.left: parent.left

    margin-top: 10

  BotSwitch

    id: item

    anchors.top: prev.top

    anchors.left: prev.right

    anchors.right: parent.right

    anchors.bottom: prev.verticalCenter

    text-align: center

    text: Item Healing

    margin-left: 2

  BotLabel

    id: distText

    anchors.top: itemId.verticalCenter

    anchors.left: itemId.right

    anchors.right: parent.right

    anchors.bottom: itemId.bottom

    text-align: center

    text: Max Distance

  HorizontalScrollBar

    id: Distance

    anchors.left: parent.left

    anchors.top: itemId.bottom

    anchors.right: parent.right

    margin-top: 3

    minimum: 1

    maximum: 10

    step: 1

  HorizontalSeparator

    anchors.top: prev.bottom

    anchors.left: parent.left

    anchors.right: parent.right

    margin-top: 8

  BotLabel

    id: manaInfo

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    text-align: center

    margin-top: 5

  HorizontalScrollBar

    id: minMana

    anchors.left: spellName.left

    anchors.right: spellName.right

    anchors.top: manaInfo.bottom

    margin-top: 2

    minimum: 1

    maximum: 100

    step: 1

  BotLabel

    id: friendHp

    anchors.left: spellName.left

    anchors.right: spellName.right

    anchors.top: prev.bottom

    text-align: center

    margin-top: 5

  HorizontalScrollBar

    id: minFriendHp

    anchors.left: spellName.left

    anchors.right: spellName.right

    anchors.top: friendHp.bottom

    margin-top: 2

    minimum: 1

    maximum: 100

    step: 1

  VocationPanel

    id: vocation

    anchors.top: prev.bottom

    margin-top: 6

  HorizontalSeparator

    id: separator

    anchors.right: parent.right

    anchors.left: parent.left

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-top: 15

    margin-right: 5

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="spy-level-lua">
<h1>spy_level.lua<a class="headerlink" href="#spy-level-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- config</span>

<span class="kd">local</span> <span class="n">keyUp</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span>

<span class="kd">local</span> <span class="n">keyDown</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

<span class="c1">-- script</span>

<span class="kd">local</span> <span class="n">lockedLevel</span> <span class="o">=</span> <span class="n">pos</span><span class="p">().</span><span class="n">z</span>

<span class="n">onPlayerPositionChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">newPos</span><span class="p">,</span> <span class="n">oldPos</span><span class="p">)</span>

    <span class="n">lockedLevel</span> <span class="o">=</span> <span class="n">pos</span><span class="p">().</span><span class="n">z</span>

    <span class="n">modules</span><span class="p">.</span><span class="n">game_interface</span><span class="p">.</span><span class="n">getMapPanel</span><span class="p">():</span><span class="n">unlockVisibleFloor</span><span class="p">()</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onKeyPress</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">keys</span> <span class="o">==</span> <span class="n">keyDown</span> <span class="kr">then</span>

        <span class="n">lockedLevel</span> <span class="o">=</span> <span class="n">lockedLevel</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">modules</span><span class="p">.</span><span class="n">game_interface</span><span class="p">.</span><span class="n">getMapPanel</span><span class="p">():</span><span class="n">lockVisibleFloor</span><span class="p">(</span><span class="n">lockedLevel</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="n">keys</span> <span class="o">==</span> <span class="n">keyUp</span> <span class="kr">then</span>

        <span class="n">lockedLevel</span> <span class="o">=</span> <span class="n">lockedLevel</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">modules</span><span class="p">.</span><span class="n">game_interface</span><span class="p">.</span><span class="n">getMapPanel</span><span class="p">():</span><span class="n">lockVisibleFloor</span><span class="p">(</span><span class="n">lockedLevel</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="supplies-lua">
<h1>supplies.lua<a class="headerlink" href="#supplies-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Cave&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">panelName</span> <span class="o">=</span> <span class="s2">&quot;supplies&quot;</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="ow">or</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">item1</span> <span class="kr">then</span>

  <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">currentProfile</span> <span class="o">=</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span>

    <span class="p">[</span><span class="s2">&quot;Default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="p">}</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">convertOldConfig</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">config</span> <span class="ow">and</span> <span class="n">config</span><span class="p">.</span><span class="n">items</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">config</span>

  <span class="kr">end</span> <span class="c1">-- config is new</span>

  <span class="kd">local</span> <span class="n">newConfig</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">items</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="n">capSwitch</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">capSwitch</span><span class="p">,</span>

    <span class="n">SoftBoots</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">SoftBoots</span><span class="p">,</span>

    <span class="n">imbues</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">imbues</span><span class="p">,</span>

    <span class="n">staminaSwitch</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">staminaSwitch</span><span class="p">,</span>

    <span class="n">capValue</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">capValue</span><span class="p">,</span>

    <span class="n">staminaValue</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">staminaValue</span>

<span class="p">}</span>

  <span class="kd">local</span> <span class="n">items</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item1</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item2</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item3</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item4</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item5</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item6</span>

<span class="p">}</span>

  <span class="kd">local</span> <span class="n">mins</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item1Min</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item2Min</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item3Min</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item4Min</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item5Min</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item6Min</span>

<span class="p">}</span>

  <span class="kd">local</span> <span class="n">maxes</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item1Max</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item2Max</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item3Max</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item4Max</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item5Max</span><span class="p">,</span>

    <span class="n">config</span><span class="p">.</span><span class="n">item6Max</span>

<span class="p">}</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">item</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">min</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="n">maxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="n">newConfig</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">min</span> <span class="o">=</span> <span class="n">min</span><span class="p">,</span>

        <span class="n">max</span> <span class="o">=</span> <span class="n">max</span><span class="p">,</span>

        <span class="n">avg</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">}</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">newConfig</span>

<span class="kr">end</span>

<span class="c1">-- convert old configs</span>

<span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">profile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">])</span> <span class="kr">do</span>

  <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;table&#39;</span> <span class="kr">then</span>

    <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">convertOldConfig</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">currentProfile</span> <span class="o">=</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">currentProfile</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="n">currentProfile</span><span class="p">]</span>

<span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;supply&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span> <span class="kr">then</span>

  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">])</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

      <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">currentProfile</span> <span class="o">=</span> <span class="n">k</span>

      <span class="n">config</span> <span class="o">=</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>

      <span class="kr">break</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">getEmptyItemPanels</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span>

  <span class="kd">local</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">panel</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="n">count</span> <span class="o">=</span> <span class="n">child</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;blank&quot;</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">count</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">count</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">deleteFirstEmptyPanel</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">panel</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">child</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;blank&quot;</span> <span class="kr">then</span>

      <span class="n">child</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

      <span class="kr">break</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">clearEmptyPanels</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span>

  <span class="kr">if</span> <span class="n">panel</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

    <span class="kr">if</span> <span class="n">getEmptyItemPanels</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

      <span class="n">deleteFirstEmptyPanel</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">addItemPanel</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span>

  <span class="kd">local</span> <span class="n">childs</span> <span class="o">=</span> <span class="n">parent</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;ItemPanel&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">id</span>

  <span class="kd">local</span> <span class="n">min</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">min</span>

  <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">max</span>

  <span class="kd">local</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">avg</span>

  <span class="n">panel</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="s2">&quot;blank&quot;</span><span class="p">)</span>

  <span class="n">item</span><span class="p">:</span><span class="n">setShowCount</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

  <span class="n">item</span><span class="p">.</span><span class="n">onItemChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="n">widget</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">panelId</span> <span class="o">=</span> <span class="n">panel</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

    <span class="c1">-- empty, verify</span>

    <span class="kr">if</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="kr">then</span>

      <span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">panelId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

      <span class="n">panel</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="s2">&quot;blank&quot;</span><span class="p">)</span>

      <span class="n">clearEmptyPanels</span><span class="p">()</span> <span class="c1">-- clear empty panels if any</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="c1">-- itemId was not changed, ignore</span>

    <span class="kr">if</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">panelId</span><span class="p">)</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="c1">-- check if isnt already added</span>

    <span class="kr">if</span> <span class="n">config</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="kr">then</span>

      <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;vBot[Drop Tracker]: Item already added!&quot;</span><span class="p">)</span>

      <span class="n">widget</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

      <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="c1">-- new item id</span>

    <span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span> <span class="ow">or</span> <span class="p">{}</span> <span class="c1">-- min, max, avg</span>

    <span class="n">panel</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="n">addItemPanel</span><span class="p">()</span> <span class="c1">-- add new panel</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">panel</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWindow</span><span class="p">(</span><span class="s2">&quot;SuppliesWindow&quot;</span><span class="p">)</span>

<span class="n">SuppliesWindow</span><span class="p">:</span><span class="n">hide</span><span class="p">()</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>

  <span class="s2">&quot;Supply Settings&quot;</span><span class="p">,</span>

  <span class="kr">function</span><span class="p">()</span>

    <span class="n">SuppliesWindow</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="n">SuppliesWindow</span><span class="p">:</span><span class="n">isVisible</span><span class="p">())</span>

  <span class="kr">end</span>

<span class="p">)</span>

<span class="c1">-- load settings</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">loadSettings</span><span class="p">()</span>

  <span class="c1">-- panels</span>

  <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">id</span><span class="p">,</span> <span class="n">data</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">addItemPanel</span><span class="p">()</span>

    <span class="n">widget</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="nb">tonumber</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">min</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">min</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">max</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">max</span><span class="p">)</span>

    <span class="n">widget</span><span class="p">.</span><span class="n">avg</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">avg</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="n">addItemPanel</span><span class="p">()</span> <span class="c1">-- add empty panel</span>

  <span class="c1">-- switches and values</span>

  <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">capSwitch</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">capSwitch</span><span class="p">)</span>

  <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">SoftBoots</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">SoftBoots</span><span class="p">)</span>

  <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">imbues</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">imbues</span><span class="p">)</span>

  <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">staminaSwitch</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">staminaSwitch</span><span class="p">)</span>

  <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">capValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">capValue</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

  <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">staminaValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">staminaValue</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">loadSettings</span><span class="p">()</span>

<span class="c1">-- save settings</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">onVisibilityChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">visible</span> <span class="kr">then</span>

    <span class="kd">local</span> <span class="n">currentProfile</span> <span class="o">=</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">currentProfile</span>

    <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="n">currentProfile</span><span class="p">].</span><span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kd">local</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span>

    <span class="c1">-- items</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">panel</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">parent</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

      <span class="kr">if</span> <span class="n">panel</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">getItemId</span><span class="p">())</span>

        <span class="kd">local</span> <span class="n">min</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">min</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">max</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">avg</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

        <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="n">currentProfile</span><span class="p">].</span><span class="n">items</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

          <span class="n">min</span> <span class="o">=</span> <span class="n">min</span><span class="p">,</span>

          <span class="n">max</span> <span class="o">=</span> <span class="n">max</span><span class="p">,</span>

          <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span>

<span class="p">}</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;supply&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">refreshProfileList</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">profiles</span> <span class="o">=</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">]</span>

  <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">profiles</span><span class="p">:</span><span class="n">destroyChildren</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">profiles</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">label</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s2">&quot;ProfileLabel&quot;</span><span class="p">,</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">profiles</span><span class="p">)</span>

      <span class="n">label</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

      <span class="n">label</span><span class="p">:</span><span class="n">setTooltip</span><span class="p">(</span><span class="s2">&quot;Click to load this profile. </span><span class="se">\n</span><span class="s2">Double click to change the name.&quot;</span><span class="p">)</span>

      <span class="n">label</span><span class="p">.</span><span class="n">remove</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">childs</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">profiles</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">childs</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

          <span class="kr">return</span> <span class="n">info</span><span class="p">(</span><span class="s2">&quot;vBot[Supplies] You need at least one profile!&quot;</span><span class="p">)</span>

        <span class="kr">end</span>

        <span class="n">profiles</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

        <span class="n">label</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>

        <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;supply&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">label</span><span class="p">.</span><span class="n">onDoubleClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="kd">local</span> <span class="n">window</span> <span class="o">=</span>

          <span class="n">modules</span><span class="p">.</span><span class="n">client_textedit</span><span class="p">.</span><span class="n">show</span><span class="p">(</span>

          <span class="n">widget</span><span class="p">,</span>

          <span class="p">{</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Set Profile Name&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Enter a new name for selected profile&quot;</span><span class="p">}</span>

<span class="p">)</span>

        <span class="n">schedule</span><span class="p">(</span>

          <span class="mi">50</span><span class="p">,</span>

          <span class="kr">function</span><span class="p">()</span>

            <span class="n">window</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

            <span class="n">window</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

          <span class="kr">end</span>

<span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">label</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">currentProfile</span> <span class="o">=</span> <span class="n">label</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="n">label</span><span class="p">:</span><span class="n">getText</span><span class="p">()]</span>

        <span class="n">loadSettings</span><span class="p">()</span>

        <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;supply&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

      <span class="n">label</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="n">currentProfile</span> <span class="o">=</span> <span class="n">text</span>

        <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">currentProfile</span> <span class="o">=</span> <span class="n">text</span>

        <span class="n">profiles</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">profiles</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">profiles</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

        <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;supply&quot;</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">refreshProfileList</span><span class="p">()</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">setProfileFocus</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">profiles</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">v</span><span class="p">:</span><span class="n">getText</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">].</span><span class="n">currentProfile</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="n">v</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">setProfileFocus</span><span class="p">()</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">newProfile</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">profiles</span><span class="p">:</span><span class="n">getChildCount</span><span class="p">()</span>

  <span class="kr">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">info</span><span class="p">(</span><span class="s2">&quot;vBot[Supplies] - max profile count reached!&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Profile #&quot;</span> <span class="o">..</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>

  <span class="n">SuppliesConfig</span><span class="p">[</span><span class="n">panelName</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">items</span> <span class="o">=</span> <span class="p">{}}</span>

  <span class="n">refreshProfileList</span><span class="p">()</span>

  <span class="n">setProfileFocus</span><span class="p">()</span>

  <span class="n">vBotConfigSave</span><span class="p">(</span><span class="s2">&quot;supply&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">capSwitch</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">config</span><span class="p">.</span><span class="n">capSwitch</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">capSwitch</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">capSwitch</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">SoftBoots</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">config</span><span class="p">.</span><span class="n">SoftBoots</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">SoftBoots</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">SoftBoots</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">imbues</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">config</span><span class="p">.</span><span class="n">imbues</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">imbues</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">imbues</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">staminaSwitch</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="n">config</span><span class="p">.</span><span class="n">staminaSwitch</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">staminaSwitch</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setOn</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">staminaSwitch</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">capValue</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">capValue</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="kr">then</span>

    <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">capValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">capValue</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kr">else</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;0*(%d+)&quot;</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">capValue</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">staminaValue</span><span class="p">.</span><span class="n">onTextChange</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">staminaValue</span><span class="p">:</span><span class="n">getText</span><span class="p">())</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="kr">then</span>

    <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">staminaValue</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">staminaValue</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="kr">else</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;0*(%d+)&quot;</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="n">staminaValue</span> <span class="o">=</span> <span class="n">text</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">increment</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">panel</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">panel</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">max</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">avg</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">avg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">max</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">max</span> <span class="o">+</span> <span class="n">avg</span><span class="p">)</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">decrement</span><span class="p">.</span><span class="n">onClick</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">panel</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">panel</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">max</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">avg</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kr">if</span> <span class="n">avg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="n">panel</span><span class="p">.</span><span class="n">max</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="nb">math.max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max</span> <span class="o">-</span> <span class="n">avg</span><span class="p">))</span> <span class="c1">-- dont go below 0</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">increment</span><span class="p">.</span><span class="n">onMouseWheel</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">mousePos</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">dir</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

    <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">increment</span><span class="p">.</span><span class="n">onClick</span><span class="p">()</span>

  <span class="kr">elseif</span> <span class="n">dir</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

    <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">decrement</span><span class="p">.</span><span class="n">onClick</span><span class="p">()</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">decrement</span><span class="p">.</span><span class="n">onMouseWheel</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">increment</span><span class="p">.</span><span class="n">onMouseWheel</span>

<span class="n">Supplies</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- public functions</span>

<span class="n">Supplies</span><span class="p">.</span><span class="n">show</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="n">SuppliesWindow</span><span class="p">:</span><span class="n">show</span><span class="p">()</span>

  <span class="n">SuppliesWindow</span><span class="p">:</span><span class="n">raise</span><span class="p">()</span>

  <span class="n">SuppliesWindow</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

<span class="kr">end</span>

<span class="n">Supplies</span><span class="p">.</span><span class="n">getItemsData</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="c1">-- items</span>

  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">panel</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="n">panel</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">getItemId</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="kr">then</span>

      <span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">getItemId</span><span class="p">())</span>

      <span class="kd">local</span> <span class="n">min</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">min</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">max</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">max</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">panel</span><span class="p">.</span><span class="n">avg</span><span class="p">:</span><span class="n">getValue</span><span class="p">()</span>

      <span class="n">t</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

        <span class="n">min</span> <span class="o">=</span> <span class="n">min</span><span class="p">,</span>

        <span class="n">max</span> <span class="o">=</span> <span class="n">max</span><span class="p">,</span>

        <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span>

<span class="p">}</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">t</span>

<span class="kr">end</span>

<span class="n">Supplies</span><span class="p">.</span><span class="n">isSupplyItem</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

  <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Supplies</span><span class="p">.</span><span class="n">getItemsData</span><span class="p">()</span>

  <span class="n">id</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

  <span class="kr">if</span> <span class="n">data</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="kr">then</span>

    <span class="kr">return</span> <span class="n">data</span><span class="p">[</span><span class="n">id</span><span class="p">]</span>

  <span class="kr">else</span>

    <span class="kr">return</span> <span class="kc">false</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">Supplies</span><span class="p">.</span><span class="n">hasEnough</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Supplies</span><span class="p">.</span><span class="n">getItemsData</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">id</span><span class="p">,</span> <span class="n">values</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="kr">do</span>

    <span class="n">id</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">minimum</span> <span class="o">=</span> <span class="n">values</span><span class="p">.</span><span class="n">min</span>

    <span class="kd">local</span> <span class="n">current</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">minimum</span> <span class="kr">then</span>

      <span class="kr">return</span> <span class="p">{</span><span class="n">id</span><span class="o">=</span><span class="n">id</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">current</span><span class="p">}</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

  <span class="kr">return</span> <span class="kc">true</span>

<span class="kr">end</span>

<span class="n">hasSupplies</span> <span class="o">=</span> <span class="n">Supplies</span><span class="p">.</span><span class="n">hasEnough</span>

<span class="n">Supplies</span><span class="p">.</span><span class="n">setAverageValues</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

  <span class="kr">for</span> <span class="n">id</span><span class="p">,</span> <span class="n">amount</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">SuppliesWindow</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">id</span><span class="p">]</span>

    <span class="kr">if</span> <span class="n">widget</span> <span class="kr">then</span>

      <span class="n">widget</span><span class="p">.</span><span class="n">avg</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span>

<span class="n">Supplies</span><span class="p">.</span><span class="n">addSupplyItem</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">avg</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">id</span> <span class="kr">then</span>

    <span class="kr">return</span>

  <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">widget</span> <span class="o">=</span> <span class="n">addItemPanel</span><span class="p">()</span>

  <span class="n">widget</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">id</span><span class="p">:</span><span class="n">setItemId</span><span class="p">(</span><span class="nb">tonumber</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">min</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">min</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">max</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">max</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

  <span class="n">widget</span><span class="p">.</span><span class="n">avg</span><span class="p">:</span><span class="n">setText</span><span class="p">(</span><span class="n">avg</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

<span class="kr">end</span>

<span class="n">Supplies</span><span class="p">.</span><span class="n">getAdditionalData</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">stamina</span> <span class="o">=</span> <span class="p">{</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">staminaSwitch</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">staminaValue</span><span class="p">},</span>

    <span class="n">capacity</span> <span class="o">=</span> <span class="p">{</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">capSwitch</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">capValue</span><span class="p">},</span>

    <span class="n">softBoots</span> <span class="o">=</span> <span class="p">{</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">SoftBoots</span><span class="p">},</span>

    <span class="n">imbues</span> <span class="o">=</span> <span class="p">{</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">imbues</span><span class="p">}</span>

<span class="p">}</span>

  <span class="kr">return</span> <span class="n">data</span>

<span class="kr">end</span>

<span class="n">Supplies</span><span class="p">.</span><span class="n">getFullData</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">Supplies</span><span class="p">.</span><span class="n">getItemsData</span><span class="p">(),</span>

    <span class="n">additional</span> <span class="o">=</span> <span class="n">Supplies</span><span class="p">.</span><span class="n">getAdditionalData</span><span class="p">()</span>

<span class="p">}</span>

  <span class="kr">return</span> <span class="n">data</span>

<span class="kr">end</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="supplies-otui">
<h1>supplies.otui<a class="headerlink" href="#supplies-otui" title="Link to this heading">#</a></h1>
<div class="highlight-otui notranslate"><div class="highlight"><pre><span></span>
ProfileLabel &lt; UIWidget

  background-color: alpha

  text-offset: 3 1

  focusable: true

  height: 16

  font: verdana-11px-rounded

  text-align: left

  $focus:

    background-color: #00000055

  Button

    id: remove

    !text: tr(&#39;X&#39;)

    anchors.right: parent.right

    anchors.verticalCenter: parent.verticalCenter

    width: 14

    height: 14

    margin-right: 3

    text-align: center

    text-offset: 0 1

    tooltip: Remove profile from the list.

SupplySpinBox &lt; SpinBox

  height: 20

  margin-left: 3

  width: 75

  minimum: 0

  maximum: 9999

  text-align: center

  focusable: true

  text: 0

ItemPanel &lt; Panel

  height: 38

  BotItem

    id: id

    anchors.left: parent.left

    anchors.bottom: parent.bottom

  SupplySpinBox

    id: min

    anchors.left: prev.right

    anchors.bottom: parent.bottom

  SupplySpinBox

    id: max

    anchors.left: prev.right

    anchors.bottom: parent.bottom

  SupplySpinBox

    id: avg

    anchors.left: prev.right

    anchors.bottom: parent.bottom

    width: 50

  UIWidget

    anchors.left: min.left

    anchors.bottom: min.top

    width: 75

    text-align: center

    font: verdana-11px-rounded

    text: Min

    tooltip: Amount of given supplies for bot to leave the spawn.

  UIWidget

    anchors.left: max.left

    anchors.bottom: max.top

    width: 75

    text-align: center

    font: verdana-11px-rounded

    text: Max

    tooltip: Amount of given supplies to purchase

  UIWidget

    anchors.left: avg.left

    anchors.bottom: avg.top

    width: 55

    text-align: center

    font: verdana-11px-rounded

    text: AVG

    !tooltip: (&quot;This is average consumption of supplies by round to help calculate the amount to purchase\n (info provided by CaveBot Stats)&quot;)

SuppliesWindow &lt; MainWindow

  !text: tr(&#39;Supplies&#39;)

  size: 430 330

  @onEscape: self:hide()

  VerticalSeparator

    id: sep

    anchors.top: parent.top

    anchors.right: parent.right

    margin-right: 140

    anchors.bottom: bottomSep.top

    margin-bottom: 5

    margin-left: 10

    visible: false

  Label

    anchors.left: sep.right

    anchors.right: parent.right

    anchors.top: parent.top

    margin-left: 10

    margin-top: 3

    text-align: center

    text: Additional Conditions:

  HorizontalSeparator

    anchors.top: prev.bottom

    anchors.left: prev.left

    anchors.right: prev.right

    margin-top: 3

  BotSwitch

    id: SoftBoots

    anchors.top: prev.bottom

    anchors.left: sep.right

    anchors.right: parent.right

    margin-top: 5

    margin-left: 10

    text: No Soft

    tooltip: Go refill if there&#39;s no more active soft boots.

  BotSwitch

    id: capSwitch

    height: 20

    anchors.left: SoftBoots.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 5

    margin-right: 50

    text-align: center

    text: Cap Below:

    tooltip: Go refill if capacity is below set value.

  BotTextEdit

    id: capValue

    size: 40 20

    anchors.left: prev.right

    anchors.right: parent.right

    anchors.top: prev.top

    margin-left: 5

  BotSwitch

    id: staminaSwitch

    height: 20

    anchors.left: SoftBoots.left

    anchors.right: parent.right

    anchors.top: prev.bottom

    margin-top: 5

    margin-right: 50

    text-align: center

    text: Stamina:

    tooltip: Go refill if stamina is below set value. (in minutes)

  BotTextEdit

    id: staminaValue

    size: 40 20

    anchors.left: prev.right

    anchors.right: parent.right

    anchors.top: prev.top

    margin-left: 5

  BotSwitch

    id: imbues

    anchors.top: prev.bottom

    anchors.left: sep.right

    anchors.right: parent.right

    margin-top: 5

    margin-left: 10

    text: No Imbues

    tooltip: Go refill when mana leech imbue has worn off.

  TextList

    id: profiles

    anchors.top: prev.bottom

    margin-top: 5

    anchors.left: prev.left

    anchors.right: prev.right

    anchors.bottom: bottomSep.top

    margin-bottom: 25

  BotButton

    id: newProfile

    anchors.left: prev.left

    anchors.top: prev.bottom

    size: 35 15

    text: New

    font: cipsoftFont

    tooltip: Create new supplies profile.

  VerticalScrollBar

    id: itemsScrollBar

    anchors.top: items.top

    anchors.bottom: items.bottom

    anchors.right: items.right

    step: 14

    pixels-scroll: true

  ScrollablePanel

    id: items

    anchors.top: parent.top

    anchors.left: parent.left

    anchors.right: sep.left

    anchors.bottom: bottomSep.top

    margin-bottom: 8

    vertical-scrollbar: itemsScrollBar

    layout: verticalBox

  HorizontalSeparator

    id: bottomSep

    anchors.left: parent.left

    anchors.right: parent.right

    anchors.bottom: closeButton.top

    margin-bottom: 8

  Button

    id: closeButton

    !text: tr(&#39;Close&#39;)

    font: cipsoftFont

    anchors.right: parent.right

    anchors.bottom: parent.bottom

    size: 45 21

    margin-top: 15

    tooltip: Close supplies window and save settings.

    @onClick: self:getParent():hide()

  Button

    id: increment

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: items.right

    text: +

    width: 50

    tooltip: increase all max supplies amount by average

  Button

    id: decrement

    anchors.verticalCenter: prev.verticalCenter

    anchors.right: prev.left

    margin-right: 3

    text: -

    width: 50

    tooltip: decrease all max supplies amount by average

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="tools-lua">
<h1>tools.lua<a class="headerlink" href="#tools-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- tools tab</span>

<span class="n">setDefaultTab</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>

<span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">moneyItems</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">moneyItems</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3031</span><span class="p">,</span> <span class="mi">3035</span><span class="p">}</span>

<span class="kr">end</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;Exchange money&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">storage</span><span class="p">.</span><span class="n">moneyItems</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="kd">local</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getContainers</span><span class="p">()</span>

  <span class="kr">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">container</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">containers</span><span class="p">)</span> <span class="kr">do</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">container</span><span class="p">.</span><span class="n">lootContainer</span> <span class="kr">then</span> <span class="c1">-- ignore monster containers</span>

      <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">container</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">100</span> <span class="kr">then</span>

          <span class="kr">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">moneyId</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">moneyItems</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">moneyId</span><span class="p">.</span><span class="n">id</span> <span class="kr">then</span>

              <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="kr">end</span>

          <span class="kr">end</span>

        <span class="kr">end</span>

      <span class="kr">end</span>

    <span class="kr">end</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">moneyContainer</span> <span class="o">=</span> <span class="n">UI</span><span class="p">.</span><span class="n">Container</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">moneyItems</span> <span class="o">=</span> <span class="n">items</span>

<span class="kr">end</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

<span class="n">moneyContainer</span><span class="p">:</span><span class="n">setHeight</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>

<span class="n">moneyContainer</span><span class="p">:</span><span class="n">setItems</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">moneyItems</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">60000</span><span class="p">,</span> <span class="s2">&quot;Send message on trade&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

  <span class="kd">local</span> <span class="n">trade</span> <span class="o">=</span> <span class="n">getChannelId</span><span class="p">(</span><span class="s2">&quot;advertising&quot;</span><span class="p">)</span>

  <span class="kr">if</span> <span class="ow">not</span> <span class="n">trade</span> <span class="kr">then</span>

    <span class="n">trade</span> <span class="o">=</span> <span class="n">getChannelId</span><span class="p">(</span><span class="s2">&quot;trade&quot;</span><span class="p">)</span>

  <span class="kr">end</span>

  <span class="kr">if</span> <span class="n">trade</span> <span class="ow">and</span> <span class="n">storage</span><span class="p">.</span><span class="n">autoTradeMessage</span><span class="p">:</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

    <span class="n">sayChannel</span><span class="p">(</span><span class="n">trade</span><span class="p">,</span> <span class="n">storage</span><span class="p">.</span><span class="n">autoTradeMessage</span><span class="p">)</span>

  <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">TextEdit</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">autoTradeMessage</span> <span class="ow">or</span> <span class="s2">&quot;I&#39;m using OTClientV8!&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

  <span class="n">storage</span><span class="p">.</span><span class="n">autoTradeMessage</span> <span class="o">=</span> <span class="n">text</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">UI</span><span class="p">.</span><span class="n">Separator</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="version-txt">
<h1>version.txt<a class="headerlink" href="#version-txt" title="Link to this heading">#</a></h1>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>4.8
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="vlib-lua">
<h1>vlib.lua<a class="headerlink" href="#vlib-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Author: Vithrax</span>

<span class="c1">-- contains mostly basic function shortcuts and code shorteners</span>

<span class="c1">-- initial global variables declaration</span>

<span class="n">vBot</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- global namespace for bot variables</span>

<span class="n">vBot</span><span class="p">.</span><span class="n">BotServerMembers</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">vBot</span><span class="p">.</span><span class="n">standTime</span> <span class="o">=</span> <span class="n">now</span>

<span class="n">vBot</span><span class="p">.</span><span class="n">isUsingPotion</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">vBot</span><span class="p">.</span><span class="n">isUsing</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">vBot</span><span class="p">.</span><span class="n">customCooldowns</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kr">function</span> <span class="nf">logInfo</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">start</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">..</span><span class="s2">&quot; [vBot]: &quot;</span>

    <span class="kr">return</span> <span class="n">modules</span><span class="p">.</span><span class="n">client_terminal</span><span class="p">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">start</span><span class="o">..</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- scripts / functions</span>

<span class="n">onPlayerPositionChange</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

    <span class="n">vBot</span><span class="p">.</span><span class="n">standTime</span> <span class="o">=</span> <span class="n">now</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kr">function</span> <span class="nf">standTime</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">now</span> <span class="o">-</span> <span class="n">vBot</span><span class="p">.</span><span class="n">standTime</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">relogOnCharacter</span><span class="p">(</span><span class="n">charName</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">characters</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">getRootWidget</span><span class="p">().</span><span class="n">charactersWindow</span><span class="p">.</span><span class="n">characters</span>

    <span class="kr">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">child</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">characters</span><span class="p">:</span><span class="n">getChildren</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">child</span><span class="p">:</span><span class="n">getChildren</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span><span class="n">getText</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="n">charName</span><span class="p">:</span><span class="n">lower</span><span class="p">())</span> <span class="kr">then</span>

            <span class="n">child</span><span class="p">:</span><span class="n">focus</span><span class="p">()</span>

            <span class="n">schedule</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">modules</span><span class="p">.</span><span class="n">client_entergame</span><span class="p">.</span><span class="n">CharacterList</span><span class="p">.</span><span class="n">doLogin</span><span class="p">)</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">castSpell</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">canCast</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="kr">then</span>

        <span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">dmgTable</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="n">lastDmgMessage</span> <span class="o">=</span> <span class="n">now</span>

<span class="n">onTextMessage</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;you lose&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">():</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;due to&quot;</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">return</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">dmg</span> <span class="o">=</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;%d+&quot;</span><span class="p">)</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">dmgTable</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">dmgTable</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">v</span><span class="p">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">3000</span> <span class="kr">then</span> <span class="nb">table.remove</span><span class="p">(</span><span class="n">dmgTable</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">lastDmgMessage</span> <span class="o">=</span> <span class="n">now</span>

    <span class="nb">table.insert</span><span class="p">(</span><span class="n">dmgTable</span><span class="p">,</span> <span class="p">{</span><span class="n">d</span> <span class="o">=</span> <span class="n">dmg</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">now</span><span class="p">})</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">3050</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">lastDmgMessage</span> <span class="o">&gt;</span> <span class="mi">3000</span> <span class="kr">then</span> <span class="n">dmgTable</span> <span class="o">=</span> <span class="p">{}</span> <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- based on data collected by callback calculates per second damage</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">burstDamageValue</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">local</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">dmgTable</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">dmgTable</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span> <span class="n">time</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">t</span> <span class="kr">end</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">v</span><span class="p">.</span><span class="n">d</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="p">((</span><span class="n">now</span> <span class="o">-</span> <span class="n">time</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>

<span class="kr">end</span>

<span class="c1">-- simplified function from modules</span>

<span class="c1">-- displays string as white colour message</span>

<span class="kr">function</span> <span class="nf">whiteInfoMessage</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">return</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">displayGameMessage</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">statusMessage</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">logInConsole</span><span class="p">)</span>

    <span class="kr">return</span> <span class="ow">not</span> <span class="n">logInConsole</span> <span class="ow">and</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">displayFailureMessage</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">displayStatusMessage</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- same as above but red message</span>

<span class="kr">function</span> <span class="nf">broadcastMessage</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">return</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_textmessage</span><span class="p">.</span><span class="n">displayBroadcastMessage</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- almost every talk action inside cavebot has to be done by using schedule</span>

<span class="c1">-- therefore this is simplified function that doesn&#39;t require to build a body for schedule function</span>

<span class="kr">function</span> <span class="nf">scheduleNpcSay</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">delay</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">schedule</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">NPC</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="kr">end</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- returns first number in string, already formatted as number</span>

<span class="c1">-- returns number or nil</span>

<span class="kr">function</span> <span class="nf">getFirstNumberInText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">n</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">if</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;%d+&quot;</span><span class="p">)</span> <span class="kr">then</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="nb">string.match</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;%d+&quot;</span><span class="p">))</span> <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">n</span>

<span class="kr">end</span>

<span class="c1">-- function to search if item of given ID can be found on certain tile</span>

<span class="c1">-- first argument is always ID</span>

<span class="c1">-- the rest of aguments can be:</span>

<span class="c1">-- - tile</span>

<span class="c1">-- - position</span>

<span class="c1">-- - or x,y,z coordinates as p1, p2 and p3</span>

<span class="c1">-- returns boolean</span>

<span class="kr">function</span> <span class="nf">isOnTile</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">id</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">tile</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span>

        <span class="n">tile</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>

    <span class="kr">elseif</span> <span class="nb">type</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;number&quot;</span> <span class="kr">then</span>

        <span class="n">tile</span> <span class="o">=</span> <span class="n">p1</span>

    <span class="kr">else</span>

        <span class="kd">local</span> <span class="n">p</span> <span class="o">=</span> <span class="n">getPos</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>

        <span class="n">tile</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">tile</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">v</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span> <span class="n">item</span> <span class="o">=</span> <span class="kc">true</span> <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">item</span>

<span class="kr">end</span>

<span class="c1">-- position is a special table, impossible to compare with normal one</span>

<span class="c1">-- this is translator from x,y,z to proper position value</span>

<span class="c1">-- returns position table</span>

<span class="kr">function</span> <span class="nf">getPos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">y</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">z</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">nil</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">()</span>

    <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

    <span class="n">pos</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>

    <span class="kr">return</span> <span class="n">pos</span>

<span class="kr">end</span>

<span class="c1">-- opens purse... that&#39;s it</span>

<span class="kr">function</span> <span class="nf">openPurse</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getLocalPlayer</span><span class="p">():</span><span class="n">getInventoryItem</span><span class="p">(</span>

                          <span class="n">InventorySlotPurse</span><span class="p">))</span>

<span class="kr">end</span>

<span class="c1">-- check&#39;s whether container is full</span>

<span class="c1">-- c has to be container object</span>

<span class="c1">-- returns boolean</span>

<span class="kr">function</span> <span class="nf">containerIsFull</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">c</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">c</span><span class="p">:</span><span class="n">getCapacity</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">#</span><span class="n">c</span><span class="p">:</span><span class="n">getItems</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">dropItem</span><span class="p">(</span><span class="n">idOrObject</span><span class="p">)</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idOrObject</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="kr">then</span>

        <span class="n">idOrObject</span> <span class="o">=</span> <span class="n">findItem</span><span class="p">(</span><span class="n">idOrObject</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="n">g_game</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">idOrObject</span><span class="p">,</span> <span class="n">pos</span><span class="p">(),</span> <span class="n">idOrObject</span><span class="p">:</span><span class="n">getCount</span><span class="p">())</span>

<span class="kr">end</span>

<span class="c1">-- not perfect function to return whether character has utito tempo buff</span>

<span class="c1">-- known to be bugged if received debuff (ie. roshamuul)</span>

<span class="c1">-- TODO: simply a better version</span>

<span class="c1">-- returns boolean</span>

<span class="kr">function</span> <span class="nf">isBuffed</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">var</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">hasPartyBuff</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">var</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">skillId</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">player</span><span class="p">:</span><span class="n">getSkillBaseLevel</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">player</span><span class="p">:</span><span class="n">getSkillBaseLevel</span><span class="p">(</span><span class="n">skillId</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">skillId</span> <span class="o">=</span> <span class="n">i</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">premium</span> <span class="o">=</span> <span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getSkillLevel</span><span class="p">(</span><span class="n">skillId</span><span class="p">)</span> <span class="o">-</span> <span class="n">player</span><span class="p">:</span><span class="n">getSkillBaseLevel</span><span class="p">(</span><span class="n">skillId</span><span class="p">))</span>

    <span class="kd">local</span> <span class="n">base</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getSkillBaseLevel</span><span class="p">(</span><span class="n">skillId</span><span class="p">)</span>

    <span class="kr">if</span> <span class="p">(</span><span class="n">premium</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">305</span> <span class="o">&gt;</span> <span class="n">base</span> <span class="kr">then</span>

        <span class="n">var</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">var</span>

<span class="kr">end</span>

<span class="c1">-- if using index as table element, this can be used to properly assign new idex to all values</span>

<span class="c1">-- table needs to contain &quot;index&quot; as value</span>

<span class="c1">-- if no index in tables, it will create one</span>

<span class="kr">function</span> <span class="nf">reindexTable</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">t</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">e</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="kr">do</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">e</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">i</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- supports only new tibia, ver 10+</span>

<span class="c1">-- returns how many kills left to get next skull - can be red skull, can be black skull!</span>

<span class="c1">-- reutrns number</span>

<span class="kr">function</span> <span class="nf">killsToRs</span><span class="p">()</span>

    <span class="kr">return</span> <span class="nb">math.min</span><span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getUnjustifiedPoints</span><span class="p">().</span><span class="n">killsDayRemaining</span><span class="p">,</span>

                    <span class="n">g_game</span><span class="p">.</span><span class="n">getUnjustifiedPoints</span><span class="p">().</span><span class="n">killsWeekRemaining</span><span class="p">,</span>

                    <span class="n">g_game</span><span class="p">.</span><span class="n">getUnjustifiedPoints</span><span class="p">().</span><span class="n">killsMonthRemaining</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- calculates exhaust for potions based on &quot;Aaaah...&quot; message</span>

<span class="c1">-- changes state of vBot variable, can be used in other scripts</span>

<span class="c1">-- already used in pushmax, healbot, etc</span>

<span class="n">onTalk</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">name</span> <span class="o">~=</span> <span class="n">player</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">mode</span> <span class="o">~=</span> <span class="mi">34</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Aaaah...&quot;</span> <span class="kr">then</span>

        <span class="n">vBot</span><span class="p">.</span><span class="n">isUsingPotion</span> <span class="o">=</span> <span class="kc">true</span>

        <span class="n">schedule</span><span class="p">(</span><span class="mi">950</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">vBot</span><span class="p">.</span><span class="n">isUsingPotion</span> <span class="o">=</span> <span class="kc">false</span> <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- [[ canCast and cast functions ]] --</span>

<span class="c1">-- callback connected to cast and canCast function</span>

<span class="c1">-- detects if a given spell was in fact casted based on player&#39;s text messages</span>

<span class="c1">-- Cast text and message text must match</span>

<span class="c1">-- checks only spells inserted in SpellCastTable by function cast</span>

<span class="n">SpellCastTable</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">onTalk</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">name</span> <span class="o">~=</span> <span class="n">player</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="kr">then</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">text</span><span class="p">].</span><span class="n">t</span> <span class="o">=</span> <span class="n">now</span> <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- if delay is nil or delay is lower than 100 then this function will act as a normal say function</span>

<span class="c1">-- checks or adds a spell to SpellCastTable and updates cast time if exist</span>

<span class="kr">function</span> <span class="nf">cast</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">delay</span> <span class="ow">or</span> <span class="n">delay</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="c1">-- if not added delay or delay is really low then just treat it like casual say</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="ow">or</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">text</span><span class="p">].</span><span class="n">d</span> <span class="o">~=</span> <span class="n">delay</span> <span class="kr">then</span>

        <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">delay</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">delay</span><span class="p">}</span>

        <span class="kr">return</span> <span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">lastCast</span> <span class="o">=</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">text</span><span class="p">].</span><span class="n">t</span>

    <span class="kd">local</span> <span class="n">spellDelay</span> <span class="o">=</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">text</span><span class="p">].</span><span class="n">d</span>

    <span class="kr">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">lastCast</span> <span class="o">&gt;</span> <span class="n">spellDelay</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- canCast is a base for AttackBot and HealBot</span>

<span class="c1">-- checks if spell is ready to be casted again</span>

<span class="c1">-- ignoreRL - if true, aparat from cooldown will also check conditions inside gamelib SpellInfo table</span>

<span class="c1">-- ignoreCd - it true, will ignore cooldown</span>

<span class="c1">-- returns boolean</span>

<span class="kd">local</span> <span class="n">Spells</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">gamelib</span><span class="p">.</span><span class="n">SpellInfo</span><span class="p">[</span><span class="s1">&#39;Default&#39;</span><span class="p">]</span>

<span class="kr">function</span> <span class="nf">canCast</span><span class="p">(</span><span class="n">spell</span><span class="p">,</span> <span class="n">ignoreRL</span><span class="p">,</span> <span class="n">ignoreCd</span><span class="p">)</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spell</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">spell</span> <span class="o">=</span> <span class="n">spell</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">spell</span><span class="p">]</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">now</span> <span class="o">-</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">spell</span><span class="p">].</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">SpellCastTable</span><span class="p">[</span><span class="n">spell</span><span class="p">].</span><span class="n">d</span> <span class="ow">or</span> <span class="n">ignoreCd</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="kc">true</span>

        <span class="kr">else</span>

            <span class="kr">return</span> <span class="kc">false</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">getSpellData</span><span class="p">(</span><span class="n">spell</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="p">(</span><span class="n">ignoreCd</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">getSpellCoolDown</span><span class="p">(</span><span class="n">spell</span><span class="p">))</span> <span class="ow">and</span>

            <span class="p">(</span><span class="n">ignoreRL</span> <span class="ow">or</span> <span class="n">level</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">getSpellData</span><span class="p">(</span><span class="n">spell</span><span class="p">).</span><span class="n">level</span> <span class="ow">and</span> <span class="n">mana</span><span class="p">()</span> <span class="o">&gt;=</span>

                <span class="n">getSpellData</span><span class="p">(</span><span class="n">spell</span><span class="p">).</span><span class="n">mana</span><span class="p">)</span> <span class="kr">then</span>

            <span class="kr">return</span> <span class="kc">true</span>

        <span class="kr">else</span>

            <span class="kr">return</span> <span class="kc">false</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="c1">-- if no data nor spell table then return true</span>

    <span class="kr">return</span> <span class="kc">true</span>

<span class="kr">end</span>

<span class="kd">local</span> <span class="n">lastPhrase</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">onTalk</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">channelId</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span> <span class="kr">then</span>

        <span class="n">lastPhrase</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="kr">if</span> <span class="n">onSpellCooldown</span> <span class="ow">and</span> <span class="n">onGroupSpellCooldown</span> <span class="kr">then</span>

    <span class="n">onSpellCooldown</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">iconId</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>

        <span class="n">schedule</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

            <span class="kr">if</span> <span class="ow">not</span> <span class="n">vBot</span><span class="p">.</span><span class="n">customCooldowns</span><span class="p">[</span><span class="n">lastPhrase</span><span class="p">]</span> <span class="kr">then</span>

                <span class="n">vBot</span><span class="p">.</span><span class="n">customCooldowns</span><span class="p">[</span><span class="n">lastPhrase</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">id</span> <span class="o">=</span> <span class="n">iconId</span><span class="p">}</span>

            <span class="kr">end</span>

        <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="n">onGroupSpellCooldown</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">iconId</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>

        <span class="n">schedule</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

            <span class="kr">if</span> <span class="n">vBot</span><span class="p">.</span><span class="n">customCooldowns</span><span class="p">[</span><span class="n">lastPhrase</span><span class="p">]</span> <span class="kr">then</span>

                <span class="n">vBot</span><span class="p">.</span><span class="n">customCooldowns</span><span class="p">[</span><span class="n">lastPhrase</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">id</span> <span class="o">=</span> <span class="n">vBot</span><span class="p">.</span><span class="n">customCooldowns</span><span class="p">[</span><span class="n">lastPhrase</span><span class="p">].</span><span class="n">id</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="p">{[</span><span class="n">iconId</span><span class="p">]</span> <span class="o">=</span> <span class="n">duration</span><span class="p">}}</span>

            <span class="kr">end</span>

        <span class="kr">end</span><span class="p">)</span>

    <span class="kr">end</span><span class="p">)</span>

<span class="kr">else</span>

    <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;Outdated OTClient! update to newest version to take benefits from all scripts!&quot;</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- exctracts data about spell from gamelib SpellInfo table</span>

<span class="c1">-- returns table</span>

<span class="c1">-- ie:[&#39;Spell Name&#39;] = {id, words, exhaustion, premium, type, icon, mana, level, soul, group, vocations}</span>

<span class="c1">-- cooldown detection module</span>

<span class="kr">function</span> <span class="nf">getSpellData</span><span class="p">(</span><span class="n">spell</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">spell</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="n">spell</span> <span class="o">=</span> <span class="n">spell</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kd">local</span> <span class="n">c</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">Spells</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">v</span><span class="p">.</span><span class="n">words</span> <span class="o">==</span> <span class="n">spell</span> <span class="kr">then</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">k</span>

            <span class="kr">break</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">t</span> <span class="kr">then</span>

        <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">vBot</span><span class="p">.</span><span class="n">customCooldowns</span><span class="p">)</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">spell</span> <span class="kr">then</span>

                <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="n">id</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">mana</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">group</span><span class="p">}</span>

                <span class="kr">break</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">t</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">Spells</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

    <span class="kr">elseif</span> <span class="n">c</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">c</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- based on info extracted by getSpellData checks if spell is on cooldown</span>

<span class="c1">-- returns boolean</span>

<span class="kr">function</span> <span class="nf">getSpellCoolDown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">nil</span> <span class="kr">end</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">getSpellData</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">icon</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_cooldown</span><span class="p">.</span><span class="n">isCooldownIconActive</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">group</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">for</span> <span class="n">groupId</span><span class="p">,</span> <span class="n">duration</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">group</span><span class="p">)</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">modules</span><span class="p">.</span><span class="n">game_cooldown</span><span class="p">.</span><span class="n">isGroupCooldownIconActive</span><span class="p">(</span><span class="n">groupId</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">group</span> <span class="o">=</span> <span class="kc">true</span>

            <span class="kr">break</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">icon</span> <span class="ow">or</span> <span class="n">group</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- global var to indicate that player is trying to do something</span>

<span class="c1">-- prevents action blocking by scripts</span>

<span class="c1">-- below callbacks are triggers to changing the var state</span>

<span class="kd">local</span> <span class="n">isUsingTime</span> <span class="o">=</span> <span class="n">now</span>

<span class="n">macro</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

    <span class="n">vBot</span><span class="p">.</span><span class="n">isUsing</span> <span class="o">=</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="n">isUsingTime</span> <span class="ow">and</span> <span class="kc">true</span> <span class="ow">or</span> <span class="kc">false</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onUse</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">itemId</span><span class="p">,</span> <span class="n">stackPos</span><span class="p">,</span> <span class="n">subType</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">65000</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">getDistanceBetween</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span> <span class="n">pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">tile</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">topThing</span> <span class="o">=</span> <span class="n">tile</span><span class="p">:</span><span class="n">getTopUseThing</span><span class="p">()</span>

    <span class="kr">if</span> <span class="n">topThing</span><span class="p">:</span><span class="n">isContainer</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="n">isUsingTime</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">1000</span>

<span class="kr">end</span><span class="p">)</span>

<span class="n">onUseWith</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">itemId</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">subType</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">65000</span> <span class="kr">then</span> <span class="n">isUsingTime</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">1000</span> <span class="kr">end</span>

<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- returns first word in string</span>

<span class="kr">function</span> <span class="nc">string</span><span class="p">.</span><span class="nf">starts</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">Start</span><span class="p">)</span>

    <span class="kr">return</span> <span class="nb">string.sub</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">string.len</span><span class="p">(</span><span class="n">Start</span><span class="p">))</span> <span class="o">==</span> <span class="n">Start</span>

<span class="kr">end</span>

<span class="c1">-- global tables for cached players to prevent unnecesary resource consumption</span>

<span class="c1">-- probably still can be improved, TODO in future</span>

<span class="c1">-- c can be creature or string</span>

<span class="c1">-- if exected then adds name or name and creature to tables</span>

<span class="c1">-- returns boolean</span>

<span class="n">CachedFriends</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">CachedEnemies</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kr">function</span> <span class="nf">isFriend</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">c</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">player</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">true</span> <span class="kr">end</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">CachedFriends</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">true</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">CachedEnemies</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">friendList</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="kr">then</span>

        <span class="n">CachedFriends</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">elseif</span> <span class="n">vBot</span><span class="p">.</span><span class="n">BotServerMembers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>

        <span class="n">CachedFriends</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">elseif</span> <span class="n">storage</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">groupMembers</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">p</span> <span class="o">=</span> <span class="n">c</span>

        <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span> <span class="n">p</span> <span class="o">=</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">p</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">true</span> <span class="kr">end</span>

        <span class="kr">if</span> <span class="n">p</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">p</span><span class="p">:</span><span class="n">isPartyMember</span><span class="p">()</span> <span class="kr">then</span>

                <span class="n">CachedFriends</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>

                <span class="n">CachedFriends</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>

                <span class="kr">return</span> <span class="kc">true</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- similar to isFriend but lighter version</span>

<span class="c1">-- accepts only name string</span>

<span class="c1">-- returns boolean</span>

<span class="kr">function</span> <span class="nf">isEnemy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">c</span>

    <span class="kd">local</span> <span class="n">p</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span>

        <span class="kr">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">player</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">c</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="kr">then</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">getCreatureByName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">p</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">p</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">enemyList</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">or</span>

        <span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">marks</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">or</span> <span class="n">p</span><span class="p">:</span><span class="n">getEmblem</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">getPlayerDistribution</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">friends</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kd">local</span> <span class="n">neutrals</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kd">local</span> <span class="n">enemies</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="kr">then</span>

                <span class="nb">table.insert</span><span class="p">(</span><span class="n">friends</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

            <span class="kr">elseif</span> <span class="n">isEnemy</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="kr">then</span>

                <span class="nb">table.insert</span><span class="p">(</span><span class="n">enemies</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

            <span class="kr">else</span>

                <span class="nb">table.insert</span><span class="p">(</span><span class="n">neutrals</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">friends</span><span class="p">,</span> <span class="n">neutrals</span><span class="p">,</span> <span class="n">enemies</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">getFriends</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">friends</span><span class="p">,</span> <span class="n">neutrals</span><span class="p">,</span> <span class="n">enemies</span> <span class="o">=</span> <span class="n">getPlayerDistribution</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">friends</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">getNeutrals</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">friends</span><span class="p">,</span> <span class="n">neutrals</span><span class="p">,</span> <span class="n">enemies</span> <span class="o">=</span> <span class="n">getPlayerDistribution</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">neutrals</span>

<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">getEnemies</span><span class="p">()</span>

    <span class="kd">local</span> <span class="n">friends</span><span class="p">,</span> <span class="n">neutrals</span><span class="p">,</span> <span class="n">enemies</span> <span class="o">=</span> <span class="n">getPlayerDistribution</span><span class="p">()</span>

    <span class="kr">return</span> <span class="n">enemies</span>

<span class="kr">end</span>

<span class="c1">-- based on first word in string detects if text is a offensive spell</span>

<span class="c1">-- returns boolean</span>

<span class="kr">function</span> <span class="nf">isAttSpell</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">string</span><span class="p">.</span><span class="n">starts</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s2">&quot;exori&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">string</span><span class="p">.</span><span class="n">starts</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s2">&quot;exevo&quot;</span><span class="p">)</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- returns dressed-up item id based on not dressed id</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getActiveItemId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">id</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3049</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3086</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3050</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3087</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3051</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3088</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3052</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3089</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3053</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3090</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3091</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3094</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3092</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3095</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3093</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3096</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3097</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3099</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3098</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3100</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">16114</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">16264</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">23531</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">23532</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">23533</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">23534</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">23544</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">23528</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">23529</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">23530</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">30343</span> <span class="kr">then</span> <span class="c1">-- Sleep Shawl</span>

        <span class="kr">return</span> <span class="mi">30342</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">30344</span> <span class="kr">then</span> <span class="c1">-- Enchanted Pendulet</span>

        <span class="kr">return</span> <span class="mi">30345</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">30403</span> <span class="kr">then</span> <span class="c1">-- Enchanted Theurgic Amulet</span>

        <span class="kr">return</span> <span class="mi">30402</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">31621</span> <span class="kr">then</span> <span class="c1">-- Blister Ring</span>

        <span class="kr">return</span> <span class="mi">31616</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">32621</span> <span class="kr">then</span> <span class="c1">-- Ring of Souls</span>

        <span class="kr">return</span> <span class="mi">32635</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="n">id</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- returns not dressed item id based on dressed-up id</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getInactiveItemId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">id</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3086</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3049</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3087</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3050</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3088</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3051</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3089</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3052</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3090</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3053</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3094</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3091</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3095</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3092</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3096</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3093</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3099</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3097</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">3100</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">3098</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">16264</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">16114</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">23532</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">23531</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">23534</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">23533</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">23530</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="mi">23529</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">30342</span> <span class="kr">then</span> <span class="c1">-- Sleep Shawl</span>

        <span class="kr">return</span> <span class="mi">30343</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">30345</span> <span class="kr">then</span> <span class="c1">-- Enchanted Pendulet</span>

        <span class="kr">return</span> <span class="mi">30344</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">30402</span> <span class="kr">then</span> <span class="c1">-- Enchanted Theurgic Amulet</span>

        <span class="kr">return</span> <span class="mi">30403</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">31616</span> <span class="kr">then</span> <span class="c1">-- Blister Ring</span>

        <span class="kr">return</span> <span class="mi">31621</span>

    <span class="kr">elseif</span> <span class="n">id</span> <span class="o">==</span> <span class="mi">32635</span> <span class="kr">then</span> <span class="c1">-- Ring of Souls</span>

        <span class="kr">return</span> <span class="mi">32621</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="n">id</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- returns amount of monsters within the range of position</span>

<span class="c1">-- does not include summons (new tibia)</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getMonstersInRange</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">range</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">pos</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">range</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">monsters</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isMonster</span><span class="p">()</span> <span class="ow">and</span>

            <span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">960</span> <span class="ow">or</span> <span class="n">spec</span><span class="p">:</span><span class="n">getType</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span>

            <span class="n">getDistanceBetween</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">range</span> <span class="kr">then</span>

            <span class="n">monsters</span> <span class="o">=</span> <span class="n">monsters</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">monsters</span>

<span class="kr">end</span>

<span class="c1">-- shortcut in calculating distance from local player position</span>

<span class="c1">-- needs only one argument</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">distanceFromPlayer</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">coords</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">getDistanceBetween</span><span class="p">(</span><span class="n">pos</span><span class="p">(),</span> <span class="n">coords</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- returns amount of monsters within the range of local player position</span>

<span class="c1">-- does not include summons (new tibia)</span>

<span class="c1">-- can also check multiple floors</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getMonsters</span><span class="p">(</span><span class="n">range</span><span class="p">,</span> <span class="n">multifloor</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">range</span> <span class="kr">then</span> <span class="n">range</span> <span class="o">=</span> <span class="mi">10</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">mobs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">multifloor</span><span class="p">))</span> <span class="kr">do</span>

        <span class="n">mobs</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">960</span> <span class="ow">or</span> <span class="n">spec</span><span class="p">:</span><span class="n">getType</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span>

                   <span class="n">spec</span><span class="p">:</span><span class="n">isMonster</span><span class="p">()</span> <span class="ow">and</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span>

                   <span class="n">range</span> <span class="ow">and</span> <span class="n">mobs</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">mobs</span><span class="p">;</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">mobs</span><span class="p">;</span>

<span class="kr">end</span>

<span class="c1">-- returns amount of players within the range of local player position</span>

<span class="c1">-- does not include party members</span>

<span class="c1">-- can also check multiple floors</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getPlayers</span><span class="p">(</span><span class="n">range</span><span class="p">,</span> <span class="n">multifloor</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">range</span> <span class="kr">then</span> <span class="n">range</span> <span class="o">=</span> <span class="mi">10</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">specs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">multifloor</span><span class="p">))</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">range</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">((</span><span class="n">spec</span><span class="p">:</span><span class="n">getShield</span><span class="p">()</span> <span class="o">~=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPartyMember</span><span class="p">())</span> <span class="ow">or</span> <span class="n">spec</span><span class="p">:</span><span class="n">getEmblem</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="kr">then</span>

            <span class="n">specs</span> <span class="o">=</span> <span class="n">specs</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">specs</span><span class="p">;</span>

<span class="kr">end</span>

<span class="c1">-- this is multifloor function</span>

<span class="c1">-- checks if player added in &quot;Anti RS list&quot; in player list is within the given range</span>

<span class="c1">-- returns boolean</span>

<span class="kr">function</span> <span class="nf">isBlackListedPlayerInRange</span><span class="p">(</span><span class="n">range</span><span class="p">)</span>

    <span class="kr">if</span> <span class="o">#</span><span class="n">storage</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">blackList</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">range</span> <span class="kr">then</span> <span class="n">range</span> <span class="o">=</span> <span class="mi">10</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">specPos</span> <span class="o">=</span> <span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

        <span class="kd">local</span> <span class="n">pPos</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="nb">math.abs</span><span class="p">(</span><span class="n">specPos</span><span class="p">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">pPos</span><span class="p">.</span><span class="n">z</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="kr">then</span>

                <span class="kr">if</span> <span class="n">specPos</span><span class="p">.</span><span class="n">z</span> <span class="o">~=</span> <span class="n">pPos</span><span class="p">.</span><span class="n">z</span> <span class="kr">then</span> <span class="n">specPos</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">pPos</span><span class="p">.</span><span class="n">z</span> <span class="kr">end</span>

                <span class="kr">if</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">specPos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">range</span> <span class="kr">then</span>

                    <span class="kr">if</span> <span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">storage</span><span class="p">.</span><span class="n">playerList</span><span class="p">.</span><span class="n">blackList</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="kr">then</span>

                        <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">found</span>

<span class="kr">end</span>

<span class="c1">-- checks if there is non-friend player withing the range</span>

<span class="c1">-- padding is only for multifloor</span>

<span class="c1">-- returns boolean</span>

<span class="kr">function</span> <span class="nf">isSafe</span><span class="p">(</span><span class="n">range</span><span class="p">,</span> <span class="n">multifloor</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">onSame</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">local</span> <span class="n">onAnother</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">multifloor</span> <span class="ow">and</span> <span class="n">padding</span> <span class="kr">then</span>

        <span class="n">multifloor</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="n">padding</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="kr">end</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">multifloor</span><span class="p">))</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="ow">and</span>

            <span class="ow">not</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="kr">then</span>

            <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span> <span class="o">==</span> <span class="n">posz</span><span class="p">()</span> <span class="ow">and</span>

                <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">range</span> <span class="kr">then</span>

                <span class="n">onSame</span> <span class="o">=</span> <span class="n">onSame</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="kr">end</span>

            <span class="kr">if</span> <span class="n">multifloor</span> <span class="ow">and</span> <span class="n">padding</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">().</span><span class="n">z</span> <span class="o">~=</span> <span class="n">posz</span><span class="p">()</span> <span class="ow">and</span>

                <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">range</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)</span> <span class="kr">then</span>

                <span class="n">onAnother</span> <span class="o">=</span> <span class="n">onAnother</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">onSame</span> <span class="o">+</span> <span class="n">onAnother</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">true</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- returns amount of players within the range of local player position</span>

<span class="c1">-- can also check multiple floors</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getAllPlayers</span><span class="p">(</span><span class="n">range</span><span class="p">,</span> <span class="n">multifloor</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">range</span> <span class="kr">then</span> <span class="n">range</span> <span class="o">=</span> <span class="mi">10</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">specs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">multifloor</span><span class="p">))</span> <span class="kr">do</span>

        <span class="n">specs</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span><span class="n">isLocalPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span>

                    <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">range</span> <span class="ow">and</span> <span class="n">specs</span> <span class="o">+</span>

                    <span class="mi">1</span> <span class="ow">or</span> <span class="n">specs</span><span class="p">;</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">specs</span><span class="p">;</span>

<span class="kr">end</span>

<span class="c1">-- returns amount of NPC&#39;s within the range of local player position</span>

<span class="c1">-- can also check multiple floors</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getNpcs</span><span class="p">(</span><span class="n">range</span><span class="p">,</span> <span class="n">multifloor</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">range</span> <span class="kr">then</span> <span class="n">range</span> <span class="o">=</span> <span class="mi">10</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">npcs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">multifloor</span><span class="p">))</span> <span class="kr">do</span>

        <span class="n">npcs</span> <span class="o">=</span>

            <span class="n">spec</span><span class="p">:</span><span class="n">isNpc</span><span class="p">()</span> <span class="ow">and</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">range</span> <span class="ow">and</span>

                <span class="n">npcs</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">npcs</span><span class="p">;</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">npcs</span><span class="p">;</span>

<span class="kr">end</span>

<span class="c1">-- main function for calculatin item amount in all visible containers</span>

<span class="c1">-- also considers equipped items</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">itemAmount</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">return</span> <span class="n">player</span><span class="p">:</span><span class="n">getItemsCount</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- self explanatory</span>

<span class="c1">-- a is item to use on</span>

<span class="c1">-- b is item to use a on</span>

<span class="kr">function</span> <span class="nf">useOnInvertoryItem</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">findItem</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">item</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- pos can be tile or position</span>

<span class="c1">-- returns table of tiles surrounding given POS/tile</span>

<span class="kr">function</span> <span class="nf">getNearTiles</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;table&quot;</span> <span class="kr">then</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">tiles</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="kd">local</span> <span class="n">dirs</span> <span class="o">=</span> <span class="p">{</span>

        <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>

<span class="p">}</span>

    <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">dirs</span> <span class="kr">do</span>

        <span class="kd">local</span> <span class="n">tile</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getTile</span><span class="p">({</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">dirs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>

            <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">dirs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>

            <span class="n">z</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">z</span>

<span class="p">})</span>

        <span class="kr">if</span> <span class="n">tile</span> <span class="kr">then</span> <span class="nb">table.insert</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">tile</span><span class="p">)</span> <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">tiles</span>

<span class="kr">end</span>

<span class="c1">-- self explanatory</span>

<span class="c1">-- use along with delay, it will only call action</span>

<span class="kr">function</span> <span class="nf">useGroundItem</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">id</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">dest</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

        <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

                <span class="n">dest</span> <span class="o">=</span> <span class="n">item</span>

                <span class="kr">break</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">dest</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">use</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- self explanatory</span>

<span class="c1">-- use along with delay, it will only call action</span>

<span class="kr">function</span> <span class="nf">reachGroundItem</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">id</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">dest</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

        <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kd">local</span> <span class="n">iPos</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span>

            <span class="kd">local</span> <span class="n">iId</span> <span class="o">=</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span>

            <span class="kr">if</span> <span class="n">iId</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

                <span class="kr">if</span> <span class="n">findPath</span><span class="p">(</span><span class="n">pos</span><span class="p">(),</span> <span class="n">iPos</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span>

                            <span class="p">{</span><span class="n">ignoreNonPathable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mi">1</span><span class="p">})</span> <span class="kr">then</span>

                    <span class="n">dest</span> <span class="o">=</span> <span class="n">item</span>

                    <span class="kr">break</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">dest</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">autoWalk</span><span class="p">(</span><span class="n">iPos</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">{</span><span class="n">ignoreNonPathable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mi">1</span><span class="p">})</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- self explanatory</span>

<span class="c1">-- returns object</span>

<span class="kr">function</span> <span class="nf">findItemOnGround</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

        <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">item</span> <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- self explanatory</span>

<span class="c1">-- use along with delay, it will only call action</span>

<span class="kr">function</span> <span class="nf">useOnGroundItem</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">b</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">findItem</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">item</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">false</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">dest</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

        <span class="kr">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">item</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="kr">then</span>

                <span class="n">dest</span> <span class="o">=</span> <span class="n">item</span>

                <span class="kr">break</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">dest</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">useWith</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- returns target creature</span>

<span class="kr">function</span> <span class="nf">target</span><span class="p">()</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">g_game</span><span class="p">.</span><span class="n">isAttacking</span><span class="p">()</span> <span class="kr">then</span>

        <span class="kr">return</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="n">g_game</span><span class="p">.</span><span class="n">getAttackingCreature</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- returns target creature</span>

<span class="kr">function</span> <span class="nf">getTarget</span><span class="p">()</span> <span class="kr">return</span> <span class="n">target</span><span class="p">()</span> <span class="kr">end</span>

<span class="c1">-- dist is boolean</span>

<span class="c1">-- returns target position/distance from player</span>

<span class="kr">function</span> <span class="nf">targetPos</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">g_game</span><span class="p">.</span><span class="n">isAttacking</span><span class="p">()</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">dist</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">target</span><span class="p">():</span><span class="n">getPosition</span><span class="p">())</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="n">target</span><span class="p">():</span><span class="n">getPosition</span><span class="p">()</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- for gunzodus/ezodus only</span>

<span class="c1">-- it will reopen loot bag, necessary for depositer</span>

<span class="kr">function</span> <span class="nf">reopenPurse</span><span class="p">()</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">c</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;loot bag&quot;</span> <span class="ow">or</span> <span class="n">c</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span>

            <span class="s2">&quot;store inbox&quot;</span> <span class="kr">then</span> <span class="n">g_game</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="n">g_game</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getLocalPlayer</span><span class="p">():</span><span class="n">getInventoryItem</span><span class="p">(</span><span class="n">InventorySlotPurse</span><span class="p">))</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="n">schedule</span><span class="p">(</span><span class="mi">1400</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

        <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

            <span class="kr">if</span> <span class="n">c</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;store inbox&quot;</span> <span class="kr">then</span>

                <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">i</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">c</span><span class="p">:</span><span class="n">getItems</span><span class="p">())</span> <span class="kr">do</span>

                    <span class="kr">if</span> <span class="n">i</span><span class="p">:</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="mi">23721</span> <span class="kr">then</span>

                        <span class="n">g_game</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span><span class="p">)</span>

    <span class="kr">return</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">)</span>

<span class="kr">end</span>

<span class="c1">-- getSpectator patterns</span>

<span class="c1">-- param1 - pos/creature</span>

<span class="c1">-- param2 - pattern</span>

<span class="c1">-- param3 - type of return</span>

<span class="c1">-- 1 - everyone, 2 - monsters, 3 - players</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getCreaturesInArea</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">,</span> <span class="n">param3</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">specs</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">local</span> <span class="n">monsters</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">local</span> <span class="n">players</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getSpectators</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">))</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">spec</span> <span class="o">~=</span> <span class="n">player</span> <span class="kr">then</span>

            <span class="n">specs</span> <span class="o">=</span> <span class="n">specs</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="kr">if</span> <span class="n">spec</span><span class="p">:</span><span class="n">isMonster</span><span class="p">()</span> <span class="ow">and</span>

                <span class="p">(</span><span class="n">g_game</span><span class="p">.</span><span class="n">getClientVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">960</span> <span class="ow">or</span> <span class="n">spec</span><span class="p">:</span><span class="n">getType</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="kr">then</span>

                <span class="n">monsters</span> <span class="o">=</span> <span class="n">monsters</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="kr">elseif</span> <span class="n">spec</span><span class="p">:</span><span class="n">isPlayer</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isFriend</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span><span class="n">getName</span><span class="p">())</span> <span class="kr">then</span>

                <span class="n">players</span> <span class="o">=</span> <span class="n">players</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">if</span> <span class="n">param3</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">specs</span>

    <span class="kr">elseif</span> <span class="n">param3</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">monsters</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="n">players</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- can be improved</span>

<span class="c1">-- TODO in future</span>

<span class="c1">-- uses getCreaturesInArea, specType</span>

<span class="c1">-- returns number</span>

<span class="kr">function</span> <span class="nf">getBestTileByPatern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">specType</span><span class="p">,</span> <span class="n">maxDist</span><span class="p">,</span> <span class="n">safe</span><span class="p">)</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">pattern</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">specType</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">maxDist</span> <span class="kr">then</span> <span class="n">maxDist</span> <span class="o">=</span> <span class="mi">4</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">bestTile</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kd">local</span> <span class="n">best</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tile</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">g_map</span><span class="p">.</span><span class="n">getTiles</span><span class="p">(</span><span class="n">posz</span><span class="p">()))</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">distanceFromPlayer</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">maxDist</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">minimapColor</span> <span class="o">=</span> <span class="n">g_map</span><span class="p">.</span><span class="n">getMinimapColor</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

            <span class="kd">local</span> <span class="n">stairs</span> <span class="o">=</span> <span class="p">(</span><span class="n">minimapColor</span> <span class="o">&gt;=</span> <span class="mi">210</span> <span class="ow">and</span> <span class="n">minimapColor</span> <span class="o">&lt;=</span> <span class="mi">213</span><span class="p">)</span>

            <span class="kr">if</span> <span class="n">tile</span><span class="p">:</span><span class="n">canShoot</span><span class="p">()</span> <span class="ow">and</span> <span class="n">tile</span><span class="p">:</span><span class="n">isWalkable</span><span class="p">()</span> <span class="kr">then</span>

                <span class="kr">if</span> <span class="n">getCreaturesInArea</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">specType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>

                    <span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">safe</span> <span class="ow">or</span>

                        <span class="n">getCreaturesInArea</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span> <span class="n">pattern</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="kr">then</span>

                        <span class="kd">local</span> <span class="n">candidate</span> <span class="o">=</span>

<span class="p">{</span>

                                <span class="n">pos</span> <span class="o">=</span> <span class="n">tile</span><span class="p">,</span>

                                <span class="n">count</span> <span class="o">=</span> <span class="n">getCreaturesInArea</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span>

                                                           <span class="n">pattern</span><span class="p">,</span> <span class="n">specType</span><span class="p">)</span>

<span class="p">}</span>

                        <span class="kr">if</span> <span class="ow">not</span> <span class="n">best</span> <span class="ow">or</span> <span class="n">best</span><span class="p">.</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="n">candidate</span><span class="p">.</span><span class="n">count</span> <span class="kr">then</span>

                            <span class="n">best</span> <span class="o">=</span> <span class="n">candidate</span>

                        <span class="kr">end</span>

                    <span class="kr">end</span>

                <span class="kr">end</span>

            <span class="kr">end</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="n">bestTile</span> <span class="o">=</span> <span class="n">best</span>

    <span class="kr">if</span> <span class="n">bestTile</span> <span class="kr">then</span>

        <span class="kr">return</span> <span class="n">bestTile</span>

    <span class="kr">else</span>

        <span class="kr">return</span> <span class="kc">false</span>

    <span class="kr">end</span>

<span class="kr">end</span>

<span class="c1">-- returns container object based on name</span>

<span class="kr">function</span> <span class="nf">getContainerByName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">notFull</span><span class="p">)</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;string&quot;</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">nil</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">d</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">c</span><span class="p">:</span><span class="n">getName</span><span class="p">():</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">notFull</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">containerIsFull</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="kr">then</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">c</span>

            <span class="kr">break</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">d</span>

<span class="kr">end</span>

<span class="c1">-- returns container object based on container ID</span>

<span class="kr">function</span> <span class="nf">getContainerByItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">notFull</span><span class="p">)</span>

    <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="o">~=</span> <span class="s2">&quot;number&quot;</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kc">nil</span> <span class="kr">end</span>

    <span class="kd">local</span> <span class="n">d</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">getContainers</span><span class="p">())</span> <span class="kr">do</span>

        <span class="kr">if</span> <span class="n">c</span><span class="p">:</span><span class="n">getContainerItem</span><span class="p">():</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">id</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">notFull</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">containerIsFull</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="kr">then</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">c</span>

            <span class="kr">break</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">d</span>

<span class="kr">end</span>

<span class="c1">-- [[ ready to use getSpectators patterns ]] --</span>

<span class="n">LargeUeArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    0000001000000</span>

<span class="s">    0000011100000</span>

<span class="s">    0000111110000</span>

<span class="s">    0001111111000</span>

<span class="s">    0011111111100</span>

<span class="s">    0111111111110</span>

<span class="s">    1111111111111</span>

<span class="s">    0111111111110</span>

<span class="s">    0011111111100</span>

<span class="s">    0001111111000</span>

<span class="s">    0000111110000</span>

<span class="s">    0000011100000</span>

<span class="s">    0000001000000</span>

<span class="s">]]</span>

<span class="n">NormalUeAreaMs</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    00000100000</span>

<span class="s">    00011111000</span>

<span class="s">    00111111100</span>

<span class="s">    01111111110</span>

<span class="s">    01111111110</span>

<span class="s">    11111111111</span>

<span class="s">    01111111110</span>

<span class="s">    01111111110</span>

<span class="s">    00111111100</span>

<span class="s">    00001110000</span>

<span class="s">    00000100000</span>

<span class="s">]]</span>

<span class="n">NormalUeAreaEd</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    00000100000</span>

<span class="s">    00001110000</span>

<span class="s">    00011111000</span>

<span class="s">    00111111100</span>

<span class="s">    01111111110</span>

<span class="s">    11111111111</span>

<span class="s">    01111111110</span>

<span class="s">    00111111100</span>

<span class="s">    00011111000</span>

<span class="s">    00001110000</span>

<span class="s">    00000100000</span>

<span class="s">]]</span>

<span class="n">smallUeArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    0011100</span>

<span class="s">    0111110</span>

<span class="s">    1111111</span>

<span class="s">    1111111</span>

<span class="s">    1111111</span>

<span class="s">    0111110</span>

<span class="s">    0011100</span>

<span class="s">]]</span>

<span class="n">largeRuneArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    0011100</span>

<span class="s">    0111110</span>

<span class="s">    1111111</span>

<span class="s">    1111111</span>

<span class="s">    1111111</span>

<span class="s">    0111110</span>

<span class="s">    0011100</span>

<span class="s">]]</span>

<span class="n">adjacentArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    111</span>

<span class="s">    101</span>

<span class="s">    111</span>

<span class="s">]]</span>

<span class="n">longBeamArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    0000000N0000000</span>

<span class="s">    0000000N0000000</span>

<span class="s">    0000000N0000000</span>

<span class="s">    0000000N0000000</span>

<span class="s">    0000000N0000000</span>

<span class="s">    0000000N0000000</span>

<span class="s">    0000000N0000000</span>

<span class="s">    WWWWWWW0EEEEEEE</span>

<span class="s">    0000000S0000000</span>

<span class="s">    0000000S0000000</span>

<span class="s">    0000000S0000000</span>

<span class="s">    0000000S0000000</span>

<span class="s">    0000000S0000000</span>

<span class="s">    0000000S0000000</span>

<span class="s">    0000000S0000000</span>

<span class="s">]]</span>

<span class="n">shortBeamArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    00000100000</span>

<span class="s">    00000100000</span>

<span class="s">    00000100000</span>

<span class="s">    00000100000</span>

<span class="s">    00000100000</span>

<span class="s">    EEEEE0WWWWW</span>

<span class="s">    00000S00000</span>

<span class="s">    00000S00000</span>

<span class="s">    00000S00000</span>

<span class="s">    00000S00000</span>

<span class="s">    00000S00000</span>

<span class="s">]]</span>

<span class="n">newWaveArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    000NNNNN000</span>

<span class="s">    000NNNNN000</span>

<span class="s">    0000NNN0000</span>

<span class="s">    WW00NNN00EE</span>

<span class="s">    WWWW0N0EEEE</span>

<span class="s">    WWWWW0EEEEE</span>

<span class="s">    WWWW0S0EEEE</span>

<span class="s">    WW00SSS00EE</span>

<span class="s">    0000SSS0000</span>

<span class="s">    000SSSSS000</span>

<span class="s">    000SSSSS000</span>

<span class="s">]]</span>

<span class="n">bigWaveArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    0000NNN0000</span>

<span class="s">    0000NNN0000</span>

<span class="s">    0000NNN0000</span>

<span class="s">    00000N00000</span>

<span class="s">    WWW00N00EEE</span>

<span class="s">    WWWWW0EEEEE</span>

<span class="s">    WWW00S00EEE</span>

<span class="s">    00000S00000</span>

<span class="s">    0000SSS0000</span>

<span class="s">    0000SSS0000</span>

<span class="s">    0000SSS0000</span>

<span class="s">]]</span>

<span class="n">smallWaveArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    00NNN00</span>

<span class="s">    00NNN00</span>

<span class="s">    WW0N0EE</span>

<span class="s">    WWW0EEE</span>

<span class="s">    WW0S0EE</span>

<span class="s">    00SSS00</span>

<span class="s">    00SSS00</span>

<span class="s">]]</span>

<span class="n">diamondArrowArea</span> <span class="o">=</span> <span class="s">[[</span>

<span class="s">    01110</span>

<span class="s">    11111</span>

<span class="s">    11111</span>

<span class="s">    11111</span>

<span class="s">    01110</span>

<span class="s">]]</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="xeno-menu-lua">
<h1>xeno_menu.lua<a class="headerlink" href="#xeno-menu-lua" title="Link to this heading">#</a></h1>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">modules</span><span class="p">.</span><span class="n">game_interface</span><span class="p">.</span><span class="n">gameRootPanel</span><span class="p">.</span><span class="n">onMouseRelease</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">mousePos</span><span class="p">,</span> <span class="n">mouseButton</span><span class="p">)</span>

    <span class="kr">if</span> <span class="n">mouseButton</span> <span class="o">==</span> <span class="mi">2</span> <span class="kr">then</span>

        <span class="kd">local</span> <span class="n">child</span> <span class="o">=</span> <span class="n">rootWidget</span><span class="p">:</span><span class="n">recursiveGetChildByPos</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>

        <span class="kr">if</span> <span class="n">child</span> <span class="o">==</span> <span class="n">widget</span> <span class="kr">then</span>

            <span class="kd">local</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">g_ui</span><span class="p">.</span><span class="n">createWidget</span><span class="p">(</span><span class="s1">&#39;PopupMenu&#39;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">setId</span><span class="p">(</span><span class="s2">&quot;blzMenu&quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">setGameMenu</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;AttackBot&#39;</span><span class="p">,</span> <span class="n">AttackBot</span><span class="p">.</span><span class="n">show</span><span class="p">,</span> <span class="s2">&quot;OTCv8&quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;HealBot&#39;</span><span class="p">,</span> <span class="n">HealBot</span><span class="p">.</span><span class="n">show</span><span class="p">,</span> <span class="s2">&quot;OTCv8&quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;Conditions&#39;</span><span class="p">,</span> <span class="n">Conditions</span><span class="p">.</span><span class="n">show</span><span class="p">,</span> <span class="s2">&quot;OTCv8&quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">addSeparator</span><span class="p">()</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;CaveBot&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                <span class="kr">if</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span> <span class="kr">then</span>

                    <span class="n">CaveBot</span><span class="p">.</span><span class="n">setOff</span><span class="p">()</span>

                <span class="kr">else</span>

                    <span class="n">CaveBot</span><span class="p">.</span><span class="n">setOn</span><span class="p">()</span>

                <span class="kr">end</span>

            <span class="kr">end</span><span class="p">,</span> <span class="n">CaveBot</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;ON &quot;</span> <span class="ow">or</span> <span class="s2">&quot;OFF &quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">addOption</span><span class="p">(</span><span class="s1">&#39;TargetBot&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>

                <span class="kr">if</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span> <span class="kr">then</span>

                    <span class="n">TargetBot</span><span class="p">.</span><span class="n">setOff</span><span class="p">()</span>

                <span class="kr">else</span>

                    <span class="n">TargetBot</span><span class="p">.</span><span class="n">setOn</span><span class="p">()</span>

                <span class="kr">end</span>

            <span class="kr">end</span><span class="p">,</span> <span class="n">TargetBot</span><span class="p">.</span><span class="n">isOn</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;ON &quot;</span> <span class="ow">or</span> <span class="s2">&quot;OFF &quot;</span><span class="p">)</span>

            <span class="n">menu</span><span class="p">:</span><span class="n">display</span><span class="p">(</span><span class="n">mousePos</span><span class="p">)</span>

            <span class="kr">return</span> <span class="kc">true</span>

        <span class="kr">end</span>

    <span class="kr">end</span>

<span class="kr">end</span>
</pre></div>
</div>
<hr class="docutils" />
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Moduł: | Moduł: <code class="docutils literal notranslate"><span class="pre">game_bot/default_configs/vBot_4.8/vBot</span></code></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#attackbot-otui">AttackBot.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#botserver-lua">BotServer.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#botserver-otui">BotServer.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#conditions-lua">Conditions.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#conditions-otui">Conditions.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#containers-lua">Containers.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dropper-lua">Dropper.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#equipper-lua">Equipper.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#healbot-lua">HealBot.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#healbot-otui">HealBot.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sio-lua">Sio.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#alarms-lua">alarms.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#alarms-otui">alarms.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzer-lua">analyzer.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzer-otui">analyzer.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#antirs-lua">antiRs.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cast-food-lua">cast_food.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cavebot-lua">cavebot.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cavebot-control-panel-lua">cavebot_control_panel.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#combo-lua">combo.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#combo-otui">combo.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#configs-lua">configs.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#depositer-config-lua">depositer_config.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#depositer-config-otui">depositer_config.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#depot-withdraw-lua">depot_withdraw.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eat-food-lua">eat_food.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#equip-lua">equip.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#equipper-otui">equipper.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exeta-lua">exeta.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#extras-lua">extras.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#extras-otui">extras.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#hold-target-lua">hold_target.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#ingame-editor-lua">ingame_editor.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#items-lua">items.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#main-lua">main.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#new-cavebot-lib-lua">new_cavebot_lib.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#new-healer-lua">new_healer.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#new-healer-otui">new_healer.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#npc-talk-lua">npc_talk.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#playerlist-lua">playerlist.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#playerlist-otui">playerlist.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pushmax-lua">pushmax.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pushmax-otui">pushmax.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quiver-label-lua">quiver_label.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quiver-manager-lua">quiver_manager.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#siolist-otui">siolist.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#spy-level-lua">spy_level.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#supplies-lua">supplies.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#supplies-otui">supplies.otui</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tools-lua">tools.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#version-txt">version.txt</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vlib-lua">vlib.lua</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#xeno-menu-lua">xeno_menu.lua</a></li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>Ta strona</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/modules/structured/bot_tools/modul-game-bot-default-configs-vbot-4.8-vbot.md.txt"
            rel="nofollow">Pokaż źródło</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>